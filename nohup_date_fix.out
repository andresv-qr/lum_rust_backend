nohup: ignoring input
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.31s
     Running `target/debug/lum_rust_ws`
[2m2025-10-12T01:56:00.570965Z[0m [32m INFO[0m [2mlum_rust_ws::monitoring[0m[2m:[0m üîç Monitoring system initialized
[2m2025-10-12T01:56:00.571067Z[0m [32m INFO[0m [2mlum_rust_ws[0m[2m:[0m üîç Monitoring system initialized
[2m2025-10-12T01:56:00.571118Z[0m [32m INFO[0m [2mlum_rust_ws::optimization[0m[2m:[0m üîß Creating optimized database pool with 50 max connections
[2m2025-10-12T01:56:01.200253Z[0m [32m INFO[0m [2mlum_rust_ws::optimization[0m[2m:[0m ‚úÖ Database pool created successfully
[2m2025-10-12T01:56:01.200338Z[0m [32m INFO[0m [2mlum_rust_ws::optimization[0m[2m:[0m üîß Creating optimized Redis client
[2m2025-10-12T01:56:01.200443Z[0m [32m INFO[0m [2mlum_rust_ws::optimization[0m[2m:[0m ‚úÖ Redis client created successfully
[2m2025-10-12T01:56:01.251133Z[0m [32m INFO[0m [2mlum_rust_ws::domains::qr::service[0m[2m:[0m üöÄ Initializing optimized hybrid QR service (2-level cascade)
[2m2025-10-12T01:56:01.251178Z[0m [32m INFO[0m [2mlum_rust_ws::domains::qr::service[0m[2m:[0m üìä Expected performance: 85% success with Rust (5-15ms), 12% with Python fallback (30-50ms)
[2m2025-10-12T01:56:01.251269Z[0m [32m INFO[0m [2mlum_rust_ws::shared::performance[0m[2m:[0m üöÄ Initializing PerformanceManager with advanced configuration
[2m2025-10-12T01:56:01.251289Z[0m [32m INFO[0m [2mlum_rust_ws::shared::performance[0m[2m:[0m üìä QR Detection: 50 max concurrent
[2m2025-10-12T01:56:01.251297Z[0m [32m INFO[0m [2mlum_rust_ws::shared::performance[0m[2m:[0m üìä OCR Processing: 20 max concurrent
[2m2025-10-12T01:56:01.251307Z[0m [32m INFO[0m [2mlum_rust_ws::shared::performance[0m[2m:[0m üìä Webhook Processing: 100 max concurrent
[2m2025-10-12T01:56:01.251320Z[0m [32m INFO[0m [2mlum_rust_ws::shared::performance[0m[2m:[0m üìä API Requests: 200 max concurrent
[2m2025-10-12T01:56:01.251450Z[0m [32m INFO[0m [2mlum_rust_ws::webhook::deduplication[0m[2m:[0m üîÑ MessageDeduplicator initialized with TTL: 300s, max_entries: 10000
[2m2025-10-12T01:56:01.251490Z[0m [32m INFO[0m [2mlum_rust_ws::shared::performance[0m[2m:[0m üî• Starting performance warm-up process...
[2m2025-10-12T01:56:01.252762Z[0m [32m INFO[0m [2mlum_rust_ws::shared::performance[0m[2m:[0m ‚úÖ Database connection verified
[2m2025-10-12T01:56:01.253195Z[0m [32m INFO[0m [2mlum_rust_ws::shared::performance[0m[2m:[0m ‚úÖ Redis connection verified
[2m2025-10-12T01:56:01.253274Z[0m [32m INFO[0m [2mlum_rust_ws::shared::performance[0m[2m:[0m üî• Performance warm-up completed
[2m2025-10-12T01:56:01.253307Z[0m [32m INFO[0m [2mlum_rust_ws[0m[2m:[0m üöÄ Application state initialized with optimized configuration
[2m2025-10-12T01:56:01.253355Z[0m [32m INFO[0m [2mlum_rust_ws::domains::qr::rust_qreader[0m[2m:[0m üîß Initializing RustQReader with ONNX: "models/qreader_detector_small.onnx"
[2m2025-10-12T01:56:01.266728Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Session Options {  execution_mode:0 execution_order:DEFAULT enable_profiling:0 optimized_model_filepath:"" enable_mem_pattern:1 enable_mem_reuse:1 enable_cpu_mem_arena:1 profile_file_prefix:onnxruntime_profile_ session_logid: session_log_severity_level:-1 session_log_verbosity_level:0 max_num_graph_transformation_steps:10 graph_optimization_level:3 intra_op_param:OrtThreadPoolParams { thread_pool_size: 0 auto_set_affinity: 0 allow_spinning: 1 dynamic_block_base_: 0 stack_size: 0 affinity_str:  set_denormal_as_zero: 0 } inter_op_param:OrtThreadPoolParams { thread_pool_size: 0 auto_set_affinity: 0 allow_spinning: 1 dynamic_block_base_: 0 stack_size: 0 affinity_str:  set_denormal_as_zero: 0 } use_per_session_threads:1 thread_pool_allow_spinning:1 use_deterministic_compute:0 ep_selection_policy:0 config_options: {  } }
[2m2025-10-12T01:56:01.266807Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Flush-to-zero and denormal-as-zero are off
[2m2025-10-12T01:56:01.266838Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Creating and using per session threadpools since use_per_session_threads_ is true
[2m2025-10-12T01:56:01.266853Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Dynamic block base set to 0
[2m2025-10-12T01:56:01.323331Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Initializing session.
[2m2025-10-12T01:56:01.323430Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Adding default CPU execution provider.
[2m2025-10-12T01:56:01.323471Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Creating BFCArena for Cpu with following configs: initial_chunk_size_bytes: 1048576 max_dead_bytes_per_chunk: 134217728 initial_growth_chunk_size_bytes: 2097152 max_power_of_two_extend_bytes: 1073741824 memory limit: 18446744073709551615 arena_extend_strategy: 0
[2m2025-10-12T01:56:01.326485Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m This model does not have any local functions defined. AOT Inlining is not performed
[2m2025-10-12T01:56:01.326682Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer EnsureUniqueDQForNodeUnit modified: 0 with status: OK
[2m2025-10-12T01:56:01.326903Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer Level1_RuleBasedTransformer modified: 1 with status: OK
[2m2025-10-12T01:56:01.328837Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer '/model.22/Constant_61_output_0'. It is no longer used by any node.
[2m2025-10-12T01:56:01.328885Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer '/model.18/Constant_4_output_0'. It is no longer used by any node.
[2m2025-10-12T01:56:01.328898Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer '/model.12/Constant_4_output_0'. It is no longer used by any node.
[2m2025-10-12T01:56:01.328910Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer '/model.4/Constant_4_output_0'. It is no longer used by any node.
[2m2025-10-12T01:56:01.328929Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer '/model.2/Constant_4_output_0'. It is no longer used by any node.
[2m2025-10-12T01:56:01.328941Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer '/model.6/Constant_4_output_0'. It is no longer used by any node.
[2m2025-10-12T01:56:01.328953Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer '/model.8/Constant_4_output_0'. It is no longer used by any node.
[2m2025-10-12T01:56:01.328964Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer '/model.15/Constant_4_output_0'. It is no longer used by any node.
[2m2025-10-12T01:56:01.328975Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer '/model.21/Constant_4_output_0'. It is no longer used by any node.
[2m2025-10-12T01:56:01.329126Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer DoubleQDQPairsRemover modified: 0 with status: OK
[2m2025-10-12T01:56:01.329452Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Total shared scalar initializer count: 92
[2m2025-10-12T01:56:01.329483Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer ConstantSharing modified: 1 with status: OK
[2m2025-10-12T01:56:01.331764Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer CommonSubexpressionElimination modified: 1 with status: OK
[2m2025-10-12T01:56:01.333803Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer ConstantFolding modified: 1 with status: OK
[2m2025-10-12T01:56:01.335624Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer '/model.22/Split_output_0'. It is no longer used by any node.
[2m2025-10-12T01:56:01.335683Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer '/model.22/Split_output_1'. It is no longer used by any node.
[2m2025-10-12T01:56:01.335704Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer '/model.22/Constant_14_output_0'. It is no longer used by any node.
[2m2025-10-12T01:56:01.335717Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer '/model.22/Split_output_2'. It is no longer used by any node.
[2m2025-10-12T01:56:01.335879Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer MatMulAddFusion modified: 0 with status: OK
[2m2025-10-12T01:56:01.335993Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Fused reshape node: /model.22/dfl/Reshape_output_0
[2m2025-10-12T01:56:01.336024Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Fused reshape node: /model.22/Reshape_18_output_0
[2m2025-10-12T01:56:01.336038Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Fused reshape node: /model.22/Reshape_19_output_0
[2m2025-10-12T01:56:01.336050Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Fused reshape node: /model.22/Reshape_13_output_0
[2m2025-10-12T01:56:01.336063Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Fused reshape node: /model.22/Reshape_14_output_0
[2m2025-10-12T01:56:01.336074Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Fused reshape node: /model.22/Reshape_8_output_0
[2m2025-10-12T01:56:01.336087Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Fused reshape node: /model.22/Reshape_9_output_0
[2m2025-10-12T01:56:01.336099Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Total fused reshape node count: 7
[2m2025-10-12T01:56:01.336109Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer ReshapeFusion modified: 1 with status: OK
[2m2025-10-12T01:56:01.337795Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer '/model.22/dfl/Constant_3_output_0'. It is no longer used by any node.
[2m2025-10-12T01:56:01.337879Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer FreeDimensionOverrideTransformer modified: 0 with status: OK
[2m2025-10-12T01:56:01.337904Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer GeluFusionL1 modified: 0 with status: OK
[2m2025-10-12T01:56:01.337915Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer LayerNormFusionL1 modified: 0 with status: OK
[2m2025-10-12T01:56:01.338034Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer QDQPropagationTransformer modified: 0 with status: OK
[2m2025-10-12T01:56:01.338154Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer WeightBiasQuantization modified: 0 with status: OK
[2m2025-10-12T01:56:01.338251Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer EnsureUniqueDQForNodeUnit modified: 0 with status: OK
[2m2025-10-12T01:56:01.338341Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer RocmBlasAltImpl modified: 0 with status: OK
[2m2025-10-12T01:56:01.338835Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer TransposeOptimizer modified: 0 with status: OK
[2m2025-10-12T01:56:01.339003Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer Level1_RuleBasedTransformer modified: 0 with status: OK
[2m2025-10-12T01:56:01.339099Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer DoubleQDQPairsRemover modified: 0 with status: OK
[2m2025-10-12T01:56:01.339459Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer CommonSubexpressionElimination modified: 0 with status: OK
[2m2025-10-12T01:56:01.339668Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer ConstantFolding modified: 0 with status: OK
[2m2025-10-12T01:56:01.339770Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer MatMulAddFusion modified: 0 with status: OK
[2m2025-10-12T01:56:01.339873Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer ReshapeFusion modified: 0 with status: OK
[2m2025-10-12T01:56:01.339898Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer FreeDimensionOverrideTransformer modified: 0 with status: OK
[2m2025-10-12T01:56:01.339908Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer GeluFusionL1 modified: 0 with status: OK
[2m2025-10-12T01:56:01.339919Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer LayerNormFusionL1 modified: 0 with status: OK
[2m2025-10-12T01:56:01.340027Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer QDQPropagationTransformer modified: 0 with status: OK
[2m2025-10-12T01:56:01.340162Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer WeightBiasQuantization modified: 0 with status: OK
[2m2025-10-12T01:56:01.340259Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer EnsureUniqueDQForNodeUnit modified: 0 with status: OK
[2m2025-10-12T01:56:01.340350Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer RocmBlasAltImpl modified: 0 with status: OK
[2m2025-10-12T01:56:01.341058Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer Level2_RuleBasedTransformer modified: 0 with status: OK
[2m2025-10-12T01:56:01.341418Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer TransposeOptimizer_CPUExecutionProvider modified: 0 with status: OK
[2m2025-10-12T01:56:01.341522Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer QDQS8ToU8Transformer modified: 0 with status: OK
[2m2025-10-12T01:56:01.341759Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer QDQSelectorActionTransformer modified: 0 with status: OK
[2m2025-10-12T01:56:01.341860Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer GemmActivationFusion modified: 0 with status: OK
[2m2025-10-12T01:56:01.341968Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer MatMulIntegerToFloatFusion modified: 0 with status: OK
[2m2025-10-12T01:56:01.342059Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer DynamicQuantizeMatMulFusion modified: 0 with status: OK
[2m2025-10-12T01:56:01.342183Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer ConvActivationFusion modified: 0 with status: OK
[2m2025-10-12T01:56:01.342279Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer GeluFusionL2 modified: 0 with status: OK
[2m2025-10-12T01:56:01.342371Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer LayerNormFusionL2 modified: 0 with status: OK
[2m2025-10-12T01:56:01.342463Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer SimplifiedLayerNormFusion modified: 0 with status: OK
[2m2025-10-12T01:56:01.342552Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer AttentionFusion modified: 0 with status: OK
[2m2025-10-12T01:56:01.342679Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer EmbedLayerNormFusion modified: 0 with status: OK
[2m2025-10-12T01:56:01.342709Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer GatherSliceToSplitFusion modified: 0 with status: OK
[2m2025-10-12T01:56:01.342792Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer GatherToSliceFusion modified: 0 with status: OK
[2m2025-10-12T01:56:01.342887Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer MatmulTransposeFusion modified: 0 with status: OK
[2m2025-10-12T01:56:01.342987Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer BiasGeluFusion modified: 0 with status: OK
[2m2025-10-12T01:56:01.343073Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer GroupQueryAttentionFusion modified: 0 with status: OK
[2m2025-10-12T01:56:01.343164Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer SkipLayerNormFusion modified: 0 with status: OK
[2m2025-10-12T01:56:01.343272Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer FastGeluFusion modified: 0 with status: OK
[2m2025-10-12T01:56:01.343571Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer QuickGeluFusion modified: 1 with status: OK
[2m2025-10-12T01:56:01.345429Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer BiasSoftmaxFusion modified: 0 with status: OK
[2m2025-10-12T01:56:01.345538Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer BiasDropoutFusion modified: 0 with status: OK
[2m2025-10-12T01:56:01.345676Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer MatMulScaleFusion modified: 0 with status: OK
[2m2025-10-12T01:56:01.345796Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer MatMulActivationFusion modified: 0 with status: OK
[2m2025-10-12T01:56:01.345951Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer MatMulNBitsFusion modified: 0 with status: OK
[2m2025-10-12T01:56:01.346049Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer QDQFinalCleanupTransformer modified: 0 with status: OK
[2m2025-10-12T01:56:01.346134Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer Level2_RuleBasedTransformer modified: 0 with status: OK
[2m2025-10-12T01:56:01.346220Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer QDQS8ToU8Transformer modified: 0 with status: OK
[2m2025-10-12T01:56:01.346386Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer QDQSelectorActionTransformer modified: 0 with status: OK
[2m2025-10-12T01:56:01.346468Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer GemmActivationFusion modified: 0 with status: OK
[2m2025-10-12T01:56:01.346555Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer MatMulIntegerToFloatFusion modified: 0 with status: OK
[2m2025-10-12T01:56:01.346669Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer DynamicQuantizeMatMulFusion modified: 0 with status: OK
[2m2025-10-12T01:56:01.346811Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer ConvActivationFusion modified: 0 with status: OK
[2m2025-10-12T01:56:01.346896Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer GeluFusionL2 modified: 0 with status: OK
[2m2025-10-12T01:56:01.346976Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer LayerNormFusionL2 modified: 0 with status: OK
[2m2025-10-12T01:56:01.347055Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer SimplifiedLayerNormFusion modified: 0 with status: OK
[2m2025-10-12T01:56:01.347134Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer AttentionFusion modified: 0 with status: OK
[2m2025-10-12T01:56:01.347206Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer EmbedLayerNormFusion modified: 0 with status: OK
[2m2025-10-12T01:56:01.347228Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer GatherSliceToSplitFusion modified: 0 with status: OK
[2m2025-10-12T01:56:01.347295Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer GatherToSliceFusion modified: 0 with status: OK
[2m2025-10-12T01:56:01.347419Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer MatmulTransposeFusion modified: 0 with status: OK
[2m2025-10-12T01:56:01.347543Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer BiasGeluFusion modified: 0 with status: OK
[2m2025-10-12T01:56:01.347683Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer GroupQueryAttentionFusion modified: 0 with status: OK
[2m2025-10-12T01:56:01.347780Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer SkipLayerNormFusion modified: 0 with status: OK
[2m2025-10-12T01:56:01.347870Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer FastGeluFusion modified: 0 with status: OK
[2m2025-10-12T01:56:01.347960Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer QuickGeluFusion modified: 0 with status: OK
[2m2025-10-12T01:56:01.348047Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer BiasSoftmaxFusion modified: 0 with status: OK
[2m2025-10-12T01:56:01.348126Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer BiasDropoutFusion modified: 0 with status: OK
[2m2025-10-12T01:56:01.348218Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer MatMulScaleFusion modified: 0 with status: OK
[2m2025-10-12T01:56:01.348296Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer MatMulActivationFusion modified: 0 with status: OK
[2m2025-10-12T01:56:01.348398Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer MatMulNBitsFusion modified: 0 with status: OK
[2m2025-10-12T01:56:01.348518Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer QDQFinalCleanupTransformer modified: 0 with status: OK
[2m2025-10-12T01:56:01.414097Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer NchwcTransformer modified: 1 with status: OK
[2m2025-10-12T01:56:01.418004Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1144'. It is no longer used by any node.
[2m2025-10-12T01:56:01.418056Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1210'. It is no longer used by any node.
[2m2025-10-12T01:56:01.418070Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1198'. It is no longer used by any node.
[2m2025-10-12T01:56:01.418082Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1207'. It is no longer used by any node.
[2m2025-10-12T01:56:01.418091Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1258'. It is no longer used by any node.
[2m2025-10-12T01:56:01.418101Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1228'. It is no longer used by any node.
[2m2025-10-12T01:56:01.418112Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1168'. It is no longer used by any node.
[2m2025-10-12T01:56:01.418122Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1156'. It is no longer used by any node.
[2m2025-10-12T01:56:01.418134Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1141'. It is no longer used by any node.
[2m2025-10-12T01:56:01.418145Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1132'. It is no longer used by any node.
[2m2025-10-12T01:56:01.418156Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1138'. It is no longer used by any node.
[2m2025-10-12T01:56:01.418184Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1267'. It is no longer used by any node.
[2m2025-10-12T01:56:01.418196Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1090'. It is no longer used by any node.
[2m2025-10-12T01:56:01.418215Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1162'. It is no longer used by any node.
[2m2025-10-12T01:56:01.418249Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'model.22.cv3.1.2.bias'. It is no longer used by any node.
[2m2025-10-12T01:56:01.418264Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'model.22.cv4.2.2.weight'. It is no longer used by any node.
[2m2025-10-12T01:56:01.418275Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1189'. It is no longer used by any node.
[2m2025-10-12T01:56:01.418287Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1192'. It is no longer used by any node.
[2m2025-10-12T01:56:01.418322Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1177'. It is no longer used by any node.
[2m2025-10-12T01:56:01.418344Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1240'. It is no longer used by any node.
[2m2025-10-12T01:56:01.418363Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'model.22.cv4.1.2.weight'. It is no longer used by any node.
[2m2025-10-12T01:56:01.418374Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1153'. It is no longer used by any node.
[2m2025-10-12T01:56:01.418383Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1135'. It is no longer used by any node.
[2m2025-10-12T01:56:01.418393Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1096'. It is no longer used by any node.
[2m2025-10-12T01:56:01.418425Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1147'. It is no longer used by any node.
[2m2025-10-12T01:56:01.418438Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1099'. It is no longer used by any node.
[2m2025-10-12T01:56:01.418456Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'model.22.cv4.0.2.weight'. It is no longer used by any node.
[2m2025-10-12T01:56:01.418478Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1123'. It is no longer used by any node.
[2m2025-10-12T01:56:01.418495Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'model.22.dfl.conv.weight'. It is no longer used by any node.
[2m2025-10-12T01:56:01.418512Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1186'. It is no longer used by any node.
[2m2025-10-12T01:56:01.418522Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1120'. It is no longer used by any node.
[2m2025-10-12T01:56:01.418533Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1180'. It is no longer used by any node.
[2m2025-10-12T01:56:01.418545Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'model.22.cv3.1.2.weight'. It is no longer used by any node.
[2m2025-10-12T01:56:01.418564Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1102'. It is no longer used by any node.
[2m2025-10-12T01:56:01.418580Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'model.22.cv3.0.2.bias'. It is no longer used by any node.
[2m2025-10-12T01:56:01.418591Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1225'. It is no longer used by any node.
[2m2025-10-12T01:56:01.418622Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1255'. It is no longer used by any node.
[2m2025-10-12T01:56:01.418632Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'model.22.cv3.0.2.weight'. It is no longer used by any node.
[2m2025-10-12T01:56:01.418642Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1159'. It is no longer used by any node.
[2m2025-10-12T01:56:01.418665Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1231'. It is no longer used by any node.
[2m2025-10-12T01:56:01.418675Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1081'. It is no longer used by any node.
[2m2025-10-12T01:56:01.418684Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1111'. It is no longer used by any node.
[2m2025-10-12T01:56:01.418694Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1078'. It is no longer used by any node.
[2m2025-10-12T01:56:01.418703Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'model.22.cv3.2.2.bias'. It is no longer used by any node.
[2m2025-10-12T01:56:01.418715Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1129'. It is no longer used by any node.
[2m2025-10-12T01:56:01.418724Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1093'. It is no longer used by any node.
[2m2025-10-12T01:56:01.418734Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1204'. It is no longer used by any node.
[2m2025-10-12T01:56:01.418744Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'model.22.cv2.0.2.weight'. It is no longer used by any node.
[2m2025-10-12T01:56:01.418753Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1165'. It is no longer used by any node.
[2m2025-10-12T01:56:01.418763Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1213'. It is no longer used by any node.
[2m2025-10-12T01:56:01.418783Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1105'. It is no longer used by any node.
[2m2025-10-12T01:56:01.418794Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1108'. It is no longer used by any node.
[2m2025-10-12T01:56:01.418805Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1126'. It is no longer used by any node.
[2m2025-10-12T01:56:01.418815Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'model.22.cv2.2.2.weight'. It is no longer used by any node.
[2m2025-10-12T01:56:01.418824Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1084'. It is no longer used by any node.
[2m2025-10-12T01:56:01.418833Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1234'. It is no longer used by any node.
[2m2025-10-12T01:56:01.418843Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1246'. It is no longer used by any node.
[2m2025-10-12T01:56:01.418852Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1150'. It is no longer used by any node.
[2m2025-10-12T01:56:01.418863Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1219'. It is no longer used by any node.
[2m2025-10-12T01:56:01.418872Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1243'. It is no longer used by any node.
[2m2025-10-12T01:56:01.418881Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1201'. It is no longer used by any node.
[2m2025-10-12T01:56:01.418891Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1252'. It is no longer used by any node.
[2m2025-10-12T01:56:01.418900Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1261'. It is no longer used by any node.
[2m2025-10-12T01:56:01.418909Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1264'. It is no longer used by any node.
[2m2025-10-12T01:56:01.418920Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1075'. It is no longer used by any node.
[2m2025-10-12T01:56:01.418929Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1270'. It is no longer used by any node.
[2m2025-10-12T01:56:01.418939Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1237'. It is no longer used by any node.
[2m2025-10-12T01:56:01.418948Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1183'. It is no longer used by any node.
[2m2025-10-12T01:56:01.418957Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'model.22.cv3.2.2.weight'. It is no longer used by any node.
[2m2025-10-12T01:56:01.418968Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1174'. It is no longer used by any node.
[2m2025-10-12T01:56:01.418977Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1171'. It is no longer used by any node.
[2m2025-10-12T01:56:01.418987Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1249'. It is no longer used by any node.
[2m2025-10-12T01:56:01.418997Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1117'. It is no longer used by any node.
[2m2025-10-12T01:56:01.419005Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1216'. It is no longer used by any node.
[2m2025-10-12T01:56:01.419015Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1222'. It is no longer used by any node.
[2m2025-10-12T01:56:01.419025Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1114'. It is no longer used by any node.
[2m2025-10-12T01:56:01.419034Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1087'. It is no longer used by any node.
[2m2025-10-12T01:56:01.419051Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1195'. It is no longer used by any node.
[2m2025-10-12T01:56:01.419060Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'model.22.cv2.1.2.weight'. It is no longer used by any node.
[2m2025-10-12T01:56:01.425440Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer NhwcTransformer modified: 0 with status: OK
[2m2025-10-12T01:56:01.425666Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer ConvAddActivationFusion modified: 0 with status: OK
[2m2025-10-12T01:56:01.425805Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer NchwcTransformer modified: 0 with status: OK
[2m2025-10-12T01:56:01.426101Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer NhwcTransformer modified: 0 with status: OK
[2m2025-10-12T01:56:01.426265Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer ConvAddActivationFusion modified: 0 with status: OK
[2m2025-10-12T01:56:01.426732Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer RemoveDuplicateCastTransformer modified: 0 with status: OK
[2m2025-10-12T01:56:01.426773Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer CastFloat16Transformer modified: 0 with status: OK
[2m2025-10-12T01:56:01.426790Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer MemcpyTransformer modified: 0 with status: OK
[2m2025-10-12T01:56:01.427821Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Use DeviceBasedPartition as default
[2m2025-10-12T01:56:01.454254Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Saving initialized tensors.
[2m2025-10-12T01:56:01.454338Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Extending BFCArena for Cpu. bin_num:12 (requested) num_bytes: 1179648 (actual) rounded_bytes:1179648
[2m2025-10-12T01:56:01.454369Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Extended allocation by 2097152 bytes.
[2m2025-10-12T01:56:01.454389Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Total allocated bytes: 2097152
[2m2025-10-12T01:56:01.454405Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Allocated memory at 0x5d6c8512cd00 to 0x5d6c8532cd00
[2m2025-10-12T01:56:01.454576Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Extending BFCArena for Cpu. bin_num:11 (requested) num_bytes: 589824 (actual) rounded_bytes:589824
[2m2025-10-12T01:56:01.454642Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Extended allocation by 2097152 bytes.
[2m2025-10-12T01:56:01.454683Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Total allocated bytes: 4194304
[2m2025-10-12T01:56:01.454693Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Allocated memory at 0x5d6c8532cd40 to 0x5d6c8552cd40
[2m2025-10-12T01:56:01.455677Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Extending BFCArena for Cpu. bin_num:12 (requested) num_bytes: 1572864 (actual) rounded_bytes:1572864
[2m2025-10-12T01:56:01.455715Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Extended allocation by 4194304 bytes.
[2m2025-10-12T01:56:01.455725Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Total allocated bytes: 8388608
[2m2025-10-12T01:56:01.455734Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Allocated memory at 0x5d6c8552cd80 to 0x5d6c8592cd80
[2m2025-10-12T01:56:01.457139Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Extending BFCArena for Cpu. bin_num:14 (requested) num_bytes: 4718592 (actual) rounded_bytes:4718592
[2m2025-10-12T01:56:01.457195Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Extended allocation by 8388608 bytes.
[2m2025-10-12T01:56:01.457209Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Total allocated bytes: 16777216
[2m2025-10-12T01:56:01.457217Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Allocated memory at 0x7dc596ffe040 to 0x7dc5977fe040
[2m2025-10-12T01:56:01.462526Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Extending BFCArena for Cpu. bin_num:11 (requested) num_bytes: 589824 (actual) rounded_bytes:589824
[2m2025-10-12T01:56:01.462584Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Extended allocation by 16777216 bytes.
[2m2025-10-12T01:56:01.462596Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Total allocated bytes: 33554432
[2m2025-10-12T01:56:01.462627Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Allocated memory at 0x7dc595ffd040 to 0x7dc596ffd040
[2m2025-10-12T01:56:01.473961Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Extending BFCArena for Cpu. bin_num:10 (requested) num_bytes: 294912 (actual) rounded_bytes:294912
[2m2025-10-12T01:56:01.474018Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Extended allocation by 33554432 bytes.
[2m2025-10-12T01:56:01.474037Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Total allocated bytes: 67108864
[2m2025-10-12T01:56:01.474052Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Allocated memory at 0x7dc58dfff040 to 0x7dc58ffff040
[2m2025-10-12T01:56:01.489042Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Done saving initialized tensors
[2m2025-10-12T01:56:01.490188Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Session successfully initialized.
[2m2025-10-12T01:56:01.490353Z[0m [32m INFO[0m [2mlum_rust_ws::domains::qr::rust_qreader[0m[2m:[0m ‚úÖ RustQReader ONNX session initialized for Small model
[2m2025-10-12T01:56:01.490402Z[0m [32m INFO[0m [2mlum_rust_ws::processing::qr_detection[0m[2m:[0m ‚úÖ ONNX Small model initialized successfully
[2m2025-10-12T01:56:01.490444Z[0m [32m INFO[0m [2mlum_rust_ws::domains::qr::rust_qreader[0m[2m:[0m üîß Initializing RustQReader with ONNX: "models/qreader_detector_medium.onnx"
[2m2025-10-12T01:56:01.490501Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Session Options {  execution_mode:0 execution_order:DEFAULT enable_profiling:0 optimized_model_filepath:"" enable_mem_pattern:1 enable_mem_reuse:1 enable_cpu_mem_arena:1 profile_file_prefix:onnxruntime_profile_ session_logid: session_log_severity_level:-1 session_log_verbosity_level:0 max_num_graph_transformation_steps:10 graph_optimization_level:3 intra_op_param:OrtThreadPoolParams { thread_pool_size: 0 auto_set_affinity: 0 allow_spinning: 1 dynamic_block_base_: 0 stack_size: 0 affinity_str:  set_denormal_as_zero: 0 } inter_op_param:OrtThreadPoolParams { thread_pool_size: 0 auto_set_affinity: 0 allow_spinning: 1 dynamic_block_base_: 0 stack_size: 0 affinity_str:  set_denormal_as_zero: 0 } use_per_session_threads:1 thread_pool_allow_spinning:1 use_deterministic_compute:0 ep_selection_policy:0 config_options: {  } }
[2m2025-10-12T01:56:01.490549Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Creating and using per session threadpools since use_per_session_threads_ is true
[2m2025-10-12T01:56:01.490563Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Dynamic block base set to 0
[2m2025-10-12T01:56:01.572512Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Initializing session.
[2m2025-10-12T01:56:01.572633Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Adding default CPU execution provider.
[2m2025-10-12T01:56:01.572699Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Creating BFCArena for Cpu with following configs: initial_chunk_size_bytes: 1048576 max_dead_bytes_per_chunk: 134217728 initial_growth_chunk_size_bytes: 2097152 max_power_of_two_extend_bytes: 1073741824 memory limit: 18446744073709551615 arena_extend_strategy: 0
[2m2025-10-12T01:56:01.572864Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m This model does not have any local functions defined. AOT Inlining is not performed
[2m2025-10-12T01:56:01.573020Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer EnsureUniqueDQForNodeUnit modified: 0 with status: OK
[2m2025-10-12T01:56:01.573270Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer Level1_RuleBasedTransformer modified: 1 with status: OK
[2m2025-10-12T01:56:01.575338Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer '/model.22/Constant_61_output_0'. It is no longer used by any node.
[2m2025-10-12T01:56:01.575413Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer '/model.8/Constant_4_output_0'. It is no longer used by any node.
[2m2025-10-12T01:56:01.575430Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer '/model.12/Constant_4_output_0'. It is no longer used by any node.
[2m2025-10-12T01:56:01.575441Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer '/model.6/Constant_4_output_0'. It is no longer used by any node.
[2m2025-10-12T01:56:01.575457Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer '/model.4/Constant_4_output_0'. It is no longer used by any node.
[2m2025-10-12T01:56:01.575469Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer '/model.18/Constant_4_output_0'. It is no longer used by any node.
[2m2025-10-12T01:56:01.575485Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer '/model.2/Constant_4_output_0'. It is no longer used by any node.
[2m2025-10-12T01:56:01.575499Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer '/model.15/Constant_4_output_0'. It is no longer used by any node.
[2m2025-10-12T01:56:01.575511Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer '/model.21/Constant_4_output_0'. It is no longer used by any node.
[2m2025-10-12T01:56:01.575717Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer DoubleQDQPairsRemover modified: 0 with status: OK
[2m2025-10-12T01:56:01.576068Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Total shared scalar initializer count: 92
[2m2025-10-12T01:56:01.576103Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer ConstantSharing modified: 1 with status: OK
[2m2025-10-12T01:56:01.578622Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer CommonSubexpressionElimination modified: 1 with status: OK
[2m2025-10-12T01:56:01.581089Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer ConstantFolding modified: 1 with status: OK
[2m2025-10-12T01:56:01.583064Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer '/model.22/Split_output_2'. It is no longer used by any node.
[2m2025-10-12T01:56:01.583104Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer '/model.22/Split_output_1'. It is no longer used by any node.
[2m2025-10-12T01:56:01.583118Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer '/model.22/Constant_14_output_0'. It is no longer used by any node.
[2m2025-10-12T01:56:01.583135Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer '/model.22/Split_output_0'. It is no longer used by any node.
[2m2025-10-12T01:56:01.583306Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer MatMulAddFusion modified: 0 with status: OK
[2m2025-10-12T01:56:01.583441Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Fused reshape node: /model.22/dfl/Reshape_output_0
[2m2025-10-12T01:56:01.583487Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Fused reshape node: /model.22/Reshape_18_output_0
[2m2025-10-12T01:56:01.583503Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Fused reshape node: /model.22/Reshape_19_output_0
[2m2025-10-12T01:56:01.583516Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Fused reshape node: /model.22/Reshape_13_output_0
[2m2025-10-12T01:56:01.583530Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Fused reshape node: /model.22/Reshape_14_output_0
[2m2025-10-12T01:56:01.583543Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Fused reshape node: /model.22/Reshape_8_output_0
[2m2025-10-12T01:56:01.583557Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Fused reshape node: /model.22/Reshape_9_output_0
[2m2025-10-12T01:56:01.583568Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Total fused reshape node count: 7
[2m2025-10-12T01:56:01.583578Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer ReshapeFusion modified: 1 with status: OK
[2m2025-10-12T01:56:01.585542Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer '/model.22/dfl/Constant_3_output_0'. It is no longer used by any node.
[2m2025-10-12T01:56:01.585695Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer FreeDimensionOverrideTransformer modified: 0 with status: OK
[2m2025-10-12T01:56:01.585722Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer GeluFusionL1 modified: 0 with status: OK
[2m2025-10-12T01:56:01.585734Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer LayerNormFusionL1 modified: 0 with status: OK
[2m2025-10-12T01:56:01.585875Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer QDQPropagationTransformer modified: 0 with status: OK
[2m2025-10-12T01:56:01.586018Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer WeightBiasQuantization modified: 0 with status: OK
[2m2025-10-12T01:56:01.586133Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer EnsureUniqueDQForNodeUnit modified: 0 with status: OK
[2m2025-10-12T01:56:01.586239Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer RocmBlasAltImpl modified: 0 with status: OK
[2m2025-10-12T01:56:01.586712Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer TransposeOptimizer modified: 0 with status: OK
[2m2025-10-12T01:56:01.586892Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer Level1_RuleBasedTransformer modified: 0 with status: OK
[2m2025-10-12T01:56:01.587003Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer DoubleQDQPairsRemover modified: 0 with status: OK
[2m2025-10-12T01:56:01.587456Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer CommonSubexpressionElimination modified: 0 with status: OK
[2m2025-10-12T01:56:01.587680Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer ConstantFolding modified: 0 with status: OK
[2m2025-10-12T01:56:01.587800Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer MatMulAddFusion modified: 0 with status: OK
[2m2025-10-12T01:56:01.587920Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer ReshapeFusion modified: 0 with status: OK
[2m2025-10-12T01:56:01.587948Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer FreeDimensionOverrideTransformer modified: 0 with status: OK
[2m2025-10-12T01:56:01.587959Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer GeluFusionL1 modified: 0 with status: OK
[2m2025-10-12T01:56:01.587968Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer LayerNormFusionL1 modified: 0 with status: OK
[2m2025-10-12T01:56:01.588078Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer QDQPropagationTransformer modified: 0 with status: OK
[2m2025-10-12T01:56:01.588208Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer WeightBiasQuantization modified: 0 with status: OK
[2m2025-10-12T01:56:01.588315Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer EnsureUniqueDQForNodeUnit modified: 0 with status: OK
[2m2025-10-12T01:56:01.588420Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer RocmBlasAltImpl modified: 0 with status: OK
[2m2025-10-12T01:56:01.589329Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer Level2_RuleBasedTransformer modified: 0 with status: OK
[2m2025-10-12T01:56:01.589794Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer TransposeOptimizer_CPUExecutionProvider modified: 0 with status: OK
[2m2025-10-12T01:56:01.589924Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer QDQS8ToU8Transformer modified: 0 with status: OK
[2m2025-10-12T01:56:01.590173Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer QDQSelectorActionTransformer modified: 0 with status: OK
[2m2025-10-12T01:56:01.590283Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer GemmActivationFusion modified: 0 with status: OK
[2m2025-10-12T01:56:01.590415Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer MatMulIntegerToFloatFusion modified: 0 with status: OK
[2m2025-10-12T01:56:01.590570Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer DynamicQuantizeMatMulFusion modified: 0 with status: OK
[2m2025-10-12T01:56:01.590797Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer ConvActivationFusion modified: 0 with status: OK
[2m2025-10-12T01:56:01.590927Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer GeluFusionL2 modified: 0 with status: OK
[2m2025-10-12T01:56:01.591046Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer LayerNormFusionL2 modified: 0 with status: OK
[2m2025-10-12T01:56:01.591164Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer SimplifiedLayerNormFusion modified: 0 with status: OK
[2m2025-10-12T01:56:01.591268Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer AttentionFusion modified: 0 with status: OK
[2m2025-10-12T01:56:01.591374Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer EmbedLayerNormFusion modified: 0 with status: OK
[2m2025-10-12T01:56:01.591400Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer GatherSliceToSplitFusion modified: 0 with status: OK
[2m2025-10-12T01:56:01.591490Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer GatherToSliceFusion modified: 0 with status: OK
[2m2025-10-12T01:56:01.591615Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer MatmulTransposeFusion modified: 0 with status: OK
[2m2025-10-12T01:56:01.591745Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer BiasGeluFusion modified: 0 with status: OK
[2m2025-10-12T01:56:01.591875Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer GroupQueryAttentionFusion modified: 0 with status: OK
[2m2025-10-12T01:56:01.592006Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer SkipLayerNormFusion modified: 0 with status: OK
[2m2025-10-12T01:56:01.592147Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer FastGeluFusion modified: 0 with status: OK
[2m2025-10-12T01:56:01.592512Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer QuickGeluFusion modified: 1 with status: OK
[2m2025-10-12T01:56:01.594555Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer BiasSoftmaxFusion modified: 0 with status: OK
[2m2025-10-12T01:56:01.594723Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer BiasDropoutFusion modified: 0 with status: OK
[2m2025-10-12T01:56:01.594845Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer MatMulScaleFusion modified: 0 with status: OK
[2m2025-10-12T01:56:01.594950Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer MatMulActivationFusion modified: 0 with status: OK
[2m2025-10-12T01:56:01.595071Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer MatMulNBitsFusion modified: 0 with status: OK
[2m2025-10-12T01:56:01.595174Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer QDQFinalCleanupTransformer modified: 0 with status: OK
[2m2025-10-12T01:56:01.595277Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer Level2_RuleBasedTransformer modified: 0 with status: OK
[2m2025-10-12T01:56:01.595373Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer QDQS8ToU8Transformer modified: 0 with status: OK
[2m2025-10-12T01:56:01.595567Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer QDQSelectorActionTransformer modified: 0 with status: OK
[2m2025-10-12T01:56:01.595717Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer GemmActivationFusion modified: 0 with status: OK
[2m2025-10-12T01:56:01.595891Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer MatMulIntegerToFloatFusion modified: 0 with status: OK
[2m2025-10-12T01:56:01.595994Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer DynamicQuantizeMatMulFusion modified: 0 with status: OK
[2m2025-10-12T01:56:01.596149Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer ConvActivationFusion modified: 0 with status: OK
[2m2025-10-12T01:56:01.596259Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer GeluFusionL2 modified: 0 with status: OK
[2m2025-10-12T01:56:01.596349Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer LayerNormFusionL2 modified: 0 with status: OK
[2m2025-10-12T01:56:01.596438Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer SimplifiedLayerNormFusion modified: 0 with status: OK
[2m2025-10-12T01:56:01.596522Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer AttentionFusion modified: 0 with status: OK
[2m2025-10-12T01:56:01.596625Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer EmbedLayerNormFusion modified: 0 with status: OK
[2m2025-10-12T01:56:01.596664Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer GatherSliceToSplitFusion modified: 0 with status: OK
[2m2025-10-12T01:56:01.596746Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer GatherToSliceFusion modified: 0 with status: OK
[2m2025-10-12T01:56:01.596841Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer MatmulTransposeFusion modified: 0 with status: OK
[2m2025-10-12T01:56:01.596961Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer BiasGeluFusion modified: 0 with status: OK
[2m2025-10-12T01:56:01.597053Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer GroupQueryAttentionFusion modified: 0 with status: OK
[2m2025-10-12T01:56:01.597136Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer SkipLayerNormFusion modified: 0 with status: OK
[2m2025-10-12T01:56:01.597220Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer FastGeluFusion modified: 0 with status: OK
[2m2025-10-12T01:56:01.597305Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer QuickGeluFusion modified: 0 with status: OK
[2m2025-10-12T01:56:01.597384Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer BiasSoftmaxFusion modified: 0 with status: OK
[2m2025-10-12T01:56:01.597458Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer BiasDropoutFusion modified: 0 with status: OK
[2m2025-10-12T01:56:01.597546Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer MatMulScaleFusion modified: 0 with status: OK
[2m2025-10-12T01:56:01.597637Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer MatMulActivationFusion modified: 0 with status: OK
[2m2025-10-12T01:56:01.597761Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer MatMulNBitsFusion modified: 0 with status: OK
[2m2025-10-12T01:56:01.597843Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer QDQFinalCleanupTransformer modified: 0 with status: OK
[2m2025-10-12T01:56:01.732703Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer NchwcTransformer modified: 1 with status: OK
[2m2025-10-12T01:56:01.736790Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1320'. It is no longer used by any node.
[2m2025-10-12T01:56:01.736835Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1437'. It is no longer used by any node.
[2m2025-10-12T01:56:01.736850Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1431'. It is no longer used by any node.
[2m2025-10-12T01:56:01.736860Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1425'. It is no longer used by any node.
[2m2025-10-12T01:56:01.736870Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1479'. It is no longer used by any node.
[2m2025-10-12T01:56:01.736880Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1419'. It is no longer used by any node.
[2m2025-10-12T01:56:01.736890Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1401'. It is no longer used by any node.
[2m2025-10-12T01:56:01.736929Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1281'. It is no longer used by any node.
[2m2025-10-12T01:56:01.736942Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1434'. It is no longer used by any node.
[2m2025-10-12T01:56:01.736953Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1395'. It is no longer used by any node.
[2m2025-10-12T01:56:01.736963Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'model.22.cv3.2.2.weight'. It is no longer used by any node.
[2m2025-10-12T01:56:01.736975Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1371'. It is no longer used by any node.
[2m2025-10-12T01:56:01.736984Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1389'. It is no longer used by any node.
[2m2025-10-12T01:56:01.736995Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1386'. It is no longer used by any node.
[2m2025-10-12T01:56:01.737020Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1380'. It is no longer used by any node.
[2m2025-10-12T01:56:01.737032Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1413'. It is no longer used by any node.
[2m2025-10-12T01:56:01.737042Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1290'. It is no longer used by any node.
[2m2025-10-12T01:56:01.737053Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1365'. It is no longer used by any node.
[2m2025-10-12T01:56:01.737064Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1368'. It is no longer used by any node.
[2m2025-10-12T01:56:01.737089Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1359'. It is no longer used by any node.
[2m2025-10-12T01:56:01.737100Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1404'. It is no longer used by any node.
[2m2025-10-12T01:56:01.737110Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1356'. It is no longer used by any node.
[2m2025-10-12T01:56:01.737120Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1350'. It is no longer used by any node.
[2m2025-10-12T01:56:01.737131Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1341'. It is no longer used by any node.
[2m2025-10-12T01:56:01.737140Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'model.22.cv2.1.2.weight'. It is no longer used by any node.
[2m2025-10-12T01:56:01.737151Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1392'. It is no longer used by any node.
[2m2025-10-12T01:56:01.737161Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1485'. It is no longer used by any node.
[2m2025-10-12T01:56:01.737172Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'model.22.dfl.conv.weight'. It is no longer used by any node.
[2m2025-10-12T01:56:01.737183Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'model.22.cv4.1.2.weight'. It is no longer used by any node.
[2m2025-10-12T01:56:01.737193Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1284'. It is no longer used by any node.
[2m2025-10-12T01:56:01.737204Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1377'. It is no longer used by any node.
[2m2025-10-12T01:56:01.737214Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1293'. It is no longer used by any node.
[2m2025-10-12T01:56:01.737241Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'model.22.cv3.0.2.bias'. It is no longer used by any node.
[2m2025-10-12T01:56:01.737253Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1302'. It is no longer used by any node.
[2m2025-10-12T01:56:01.737281Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1311'. It is no longer used by any node.
[2m2025-10-12T01:56:01.737292Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1317'. It is no longer used by any node.
[2m2025-10-12T01:56:01.737303Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'model.22.cv3.1.2.weight'. It is no longer used by any node.
[2m2025-10-12T01:56:01.737312Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1347'. It is no longer used by any node.
[2m2025-10-12T01:56:01.737322Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1515'. It is no longer used by any node.
[2m2025-10-12T01:56:01.737332Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'model.22.cv2.2.2.weight'. It is no longer used by any node.
[2m2025-10-12T01:56:01.737342Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1374'. It is no longer used by any node.
[2m2025-10-12T01:56:01.737352Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'model.22.cv3.0.2.weight'. It is no longer used by any node.
[2m2025-10-12T01:56:01.737362Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1329'. It is no longer used by any node.
[2m2025-10-12T01:56:01.737373Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'model.22.cv3.2.2.bias'. It is no longer used by any node.
[2m2025-10-12T01:56:01.737397Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1323'. It is no longer used by any node.
[2m2025-10-12T01:56:01.737408Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1443'. It is no longer used by any node.
[2m2025-10-12T01:56:01.737418Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1296'. It is no longer used by any node.
[2m2025-10-12T01:56:01.737429Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1422'. It is no longer used by any node.
[2m2025-10-12T01:56:01.737439Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1299'. It is no longer used by any node.
[2m2025-10-12T01:56:01.737450Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1512'. It is no longer used by any node.
[2m2025-10-12T01:56:01.737461Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1416'. It is no longer used by any node.
[2m2025-10-12T01:56:01.737484Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1353'. It is no longer used by any node.
[2m2025-10-12T01:56:01.737496Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1308'. It is no longer used by any node.
[2m2025-10-12T01:56:01.737506Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1461'. It is no longer used by any node.
[2m2025-10-12T01:56:01.737516Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1314'. It is no longer used by any node.
[2m2025-10-12T01:56:01.737527Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1287'. It is no longer used by any node.
[2m2025-10-12T01:56:01.737538Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1305'. It is no longer used by any node.
[2m2025-10-12T01:56:01.737560Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1326'. It is no longer used by any node.
[2m2025-10-12T01:56:01.737570Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1527'. It is no longer used by any node.
[2m2025-10-12T01:56:01.737581Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'model.22.cv2.0.2.weight'. It is no longer used by any node.
[2m2025-10-12T01:56:01.737627Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1335'. It is no longer used by any node.
[2m2025-10-12T01:56:01.737644Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'model.22.cv4.0.2.weight'. It is no longer used by any node.
[2m2025-10-12T01:56:01.737664Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1440'. It is no longer used by any node.
[2m2025-10-12T01:56:01.737674Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1509'. It is no longer used by any node.
[2m2025-10-12T01:56:01.737684Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1446'. It is no longer used by any node.
[2m2025-10-12T01:56:01.737696Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1449'. It is no longer used by any node.
[2m2025-10-12T01:56:01.737706Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1428'. It is no longer used by any node.
[2m2025-10-12T01:56:01.737716Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1455'. It is no longer used by any node.
[2m2025-10-12T01:56:01.737726Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1458'. It is no longer used by any node.
[2m2025-10-12T01:56:01.737737Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1464'. It is no longer used by any node.
[2m2025-10-12T01:56:01.737764Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1467'. It is no longer used by any node.
[2m2025-10-12T01:56:01.737775Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1470'. It is no longer used by any node.
[2m2025-10-12T01:56:01.737786Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'model.22.cv4.2.2.weight'. It is no longer used by any node.
[2m2025-10-12T01:56:01.737797Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1362'. It is no longer used by any node.
[2m2025-10-12T01:56:01.737807Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1473'. It is no longer used by any node.
[2m2025-10-12T01:56:01.737818Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1476'. It is no longer used by any node.
[2m2025-10-12T01:56:01.737828Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1482'. It is no longer used by any node.
[2m2025-10-12T01:56:01.737854Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1338'. It is no longer used by any node.
[2m2025-10-12T01:56:01.737865Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1488'. It is no longer used by any node.
[2m2025-10-12T01:56:01.737875Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1344'. It is no longer used by any node.
[2m2025-10-12T01:56:01.737886Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1491'. It is no longer used by any node.
[2m2025-10-12T01:56:01.737895Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1383'. It is no longer used by any node.
[2m2025-10-12T01:56:01.737905Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1497'. It is no longer used by any node.
[2m2025-10-12T01:56:01.737917Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1332'. It is no longer used by any node.
[2m2025-10-12T01:56:01.737927Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1500'. It is no longer used by any node.
[2m2025-10-12T01:56:01.737951Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1494'. It is no longer used by any node.
[2m2025-10-12T01:56:01.737971Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1503'. It is no longer used by any node.
[2m2025-10-12T01:56:01.737981Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1506'. It is no longer used by any node.
[2m2025-10-12T01:56:01.737992Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1518'. It is no longer used by any node.
[2m2025-10-12T01:56:01.738017Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1521'. It is no longer used by any node.
[2m2025-10-12T01:56:01.738029Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1524'. It is no longer used by any node.
[2m2025-10-12T01:56:01.738040Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1530'. It is no longer used by any node.
[2m2025-10-12T01:56:01.738050Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1533'. It is no longer used by any node.
[2m2025-10-12T01:56:01.738060Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'model.22.cv3.1.2.bias'. It is no longer used by any node.
[2m2025-10-12T01:56:01.738070Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1536'. It is no longer used by any node.
[2m2025-10-12T01:56:01.738095Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1452'. It is no longer used by any node.
[2m2025-10-12T01:56:01.738108Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1398'. It is no longer used by any node.
[2m2025-10-12T01:56:01.738118Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1410'. It is no longer used by any node.
[2m2025-10-12T01:56:01.738129Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Removing initializer 'onnx::Conv_1407'. It is no longer used by any node.
[2m2025-10-12T01:56:01.739547Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer NhwcTransformer modified: 0 with status: OK
[2m2025-10-12T01:56:01.739807Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer ConvAddActivationFusion modified: 0 with status: OK
[2m2025-10-12T01:56:01.739973Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer NchwcTransformer modified: 0 with status: OK
[2m2025-10-12T01:56:01.740336Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer NhwcTransformer modified: 0 with status: OK
[2m2025-10-12T01:56:01.740541Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer ConvAddActivationFusion modified: 0 with status: OK
[2m2025-10-12T01:56:01.741024Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer RemoveDuplicateCastTransformer modified: 0 with status: OK
[2m2025-10-12T01:56:01.741062Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer CastFloat16Transformer modified: 0 with status: OK
[2m2025-10-12T01:56:01.741082Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m GraphTransformer MemcpyTransformer modified: 0 with status: OK
[2m2025-10-12T01:56:01.742234Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Use DeviceBasedPartition as default
[2m2025-10-12T01:56:01.781156Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Saving initialized tensors.
[2m2025-10-12T01:56:01.781260Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Extending BFCArena for Cpu. bin_num:3 (requested) num_bytes: 2304 (actual) rounded_bytes:2304
[2m2025-10-12T01:56:01.781301Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Extended allocation by 1048576 bytes.
[2m2025-10-12T01:56:01.781315Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Total allocated bytes: 1048576
[2m2025-10-12T01:56:01.781328Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Allocated memory at 0x5d6c8b645240 to 0x5d6c8b745240
[2m2025-10-12T01:56:01.781395Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Extending BFCArena for Cpu. bin_num:12 (requested) num_bytes: 1327104 (actual) rounded_bytes:1327104
[2m2025-10-12T01:56:01.781464Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Extended allocation by 2097152 bytes.
[2m2025-10-12T01:56:01.781478Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Total allocated bytes: 3145728
[2m2025-10-12T01:56:01.781491Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Allocated memory at 0x5d6c83c8cc40 to 0x5d6c83e8cc40
[2m2025-10-12T01:56:01.781716Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Extending BFCArena for Cpu. bin_num:12 (requested) num_bytes: 1327104 (actual) rounded_bytes:1327104
[2m2025-10-12T01:56:01.781766Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Extended allocation by 4194304 bytes.
[2m2025-10-12T01:56:01.781781Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Total allocated bytes: 7340032
[2m2025-10-12T01:56:01.781794Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Allocated memory at 0x5d6c8244cac0 to 0x5d6c8284cac0
[2m2025-10-12T01:56:01.782507Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Extending BFCArena for Cpu. bin_num:12 (requested) num_bytes: 1327104 (actual) rounded_bytes:1327104
[2m2025-10-12T01:56:01.782538Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Extended allocation by 8388608 bytes.
[2m2025-10-12T01:56:01.782547Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Total allocated bytes: 15728640
[2m2025-10-12T01:56:01.782555Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Allocated memory at 0x5d6c83f8cc80 to 0x5d6c8478cc80
[2m2025-10-12T01:56:01.783629Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Extending BFCArena for Cpu. bin_num:13 (requested) num_bytes: 2654208 (actual) rounded_bytes:2654208
[2m2025-10-12T01:56:01.783684Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Extended allocation by 16777216 bytes.
[2m2025-10-12T01:56:01.783695Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Total allocated bytes: 32505856
[2m2025-10-12T01:56:01.783703Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Allocated memory at 0x5d6c8592cdc0 to 0x5d6c8692cdc0
[2m2025-10-12T01:56:01.786536Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Extending BFCArena for Cpu. bin_num:13 (requested) num_bytes: 2654208 (actual) rounded_bytes:2654208
[2m2025-10-12T01:56:01.786584Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Extended allocation by 33554432 bytes.
[2m2025-10-12T01:56:01.786612Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Total allocated bytes: 66060288
[2m2025-10-12T01:56:01.786625Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Allocated memory at 0x5d6c8692ce00 to 0x5d6c8892ce00
[2m2025-10-12T01:56:01.793102Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Extending BFCArena for Cpu. bin_num:0 (requested) num_bytes: 16 (actual) rounded_bytes:256
[2m2025-10-12T01:56:01.793169Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Extended allocation by 67108864 bytes.
[2m2025-10-12T01:56:01.793182Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Total allocated bytes: 133169152
[2m2025-10-12T01:56:01.793192Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Allocated memory at 0x7dc55bfff040 to 0x7dc55ffff040
[2m2025-10-12T01:56:01.831157Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Done saving initialized tensors
[2m2025-10-12T01:56:01.833142Z[0m [32m INFO[0m [2mort::logging[0m[2m:[0m Session successfully initialized.
[2m2025-10-12T01:56:01.833279Z[0m [32m INFO[0m [2mlum_rust_ws::domains::qr::rust_qreader[0m[2m:[0m ‚úÖ RustQReader ONNX session initialized for Medium model
[2m2025-10-12T01:56:01.833331Z[0m [32m INFO[0m [2mlum_rust_ws::processing::qr_detection[0m[2m:[0m ‚úÖ ONNX Medium model initialized successfully
[2m2025-10-12T01:56:01.833352Z[0m [32m INFO[0m [2mlum_rust_ws[0m[2m:[0m ü§ñ ONNX ML models initialized for enhanced QR detection
[2m2025-10-12T01:56:01.839941Z[0m [32m INFO[0m [2mlum_rust_ws[0m[2m:[0m listening on 0.0.0.0:8000
[2m2025-10-12T01:57:07.386170Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T01:57:07.386367Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T01:57:07.386453Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m Fetching user data for user_id: 1
[2m2025-10-12T01:57:07.389162Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m User data retrieved in 2ms for user_id: 1 - email: Some("andresfelipevalenciag@gmail.com")
[2m2025-10-12T01:57:08.362450Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T01:57:08.362594Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m Getting user balance for user_id: 1
[2m2025-10-12T01:57:08.364849Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m User balance retrieved successfully for user 1 in 2ms: 298 L√ºmis
[2m2025-10-12T01:57:08.872289Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T01:57:08.872620Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0mfc996ace-761d-4fe4-a4b2-4a1c046193d9
[2m2025-10-12T01:57:08.872682Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request fc996ace-761d-4fe4-a4b2-4a1c046193d9: Processing headers for user 1 with limit 50 offset 0
[2m2025-10-12T01:57:08.872716Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request fc996ace-761d-4fe4-a4b2-4a1c046193d9: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            h.issuer_ruc,
            h.issuer_dv,
            h.issuer_address,
            h.issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T01:57:08.878455Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request fc996ace-761d-4fe4-a4b2-4a1c046193d9: Retrieved 0 invoice headers (total: 0) in 5ms with enhanced filtering
[2m2025-10-12T01:57:09.385575Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T01:57:09.385854Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0mf2028617-c450-4283-9ab3-fbf73cc8aa76
[2m2025-10-12T01:57:09.385892Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request f2028617-c450-4283-9ab3-fbf73cc8aa76: Processing headers for user 1 with limit 50 offset 100
[2m2025-10-12T01:57:09.385921Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request f2028617-c450-4283-9ab3-fbf73cc8aa76: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            h.issuer_ruc,
            h.issuer_dv,
            h.issuer_address,
            h.issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T01:57:09.391618Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request f2028617-c450-4283-9ab3-fbf73cc8aa76: Retrieved 0 invoice headers (total: 0) in 5ms with enhanced filtering
[2m2025-10-12T01:57:09.471927Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T01:57:09.472154Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0m957807a2-414f-4103-ad9d-69ddc6f6fb24
[2m2025-10-12T01:57:09.472187Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 957807a2-414f-4103-ad9d-69ddc6f6fb24: Processing headers for user 1 with limit 50 offset 50
[2m2025-10-12T01:57:09.472213Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 957807a2-414f-4103-ad9d-69ddc6f6fb24: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            h.issuer_ruc,
            h.issuer_dv,
            h.issuer_address,
            h.issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T01:57:09.476011Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 957807a2-414f-4103-ad9d-69ddc6f6fb24: Retrieved 0 invoice headers (total: 0) in 3ms with enhanced filtering
[2m2025-10-12T01:57:09.670464Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T01:57:09.670774Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m1e18a862-d23a-4ce3-a24f-41a29fbbd0dd
[2m2025-10-12T01:57:09.670826Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 1e18a862-d23a-4ce3-a24f-41a29fbbd0dd: Processing for user 1 with limit 100 offset 100 order_by date direction DESC
[2m2025-10-12T01:57:09.670846Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 1e18a862-d23a-4ce3-a24f-41a29fbbd0dd: Querying details for user 1 with enhanced filters
[2m2025-10-12T01:57:09.670902Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 1e18a862-d23a-4ce3-a24f-41a29fbbd0dd: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T01:57:09.672083Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T01:57:09.672249Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0mbf01f531-ca2b-43ef-b349-219e1f9f9e27
[2m2025-10-12T01:57:09.672272Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request bf01f531-ca2b-43ef-b349-219e1f9f9e27: Processing for user 1 with limit 100 offset 0 order_by date direction DESC
[2m2025-10-12T01:57:09.672286Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request bf01f531-ca2b-43ef-b349-219e1f9f9e27: Querying details for user 1 with enhanced filters
[2m2025-10-12T01:57:09.672304Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request bf01f531-ca2b-43ef-b349-219e1f9f9e27: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T01:57:09.673144Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T01:57:09.673349Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m59d0a6d1-89a6-407c-9de2-cb58f4d0ee7e
[2m2025-10-12T01:57:09.673389Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 59d0a6d1-89a6-407c-9de2-cb58f4d0ee7e: Processing for user 1 with limit 100 offset 200 order_by date direction DESC
[2m2025-10-12T01:57:09.673403Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 59d0a6d1-89a6-407c-9de2-cb58f4d0ee7e: Querying details for user 1 with enhanced filters
[2m2025-10-12T01:57:09.673422Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 59d0a6d1-89a6-407c-9de2-cb58f4d0ee7e: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T01:57:09.677514Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 1e18a862-d23a-4ce3-a24f-41a29fbbd0dd: Retrieved 0 invoice details (total: 0) in 6ms with enhanced pagination
[2m2025-10-12T01:57:09.681920Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request bf01f531-ca2b-43ef-b349-219e1f9f9e27: Retrieved 0 invoice details (total: 0) in 9ms with enhanced pagination
[2m2025-10-12T01:57:09.682009Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 59d0a6d1-89a6-407c-9de2-cb58f4d0ee7e: Retrieved 0 invoice details (total: 0) in 8ms with enhanced pagination
[2m2025-10-12T01:57:17.796385Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T01:57:17.796953Z[0m [32m INFO[0m [2mlum_rust_ws::api::url_processing_v4[0m[2m:[0m Processing URL request for user 1: https://dgi-fep.mef.gob.pa/Consultas/FacturasPorQR?chFE=FE01200000000434-15-93796-2200512025101100002104380050312308413028&iAmb=1&digestValue=sHKttJh3945+T033s9Krr+9/Fw6oun1yLH/6XW8bukI=&jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJjaEZFIjoiRkUwMTIwMDAwMDAwMDQzNC0xNS05Mzc5Ni0yMjAwNTEyMDI1MTAxMTAwMDAyMTA0MzgwMDUwMzEyMzA4NDEzMDI4IiwiaUFtYiI6IjEiLCJkaWdlc3RWYWx1ZSI6InNIS3R0SmgzOTQ1K1QwMzNzOUtycis5L0Z3Nm91bjF5TEgvNlhXOGJ1a0k9In0.XXv-2GC3LP1xtcsU_Mhwt5sVn2sLGFFpxw1ap80vwbo
[2m2025-10-12T01:57:17.797281Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m Starting to scrape invoice from URL: https://dgi-fep.mef.gob.pa/Consultas/FacturasPorQR?chFE=FE01200000000434-15-93796-2200512025101100002104380050312308413028&iAmb=1&digestValue=sHKttJh3945+T033s9Krr+9/Fw6oun1yLH/6XW8bukI=&jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJjaEZFIjoiRkUwMTIwMDAwMDAwMDQzNC0xNS05Mzc5Ni0yMjAwNTEyMDI1MTAxMTAwMDAyMTA0MzgwMDUwMzEyMzA4NDEzMDI4IiwiaUFtYiI6IjEiLCJkaWdlc3RWYWx1ZSI6InNIS3R0SmgzOTQ1K1QwMzNzOUtycis5L0Z3Nm91bjF5TEgvNlhXOGJ1a0k9In0.XXv-2GC3LP1xtcsU_Mhwt5sVn2sLGFFpxw1ap80vwbo
[2m2025-10-12T01:57:17.797344Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m Fetching HTML with final URL tracking from: https://dgi-fep.mef.gob.pa/Consultas/FacturasPorQR?chFE=FE01200000000434-15-93796-2200512025101100002104380050312308413028&iAmb=1&digestValue=sHKttJh3945+T033s9Krr+9/Fw6oun1yLH/6XW8bukI=&jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJjaEZFIjoiRkUwMTIwMDAwMDAwMDQzNC0xNS05Mzc5Ni0yMjAwNTEyMDI1MTAxMTAwMDAyMTA0MzgwMDUwMzEyMzA4NDEzMDI4IiwiaUFtYiI6IjEiLCJkaWdlc3RWYWx1ZSI6InNIS3R0SmgzOTQ1K1QwMzNzOUtycis5L0Z3Nm91bjF5TEgvNlhXOGJ1a0k9In0.XXv-2GC3LP1xtcsU_Mhwt5sVn2sLGFFpxw1ap80vwbo
[2m2025-10-12T01:57:19.038805Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m Successfully fetched HTML content (30694 bytes) from final URL: https://dgi-fep.mef.gob.pa/Consultas/FacturasPorQR?chFE=FE01200000000434-15-93796-2200512025101100002104380050312308413028&iAmb=1&digestValue=sHKttJh3945+T033s9Krr+9/Fw6oun1yLH/6XW8bukI=&jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJjaEZFIjoiRkUwMTIwMDAwMDAwMDQzNC0xNS05Mzc5Ni0yMjAwNTEyMDI1MTAxMTAwMDAyMTA0MzgwMDUwMzEyMzA4NDEzMDI4IiwiaUFtYiI6IjEiLCJkaWdlc3RWYWx1ZSI6InNIS3R0SmgzOTQ1K1QwMzNzOUtycis5L0Z3Nm91bjF5TEgvNlhXOGJ1a0k9In0.XXv-2GC3LP1xtcsU_Mhwt5sVn2sLGFFpxw1ap80vwbo
[2m2025-10-12T01:57:19.050201Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m üîç DEBUG - HTML content length: 30694 bytes
[2m2025-10-12T01:57:19.050303Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m üîç DEBUG - HTML first 500 chars: 

<!DOCTYPE html>

<html lang="es-pa">
<head>
    <link rel="icon" type="image/png" href="/Images/favicon.png">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" /><title>
	
    Consultar Facturas Por QR

</title>

    <script type="text/javascript" src="/ruxitagentjs_ICA7NVfqrux_10323250822043923.js" data-dtconfig="rid=RID_452125239|rpid=96792336|domain=mef.gob.pa|reportUrl=/rb_bf36044oye|app=042269121d25fae7|cuc=s94amosz|owa
[2m2025-10-12T01:57:19.050650Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m üîç DEBUG - HTML saved to /tmp/scraped_invoice.html
[2m2025-10-12T01:57:19.050721Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m Extracting invoice header from document using ocr_extractor
[2m2025-10-12T01:57:19.053589Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m üîç DEBUG - Calling extract_main_info with HTML length: 30427
[2m2025-10-12T01:57:19.068429Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m üîç DEBUG - extract_main_info SUCCESS, header keys: ["cufe", "emisor_address", "tot_itbms", "vuelto", "emisor_ruc", "no", "date", "receptor_phone", "total_pagado", "emisor_dv", "receptor_dv", "receptor_address", "emisor_name", "receptor_ruc", "receptor_name", "tot_amount", "emisor_phone"]
[2m2025-10-12T01:57:19.068506Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m üîç DEBUG - Raw header_data keys: ["cufe", "emisor_address", "tot_itbms", "vuelto", "emisor_ruc", "no", "date", "receptor_phone", "total_pagado", "emisor_dv", "receptor_dv", "receptor_address", "emisor_name", "receptor_ruc", "receptor_name", "tot_amount", "emisor_phone"]
[2m2025-10-12T01:57:19.068528Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m üîç DEBUG - emisor_name value: Some("IMPORTADORA RICAMAR S A")
[2m2025-10-12T01:57:19.068539Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m üîç DEBUG - tot_amount_str value: Some("2.00")
[2m2025-10-12T01:57:19.068569Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m üîç DEBUG - Extracted data - RUC: Some("434-15-93796"), Nombre: Some("IMPORTADORA RICAMAR S A"), Total: Some(2.0), ITBMS: Some(0.0)
[2m2025-10-12T01:57:19.068766Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m Found 13 potential detail rows
[2m2025-10-12T01:57:19.069019Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m Payment information extracted: forma_de_pago=Some("Tarjeta Cr√©dito"), total_pagado=Some("2.00")
[2m2025-10-12T01:57:19.071241Z[0m [32m INFO[0m [2mlum_rust_ws::api::database_persistence[0m[2m:[0m Saving invoice header with CUFE: FE01200000000434-15-93796-2200512025101100002104380050312308413028
[2m2025-10-12T01:57:19.075092Z[0m [32m INFO[0m [2msqlx::postgres::notice[0m[2m:[0m Usuario 1, sin redenci√≥n previa, buscando desde: 2025-09-15
[2m2025-10-12T01:57:19.075627Z[0m [32m INFO[0m [2msqlx::postgres::notice[0m[2m:[0m Usuario 1, contando desde semana m√°s reciente con facturas: 2025-10-06
[2m2025-10-12T01:57:19.076262Z[0m [32m INFO[0m [2msqlx::postgres::notice[0m[2m:[0m Semana 0 (desde 2025-10-06 hasta 2025-10-12 00:00:00): facturas = t
[2m2025-10-12T01:57:19.076575Z[0m [32m INFO[0m [2msqlx::postgres::notice[0m[2m:[0m Semana 1 (desde 2025-09-29 hasta 2025-10-05 00:00:00): facturas = t
[2m2025-10-12T01:57:19.076688Z[0m [32m INFO[0m [2msqlx::postgres::notice[0m[2m:[0m Semana 2 (desde 2025-09-22 hasta 2025-09-28 00:00:00): facturas = t
[2m2025-10-12T01:57:19.076763Z[0m [32m INFO[0m [2msqlx::postgres::notice[0m[2m:[0m Semana 3 (desde 2025-09-15 hasta 2025-09-21 00:00:00): facturas = t
[2m2025-10-12T01:57:19.076813Z[0m [32m INFO[0m [2msqlx::postgres::notice[0m[2m:[0m Resultado final para usuario 1: 4 semanas consecutivas (despu√©s de redenci√≥n: <NULL>)
[2m2025-10-12T01:57:19.135370Z[0m [32m INFO[0m [2mlum_rust_ws::api::database_persistence[0m[2m:[0m Saving 1 invoice details
[2m2025-10-12T01:57:19.136171Z[0m [32m INFO[0m [2mlum_rust_ws::api::database_persistence[0m[2m:[0m Saving 1 invoice payments
[2m2025-10-12T01:57:19.141898Z[0m [32m INFO[0m [2mlum_rust_ws::api::database_persistence[0m[2m:[0m üîç DEBUG - Creando respuesta con issuer_name: Some("IMPORTADORA RICAMAR S A"), tot_amount: Some(2.0)
[2m2025-10-12T01:57:19.143495Z[0m [32m INFO[0m [2mlum_rust_ws::api::gamification_service[0m[2m:[0m ÔøΩÔøΩ Found accumulation rule: 'receipts' (id=0) with 1 Lumis
[2m2025-10-12T01:57:19.147802Z[0m [32m INFO[0m [2mlum_rust_ws::api::gamification_service[0m[2m:[0m ‚úÖ Recorded accumulation for user 1 - 1 Lumis (CUFE: FE01200000000434-15-93796-2200512025101100002104380050312308413028)
[2m2025-10-12T01:57:19.149030Z[0m [32m INFO[0m [2mlum_rust_ws::api::gamification_service[0m[2m:[0m üí∞ New balance for user 1: 299 Lumis
[2m2025-10-12T01:57:19.149167Z[0m [32m INFO[0m [2mlum_rust_ws::api::url_processing_v4[0m[2m:[0m ‚úÖ Successfully credited 1 Lumis to user 1. New balance: 299
[2m2025-10-12T01:58:00.104143Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T01:58:00.104291Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T01:58:00.104350Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m Fetching user data for user_id: 1
[2m2025-10-12T01:58:00.106142Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m User data retrieved in 1ms for user_id: 1 - email: Some("andresfelipevalenciag@gmail.com")
[2m2025-10-12T01:58:01.111739Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T01:58:01.111868Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m Getting user balance for user_id: 1
[2m2025-10-12T01:58:01.113328Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m User balance retrieved successfully for user 1 in 1ms: 299 L√ºmis
[2m2025-10-12T01:58:01.619765Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T01:58:01.619997Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0mcc9a6376-34c6-4200-9eb3-4104c26a9248
[2m2025-10-12T01:58:01.620047Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request cc9a6376-34c6-4200-9eb3-4104c26a9248: Processing headers for user 1 with limit 50 offset 0
[2m2025-10-12T01:58:01.620084Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request cc9a6376-34c6-4200-9eb3-4104c26a9248: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            h.issuer_ruc,
            h.issuer_dv,
            h.issuer_address,
            h.issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T01:58:01.626985Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request cc9a6376-34c6-4200-9eb3-4104c26a9248: Retrieved 1 invoice headers (total: 1) in 6ms with enhanced filtering
[2m2025-10-12T01:58:01.862524Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T01:58:01.863358Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T01:58:01.863535Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0m5aa72b8d-4758-4e48-864e-fd1f52f8aeda
[2m2025-10-12T01:58:01.863570Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 5aa72b8d-4758-4e48-864e-fd1f52f8aeda: Processing headers for user 1 with limit 50 offset 50
[2m2025-10-12T01:58:01.863597Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 5aa72b8d-4758-4e48-864e-fd1f52f8aeda: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            h.issuer_ruc,
            h.issuer_dv,
            h.issuer_address,
            h.issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T01:58:01.864498Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0m0f251e68-751f-4a4b-a3ce-4e1b1931c7b5
[2m2025-10-12T01:58:01.864726Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 0f251e68-751f-4a4b-a3ce-4e1b1931c7b5: Processing headers for user 1 with limit 50 offset 100
[2m2025-10-12T01:58:01.864842Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 0f251e68-751f-4a4b-a3ce-4e1b1931c7b5: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            h.issuer_ruc,
            h.issuer_dv,
            h.issuer_address,
            h.issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T01:58:01.871306Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 5aa72b8d-4758-4e48-864e-fd1f52f8aeda: Retrieved 0 invoice headers (total: 1) in 7ms with enhanced filtering
[2m2025-10-12T01:58:01.871673Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 0f251e68-751f-4a4b-a3ce-4e1b1931c7b5: Retrieved 0 invoice headers (total: 1) in 7ms with enhanced filtering
[2m2025-10-12T01:58:02.139247Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T01:58:02.139537Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0m7678fb4e-adc1-4a68-8b5d-e975a1347662
[2m2025-10-12T01:58:02.139570Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 7678fb4e-adc1-4a68-8b5d-e975a1347662: Processing headers for user 1 with limit 50 offset 150
[2m2025-10-12T01:58:02.139622Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 7678fb4e-adc1-4a68-8b5d-e975a1347662: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            h.issuer_ruc,
            h.issuer_dv,
            h.issuer_address,
            h.issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T01:58:02.140544Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T01:58:02.141499Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0mde389806-8465-4690-9e6d-3d5c27a972ea
[2m2025-10-12T01:58:02.141664Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request de389806-8465-4690-9e6d-3d5c27a972ea: Processing headers for user 1 with limit 50 offset 200
[2m2025-10-12T01:58:02.141730Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request de389806-8465-4690-9e6d-3d5c27a972ea: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            h.issuer_ruc,
            h.issuer_dv,
            h.issuer_address,
            h.issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T01:58:02.142278Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T01:58:02.142446Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0m20622c6c-90c1-4de2-a390-96999d367d14
[2m2025-10-12T01:58:02.143008Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 20622c6c-90c1-4de2-a390-96999d367d14: Processing headers for user 1 with limit 50 offset 250
[2m2025-10-12T01:58:02.143114Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 20622c6c-90c1-4de2-a390-96999d367d14: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            h.issuer_ruc,
            h.issuer_dv,
            h.issuer_address,
            h.issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T01:58:02.149772Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 20622c6c-90c1-4de2-a390-96999d367d14: Retrieved 0 invoice headers (total: 1) in 7ms with enhanced filtering
[2m2025-10-12T01:58:02.152135Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 7678fb4e-adc1-4a68-8b5d-e975a1347662: Retrieved 0 invoice headers (total: 1) in 12ms with enhanced filtering
[2m2025-10-12T01:58:02.153193Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request de389806-8465-4690-9e6d-3d5c27a972ea: Retrieved 0 invoice headers (total: 1) in 11ms with enhanced filtering
[2m2025-10-12T01:58:02.323168Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T01:58:02.323413Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T01:58:02.323475Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m605b4da5-d97f-4b01-8afd-9016f383a624
[2m2025-10-12T01:58:02.323533Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 605b4da5-d97f-4b01-8afd-9016f383a624: Processing for user 1 with limit 100 offset 200 order_by date direction DESC
[2m2025-10-12T01:58:02.323556Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 605b4da5-d97f-4b01-8afd-9016f383a624: Querying details for user 1 with enhanced filters
[2m2025-10-12T01:58:02.323593Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 605b4da5-d97f-4b01-8afd-9016f383a624: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T01:58:02.323660Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m5e8607e2-647f-4c26-9c42-6bfecf3d1293
[2m2025-10-12T01:58:02.323726Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 5e8607e2-647f-4c26-9c42-6bfecf3d1293: Processing for user 1 with limit 100 offset 100 order_by date direction DESC
[2m2025-10-12T01:58:02.323744Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 5e8607e2-647f-4c26-9c42-6bfecf3d1293: Querying details for user 1 with enhanced filters
[2m2025-10-12T01:58:02.323773Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 5e8607e2-647f-4c26-9c42-6bfecf3d1293: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T01:58:02.324245Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T01:58:02.324503Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m6f7c1efa-5a1f-4c29-89f8-3f524beb9c55
[2m2025-10-12T01:58:02.324543Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 6f7c1efa-5a1f-4c29-89f8-3f524beb9c55: Processing for user 1 with limit 100 offset 0 order_by date direction DESC
[2m2025-10-12T01:58:02.324562Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 6f7c1efa-5a1f-4c29-89f8-3f524beb9c55: Querying details for user 1 with enhanced filters
[2m2025-10-12T01:58:02.324593Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 6f7c1efa-5a1f-4c29-89f8-3f524beb9c55: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T01:58:02.328026Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 5e8607e2-647f-4c26-9c42-6bfecf3d1293: Retrieved 0 invoice details (total: 1) in 4ms with enhanced pagination
[2m2025-10-12T01:58:02.328339Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 6f7c1efa-5a1f-4c29-89f8-3f524beb9c55: Retrieved 1 invoice details (total: 1) in 3ms with enhanced pagination
[2m2025-10-12T01:58:02.329497Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 605b4da5-d97f-4b01-8afd-9016f383a624: Retrieved 0 invoice details (total: 1) in 6ms with enhanced pagination
[2m2025-10-12T01:58:02.641921Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T01:58:02.642215Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0mc27c2573-1606-42fb-9b8a-c3d9b5a1158b
[2m2025-10-12T01:58:02.642243Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request c27c2573-1606-42fb-9b8a-c3d9b5a1158b: Processing for user 1 with limit 100 offset 500 order_by date direction DESC
[2m2025-10-12T01:58:02.642303Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request c27c2573-1606-42fb-9b8a-c3d9b5a1158b: Querying details for user 1 with enhanced filters
[2m2025-10-12T01:58:02.642339Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request c27c2573-1606-42fb-9b8a-c3d9b5a1158b: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T01:58:02.643532Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T01:58:02.644123Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T01:58:02.644334Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m0695bc0e-1c4e-4131-a25f-adddec133f3d
[2m2025-10-12T01:58:02.644417Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 0695bc0e-1c4e-4131-a25f-adddec133f3d: Processing for user 1 with limit 100 offset 300 order_by date direction DESC
[2m2025-10-12T01:58:02.644482Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 0695bc0e-1c4e-4131-a25f-adddec133f3d: Querying details for user 1 with enhanced filters
[2m2025-10-12T01:58:02.644553Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 0695bc0e-1c4e-4131-a25f-adddec133f3d: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T01:58:02.646818Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0mc40e6af8-320e-400e-9c27-8650ef7dfdb1
[2m2025-10-12T01:58:02.647513Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request c40e6af8-320e-400e-9c27-8650ef7dfdb1: Processing for user 1 with limit 100 offset 400 order_by date direction DESC
[2m2025-10-12T01:58:02.647590Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request c40e6af8-320e-400e-9c27-8650ef7dfdb1: Querying details for user 1 with enhanced filters
[2m2025-10-12T01:58:02.647684Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request c40e6af8-320e-400e-9c27-8650ef7dfdb1: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T01:58:02.648940Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 0695bc0e-1c4e-4131-a25f-adddec133f3d: Retrieved 0 invoice details (total: 1) in 4ms with enhanced pagination
[2m2025-10-12T01:58:02.650108Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request c27c2573-1606-42fb-9b8a-c3d9b5a1158b: Retrieved 0 invoice details (total: 1) in 7ms with enhanced pagination
[2m2025-10-12T01:58:02.652141Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request c40e6af8-320e-400e-9c27-8650ef7dfdb1: Retrieved 0 invoice details (total: 1) in 5ms with enhanced pagination
[2m2025-10-12T01:58:04.139250Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T01:58:04.139896Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T01:58:04.140594Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T01:58:04.140917Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0m2410a1d1-75ad-4902-bb62-97237abf2950
[2m2025-10-12T01:58:04.140944Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 2410a1d1-75ad-4902-bb62-97237abf2950: Processing headers for user 1 with limit 50 offset 50
[2m2025-10-12T01:58:04.140979Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0m2c80aabb-c451-45cd-bbf8-97638497893a
[2m2025-10-12T01:58:04.141001Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 2c80aabb-c451-45cd-bbf8-97638497893a: Processing headers for user 1 with limit 50 offset 0
[2m2025-10-12T01:58:04.140974Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 2410a1d1-75ad-4902-bb62-97237abf2950: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            h.issuer_ruc,
            h.issuer_dv,
            h.issuer_address,
            h.issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T01:58:04.141020Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 2c80aabb-c451-45cd-bbf8-97638497893a: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            h.issuer_ruc,
            h.issuer_dv,
            h.issuer_address,
            h.issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T01:58:04.142235Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0m1ab9467e-2ac5-4d16-949c-411697f34a5c
[2m2025-10-12T01:58:04.142375Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 1ab9467e-2ac5-4d16-949c-411697f34a5c: Processing headers for user 1 with limit 50 offset 100
[2m2025-10-12T01:58:04.142484Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 1ab9467e-2ac5-4d16-949c-411697f34a5c: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            h.issuer_ruc,
            h.issuer_dv,
            h.issuer_address,
            h.issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T01:58:04.145165Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 2c80aabb-c451-45cd-bbf8-97638497893a: Retrieved 0 invoice headers (total: 0) in 4ms with enhanced filtering
[2m2025-10-12T01:58:04.146138Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 1ab9467e-2ac5-4d16-949c-411697f34a5c: Retrieved 0 invoice headers (total: 0) in 3ms with enhanced filtering
[2m2025-10-12T01:58:04.146322Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 2410a1d1-75ad-4902-bb62-97237abf2950: Retrieved 0 invoice headers (total: 0) in 5ms with enhanced filtering
[2m2025-10-12T01:58:04.320358Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T01:58:04.320623Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m62b48006-53b7-4884-9816-bb814be2e5dc
[2m2025-10-12T01:58:04.320673Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 62b48006-53b7-4884-9816-bb814be2e5dc: Processing for user 1 with limit 100 offset 200 order_by date direction DESC
[2m2025-10-12T01:58:04.320693Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 62b48006-53b7-4884-9816-bb814be2e5dc: Querying details for user 1 with enhanced filters
[2m2025-10-12T01:58:04.320723Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 62b48006-53b7-4884-9816-bb814be2e5dc: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T01:58:04.321441Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T01:58:04.321567Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0mfde0bc00-7b53-45eb-99ee-42a82c901fa9
[2m2025-10-12T01:58:04.321592Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request fde0bc00-7b53-45eb-99ee-42a82c901fa9: Processing for user 1 with limit 100 offset 0 order_by date direction DESC
[2m2025-10-12T01:58:04.321629Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request fde0bc00-7b53-45eb-99ee-42a82c901fa9: Querying details for user 1 with enhanced filters
[2m2025-10-12T01:58:04.321661Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request fde0bc00-7b53-45eb-99ee-42a82c901fa9: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T01:58:04.322422Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T01:58:04.322557Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m336c8260-f1f3-45a5-9088-d8a1200d3731
[2m2025-10-12T01:58:04.322584Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 336c8260-f1f3-45a5-9088-d8a1200d3731: Processing for user 1 with limit 100 offset 100 order_by date direction DESC
[2m2025-10-12T01:58:04.322616Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 336c8260-f1f3-45a5-9088-d8a1200d3731: Querying details for user 1 with enhanced filters
[2m2025-10-12T01:58:04.322652Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 336c8260-f1f3-45a5-9088-d8a1200d3731: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T01:58:04.325520Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 336c8260-f1f3-45a5-9088-d8a1200d3731: Retrieved 0 invoice details (total: 0) in 2ms with enhanced pagination
[2m2025-10-12T01:58:04.326479Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 62b48006-53b7-4884-9816-bb814be2e5dc: Retrieved 0 invoice details (total: 0) in 5ms with enhanced pagination
[2m2025-10-12T01:58:04.328055Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request fde0bc00-7b53-45eb-99ee-42a82c901fa9: Retrieved 0 invoice details (total: 0) in 6ms with enhanced pagination
[2m2025-10-12T02:00:54.423222Z[0m [32m INFO[0m [2mlum_rust_ws::api::root_v4[0m[2m:[0m Request 482cdeb9-f903-4e98-a495-a74f87fd9149: Root endpoint accessed
[2m2025-10-12T02:00:54.768219Z[0m [33m WARN[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m Missing Authorization header
[2m2025-10-12T02:00:58.131316Z[0m [32m INFO[0m [2mlum_rust_ws::api::root_v4[0m[2m:[0m Request 6a777625-cb12-48c8-a5f5-8cb0b5d212fc: Root endpoint accessed
[2m2025-10-12T02:13:54.191231Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T02:13:54.191455Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T02:13:54.191570Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m Fetching user data for user_id: 1
[2m2025-10-12T02:13:54.195142Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m User data retrieved in 3ms for user_id: 1 - email: Some("andresfelipevalenciag@gmail.com")
[2m2025-10-12T02:13:55.176089Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T02:13:55.176292Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m Getting user balance for user_id: 1
[2m2025-10-12T02:13:55.178529Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m User balance retrieved successfully for user 1 in 2ms: 299 L√ºmis
[2m2025-10-12T02:13:55.725619Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T02:13:55.725878Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0m637dd7fd-aa2e-4c93-a8fb-5b65d802e286
[2m2025-10-12T02:13:55.725919Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 637dd7fd-aa2e-4c93-a8fb-5b65d802e286: Processing headers for user 1 with limit 50 offset 0
[2m2025-10-12T02:13:55.725951Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 637dd7fd-aa2e-4c93-a8fb-5b65d802e286: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            h.issuer_ruc,
            h.issuer_dv,
            h.issuer_address,
            h.issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T02:13:55.730189Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 637dd7fd-aa2e-4c93-a8fb-5b65d802e286: Retrieved 0 invoice headers (total: 0) in 4ms with enhanced filtering
[2m2025-10-12T02:13:56.675205Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T02:13:56.675462Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0m7a90f535-9d19-4dc2-baa0-6d6c20c32799
[2m2025-10-12T02:13:56.675500Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 7a90f535-9d19-4dc2-baa0-6d6c20c32799: Processing headers for user 1 with limit 50 offset 100
[2m2025-10-12T02:13:56.675526Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 7a90f535-9d19-4dc2-baa0-6d6c20c32799: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            h.issuer_ruc,
            h.issuer_dv,
            h.issuer_address,
            h.issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T02:13:56.677633Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T02:13:56.677785Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0me5b65944-3659-4b71-be0a-53a7606e89ca
[2m2025-10-12T02:13:56.677872Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request e5b65944-3659-4b71-be0a-53a7606e89ca: Processing headers for user 1 with limit 50 offset 50
[2m2025-10-12T02:13:56.677898Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request e5b65944-3659-4b71-be0a-53a7606e89ca: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            h.issuer_ruc,
            h.issuer_dv,
            h.issuer_address,
            h.issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T02:13:56.680764Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 7a90f535-9d19-4dc2-baa0-6d6c20c32799: Retrieved 0 invoice headers (total: 0) in 5ms with enhanced filtering
[2m2025-10-12T02:13:56.682387Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request e5b65944-3659-4b71-be0a-53a7606e89ca: Retrieved 0 invoice headers (total: 0) in 4ms with enhanced filtering
[2m2025-10-12T02:13:57.192094Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T02:13:57.192360Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0mbc297ba3-9226-4a59-85b1-3454bf6d6715
[2m2025-10-12T02:13:57.192419Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request bc297ba3-9226-4a59-85b1-3454bf6d6715: Processing for user 1 with limit 100 offset 100 order_by date direction DESC
[2m2025-10-12T02:13:57.192440Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request bc297ba3-9226-4a59-85b1-3454bf6d6715: Querying details for user 1 with enhanced filters
[2m2025-10-12T02:13:57.192476Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request bc297ba3-9226-4a59-85b1-3454bf6d6715: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T02:13:57.193445Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T02:13:57.193687Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m63b72605-d807-4dd8-825b-d2f3452a0977
[2m2025-10-12T02:13:57.193722Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 63b72605-d807-4dd8-825b-d2f3452a0977: Processing for user 1 with limit 100 offset 200 order_by date direction DESC
[2m2025-10-12T02:13:57.193743Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 63b72605-d807-4dd8-825b-d2f3452a0977: Querying details for user 1 with enhanced filters
[2m2025-10-12T02:13:57.193768Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 63b72605-d807-4dd8-825b-d2f3452a0977: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T02:13:57.198307Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T02:13:57.198592Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 63b72605-d807-4dd8-825b-d2f3452a0977: Retrieved 0 invoice details (total: 0) in 4ms with enhanced pagination
[2m2025-10-12T02:13:57.200115Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m43f803df-16c8-439f-90f7-2415a87f6565
[2m2025-10-12T02:13:57.200144Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 43f803df-16c8-439f-90f7-2415a87f6565: Processing for user 1 with limit 100 offset 0 order_by date direction DESC
[2m2025-10-12T02:13:57.200158Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 43f803df-16c8-439f-90f7-2415a87f6565: Querying details for user 1 with enhanced filters
[2m2025-10-12T02:13:57.200175Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 43f803df-16c8-439f-90f7-2415a87f6565: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T02:13:57.200509Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request bc297ba3-9226-4a59-85b1-3454bf6d6715: Retrieved 0 invoice details (total: 0) in 8ms with enhanced pagination
[2m2025-10-12T02:13:57.203399Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 43f803df-16c8-439f-90f7-2415a87f6565: Retrieved 0 invoice details (total: 0) in 3ms with enhanced pagination
[2m2025-10-12T02:15:32.370265Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T02:15:32.370583Z[0m [32m INFO[0m [2mlum_rust_ws::api::url_processing_v4[0m[2m:[0m Processing URL request for user 1: https://dgi-fep.mef.gob.pa/Consultas/FacturasPorQR?chFE=FE01200000000434-15-93796-2200512025101100002041000040310647845622&iAmb=1&digestValue=nYVNhuIuTBz3azVE/weE81MnPY6JWoPP4OhGhdm4SKM=&jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJjaEZFIjoiRkUwMTIwMDAwMDAwMDQzNC0xNS05Mzc5Ni0yMjAwNTEyMDI1MTAxMTAwMDAyMDQxMDAwMDQwMzEwNjQ3ODQ1NjIyIiwiaUFtYiI6IjEiLCJkaWdlc3RWYWx1ZSI6Im5ZVk5odUl1VEJ6M2F6VkUvd2VFODFNblBZNkpXb1BQNE9oR2hkbTRTS009In0.UfD_0umENALXW432NomB6Alcx6Ove_EL6kAaGOzZJNI
[2m2025-10-12T02:15:32.370670Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m Starting to scrape invoice from URL: https://dgi-fep.mef.gob.pa/Consultas/FacturasPorQR?chFE=FE01200000000434-15-93796-2200512025101100002041000040310647845622&iAmb=1&digestValue=nYVNhuIuTBz3azVE/weE81MnPY6JWoPP4OhGhdm4SKM=&jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJjaEZFIjoiRkUwMTIwMDAwMDAwMDQzNC0xNS05Mzc5Ni0yMjAwNTEyMDI1MTAxMTAwMDAyMDQxMDAwMDQwMzEwNjQ3ODQ1NjIyIiwiaUFtYiI6IjEiLCJkaWdlc3RWYWx1ZSI6Im5ZVk5odUl1VEJ6M2F6VkUvd2VFODFNblBZNkpXb1BQNE9oR2hkbTRTS009In0.UfD_0umENALXW432NomB6Alcx6Ove_EL6kAaGOzZJNI
[2m2025-10-12T02:15:32.370709Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m Fetching HTML with final URL tracking from: https://dgi-fep.mef.gob.pa/Consultas/FacturasPorQR?chFE=FE01200000000434-15-93796-2200512025101100002041000040310647845622&iAmb=1&digestValue=nYVNhuIuTBz3azVE/weE81MnPY6JWoPP4OhGhdm4SKM=&jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJjaEZFIjoiRkUwMTIwMDAwMDAwMDQzNC0xNS05Mzc5Ni0yMjAwNTEyMDI1MTAxMTAwMDAyMDQxMDAwMDQwMzEwNjQ3ODQ1NjIyIiwiaUFtYiI6IjEiLCJkaWdlc3RWYWx1ZSI6Im5ZVk5odUl1VEJ6M2F6VkUvd2VFODFNblBZNkpXb1BQNE9oR2hkbTRTS009In0.UfD_0umENALXW432NomB6Alcx6Ove_EL6kAaGOzZJNI
[2m2025-10-12T02:15:33.611775Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m Successfully fetched HTML content (29336 bytes) from final URL: https://dgi-fep.mef.gob.pa/Consultas/FacturasPorQR?chFE=FE01200000000434-15-93796-2200512025101100002041000040310647845622&iAmb=1&digestValue=nYVNhuIuTBz3azVE/weE81MnPY6JWoPP4OhGhdm4SKM=&jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJjaEZFIjoiRkUwMTIwMDAwMDAwMDQzNC0xNS05Mzc5Ni0yMjAwNTEyMDI1MTAxMTAwMDAyMDQxMDAwMDQwMzEwNjQ3ODQ1NjIyIiwiaUFtYiI6IjEiLCJkaWdlc3RWYWx1ZSI6Im5ZVk5odUl1VEJ6M2F6VkUvd2VFODFNblBZNkpXb1BQNE9oR2hkbTRTS009In0.UfD_0umENALXW432NomB6Alcx6Ove_EL6kAaGOzZJNI
[2m2025-10-12T02:15:33.620588Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m üîç DEBUG - HTML content length: 29336 bytes
[2m2025-10-12T02:15:33.620689Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m üîç DEBUG - HTML first 500 chars: 

<!DOCTYPE html>

<html lang="es-pa">
<head>
    <link rel="icon" type="image/png" href="/Images/favicon.png">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" /><title>
	
    Consultar Facturas Por QR

</title>

    <script type="text/javascript" src="/ruxitagentjs_ICA7NVfqrux_10323250822043923.js" data-dtconfig="rid=RID_-966364967|rpid=-50428213|domain=mef.gob.pa|reportUrl=/rb_bf36044oye|app=042269121d25fae7|cuc=s94amosz|o
[2m2025-10-12T02:15:33.620922Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m üîç DEBUG - HTML saved to /tmp/scraped_invoice.html
[2m2025-10-12T02:15:33.620966Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m Extracting invoice header from document using ocr_extractor
[2m2025-10-12T02:15:33.622617Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m üîç DEBUG - Calling extract_main_info with HTML length: 29069
[2m2025-10-12T02:15:33.637676Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m üîç DEBUG - extract_main_info SUCCESS, header keys: ["tot_itbms", "no", "emisor_phone", "vuelto", "receptor_dv", "date", "receptor_phone", "receptor_ruc", "emisor_ruc", "emisor_address", "total_pagado", "tot_amount", "receptor_address", "emisor_dv", "emisor_name", "receptor_name", "cufe"]
[2m2025-10-12T02:15:33.637755Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m üîç DEBUG - Raw header_data keys: ["tot_itbms", "no", "emisor_phone", "vuelto", "receptor_dv", "date", "receptor_phone", "receptor_ruc", "emisor_ruc", "emisor_address", "total_pagado", "tot_amount", "receptor_address", "emisor_dv", "emisor_name", "receptor_name", "cufe"]
[2m2025-10-12T02:15:33.637778Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m üîç DEBUG - emisor_name value: Some("IMPORTADORA RICAMAR S A")
[2m2025-10-12T02:15:33.637790Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m üîç DEBUG - tot_amount_str value: Some("4.65")
[2m2025-10-12T02:15:33.637818Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m üîç DEBUG - Extracted data - RUC: Some("434-15-93796"), Nombre: Some("IMPORTADORA RICAMAR S A"), Total: Some(4.65), ITBMS: Some(0.0)
[2m2025-10-12T02:15:33.638046Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m Found 12 potential detail rows
[2m2025-10-12T02:15:33.638423Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m Payment information extracted: forma_de_pago=Some("Tarjeta Cr√©dito"), total_pagado=Some("4.65")
[2m2025-10-12T02:15:33.640413Z[0m [32m INFO[0m [2mlum_rust_ws::api::database_persistence[0m[2m:[0m Saving invoice header with CUFE: FE01200000000434-15-93796-2200512025101100002041000040310647845622
[2m2025-10-12T02:15:33.644424Z[0m [32m INFO[0m [2msqlx::postgres::notice[0m[2m:[0m Usuario 1, sin redenci√≥n previa, buscando desde: 2025-09-15
[2m2025-10-12T02:15:33.645106Z[0m [32m INFO[0m [2msqlx::postgres::notice[0m[2m:[0m Usuario 1, contando desde semana m√°s reciente con facturas: 2025-10-06
[2m2025-10-12T02:15:33.645802Z[0m [32m INFO[0m [2msqlx::postgres::notice[0m[2m:[0m Semana 0 (desde 2025-10-06 hasta 2025-10-12 00:00:00): facturas = t
[2m2025-10-12T02:15:33.646162Z[0m [32m INFO[0m [2msqlx::postgres::notice[0m[2m:[0m Semana 1 (desde 2025-09-29 hasta 2025-10-05 00:00:00): facturas = t
[2m2025-10-12T02:15:33.646256Z[0m [32m INFO[0m [2msqlx::postgres::notice[0m[2m:[0m Semana 2 (desde 2025-09-22 hasta 2025-09-28 00:00:00): facturas = t
[2m2025-10-12T02:15:33.646424Z[0m [32m INFO[0m [2msqlx::postgres::notice[0m[2m:[0m Semana 3 (desde 2025-09-15 hasta 2025-09-21 00:00:00): facturas = t
[2m2025-10-12T02:15:33.646465Z[0m [32m INFO[0m [2msqlx::postgres::notice[0m[2m:[0m Resultado final para usuario 1: 4 semanas consecutivas (despu√©s de redenci√≥n: <NULL>)
[2m2025-10-12T02:15:33.695829Z[0m [32m INFO[0m [2mlum_rust_ws::api::database_persistence[0m[2m:[0m Saving 1 invoice details
[2m2025-10-12T02:15:33.696643Z[0m [32m INFO[0m [2mlum_rust_ws::api::database_persistence[0m[2m:[0m Saving 1 invoice payments
[2m2025-10-12T02:15:33.719694Z[0m [32m INFO[0m [2mlum_rust_ws::api::database_persistence[0m[2m:[0m üîç DEBUG - Creando respuesta con issuer_name: Some("IMPORTADORA RICAMAR S A"), tot_amount: Some(4.65)
[2m2025-10-12T02:15:33.721143Z[0m [32m INFO[0m [2mlum_rust_ws::api::gamification_service[0m[2m:[0m ÔøΩÔøΩ Found accumulation rule: 'receipts' (id=0) with 1 Lumis
[2m2025-10-12T02:15:33.725677Z[0m [32m INFO[0m [2mlum_rust_ws::api::gamification_service[0m[2m:[0m ‚úÖ Recorded accumulation for user 1 - 1 Lumis (CUFE: FE01200000000434-15-93796-2200512025101100002041000040310647845622)
[2m2025-10-12T02:15:33.726957Z[0m [32m INFO[0m [2mlum_rust_ws::api::gamification_service[0m[2m:[0m üí∞ New balance for user 1: 300 Lumis
[2m2025-10-12T02:15:33.727004Z[0m [32m INFO[0m [2mlum_rust_ws::api::url_processing_v4[0m[2m:[0m ‚úÖ Successfully credited 1 Lumis to user 1. New balance: 300
[2m2025-10-12T02:16:24.783996Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T02:16:24.784163Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m Getting user balance for user_id: 1
[2m2025-10-12T02:16:24.786164Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m User balance retrieved successfully for user 1 in 1ms: 300 L√ºmis
[2m2025-10-12T02:18:38.826083Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T02:18:38.826356Z[0m [32m INFO[0m [2mlum_rust_ws::api::url_processing_v4[0m[2m:[0m Processing URL request for user 1: https://dgi-fep.mef.gob.pa/Consultas/FacturasPorQR?chFE=FE01200000000434-15-93796-2200512025101100002104380050312308413028&iAmb=1&digestValue=sHKttJh3945+T033s9Krr+9/Fw6oun1yLH/6XW8bukI=&jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJjaEZFIjoiRkUwMTIwMDAwMDAwMDQzNC0xNS05Mzc5Ni0yMjAwNTEyMDI1MTAxMTAwMDAyMTA0MzgwMDUwMzEyMzA4NDEzMDI4IiwiaUFtYiI6IjEiLCJkaWdlc3RWYWx1ZSI6InNIS3R0SmgzOTQ1K1QwMzNzOUtycis5L0Z3Nm91bjF5TEgvNlhXOGJ1a0k9In0.XXv-2GC3LP1xtcsU_Mhwt5sVn2sLGFFpxw1ap80vwbo
[2m2025-10-12T02:18:38.826414Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m Starting to scrape invoice from URL: https://dgi-fep.mef.gob.pa/Consultas/FacturasPorQR?chFE=FE01200000000434-15-93796-2200512025101100002104380050312308413028&iAmb=1&digestValue=sHKttJh3945+T033s9Krr+9/Fw6oun1yLH/6XW8bukI=&jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJjaEZFIjoiRkUwMTIwMDAwMDAwMDQzNC0xNS05Mzc5Ni0yMjAwNTEyMDI1MTAxMTAwMDAyMTA0MzgwMDUwMzEyMzA4NDEzMDI4IiwiaUFtYiI6IjEiLCJkaWdlc3RWYWx1ZSI6InNIS3R0SmgzOTQ1K1QwMzNzOUtycis5L0Z3Nm91bjF5TEgvNlhXOGJ1a0k9In0.XXv-2GC3LP1xtcsU_Mhwt5sVn2sLGFFpxw1ap80vwbo
[2m2025-10-12T02:18:38.826443Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m Fetching HTML with final URL tracking from: https://dgi-fep.mef.gob.pa/Consultas/FacturasPorQR?chFE=FE01200000000434-15-93796-2200512025101100002104380050312308413028&iAmb=1&digestValue=sHKttJh3945+T033s9Krr+9/Fw6oun1yLH/6XW8bukI=&jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJjaEZFIjoiRkUwMTIwMDAwMDAwMDQzNC0xNS05Mzc5Ni0yMjAwNTEyMDI1MTAxMTAwMDAyMTA0MzgwMDUwMzEyMzA4NDEzMDI4IiwiaUFtYiI6IjEiLCJkaWdlc3RWYWx1ZSI6InNIS3R0SmgzOTQ1K1QwMzNzOUtycis5L0Z3Nm91bjF5TEgvNlhXOGJ1a0k9In0.XXv-2GC3LP1xtcsU_Mhwt5sVn2sLGFFpxw1ap80vwbo
[2m2025-10-12T02:18:40.226709Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m Successfully fetched HTML content (30697 bytes) from final URL: https://dgi-fep.mef.gob.pa/Consultas/FacturasPorQR?chFE=FE01200000000434-15-93796-2200512025101100002104380050312308413028&iAmb=1&digestValue=sHKttJh3945+T033s9Krr+9/Fw6oun1yLH/6XW8bukI=&jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJjaEZFIjoiRkUwMTIwMDAwMDAwMDQzNC0xNS05Mzc5Ni0yMjAwNTEyMDI1MTAxMTAwMDAyMTA0MzgwMDUwMzEyMzA4NDEzMDI4IiwiaUFtYiI6IjEiLCJkaWdlc3RWYWx1ZSI6InNIS3R0SmgzOTQ1K1QwMzNzOUtycis5L0Z3Nm91bjF5TEgvNlhXOGJ1a0k9In0.XXv-2GC3LP1xtcsU_Mhwt5sVn2sLGFFpxw1ap80vwbo
[2m2025-10-12T02:18:40.235367Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m üîç DEBUG - HTML content length: 30697 bytes
[2m2025-10-12T02:18:40.235440Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m üîç DEBUG - HTML first 500 chars: 

<!DOCTYPE html>

<html lang="es-pa">
<head>
    <link rel="icon" type="image/png" href="/Images/favicon.png">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" /><title>
	
    Consultar Facturas Por QR

</title>

    <script type="text/javascript" src="/ruxitagentjs_ICA7NVfqrux_10323250822043923.js" data-dtconfig="rid=RID_452125239|rpid=-1473400242|domain=mef.gob.pa|reportUrl=/rb_bf36044oye|app=042269121d25fae7|cuc=s94amosz|
[2m2025-10-12T02:18:40.235743Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m üîç DEBUG - HTML saved to /tmp/scraped_invoice.html
[2m2025-10-12T02:18:40.235782Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m Extracting invoice header from document using ocr_extractor
[2m2025-10-12T02:18:40.237422Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m üîç DEBUG - Calling extract_main_info with HTML length: 30430
[2m2025-10-12T02:18:40.252642Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m üîç DEBUG - extract_main_info SUCCESS, header keys: ["receptor_address", "emisor_phone", "no", "receptor_dv", "vuelto", "emisor_dv", "total_pagado", "receptor_ruc", "tot_amount", "emisor_address", "emisor_ruc", "emisor_name", "receptor_name", "tot_itbms", "cufe", "receptor_phone", "date"]
[2m2025-10-12T02:18:40.252705Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m üîç DEBUG - Raw header_data keys: ["receptor_address", "emisor_phone", "no", "receptor_dv", "vuelto", "emisor_dv", "total_pagado", "receptor_ruc", "tot_amount", "emisor_address", "emisor_ruc", "emisor_name", "receptor_name", "tot_itbms", "cufe", "receptor_phone", "date"]
[2m2025-10-12T02:18:40.252725Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m üîç DEBUG - emisor_name value: Some("IMPORTADORA RICAMAR S A")
[2m2025-10-12T02:18:40.252736Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m üîç DEBUG - tot_amount_str value: Some("2.00")
[2m2025-10-12T02:18:40.252755Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m üîç DEBUG - Extracted data - RUC: Some("434-15-93796"), Nombre: Some("IMPORTADORA RICAMAR S A"), Total: Some(2.0), ITBMS: Some(0.0)
[2m2025-10-12T02:18:40.252941Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m Found 13 potential detail rows
[2m2025-10-12T02:18:40.253206Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m Payment information extracted: forma_de_pago=Some("Tarjeta Cr√©dito"), total_pagado=Some("2.00")
[2m2025-10-12T02:18:40.254911Z[0m [33m WARN[0m [2mlum_rust_ws::api::url_processing_v4[0m[2m:[0m ‚ö†Ô∏è Factura duplicada detectada - no se guarda en mef_pending
[2m2025-10-12T02:24:21.015870Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T02:24:21.016230Z[0m [32m INFO[0m [2mlum_rust_ws::api::url_processing_v4[0m[2m:[0m Processing URL request for user 1: https://dgi-fep.mef.gob.pa/Consultas/FacturasPorQR?chFE=FE0120000000346-266-76470-13S5142025101000001224290010318270767831&iAmb=1&digestValue=Gq9BcKSAhZ/J/s3icx5VkCW86WzDGC0KgKSlmeEOxP4=&jwt=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJkaWdlc3RWYWx1ZSI6IkdxOUJjS1NBaFovSi9zM2ljeDVWa0NXODZXekRHQzBLZ0tTbG1lRU94UDQ9IiwiY2hGRSI6IkZFMDEyMDAwMDAwMDM0Ni0yNjYtNzY0NzAtMTNTNTE0MjAyNTEwMTAwMDAwMTIyNDI5MDAxMDMxODI3MDc2NzgzMSIsImlBbWIiOiIxIn0.qqYPXabgkWj0erCOlOmXC6p-gphNWOcEG9OTglz5IIE
[2m2025-10-12T02:24:21.016299Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m Starting to scrape invoice from URL: https://dgi-fep.mef.gob.pa/Consultas/FacturasPorQR?chFE=FE0120000000346-266-76470-13S5142025101000001224290010318270767831&iAmb=1&digestValue=Gq9BcKSAhZ/J/s3icx5VkCW86WzDGC0KgKSlmeEOxP4=&jwt=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJkaWdlc3RWYWx1ZSI6IkdxOUJjS1NBaFovSi9zM2ljeDVWa0NXODZXekRHQzBLZ0tTbG1lRU94UDQ9IiwiY2hGRSI6IkZFMDEyMDAwMDAwMDM0Ni0yNjYtNzY0NzAtMTNTNTE0MjAyNTEwMTAwMDAwMTIyNDI5MDAxMDMxODI3MDc2NzgzMSIsImlBbWIiOiIxIn0.qqYPXabgkWj0erCOlOmXC6p-gphNWOcEG9OTglz5IIE
[2m2025-10-12T02:24:21.016353Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m Fetching HTML with final URL tracking from: https://dgi-fep.mef.gob.pa/Consultas/FacturasPorQR?chFE=FE0120000000346-266-76470-13S5142025101000001224290010318270767831&iAmb=1&digestValue=Gq9BcKSAhZ/J/s3icx5VkCW86WzDGC0KgKSlmeEOxP4=&jwt=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJkaWdlc3RWYWx1ZSI6IkdxOUJjS1NBaFovSi9zM2ljeDVWa0NXODZXekRHQzBLZ0tTbG1lRU94UDQ9IiwiY2hGRSI6IkZFMDEyMDAwMDAwMDM0Ni0yNjYtNzY0NzAtMTNTNTE0MjAyNTEwMTAwMDAwMTIyNDI5MDAxMDMxODI3MDc2NzgzMSIsImlBbWIiOiIxIn0.qqYPXabgkWj0erCOlOmXC6p-gphNWOcEG9OTglz5IIE
[2m2025-10-12T02:24:22.544627Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m Successfully fetched HTML content (26994 bytes) from final URL: https://dgi-fep.mef.gob.pa/Consultas/FacturasPorQR?chFE=FE0120000000346-266-76470-13S5142025101000001224290010318270767831&iAmb=1&digestValue=Gq9BcKSAhZ/J/s3icx5VkCW86WzDGC0KgKSlmeEOxP4=&jwt=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJkaWdlc3RWYWx1ZSI6IkdxOUJjS1NBaFovSi9zM2ljeDVWa0NXODZXekRHQzBLZ0tTbG1lRU94UDQ9IiwiY2hGRSI6IkZFMDEyMDAwMDAwMDM0Ni0yNjYtNzY0NzAtMTNTNTE0MjAyNTEwMTAwMDAwMTIyNDI5MDAxMDMxODI3MDc2NzgzMSIsImlBbWIiOiIxIn0.qqYPXabgkWj0erCOlOmXC6p-gphNWOcEG9OTglz5IIE
[2m2025-10-12T02:24:22.552232Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m üîç DEBUG - HTML content length: 26994 bytes
[2m2025-10-12T02:24:22.552333Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m üîç DEBUG - HTML first 500 chars: 

<!DOCTYPE html>

<html lang="es-pa">
<head>
    <link rel="icon" type="image/png" href="/Images/favicon.png">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" /><title>
	
    Consultar Facturas Por QR

</title>

    <script type="text/javascript" src="/ruxitagentjs_ICA7NVfqrux_10323250822043923.js" data-dtconfig="rid=RID_1786945179|rpid=-413709141|domain=mef.gob.pa|reportUrl=/rb_bf36044oye|app=042269121d25fae7|cuc=s94amosz|
[2m2025-10-12T02:24:22.552564Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m üîç DEBUG - HTML saved to /tmp/scraped_invoice.html
[2m2025-10-12T02:24:22.552675Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m Extracting invoice header from document using ocr_extractor
[2m2025-10-12T02:24:22.554130Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m üîç DEBUG - Calling extract_main_info with HTML length: 26727
[2m2025-10-12T02:24:22.566428Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m üîç DEBUG - extract_main_info SUCCESS, header keys: ["no", "receptor_phone", "total_pagado", "emisor_address", "receptor_dv", "cufe", "emisor_phone", "vuelto", "tot_amount", "tot_itbms", "receptor_ruc", "emisor_name", "receptor_address", "date", "receptor_name", "emisor_ruc", "emisor_dv"]
[2m2025-10-12T02:24:22.566495Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m üîç DEBUG - Raw header_data keys: ["no", "receptor_phone", "total_pagado", "emisor_address", "receptor_dv", "cufe", "emisor_phone", "vuelto", "tot_amount", "tot_itbms", "receptor_ruc", "emisor_name", "receptor_address", "date", "receptor_name", "emisor_ruc", "emisor_dv"]
[2m2025-10-12T02:24:22.566518Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m üîç DEBUG - emisor_name value: Some("Farmacia Arrocha, S. A.")
[2m2025-10-12T02:24:22.566539Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m üîç DEBUG - tot_amount_str value: Some("2.09")
[2m2025-10-12T02:24:22.566569Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m üîç DEBUG - Extracted data - RUC: Some("346-266-76470"), Nombre: Some("Farmacia Arrocha, S. A."), Total: Some(2.09), ITBMS: Some(0.14)
[2m2025-10-12T02:24:22.566732Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m Found 11 potential detail rows
[2m2025-10-12T02:24:22.567011Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m Payment information extracted: forma_de_pago=None, total_pagado=Some("2.09")
[2m2025-10-12T02:24:22.570233Z[0m [33m WARN[0m [2mlum_rust_ws::api::url_processing_v4[0m[2m:[0m ‚ö†Ô∏è Factura duplicada detectada - no se guarda en mef_pending
[2m2025-10-12T02:25:51.548732Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T02:25:51.548921Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T02:25:51.549003Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m Fetching user data for user_id: 1
[2m2025-10-12T02:25:51.551714Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m User data retrieved in 2ms for user_id: 1 - email: Some("andresfelipevalenciag@gmail.com")
[2m2025-10-12T02:25:52.712484Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T02:25:52.712644Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m Getting user balance for user_id: 1
[2m2025-10-12T02:25:52.714587Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m User balance retrieved successfully for user 1 in 1ms: 300 L√ºmis
[2m2025-10-12T02:25:53.224251Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T02:25:53.224527Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0m1415c10f-92b1-4859-ba41-4f408318ee1c
[2m2025-10-12T02:25:53.224567Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 1415c10f-92b1-4859-ba41-4f408318ee1c: Processing headers for user 1 with limit 50 offset 0
[2m2025-10-12T02:25:53.224619Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 1415c10f-92b1-4859-ba41-4f408318ee1c: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            h.issuer_ruc,
            h.issuer_dv,
            h.issuer_address,
            h.issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T02:25:53.230923Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 1415c10f-92b1-4859-ba41-4f408318ee1c: Retrieved 1 invoice headers (total: 1) in 6ms with enhanced filtering
[2m2025-10-12T02:25:54.052882Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T02:25:54.053206Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0mbeb07a63-de05-43aa-8dcf-bd50347b1e53
[2m2025-10-12T02:25:54.053249Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request beb07a63-de05-43aa-8dcf-bd50347b1e53: Processing headers for user 1 with limit 50 offset 50
[2m2025-10-12T02:25:54.053292Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request beb07a63-de05-43aa-8dcf-bd50347b1e53: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            h.issuer_ruc,
            h.issuer_dv,
            h.issuer_address,
            h.issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T02:25:54.054258Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T02:25:54.054502Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0m526afafc-0892-46b5-8d49-dc660bfd5eab
[2m2025-10-12T02:25:54.054526Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 526afafc-0892-46b5-8d49-dc660bfd5eab: Processing headers for user 1 with limit 50 offset 100
[2m2025-10-12T02:25:54.054551Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 526afafc-0892-46b5-8d49-dc660bfd5eab: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            h.issuer_ruc,
            h.issuer_dv,
            h.issuer_address,
            h.issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T02:25:54.060844Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request beb07a63-de05-43aa-8dcf-bd50347b1e53: Retrieved 0 invoice headers (total: 1) in 7ms with enhanced filtering
[2m2025-10-12T02:25:54.061797Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 526afafc-0892-46b5-8d49-dc660bfd5eab: Retrieved 0 invoice headers (total: 1) in 7ms with enhanced filtering
[2m2025-10-12T02:25:54.628792Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T02:25:54.629035Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T02:25:54.629135Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0mf7b64cf6-f7a4-4b54-9081-14d106387cc0
[2m2025-10-12T02:25:54.629168Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request f7b64cf6-f7a4-4b54-9081-14d106387cc0: Processing headers for user 1 with limit 50 offset 150
[2m2025-10-12T02:25:54.629193Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0m01e8f70b-09e6-4d11-869d-f8478bb028b7
[2m2025-10-12T02:25:54.629214Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 01e8f70b-09e6-4d11-869d-f8478bb028b7: Processing headers for user 1 with limit 50 offset 200
[2m2025-10-12T02:25:54.629192Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request f7b64cf6-f7a4-4b54-9081-14d106387cc0: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            h.issuer_ruc,
            h.issuer_dv,
            h.issuer_address,
            h.issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T02:25:54.629231Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 01e8f70b-09e6-4d11-869d-f8478bb028b7: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            h.issuer_ruc,
            h.issuer_dv,
            h.issuer_address,
            h.issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T02:25:54.631511Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T02:25:54.631666Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0mf6285a75-e7c4-4dd0-9d90-d9cb76719ebc
[2m2025-10-12T02:25:54.631703Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request f6285a75-e7c4-4dd0-9d90-d9cb76719ebc: Processing headers for user 1 with limit 50 offset 250
[2m2025-10-12T02:25:54.631722Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request f6285a75-e7c4-4dd0-9d90-d9cb76719ebc: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            h.issuer_ruc,
            h.issuer_dv,
            h.issuer_address,
            h.issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T02:25:54.637676Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 01e8f70b-09e6-4d11-869d-f8478bb028b7: Retrieved 0 invoice headers (total: 1) in 8ms with enhanced filtering
[2m2025-10-12T02:25:54.638067Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request f7b64cf6-f7a4-4b54-9081-14d106387cc0: Retrieved 0 invoice headers (total: 1) in 8ms with enhanced filtering
[2m2025-10-12T02:25:54.639090Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request f6285a75-e7c4-4dd0-9d90-d9cb76719ebc: Retrieved 0 invoice headers (total: 1) in 7ms with enhanced filtering
[2m2025-10-12T02:25:55.045376Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T02:25:55.045633Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m41b84db7-fe59-45e4-8398-1973f3882230
[2m2025-10-12T02:25:55.045672Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 41b84db7-fe59-45e4-8398-1973f3882230: Processing for user 1 with limit 100 offset 100 order_by date direction DESC
[2m2025-10-12T02:25:55.045691Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 41b84db7-fe59-45e4-8398-1973f3882230: Querying details for user 1 with enhanced filters
[2m2025-10-12T02:25:55.045717Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 41b84db7-fe59-45e4-8398-1973f3882230: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T02:25:55.046633Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T02:25:55.046768Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m1cb6e5e2-fe52-4cbe-ba1e-d9cc26f44bb0
[2m2025-10-12T02:25:55.046810Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 1cb6e5e2-fe52-4cbe-ba1e-d9cc26f44bb0: Processing for user 1 with limit 100 offset 0 order_by date direction DESC
[2m2025-10-12T02:25:55.046825Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 1cb6e5e2-fe52-4cbe-ba1e-d9cc26f44bb0: Querying details for user 1 with enhanced filters
[2m2025-10-12T02:25:55.046842Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 1cb6e5e2-fe52-4cbe-ba1e-d9cc26f44bb0: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T02:25:55.050249Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 41b84db7-fe59-45e4-8398-1973f3882230: Retrieved 0 invoice details (total: 1) in 4ms with enhanced pagination
[2m2025-10-12T02:25:55.051256Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T02:25:55.051859Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m1b8cbc86-1c31-4b3d-b9b2-7ce97815548c
[2m2025-10-12T02:25:55.052006Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 1b8cbc86-1c31-4b3d-b9b2-7ce97815548c: Processing for user 1 with limit 100 offset 200 order_by date direction DESC
[2m2025-10-12T02:25:55.052083Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 1b8cbc86-1c31-4b3d-b9b2-7ce97815548c: Querying details for user 1 with enhanced filters
[2m2025-10-12T02:25:55.052117Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 1b8cbc86-1c31-4b3d-b9b2-7ce97815548c: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T02:25:55.053153Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 1cb6e5e2-fe52-4cbe-ba1e-d9cc26f44bb0: Retrieved 1 invoice details (total: 1) in 6ms with enhanced pagination
[2m2025-10-12T02:25:55.057394Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 1b8cbc86-1c31-4b3d-b9b2-7ce97815548c: Retrieved 0 invoice details (total: 1) in 5ms with enhanced pagination
[2m2025-10-12T02:25:55.480737Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T02:25:55.481045Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m9bd66bd2-d694-436c-bcf4-891ad82877ea
[2m2025-10-12T02:25:55.481228Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 9bd66bd2-d694-436c-bcf4-891ad82877ea: Processing for user 1 with limit 100 offset 300 order_by date direction DESC
[2m2025-10-12T02:25:55.481257Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 9bd66bd2-d694-436c-bcf4-891ad82877ea: Querying details for user 1 with enhanced filters
[2m2025-10-12T02:25:55.481283Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 9bd66bd2-d694-436c-bcf4-891ad82877ea: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T02:25:55.481636Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T02:25:55.481862Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m57a8e31d-ea54-4531-a107-f0490ef07b69
[2m2025-10-12T02:25:55.481897Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 57a8e31d-ea54-4531-a107-f0490ef07b69: Processing for user 1 with limit 100 offset 500 order_by date direction DESC
[2m2025-10-12T02:25:55.481917Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 57a8e31d-ea54-4531-a107-f0490ef07b69: Querying details for user 1 with enhanced filters
[2m2025-10-12T02:25:55.481944Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 57a8e31d-ea54-4531-a107-f0490ef07b69: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T02:25:55.482802Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T02:25:55.482947Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m13d8ee65-cff6-41ab-9937-9da399d1f424
[2m2025-10-12T02:25:55.483072Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 13d8ee65-cff6-41ab-9937-9da399d1f424: Processing for user 1 with limit 100 offset 400 order_by date direction DESC
[2m2025-10-12T02:25:55.483094Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 13d8ee65-cff6-41ab-9937-9da399d1f424: Querying details for user 1 with enhanced filters
[2m2025-10-12T02:25:55.483113Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 13d8ee65-cff6-41ab-9937-9da399d1f424: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T02:25:55.485434Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 9bd66bd2-d694-436c-bcf4-891ad82877ea: Retrieved 0 invoice details (total: 1) in 4ms with enhanced pagination
[2m2025-10-12T02:25:55.487646Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 57a8e31d-ea54-4531-a107-f0490ef07b69: Retrieved 0 invoice details (total: 1) in 5ms with enhanced pagination
[2m2025-10-12T02:25:55.488663Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 13d8ee65-cff6-41ab-9937-9da399d1f424: Retrieved 0 invoice details (total: 1) in 5ms with enhanced pagination
[2m2025-10-12T02:25:58.824167Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T02:25:58.824451Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0md0c495eb-eea1-40d5-be32-0d10123d10af
[2m2025-10-12T02:25:58.824488Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request d0c495eb-eea1-40d5-be32-0d10123d10af: Processing headers for user 1 with limit 50 offset 0
[2m2025-10-12T02:25:58.824571Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request d0c495eb-eea1-40d5-be32-0d10123d10af: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            h.issuer_ruc,
            h.issuer_dv,
            h.issuer_address,
            h.issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T02:25:58.826590Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T02:25:58.826961Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0maf7a205d-ae1a-49f4-8a5e-f57a17735c4a
[2m2025-10-12T02:25:58.827078Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request af7a205d-ae1a-49f4-8a5e-f57a17735c4a: Processing headers for user 1 with limit 50 offset 50
[2m2025-10-12T02:25:58.827178Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request af7a205d-ae1a-49f4-8a5e-f57a17735c4a: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            h.issuer_ruc,
            h.issuer_dv,
            h.issuer_address,
            h.issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T02:25:58.828723Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request d0c495eb-eea1-40d5-be32-0d10123d10af: Retrieved 0 invoice headers (total: 0) in 4ms with enhanced filtering
[2m2025-10-12T02:25:58.830102Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request af7a205d-ae1a-49f4-8a5e-f57a17735c4a: Retrieved 0 invoice headers (total: 0) in 3ms with enhanced filtering
[2m2025-10-12T02:25:59.653696Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T02:25:59.654105Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0m5d35064d-92cf-4306-b5ed-53bda17a8810
[2m2025-10-12T02:25:59.654245Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 5d35064d-92cf-4306-b5ed-53bda17a8810: Processing headers for user 1 with limit 50 offset 100
[2m2025-10-12T02:25:59.654291Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 5d35064d-92cf-4306-b5ed-53bda17a8810: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            h.issuer_ruc,
            h.issuer_dv,
            h.issuer_address,
            h.issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T02:25:59.658883Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 5d35064d-92cf-4306-b5ed-53bda17a8810: Retrieved 0 invoice headers (total: 0) in 4ms with enhanced filtering
[2m2025-10-12T02:25:59.880928Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T02:25:59.881258Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m34aad602-fa6b-414b-bcee-7c42ad82f373
[2m2025-10-12T02:25:59.881378Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 34aad602-fa6b-414b-bcee-7c42ad82f373: Processing for user 1 with limit 100 offset 100 order_by date direction DESC
[2m2025-10-12T02:25:59.881482Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 34aad602-fa6b-414b-bcee-7c42ad82f373: Querying details for user 1 with enhanced filters
[2m2025-10-12T02:25:59.881512Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 34aad602-fa6b-414b-bcee-7c42ad82f373: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T02:25:59.882068Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T02:25:59.882295Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0mb4e586b5-68d0-4de3-8b59-40219c3a133a
[2m2025-10-12T02:25:59.882364Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request b4e586b5-68d0-4de3-8b59-40219c3a133a: Processing for user 1 with limit 100 offset 0 order_by date direction DESC
[2m2025-10-12T02:25:59.882385Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request b4e586b5-68d0-4de3-8b59-40219c3a133a: Querying details for user 1 with enhanced filters
[2m2025-10-12T02:25:59.882411Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request b4e586b5-68d0-4de3-8b59-40219c3a133a: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T02:25:59.882788Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T02:25:59.882991Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m6c19c0f2-d044-407e-8029-80a38adcb5a0
[2m2025-10-12T02:25:59.883014Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 6c19c0f2-d044-407e-8029-80a38adcb5a0: Processing for user 1 with limit 100 offset 200 order_by date direction DESC
[2m2025-10-12T02:25:59.883030Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 6c19c0f2-d044-407e-8029-80a38adcb5a0: Querying details for user 1 with enhanced filters
[2m2025-10-12T02:25:59.883054Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 6c19c0f2-d044-407e-8029-80a38adcb5a0: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T02:25:59.885882Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 34aad602-fa6b-414b-bcee-7c42ad82f373: Retrieved 0 invoice details (total: 0) in 4ms with enhanced pagination
[2m2025-10-12T02:25:59.886715Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request b4e586b5-68d0-4de3-8b59-40219c3a133a: Retrieved 0 invoice details (total: 0) in 4ms with enhanced pagination
[2m2025-10-12T02:25:59.888738Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 6c19c0f2-d044-407e-8029-80a38adcb5a0: Retrieved 0 invoice details (total: 0) in 5ms with enhanced pagination
[2m2025-10-12T02:27:33.715203Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T02:27:33.715422Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T02:27:33.715631Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m Fetching user data for user_id: 1
[2m2025-10-12T02:27:33.717532Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m User data retrieved in 1ms for user_id: 1 - email: Some("andresfelipevalenciag@gmail.com")
[2m2025-10-12T02:27:34.804688Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T02:27:34.804851Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m Getting user balance for user_id: 1
[2m2025-10-12T02:27:34.805935Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m User balance retrieved successfully for user 1 in 1ms: 300 L√ºmis
[2m2025-10-12T02:27:35.334869Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T02:27:35.335089Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0mfe9e281a-eca9-4f83-a1d3-9a2aec4cb290
[2m2025-10-12T02:27:35.335121Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request fe9e281a-eca9-4f83-a1d3-9a2aec4cb290: Processing headers for user 1 with limit 50 offset 0
[2m2025-10-12T02:27:35.335147Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request fe9e281a-eca9-4f83-a1d3-9a2aec4cb290: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            h.issuer_ruc,
            h.issuer_dv,
            h.issuer_address,
            h.issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T02:27:35.337164Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request fe9e281a-eca9-4f83-a1d3-9a2aec4cb290: Retrieved 0 invoice headers (total: 0) in 2ms with enhanced filtering
[2m2025-10-12T02:27:35.566425Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T02:27:35.566693Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0mbcd54f33-9297-4c8f-8d6a-8ba229cb0e4e
[2m2025-10-12T02:27:35.566730Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request bcd54f33-9297-4c8f-8d6a-8ba229cb0e4e: Processing headers for user 1 with limit 50 offset 100
[2m2025-10-12T02:27:35.566758Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request bcd54f33-9297-4c8f-8d6a-8ba229cb0e4e: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            h.issuer_ruc,
            h.issuer_dv,
            h.issuer_address,
            h.issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T02:27:35.568583Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request bcd54f33-9297-4c8f-8d6a-8ba229cb0e4e: Retrieved 0 invoice headers (total: 0) in 1ms with enhanced filtering
[2m2025-10-12T02:27:35.596905Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T02:27:35.597053Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0m0b90ec50-a2ea-457c-96bd-7a5f7b180ac0
[2m2025-10-12T02:27:35.597080Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 0b90ec50-a2ea-457c-96bd-7a5f7b180ac0: Processing headers for user 1 with limit 50 offset 50
[2m2025-10-12T02:27:35.597100Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 0b90ec50-a2ea-457c-96bd-7a5f7b180ac0: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            h.issuer_ruc,
            h.issuer_dv,
            h.issuer_address,
            h.issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T02:27:35.598721Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 0b90ec50-a2ea-457c-96bd-7a5f7b180ac0: Retrieved 0 invoice headers (total: 0) in 1ms with enhanced filtering
[2m2025-10-12T02:27:35.772062Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T02:27:35.772383Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m747734e9-9cdb-4f32-9e15-8fc0f3e5c436
[2m2025-10-12T02:27:35.772562Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 747734e9-9cdb-4f32-9e15-8fc0f3e5c436: Processing for user 1 with limit 100 offset 0 order_by date direction DESC
[2m2025-10-12T02:27:35.772669Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 747734e9-9cdb-4f32-9e15-8fc0f3e5c436: Querying details for user 1 with enhanced filters
[2m2025-10-12T02:27:35.772707Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 747734e9-9cdb-4f32-9e15-8fc0f3e5c436: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T02:27:35.773572Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T02:27:35.773746Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T02:27:35.773751Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0mc80c130b-3cf5-41fc-b201-932f3a2c89d6
[2m2025-10-12T02:27:35.773894Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request c80c130b-3cf5-41fc-b201-932f3a2c89d6: Processing for user 1 with limit 100 offset 200 order_by date direction DESC
[2m2025-10-12T02:27:35.773914Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request c80c130b-3cf5-41fc-b201-932f3a2c89d6: Querying details for user 1 with enhanced filters
[2m2025-10-12T02:27:35.773942Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request c80c130b-3cf5-41fc-b201-932f3a2c89d6: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T02:27:35.774112Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m5201d19c-6dae-4ad4-962d-96a706aba45f
[2m2025-10-12T02:27:35.774264Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 5201d19c-6dae-4ad4-962d-96a706aba45f: Processing for user 1 with limit 100 offset 100 order_by date direction DESC
[2m2025-10-12T02:27:35.774328Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 5201d19c-6dae-4ad4-962d-96a706aba45f: Querying details for user 1 with enhanced filters
[2m2025-10-12T02:27:35.774439Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 5201d19c-6dae-4ad4-962d-96a706aba45f: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T02:27:35.778042Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request c80c130b-3cf5-41fc-b201-932f3a2c89d6: Retrieved 0 invoice details (total: 0) in 4ms with enhanced pagination
[2m2025-10-12T02:27:35.778311Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 747734e9-9cdb-4f32-9e15-8fc0f3e5c436: Retrieved 0 invoice details (total: 0) in 5ms with enhanced pagination
[2m2025-10-12T02:27:35.778660Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 5201d19c-6dae-4ad4-962d-96a706aba45f: Retrieved 0 invoice details (total: 0) in 4ms with enhanced pagination
[2m2025-10-12T02:38:25.359404Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T02:38:25.359721Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T02:38:25.359915Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m Fetching user data for user_id: 1
[2m2025-10-12T02:38:25.359081Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T02:38:25.360131Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m Getting user balance for user_id: 1
[2m2025-10-12T02:38:25.362901Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m User balance retrieved successfully for user 1 in 2ms: 300 L√ºmis
[2m2025-10-12T02:38:25.364576Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m User data retrieved in 4ms for user_id: 1 - email: Some("andresfelipevalenciag@gmail.com")
[2m2025-10-12T02:42:50.756746Z[0m [32m INFO[0m [2mlum_rust_ws::api::root_v4[0m[2m:[0m Request 9dbd67ff-f5f9-40f4-9b46-128ecda99a55: Root endpoint accessed
[2m2025-10-12T02:43:46.012054Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T02:43:46.012451Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m Getting user balance for user_id: 1
[2m2025-10-12T02:43:46.014534Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m User balance retrieved successfully for user 1 in 2ms: 300 L√ºmis
[2m2025-10-12T02:43:46.020407Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T02:43:46.020525Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T02:43:46.020584Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m Fetching user data for user_id: 1
[2m2025-10-12T02:43:46.022547Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m User data retrieved in 1ms for user_id: 1 - email: Some("andresfelipevalenciag@gmail.com")
[2m2025-10-12T02:45:14.953054Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T02:45:14.953219Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m Getting user balance for user_id: 1
[2m2025-10-12T02:45:14.955533Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m User balance retrieved successfully for user 1 in 2ms: 300 L√ºmis
[2m2025-10-12T02:45:19.668643Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T02:45:19.668895Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0m765db68a-9936-47b5-854c-85fd2d9e0448
[2m2025-10-12T02:45:19.668937Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 765db68a-9936-47b5-854c-85fd2d9e0448: Processing headers for user 1 with limit 50 offset 0
[2m2025-10-12T02:45:19.668964Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 765db68a-9936-47b5-854c-85fd2d9e0448: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            h.issuer_ruc,
            h.issuer_dv,
            h.issuer_address,
            h.issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T02:45:19.673263Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 765db68a-9936-47b5-854c-85fd2d9e0448: Retrieved 0 invoice headers (total: 0) in 4ms with enhanced filtering
[2m2025-10-12T02:45:19.679669Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T02:45:19.679825Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0m7286b3e7-6b67-42a2-96d4-7efd6d404cd9
[2m2025-10-12T02:45:19.679858Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 7286b3e7-6b67-42a2-96d4-7efd6d404cd9: Processing headers for user 1 with limit 50 offset 50
[2m2025-10-12T02:45:19.679879Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 7286b3e7-6b67-42a2-96d4-7efd6d404cd9: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            h.issuer_ruc,
            h.issuer_dv,
            h.issuer_address,
            h.issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T02:45:19.683907Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 7286b3e7-6b67-42a2-96d4-7efd6d404cd9: Retrieved 0 invoice headers (total: 0) in 4ms with enhanced filtering
[2m2025-10-12T02:45:20.701214Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T02:45:20.701429Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0mb3e28c3f-9eb4-4502-9cde-82311f1086b1
[2m2025-10-12T02:45:20.701465Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request b3e28c3f-9eb4-4502-9cde-82311f1086b1: Processing headers for user 1 with limit 50 offset 100
[2m2025-10-12T02:45:20.701497Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request b3e28c3f-9eb4-4502-9cde-82311f1086b1: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            h.issuer_ruc,
            h.issuer_dv,
            h.issuer_address,
            h.issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T02:45:20.706303Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request b3e28c3f-9eb4-4502-9cde-82311f1086b1: Retrieved 0 invoice headers (total: 0) in 4ms with enhanced filtering
[2m2025-10-12T02:45:20.884360Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T02:45:20.884591Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m5914b522-779a-4e5c-b198-b8385bfa156c
[2m2025-10-12T02:45:20.884637Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 5914b522-779a-4e5c-b198-b8385bfa156c: Processing for user 1 with limit 100 offset 100 order_by date direction DESC
[2m2025-10-12T02:45:20.884655Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 5914b522-779a-4e5c-b198-b8385bfa156c: Querying details for user 1 with enhanced filters
[2m2025-10-12T02:45:20.884680Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 5914b522-779a-4e5c-b198-b8385bfa156c: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T02:45:20.884796Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T02:45:20.884919Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0mde296727-79dc-4c8f-93c2-573c6a4469d7
[2m2025-10-12T02:45:20.884939Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request de296727-79dc-4c8f-93c2-573c6a4469d7: Processing for user 1 with limit 100 offset 200 order_by date direction DESC
[2m2025-10-12T02:45:20.884954Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request de296727-79dc-4c8f-93c2-573c6a4469d7: Querying details for user 1 with enhanced filters
[2m2025-10-12T02:45:20.884972Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request de296727-79dc-4c8f-93c2-573c6a4469d7: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T02:45:20.885512Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T02:45:20.885672Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m71f3b5e2-6f8a-4760-bbce-d78af8f68b38
[2m2025-10-12T02:45:20.885711Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 71f3b5e2-6f8a-4760-bbce-d78af8f68b38: Processing for user 1 with limit 100 offset 0 order_by date direction DESC
[2m2025-10-12T02:45:20.885727Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 71f3b5e2-6f8a-4760-bbce-d78af8f68b38: Querying details for user 1 with enhanced filters
[2m2025-10-12T02:45:20.885744Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 71f3b5e2-6f8a-4760-bbce-d78af8f68b38: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T02:45:20.889809Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 5914b522-779a-4e5c-b198-b8385bfa156c: Retrieved 0 invoice details (total: 0) in 5ms with enhanced pagination
[2m2025-10-12T02:45:20.891580Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request de296727-79dc-4c8f-93c2-573c6a4469d7: Retrieved 0 invoice details (total: 0) in 6ms with enhanced pagination
[2m2025-10-12T02:45:20.892811Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 71f3b5e2-6f8a-4760-bbce-d78af8f68b38: Retrieved 0 invoice details (total: 0) in 7ms with enhanced pagination
[2m2025-10-12T02:45:32.926447Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T02:45:32.926999Z[0m [32m INFO[0m [2mlum_rust_ws::api::url_processing_v4[0m[2m:[0m Processing URL request for user 1: https://dgi-fep.mef.gob.pa/Consultas/FacturasPorQR?chFE=FE0120000000541-81-118009-0610182025100800001762620320312122592596&iAmb=1&digestValue=bI+q2V9dLvXsqwmat0vZKk7AjJO8ogk8k1UKFfzVYZc=&jwt=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJjaEZFIjoiRkUwMTIwMDAwMDAwNTQxLTgxLTExODAwOS0wNjEwMTgyMDI1MTAwODAwMDAxNzYyNjIwMzIwMzEyMTIyNTkyNTk2IiwiaUFtYiI6IjEiLCJkaWdlc3RWYWx1ZSI6ImJJK3EyVjlkTHZYc3F3bWF0MHZaS2s3QWpKTzhvZ2s4azFVS0ZmelZZWmM9In0.aZfk2RrA6jFkJfzeZUyIxGAMO1kzSYDE-cxg9XZ37oI
[2m2025-10-12T02:45:32.927100Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m Starting to scrape invoice from URL: https://dgi-fep.mef.gob.pa/Consultas/FacturasPorQR?chFE=FE0120000000541-81-118009-0610182025100800001762620320312122592596&iAmb=1&digestValue=bI+q2V9dLvXsqwmat0vZKk7AjJO8ogk8k1UKFfzVYZc=&jwt=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJjaEZFIjoiRkUwMTIwMDAwMDAwNTQxLTgxLTExODAwOS0wNjEwMTgyMDI1MTAwODAwMDAxNzYyNjIwMzIwMzEyMTIyNTkyNTk2IiwiaUFtYiI6IjEiLCJkaWdlc3RWYWx1ZSI6ImJJK3EyVjlkTHZYc3F3bWF0MHZaS2s3QWpKTzhvZ2s4azFVS0ZmelZZWmM9In0.aZfk2RrA6jFkJfzeZUyIxGAMO1kzSYDE-cxg9XZ37oI
[2m2025-10-12T02:45:32.927189Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m Fetching HTML with final URL tracking from: https://dgi-fep.mef.gob.pa/Consultas/FacturasPorQR?chFE=FE0120000000541-81-118009-0610182025100800001762620320312122592596&iAmb=1&digestValue=bI+q2V9dLvXsqwmat0vZKk7AjJO8ogk8k1UKFfzVYZc=&jwt=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJjaEZFIjoiRkUwMTIwMDAwMDAwNTQxLTgxLTExODAwOS0wNjEwMTgyMDI1MTAwODAwMDAxNzYyNjIwMzIwMzEyMTIyNTkyNTk2IiwiaUFtYiI6IjEiLCJkaWdlc3RWYWx1ZSI6ImJJK3EyVjlkTHZYc3F3bWF0MHZaS2s3QWpKTzhvZ2s4azFVS0ZmelZZWmM9In0.aZfk2RrA6jFkJfzeZUyIxGAMO1kzSYDE-cxg9XZ37oI
[2m2025-10-12T02:45:34.220987Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m Successfully fetched HTML content (27042 bytes) from final URL: https://dgi-fep.mef.gob.pa/Consultas/FacturasPorQR?chFE=FE0120000000541-81-118009-0610182025100800001762620320312122592596&iAmb=1&digestValue=bI+q2V9dLvXsqwmat0vZKk7AjJO8ogk8k1UKFfzVYZc=&jwt=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJjaEZFIjoiRkUwMTIwMDAwMDAwNTQxLTgxLTExODAwOS0wNjEwMTgyMDI1MTAwODAwMDAxNzYyNjIwMzIwMzEyMTIyNTkyNTk2IiwiaUFtYiI6IjEiLCJkaWdlc3RWYWx1ZSI6ImJJK3EyVjlkTHZYc3F3bWF0MHZaS2s3QWpKTzhvZ2s4azFVS0ZmelZZWmM9In0.aZfk2RrA6jFkJfzeZUyIxGAMO1kzSYDE-cxg9XZ37oI
[2m2025-10-12T02:45:34.229261Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m üîç DEBUG - HTML content length: 27042 bytes
[2m2025-10-12T02:45:34.229374Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m üîç DEBUG - HTML first 500 chars: 

<!DOCTYPE html>

<html lang="es-pa">
<head>
    <link rel="icon" type="image/png" href="/Images/favicon.png">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" /><title>
	
    Consultar Facturas Por QR

</title>

    <script type="text/javascript" src="/ruxitagentjs_ICA7NVfqrux_10323250822043923.js" data-dtconfig="rid=RID_1696240485|rpid=-27214590|domain=mef.gob.pa|reportUrl=/rb_bf36044oye|app=042269121d25fae7|cuc=s94amosz|o
[2m2025-10-12T02:45:34.229633Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m üîç DEBUG - HTML saved to /tmp/scraped_invoice.html
[2m2025-10-12T02:45:34.229704Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m Extracting invoice header from document using ocr_extractor
[2m2025-10-12T02:45:34.231138Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m üîç DEBUG - Calling extract_main_info with HTML length: 26774
[2m2025-10-12T02:45:34.242955Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m üîç DEBUG - extract_main_info SUCCESS, header keys: ["receptor_ruc", "receptor_name", "receptor_dv", "emisor_ruc", "tot_amount", "total_pagado", "date", "cufe", "emisor_dv", "no", "vuelto", "emisor_phone", "emisor_name", "receptor_phone", "emisor_address", "tot_itbms", "receptor_address"]
[2m2025-10-12T02:45:34.243068Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m üîç DEBUG - Raw header_data keys: ["receptor_ruc", "receptor_name", "receptor_dv", "emisor_ruc", "tot_amount", "total_pagado", "date", "cufe", "emisor_dv", "no", "vuelto", "emisor_phone", "emisor_name", "receptor_phone", "emisor_address", "tot_itbms", "receptor_address"]
[2m2025-10-12T02:45:34.243128Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m üîç DEBUG - emisor_name value: Some("Inmobiliaria Don Antonio, S.A.")
[2m2025-10-12T02:45:34.243165Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m üîç DEBUG - tot_amount_str value: Some("5.88")
[2m2025-10-12T02:45:34.243220Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m üîç DEBUG - Extracted data - RUC: Some("541-81-118009"), Nombre: Some("Inmobiliaria Don Antonio, S.A."), Total: Some(5.88), ITBMS: Some(0.0)
[2m2025-10-12T02:45:34.243395Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m Found 11 potential detail rows
[2m2025-10-12T02:45:34.243678Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m Payment information extracted: forma_de_pago=Some("Tarjeta Cr√©dito"), total_pagado=Some("5.88")
[2m2025-10-12T02:45:34.245419Z[0m [32m INFO[0m [2mlum_rust_ws::api::database_persistence[0m[2m:[0m Saving invoice header with CUFE: FE0120000000541-81-118009-0610182025100800001762620320312122592596
[2m2025-10-12T02:45:34.249473Z[0m [32m INFO[0m [2msqlx::postgres::notice[0m[2m:[0m Usuario 1, sin redenci√≥n previa, buscando desde: 2025-09-15
[2m2025-10-12T02:45:34.251753Z[0m [32m INFO[0m [2msqlx::postgres::notice[0m[2m:[0m Usuario 1, contando desde semana m√°s reciente con facturas: 2025-10-06
[2m2025-10-12T02:45:34.251801Z[0m [32m INFO[0m [2msqlx::postgres::notice[0m[2m:[0m Semana 0 (desde 2025-10-06 hasta 2025-10-12 00:00:00): facturas = t
[2m2025-10-12T02:45:34.251817Z[0m [32m INFO[0m [2msqlx::postgres::notice[0m[2m:[0m Semana 1 (desde 2025-09-29 hasta 2025-10-05 00:00:00): facturas = t
[2m2025-10-12T02:45:34.251829Z[0m [32m INFO[0m [2msqlx::postgres::notice[0m[2m:[0m Semana 2 (desde 2025-09-22 hasta 2025-09-28 00:00:00): facturas = t
[2m2025-10-12T02:45:34.251840Z[0m [32m INFO[0m [2msqlx::postgres::notice[0m[2m:[0m Semana 3 (desde 2025-09-15 hasta 2025-09-21 00:00:00): facturas = t
[2m2025-10-12T02:45:34.251852Z[0m [32m INFO[0m [2msqlx::postgres::notice[0m[2m:[0m Resultado final para usuario 1: 4 semanas consecutivas (despu√©s de redenci√≥n: <NULL>)
[2m2025-10-12T02:45:34.302945Z[0m [32m INFO[0m [2mlum_rust_ws::api::database_persistence[0m[2m:[0m Saving 1 invoice details
[2m2025-10-12T02:45:34.303742Z[0m [32m INFO[0m [2mlum_rust_ws::api::database_persistence[0m[2m:[0m Saving 1 invoice payments
[2m2025-10-12T02:45:34.308269Z[0m [32m INFO[0m [2mlum_rust_ws::api::database_persistence[0m[2m:[0m üîç DEBUG - Creando respuesta con issuer_name: Some("Inmobiliaria Don Antonio, S.A."), tot_amount: Some(5.88)
[2m2025-10-12T02:45:34.309400Z[0m [32m INFO[0m [2mlum_rust_ws::api::gamification_service[0m[2m:[0m ÔøΩÔøΩ Found accumulation rule: 'receipts' (id=0) with 1 Lumis
[2m2025-10-12T02:45:34.313446Z[0m [32m INFO[0m [2mlum_rust_ws::api::gamification_service[0m[2m:[0m ‚úÖ Recorded accumulation for user 1 - 1 Lumis (CUFE: FE0120000000541-81-118009-0610182025100800001762620320312122592596)
[2m2025-10-12T02:45:34.314720Z[0m [32m INFO[0m [2mlum_rust_ws::api::gamification_service[0m[2m:[0m üí∞ New balance for user 1: 301 Lumis
[2m2025-10-12T02:45:34.314756Z[0m [32m INFO[0m [2mlum_rust_ws::api::url_processing_v4[0m[2m:[0m ‚úÖ Successfully credited 1 Lumis to user 1. New balance: 301
[2m2025-10-12T02:45:36.997194Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T02:45:36.997339Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T02:45:36.997399Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m Fetching user data for user_id: 1
[2m2025-10-12T02:45:36.999108Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m User data retrieved in 1ms for user_id: 1 - email: Some("andresfelipevalenciag@gmail.com")
[2m2025-10-12T02:45:47.240323Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T02:45:47.240460Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m Getting user balance for user_id: 1
[2m2025-10-12T02:45:47.242225Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m User balance retrieved successfully for user 1 in 1ms: 301 L√ºmis
[2m2025-10-12T02:46:29.197009Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T02:46:29.197266Z[0m [32m INFO[0m [2mlum_rust_ws::api::url_processing_v4[0m[2m:[0m Processing URL request for user 1: https://dgi-fep.mef.gob.pa/Consultas/FacturasPorQR?chFE=FE0120000000541-81-118009-0610112025101000001596070050311435005006&iAmb=1&digestValue=ouPbGWDDXoFMdOuZyRnq+BDuq/9R9ceK/t5ccJXcL2w=&jwt=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJjaEZFIjoiRkUwMTIwMDAwMDAwNTQxLTgxLTExODAwOS0wNjEwMTEyMDI1MTAxMDAwMDAxNTk2MDcwMDUwMzExNDM1MDA1MDA2IiwiaUFtYiI6IjEiLCJkaWdlc3RWYWx1ZSI6Im91UGJHV0REWG9GTWRPdVp5Um5xK0JEdXEvOVI5Y2VLL3Q1Y2NKWGNMMnc9In0.gQZoxitpOmtd61OUv_5fRTNql9MXJ1HkAz7q_lJvEzo
[2m2025-10-12T02:46:29.197340Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m Starting to scrape invoice from URL: https://dgi-fep.mef.gob.pa/Consultas/FacturasPorQR?chFE=FE0120000000541-81-118009-0610112025101000001596070050311435005006&iAmb=1&digestValue=ouPbGWDDXoFMdOuZyRnq+BDuq/9R9ceK/t5ccJXcL2w=&jwt=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJjaEZFIjoiRkUwMTIwMDAwMDAwNTQxLTgxLTExODAwOS0wNjEwMTEyMDI1MTAxMDAwMDAxNTk2MDcwMDUwMzExNDM1MDA1MDA2IiwiaUFtYiI6IjEiLCJkaWdlc3RWYWx1ZSI6Im91UGJHV0REWG9GTWRPdVp5Um5xK0JEdXEvOVI5Y2VLL3Q1Y2NKWGNMMnc9In0.gQZoxitpOmtd61OUv_5fRTNql9MXJ1HkAz7q_lJvEzo
[2m2025-10-12T02:46:29.197366Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m Fetching HTML with final URL tracking from: https://dgi-fep.mef.gob.pa/Consultas/FacturasPorQR?chFE=FE0120000000541-81-118009-0610112025101000001596070050311435005006&iAmb=1&digestValue=ouPbGWDDXoFMdOuZyRnq+BDuq/9R9ceK/t5ccJXcL2w=&jwt=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJjaEZFIjoiRkUwMTIwMDAwMDAwNTQxLTgxLTExODAwOS0wNjEwMTEyMDI1MTAxMDAwMDAxNTk2MDcwMDUwMzExNDM1MDA1MDA2IiwiaUFtYiI6IjEiLCJkaWdlc3RWYWx1ZSI6Im91UGJHV0REWG9GTWRPdVp5Um5xK0JEdXEvOVI5Y2VLL3Q1Y2NKWGNMMnc9In0.gQZoxitpOmtd61OUv_5fRTNql9MXJ1HkAz7q_lJvEzo
[2m2025-10-12T02:46:29.740667Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m Successfully fetched HTML content (42702 bytes) from final URL: https://dgi-fep.mef.gob.pa/Consultas/FacturasPorQR?chFE=FE0120000000541-81-118009-0610112025101000001596070050311435005006&iAmb=1&digestValue=ouPbGWDDXoFMdOuZyRnq+BDuq/9R9ceK/t5ccJXcL2w=&jwt=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJjaEZFIjoiRkUwMTIwMDAwMDAwNTQxLTgxLTExODAwOS0wNjEwMTEyMDI1MTAxMDAwMDAxNTk2MDcwMDUwMzExNDM1MDA1MDA2IiwiaUFtYiI6IjEiLCJkaWdlc3RWYWx1ZSI6Im91UGJHV0REWG9GTWRPdVp5Um5xK0JEdXEvOVI5Y2VLL3Q1Y2NKWGNMMnc9In0.gQZoxitpOmtd61OUv_5fRTNql9MXJ1HkAz7q_lJvEzo
[2m2025-10-12T02:46:29.751709Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m üîç DEBUG - HTML content length: 42702 bytes
[2m2025-10-12T02:46:29.751767Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m üîç DEBUG - HTML first 500 chars: 

<!DOCTYPE html>

<html lang="es-pa">
<head>
    <link rel="icon" type="image/png" href="/Images/favicon.png">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" /><title>
	
    Consultar Facturas Por QR

</title>

    <script type="text/javascript" src="/ruxitagentjs_ICA7NVfqrux_10323250822043923.js" data-dtconfig="rid=RID_1708709397|rpid=1322459349|domain=mef.gob.pa|reportUrl=/rb_bf36044oye|app=042269121d25fae7|cuc=s94amosz|
[2m2025-10-12T02:46:29.751975Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m üîç DEBUG - HTML saved to /tmp/scraped_invoice.html
[2m2025-10-12T02:46:29.752004Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m Extracting invoice header from document using ocr_extractor
[2m2025-10-12T02:46:29.754268Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m üîç DEBUG - Calling extract_main_info with HTML length: 42434
[2m2025-10-12T02:46:29.772937Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m üîç DEBUG - extract_main_info SUCCESS, header keys: ["emisor_name", "no", "cufe", "receptor_ruc", "receptor_name", "vuelto", "emisor_dv", "receptor_phone", "emisor_address", "receptor_dv", "receptor_address", "tot_amount", "date", "total_pagado", "emisor_phone", "tot_itbms", "emisor_ruc"]
[2m2025-10-12T02:46:29.772996Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m üîç DEBUG - Raw header_data keys: ["emisor_name", "no", "cufe", "receptor_ruc", "receptor_name", "vuelto", "emisor_dv", "receptor_phone", "emisor_address", "receptor_dv", "receptor_address", "tot_amount", "date", "total_pagado", "emisor_phone", "tot_itbms", "emisor_ruc"]
[2m2025-10-12T02:46:29.773017Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m üîç DEBUG - emisor_name value: Some("Inmobiliaria Don Antonio, S.A.")
[2m2025-10-12T02:46:29.773051Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m üîç DEBUG - tot_amount_str value: Some("43.97")
[2m2025-10-12T02:46:29.773071Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m üîç DEBUG - Extracted data - RUC: Some("541-81-118009"), Nombre: Some("Inmobiliaria Don Antonio, S.A."), Total: Some(43.97), ITBMS: Some(0.02)
[2m2025-10-12T02:46:29.773270Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m Found 23 potential detail rows
[2m2025-10-12T02:46:29.773551Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m Payment information extracted: forma_de_pago=Some("Tarjeta Cr√©dito"), total_pagado=Some("43.97")
[2m2025-10-12T02:46:29.775267Z[0m [33m WARN[0m [2mlum_rust_ws::api::url_processing_v4[0m[2m:[0m ‚ö†Ô∏è Factura duplicada detectada - no se guarda en mef_pending
[2m2025-10-12T02:47:36.841093Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T02:47:36.841289Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T02:47:36.841387Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m Fetching user data for user_id: 1
[2m2025-10-12T02:47:36.843540Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m User data retrieved in 2ms for user_id: 1 - email: Some("andresfelipevalenciag@gmail.com")
[2m2025-10-12T02:48:06.154041Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T02:48:06.154338Z[0m [32m INFO[0m [2mlum_rust_ws::api::url_processing_v4[0m[2m:[0m Processing URL request for user 1: https://dgi-fep.mef.gob.pa/Consultas/FacturasPorQR?chFE=FE0120000000541-81-118009-0610112025101000001596070050311435005006&iAmb=1&digestValue=ouPbGWDDXoFMdOuZyRnq+BDuq/9R9ceK/t5ccJXcL2w=&jwt=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJjaEZFIjoiRkUwMTIwMDAwMDAwNTQxLTgxLTExODAwOS0wNjEwMTEyMDI1MTAxMDAwMDAxNTk2MDcwMDUwMzExNDM1MDA1MDA2IiwiaUFtYiI6IjEiLCJkaWdlc3RWYWx1ZSI6Im91UGJHV0REWG9GTWRPdVp5Um5xK0JEdXEvOVI5Y2VLL3Q1Y2NKWGNMMnc9In0.gQZoxitpOmtd61OUv_5fRTNql9MXJ1HkAz7q_lJvEzo
[2m2025-10-12T02:48:06.154404Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m Starting to scrape invoice from URL: https://dgi-fep.mef.gob.pa/Consultas/FacturasPorQR?chFE=FE0120000000541-81-118009-0610112025101000001596070050311435005006&iAmb=1&digestValue=ouPbGWDDXoFMdOuZyRnq+BDuq/9R9ceK/t5ccJXcL2w=&jwt=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJjaEZFIjoiRkUwMTIwMDAwMDAwNTQxLTgxLTExODAwOS0wNjEwMTEyMDI1MTAxMDAwMDAxNTk2MDcwMDUwMzExNDM1MDA1MDA2IiwiaUFtYiI6IjEiLCJkaWdlc3RWYWx1ZSI6Im91UGJHV0REWG9GTWRPdVp5Um5xK0JEdXEvOVI5Y2VLL3Q1Y2NKWGNMMnc9In0.gQZoxitpOmtd61OUv_5fRTNql9MXJ1HkAz7q_lJvEzo
[2m2025-10-12T02:48:06.154448Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m Fetching HTML with final URL tracking from: https://dgi-fep.mef.gob.pa/Consultas/FacturasPorQR?chFE=FE0120000000541-81-118009-0610112025101000001596070050311435005006&iAmb=1&digestValue=ouPbGWDDXoFMdOuZyRnq+BDuq/9R9ceK/t5ccJXcL2w=&jwt=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJjaEZFIjoiRkUwMTIwMDAwMDAwNTQxLTgxLTExODAwOS0wNjEwMTEyMDI1MTAxMDAwMDAxNTk2MDcwMDUwMzExNDM1MDA1MDA2IiwiaUFtYiI6IjEiLCJkaWdlc3RWYWx1ZSI6Im91UGJHV0REWG9GTWRPdVp5Um5xK0JEdXEvOVI5Y2VLL3Q1Y2NKWGNMMnc9In0.gQZoxitpOmtd61OUv_5fRTNql9MXJ1HkAz7q_lJvEzo
[2m2025-10-12T02:48:07.281341Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m Successfully fetched HTML content (42702 bytes) from final URL: https://dgi-fep.mef.gob.pa/Consultas/FacturasPorQR?chFE=FE0120000000541-81-118009-0610112025101000001596070050311435005006&iAmb=1&digestValue=ouPbGWDDXoFMdOuZyRnq+BDuq/9R9ceK/t5ccJXcL2w=&jwt=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJjaEZFIjoiRkUwMTIwMDAwMDAwNTQxLTgxLTExODAwOS0wNjEwMTEyMDI1MTAxMDAwMDAxNTk2MDcwMDUwMzExNDM1MDA1MDA2IiwiaUFtYiI6IjEiLCJkaWdlc3RWYWx1ZSI6Im91UGJHV0REWG9GTWRPdVp5Um5xK0JEdXEvOVI5Y2VLL3Q1Y2NKWGNMMnc9In0.gQZoxitpOmtd61OUv_5fRTNql9MXJ1HkAz7q_lJvEzo
[2m2025-10-12T02:48:07.293122Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m üîç DEBUG - HTML content length: 42702 bytes
[2m2025-10-12T02:48:07.293191Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m üîç DEBUG - HTML first 500 chars: 

<!DOCTYPE html>

<html lang="es-pa">
<head>
    <link rel="icon" type="image/png" href="/Images/favicon.png">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" /><title>
	
    Consultar Facturas Por QR

</title>

    <script type="text/javascript" src="/ruxitagentjs_ICA7NVfqrux_10323250822043923.js" data-dtconfig="rid=RID_1708709397|rpid=2072624994|domain=mef.gob.pa|reportUrl=/rb_bf36044oye|app=042269121d25fae7|cuc=s94amosz|
[2m2025-10-12T02:48:07.293407Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m üîç DEBUG - HTML saved to /tmp/scraped_invoice.html
[2m2025-10-12T02:48:07.293437Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m Extracting invoice header from document using ocr_extractor
[2m2025-10-12T02:48:07.295804Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m üîç DEBUG - Calling extract_main_info with HTML length: 42434
[2m2025-10-12T02:48:07.315035Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m üîç DEBUG - extract_main_info SUCCESS, header keys: ["emisor_name", "emisor_address", "emisor_ruc", "receptor_ruc", "vuelto", "receptor_address", "receptor_name", "receptor_phone", "tot_itbms", "no", "date", "receptor_dv", "emisor_phone", "total_pagado", "cufe", "tot_amount", "emisor_dv"]
[2m2025-10-12T02:48:07.315108Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m üîç DEBUG - Raw header_data keys: ["emisor_name", "emisor_address", "emisor_ruc", "receptor_ruc", "vuelto", "receptor_address", "receptor_name", "receptor_phone", "tot_itbms", "no", "date", "receptor_dv", "emisor_phone", "total_pagado", "cufe", "tot_amount", "emisor_dv"]
[2m2025-10-12T02:48:07.315129Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m üîç DEBUG - emisor_name value: Some("Inmobiliaria Don Antonio, S.A.")
[2m2025-10-12T02:48:07.315155Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m üîç DEBUG - tot_amount_str value: Some("43.97")
[2m2025-10-12T02:48:07.315192Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m üîç DEBUG - Extracted data - RUC: Some("541-81-118009"), Nombre: Some("Inmobiliaria Don Antonio, S.A."), Total: Some(43.97), ITBMS: Some(0.02)
[2m2025-10-12T02:48:07.315423Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m Found 23 potential detail rows
[2m2025-10-12T02:48:07.315737Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m Payment information extracted: forma_de_pago=Some("Tarjeta Cr√©dito"), total_pagado=Some("43.97")
[2m2025-10-12T02:48:07.317641Z[0m [33m WARN[0m [2mlum_rust_ws::api::url_processing_v4[0m[2m:[0m ‚ö†Ô∏è Factura duplicada detectada - no se guarda en mef_pending
[2m2025-10-12T02:48:23.868956Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T02:48:23.869152Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T02:48:23.869215Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m Fetching user data for user_id: 1
[2m2025-10-12T02:48:23.870952Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m User data retrieved in 1ms for user_id: 1 - email: Some("andresfelipevalenciag@gmail.com")
[2m2025-10-12T02:48:31.293549Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T02:48:31.293785Z[0m [32m INFO[0m [2mlum_rust_ws::api::url_processing_v4[0m[2m:[0m Processing URL request for user 1: https://dgi-fep.mef.gob.pa/Consultas/FacturasPorQR?chFE=FE0120000000541-81-118009-0610112025101000001596070050311435005006&iAmb=1&digestValue=ouPbGWDDXoFMdOuZyRnq+BDuq/9R9ceK/t5ccJXcL2w=&jwt=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJjaEZFIjoiRkUwMTIwMDAwMDAwNTQxLTgxLTExODAwOS0wNjEwMTEyMDI1MTAxMDAwMDAxNTk2MDcwMDUwMzExNDM1MDA1MDA2IiwiaUFtYiI6IjEiLCJkaWdlc3RWYWx1ZSI6Im91UGJHV0REWG9GTWRPdVp5Um5xK0JEdXEvOVI5Y2VLL3Q1Y2NKWGNMMnc9In0.gQZoxitpOmtd61OUv_5fRTNql9MXJ1HkAz7q_lJvEzo
[2m2025-10-12T02:48:31.293852Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m Starting to scrape invoice from URL: https://dgi-fep.mef.gob.pa/Consultas/FacturasPorQR?chFE=FE0120000000541-81-118009-0610112025101000001596070050311435005006&iAmb=1&digestValue=ouPbGWDDXoFMdOuZyRnq+BDuq/9R9ceK/t5ccJXcL2w=&jwt=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJjaEZFIjoiRkUwMTIwMDAwMDAwNTQxLTgxLTExODAwOS0wNjEwMTEyMDI1MTAxMDAwMDAxNTk2MDcwMDUwMzExNDM1MDA1MDA2IiwiaUFtYiI6IjEiLCJkaWdlc3RWYWx1ZSI6Im91UGJHV0REWG9GTWRPdVp5Um5xK0JEdXEvOVI5Y2VLL3Q1Y2NKWGNMMnc9In0.gQZoxitpOmtd61OUv_5fRTNql9MXJ1HkAz7q_lJvEzo
[2m2025-10-12T02:48:31.293899Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m Fetching HTML with final URL tracking from: https://dgi-fep.mef.gob.pa/Consultas/FacturasPorQR?chFE=FE0120000000541-81-118009-0610112025101000001596070050311435005006&iAmb=1&digestValue=ouPbGWDDXoFMdOuZyRnq+BDuq/9R9ceK/t5ccJXcL2w=&jwt=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJjaEZFIjoiRkUwMTIwMDAwMDAwNTQxLTgxLTExODAwOS0wNjEwMTEyMDI1MTAxMDAwMDAxNTk2MDcwMDUwMzExNDM1MDA1MDA2IiwiaUFtYiI6IjEiLCJkaWdlc3RWYWx1ZSI6Im91UGJHV0REWG9GTWRPdVp5Um5xK0JEdXEvOVI5Y2VLL3Q1Y2NKWGNMMnc9In0.gQZoxitpOmtd61OUv_5fRTNql9MXJ1HkAz7q_lJvEzo
[2m2025-10-12T02:48:31.693944Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m Successfully fetched HTML content (42702 bytes) from final URL: https://dgi-fep.mef.gob.pa/Consultas/FacturasPorQR?chFE=FE0120000000541-81-118009-0610112025101000001596070050311435005006&iAmb=1&digestValue=ouPbGWDDXoFMdOuZyRnq+BDuq/9R9ceK/t5ccJXcL2w=&jwt=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJjaEZFIjoiRkUwMTIwMDAwMDAwNTQxLTgxLTExODAwOS0wNjEwMTEyMDI1MTAxMDAwMDAxNTk2MDcwMDUwMzExNDM1MDA1MDA2IiwiaUFtYiI6IjEiLCJkaWdlc3RWYWx1ZSI6Im91UGJHV0REWG9GTWRPdVp5Um5xK0JEdXEvOVI5Y2VLL3Q1Y2NKWGNMMnc9In0.gQZoxitpOmtd61OUv_5fRTNql9MXJ1HkAz7q_lJvEzo
[2m2025-10-12T02:48:31.705076Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m üîç DEBUG - HTML content length: 42702 bytes
[2m2025-10-12T02:48:31.705199Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m üîç DEBUG - HTML first 500 chars: 

<!DOCTYPE html>

<html lang="es-pa">
<head>
    <link rel="icon" type="image/png" href="/Images/favicon.png">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" /><title>
	
    Consultar Facturas Por QR

</title>

    <script type="text/javascript" src="/ruxitagentjs_ICA7NVfqrux_10323250822043923.js" data-dtconfig="rid=RID_1708709397|rpid=-667094024|domain=mef.gob.pa|reportUrl=/rb_bf36044oye|app=042269121d25fae7|cuc=s94amosz|
[2m2025-10-12T02:48:31.705463Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m üîç DEBUG - HTML saved to /tmp/scraped_invoice.html
[2m2025-10-12T02:48:31.705536Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m Extracting invoice header from document using ocr_extractor
[2m2025-10-12T02:48:31.707751Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m üîç DEBUG - Calling extract_main_info with HTML length: 42434
[2m2025-10-12T02:48:31.726135Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m üîç DEBUG - extract_main_info SUCCESS, header keys: ["receptor_ruc", "vuelto", "cufe", "receptor_dv", "tot_itbms", "date", "emisor_address", "emisor_ruc", "emisor_name", "emisor_phone", "tot_amount", "receptor_address", "total_pagado", "no", "receptor_name", "receptor_phone", "emisor_dv"]
[2m2025-10-12T02:48:31.726247Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m üîç DEBUG - Raw header_data keys: ["receptor_ruc", "vuelto", "cufe", "receptor_dv", "tot_itbms", "date", "emisor_address", "emisor_ruc", "emisor_name", "emisor_phone", "tot_amount", "receptor_address", "total_pagado", "no", "receptor_name", "receptor_phone", "emisor_dv"]
[2m2025-10-12T02:48:31.726312Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m üîç DEBUG - emisor_name value: Some("Inmobiliaria Don Antonio, S.A.")
[2m2025-10-12T02:48:31.726364Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m üîç DEBUG - tot_amount_str value: Some("43.97")
[2m2025-10-12T02:48:31.726418Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m üîç DEBUG - Extracted data - RUC: Some("541-81-118009"), Nombre: Some("Inmobiliaria Don Antonio, S.A."), Total: Some(43.97), ITBMS: Some(0.02)
[2m2025-10-12T02:48:31.726676Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m Found 23 potential detail rows
[2m2025-10-12T02:48:31.727002Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m Payment information extracted: forma_de_pago=Some("Tarjeta Cr√©dito"), total_pagado=Some("43.97")
[2m2025-10-12T02:48:31.728409Z[0m [33m WARN[0m [2mlum_rust_ws::api::url_processing_v4[0m[2m:[0m ‚ö†Ô∏è Factura duplicada detectada - no se guarda en mef_pending
[2m2025-10-12T02:52:45.873809Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T02:52:45.874164Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0m9da5e708-8298-4c38-81e0-b3d5cec8eb37
[2m2025-10-12T02:52:45.874221Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 9da5e708-8298-4c38-81e0-b3d5cec8eb37: Processing headers for user 1 with limit 50 offset 0
[2m2025-10-12T02:52:45.874268Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 9da5e708-8298-4c38-81e0-b3d5cec8eb37: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            h.issuer_ruc,
            h.issuer_dv,
            h.issuer_address,
            h.issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T02:52:45.882275Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 9da5e708-8298-4c38-81e0-b3d5cec8eb37: Retrieved 2 invoice headers (total: 2) in 8ms with enhanced filtering
[2m2025-10-12T02:52:46.884498Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T02:52:46.884755Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0m2397f4cb-7cb2-4127-b87f-a504de1301d2
[2m2025-10-12T02:52:46.884821Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 2397f4cb-7cb2-4127-b87f-a504de1301d2: Processing headers for user 1 with limit 50 offset 100
[2m2025-10-12T02:52:46.884856Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 2397f4cb-7cb2-4127-b87f-a504de1301d2: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            h.issuer_ruc,
            h.issuer_dv,
            h.issuer_address,
            h.issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T02:52:46.891847Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 2397f4cb-7cb2-4127-b87f-a504de1301d2: Retrieved 0 invoice headers (total: 2) in 7ms with enhanced filtering
[2m2025-10-12T02:52:48.085046Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T02:52:48.085272Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0m03846e0e-1519-46d4-9fc7-f885d4329832
[2m2025-10-12T02:52:48.085303Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 03846e0e-1519-46d4-9fc7-f885d4329832: Processing headers for user 1 with limit 50 offset 50
[2m2025-10-12T02:52:48.085328Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 03846e0e-1519-46d4-9fc7-f885d4329832: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            h.issuer_ruc,
            h.issuer_dv,
            h.issuer_address,
            h.issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T02:52:48.091377Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 03846e0e-1519-46d4-9fc7-f885d4329832: Retrieved 0 invoice headers (total: 2) in 6ms with enhanced filtering
[2m2025-10-12T02:52:48.497901Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T02:52:48.498550Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T02:52:48.498761Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T02:52:48.498821Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0m5eb459d9-a2fa-49f9-94a8-39f86143dea8
[2m2025-10-12T02:52:48.498846Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 5eb459d9-a2fa-49f9-94a8-39f86143dea8: Processing headers for user 1 with limit 50 offset 200
[2m2025-10-12T02:52:48.498935Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0mf7c69ae0-22a2-4bed-bd5a-c7811ebb7ee5
[2m2025-10-12T02:52:48.498871Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 5eb459d9-a2fa-49f9-94a8-39f86143dea8: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            h.issuer_ruc,
            h.issuer_dv,
            h.issuer_address,
            h.issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T02:52:48.498972Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request f7c69ae0-22a2-4bed-bd5a-c7811ebb7ee5: Processing headers for user 1 with limit 50 offset 250
[2m2025-10-12T02:52:48.498992Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request f7c69ae0-22a2-4bed-bd5a-c7811ebb7ee5: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            h.issuer_ruc,
            h.issuer_dv,
            h.issuer_address,
            h.issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T02:52:48.499212Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0m05e7a1e2-e1fa-4d5b-a66a-c1a1d1fb3a2f
[2m2025-10-12T02:52:48.499243Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 05e7a1e2-e1fa-4d5b-a66a-c1a1d1fb3a2f: Processing headers for user 1 with limit 50 offset 150
[2m2025-10-12T02:52:48.499262Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 05e7a1e2-e1fa-4d5b-a66a-c1a1d1fb3a2f: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            h.issuer_ruc,
            h.issuer_dv,
            h.issuer_address,
            h.issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T02:52:48.505793Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 5eb459d9-a2fa-49f9-94a8-39f86143dea8: Retrieved 0 invoice headers (total: 2) in 6ms with enhanced filtering
[2m2025-10-12T02:52:48.506148Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 05e7a1e2-e1fa-4d5b-a66a-c1a1d1fb3a2f: Retrieved 0 invoice headers (total: 2) in 6ms with enhanced filtering
[2m2025-10-12T02:52:48.507413Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request f7c69ae0-22a2-4bed-bd5a-c7811ebb7ee5: Retrieved 0 invoice headers (total: 2) in 8ms with enhanced filtering
[2m2025-10-12T02:52:48.680722Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T02:52:48.681027Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m78c951a6-ab6e-4732-9b9c-5db2394bf530
[2m2025-10-12T02:52:48.681225Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 78c951a6-ab6e-4732-9b9c-5db2394bf530: Processing for user 1 with limit 100 offset 0 order_by date direction DESC
[2m2025-10-12T02:52:48.681254Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 78c951a6-ab6e-4732-9b9c-5db2394bf530: Querying details for user 1 with enhanced filters
[2m2025-10-12T02:52:48.681280Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 78c951a6-ab6e-4732-9b9c-5db2394bf530: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T02:52:48.681969Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T02:52:48.681982Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T02:52:48.682116Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0mf49a01e0-4db2-4ab6-ab22-6300c07217c1
[2m2025-10-12T02:52:48.682141Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request f49a01e0-4db2-4ab6-ab22-6300c07217c1: Processing for user 1 with limit 100 offset 100 order_by date direction DESC
[2m2025-10-12T02:52:48.682161Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request f49a01e0-4db2-4ab6-ab22-6300c07217c1: Querying details for user 1 with enhanced filters
[2m2025-10-12T02:52:48.682192Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request f49a01e0-4db2-4ab6-ab22-6300c07217c1: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T02:52:48.682206Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m5545b6bd-c6b4-468b-89ce-956f6b0b803b
[2m2025-10-12T02:52:48.682233Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 5545b6bd-c6b4-468b-89ce-956f6b0b803b: Processing for user 1 with limit 100 offset 200 order_by date direction DESC
[2m2025-10-12T02:52:48.682248Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 5545b6bd-c6b4-468b-89ce-956f6b0b803b: Querying details for user 1 with enhanced filters
[2m2025-10-12T02:52:48.682272Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 5545b6bd-c6b4-468b-89ce-956f6b0b803b: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T02:52:48.687817Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request f49a01e0-4db2-4ab6-ab22-6300c07217c1: Retrieved 0 invoice details (total: 4) in 5ms with enhanced pagination
[2m2025-10-12T02:52:48.688859Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 78c951a6-ab6e-4732-9b9c-5db2394bf530: Retrieved 4 invoice details (total: 4) in 7ms with enhanced pagination
[2m2025-10-12T02:52:48.688971Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 5545b6bd-c6b4-468b-89ce-956f6b0b803b: Retrieved 0 invoice details (total: 4) in 6ms with enhanced pagination
[2m2025-10-12T02:52:49.058757Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T02:52:49.059282Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T02:52:49.059667Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0mbba1a166-c729-47e4-80f2-72ac8e4eddb2
[2m2025-10-12T02:52:49.059950Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request bba1a166-c729-47e4-80f2-72ac8e4eddb2: Processing for user 1 with limit 100 offset 400 order_by date direction DESC
[2m2025-10-12T02:52:49.060058Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request bba1a166-c729-47e4-80f2-72ac8e4eddb2: Querying details for user 1 with enhanced filters
[2m2025-10-12T02:52:49.060092Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request bba1a166-c729-47e4-80f2-72ac8e4eddb2: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T02:52:49.059868Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m37ed56a9-45d5-4576-8ced-3bd6e72902ae
[2m2025-10-12T02:52:49.060681Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 37ed56a9-45d5-4576-8ced-3bd6e72902ae: Processing for user 1 with limit 100 offset 300 order_by date direction DESC
[2m2025-10-12T02:52:49.060776Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 37ed56a9-45d5-4576-8ced-3bd6e72902ae: Querying details for user 1 with enhanced filters
[2m2025-10-12T02:52:49.060864Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 37ed56a9-45d5-4576-8ced-3bd6e72902ae: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T02:52:49.061461Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T02:52:49.063061Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m02ae4428-9c25-4547-9d64-2109d4488327
[2m2025-10-12T02:52:49.063096Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 02ae4428-9c25-4547-9d64-2109d4488327: Processing for user 1 with limit 100 offset 500 order_by date direction DESC
[2m2025-10-12T02:52:49.063111Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 02ae4428-9c25-4547-9d64-2109d4488327: Querying details for user 1 with enhanced filters
[2m2025-10-12T02:52:49.063127Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 02ae4428-9c25-4547-9d64-2109d4488327: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T02:52:49.065664Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request bba1a166-c729-47e4-80f2-72ac8e4eddb2: Retrieved 0 invoice details (total: 4) in 5ms with enhanced pagination
[2m2025-10-12T02:52:49.066497Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 02ae4428-9c25-4547-9d64-2109d4488327: Retrieved 0 invoice details (total: 4) in 3ms with enhanced pagination
[2m2025-10-12T02:52:49.068274Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 37ed56a9-45d5-4576-8ced-3bd6e72902ae: Retrieved 0 invoice details (total: 4) in 8ms with enhanced pagination
[2m2025-10-12T02:52:49.841867Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T02:52:49.842079Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0m905f7fd1-f39c-49b8-b841-f844680ee5ef
[2m2025-10-12T02:52:49.842101Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 905f7fd1-f39c-49b8-b841-f844680ee5ef: Processing headers for user 1 with limit 50 offset 50
[2m2025-10-12T02:52:49.842124Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 905f7fd1-f39c-49b8-b841-f844680ee5ef: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            h.issuer_ruc,
            h.issuer_dv,
            h.issuer_address,
            h.issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T02:52:49.843139Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T02:52:49.843357Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0m27d0558c-109e-4d1e-a0a4-033ae8eb0d2d
[2m2025-10-12T02:52:49.843444Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 27d0558c-109e-4d1e-a0a4-033ae8eb0d2d: Processing headers for user 1 with limit 50 offset 0
[2m2025-10-12T02:52:49.843555Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 27d0558c-109e-4d1e-a0a4-033ae8eb0d2d: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            h.issuer_ruc,
            h.issuer_dv,
            h.issuer_address,
            h.issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T02:52:49.844310Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T02:52:49.846299Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0m0de534da-7065-4e18-866a-12d414ef1889
[2m2025-10-12T02:52:49.846864Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 0de534da-7065-4e18-866a-12d414ef1889: Processing headers for user 1 with limit 50 offset 100
[2m2025-10-12T02:52:49.846945Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 0de534da-7065-4e18-866a-12d414ef1889: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            h.issuer_ruc,
            h.issuer_dv,
            h.issuer_address,
            h.issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T02:52:49.846148Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 27d0558c-109e-4d1e-a0a4-033ae8eb0d2d: Retrieved 0 invoice headers (total: 0) in 2ms with enhanced filtering
[2m2025-10-12T02:52:49.849760Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 0de534da-7065-4e18-866a-12d414ef1889: Retrieved 0 invoice headers (total: 0) in 3ms with enhanced filtering
[2m2025-10-12T02:52:49.850078Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 905f7fd1-f39c-49b8-b841-f844680ee5ef: Retrieved 0 invoice headers (total: 0) in 7ms with enhanced filtering
[2m2025-10-12T02:52:50.047932Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T02:52:50.048053Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T02:52:50.048172Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m4ecf9dd7-466f-4e87-962b-1b75ad0a58cb
[2m2025-10-12T02:52:50.048221Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 4ecf9dd7-466f-4e87-962b-1b75ad0a58cb: Processing for user 1 with limit 100 offset 0 order_by date direction DESC
[2m2025-10-12T02:52:50.048239Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 4ecf9dd7-466f-4e87-962b-1b75ad0a58cb: Querying details for user 1 with enhanced filters
[2m2025-10-12T02:52:50.048266Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 4ecf9dd7-466f-4e87-962b-1b75ad0a58cb: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T02:52:50.048325Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m6f968e1a-2714-4219-8260-17710eca896e
[2m2025-10-12T02:52:50.048355Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 6f968e1a-2714-4219-8260-17710eca896e: Processing for user 1 with limit 100 offset 200 order_by date direction DESC
[2m2025-10-12T02:52:50.048377Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 6f968e1a-2714-4219-8260-17710eca896e: Querying details for user 1 with enhanced filters
[2m2025-10-12T02:52:50.048404Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 6f968e1a-2714-4219-8260-17710eca896e: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T02:52:50.049672Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T02:52:50.049858Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m7ff28b62-e477-40ea-8d59-d92eb3386024
[2m2025-10-12T02:52:50.049919Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 7ff28b62-e477-40ea-8d59-d92eb3386024: Processing for user 1 with limit 100 offset 100 order_by date direction DESC
[2m2025-10-12T02:52:50.049973Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 7ff28b62-e477-40ea-8d59-d92eb3386024: Querying details for user 1 with enhanced filters
[2m2025-10-12T02:52:50.050017Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 7ff28b62-e477-40ea-8d59-d92eb3386024: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T02:52:50.051123Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 6f968e1a-2714-4219-8260-17710eca896e: Retrieved 0 invoice details (total: 0) in 2ms with enhanced pagination
[2m2025-10-12T02:52:50.051462Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 4ecf9dd7-466f-4e87-962b-1b75ad0a58cb: Retrieved 0 invoice details (total: 0) in 3ms with enhanced pagination
[2m2025-10-12T02:52:50.054056Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 7ff28b62-e477-40ea-8d59-d92eb3386024: Retrieved 0 invoice details (total: 0) in 4ms with enhanced pagination
[2m2025-10-12T02:52:57.456729Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T02:52:57.456869Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m Getting user balance for user_id: 1
[2m2025-10-12T02:52:57.457873Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m User balance retrieved successfully for user 1 in 1ms: 302 L√ºmis
[2m2025-10-12T04:07:58.464920Z[0m [32m INFO[0m [2mlum_rust_ws::api::root_v4[0m[2m:[0m Request 70cf2530-520e-4458-be76-07f9074b216f: Root endpoint accessed
[2m2025-10-12T04:08:12.094837Z[0m [32m INFO[0m [2mlum_rust_ws::api::root_v4[0m[2m:[0m Request 26f672ba-d761-4876-8b57-88125c529619: Root endpoint accessed
[2m2025-10-12T04:08:12.928545Z[0m [32m INFO[0m [2mlum_rust_ws::api::root_v4[0m[2m:[0m Request d58dc711-1278-42e4-8df8-b2a9b54eba9c: Root endpoint accessed
[2m2025-10-12T04:08:18.487870Z[0m [33m WARN[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m Missing Authorization header
[2m2025-10-12T04:23:16.490053Z[0m [32m INFO[0m [2mlum_rust_ws::api::root_v4[0m[2m:[0m Request 9ce542b7-641c-4214-aac5-a38bdf78185b: Root endpoint accessed
[2m2025-10-12T04:23:16.632734Z[0m [33m WARN[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m Missing Authorization header
[2m2025-10-12T06:28:05.760647Z[0m [33m WARN[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m Missing Authorization header
[2m2025-10-12T07:54:56.205913Z[0m [32m INFO[0m [2mlum_rust_ws::api::root_v4[0m[2m:[0m Request 39c91283-818a-4673-bdb6-0e2b01dd88a9: Root endpoint accessed
[2m2025-10-12T08:01:57.772103Z[0m [32m INFO[0m [2mlum_rust_ws::api::root_v4[0m[2m:[0m Request de08f240-0784-477d-852f-026526636542: Root endpoint accessed
[2m2025-10-12T09:21:22.589360Z[0m [33m WARN[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m Missing Authorization header
[2m2025-10-12T09:39:53.534697Z[0m [32m INFO[0m [2mlum_rust_ws::api::root_v4[0m[2m:[0m Request 19cd8347-3590-46a7-9103-925507281712: Root endpoint accessed
[2m2025-10-12T09:50:52.168366Z[0m [33m WARN[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m Missing Authorization header
[2m2025-10-12T10:50:39.835236Z[0m [33m WARN[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m Missing Authorization header
[2m2025-10-12T11:01:05.500135Z[0m [32m INFO[0m [2mlum_rust_ws::api::root_v4[0m[2m:[0m Request d346bd9b-2a5c-4879-87c5-12222bb21540: Root endpoint accessed
[2m2025-10-12T11:47:26.236170Z[0m [32m INFO[0m [2mlum_rust_ws::api::root_v4[0m[2m:[0m Request ffab32cc-6812-4032-8f41-a4b20a97c883: Root endpoint accessed
[2m2025-10-12T11:57:23.099683Z[0m [33m WARN[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m Missing Authorization header
[2m2025-10-12T11:57:23.609241Z[0m [33m WARN[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m Missing Authorization header
[2m2025-10-12T11:57:24.127770Z[0m [32m INFO[0m [2mlum_rust_ws::api::root_v4[0m[2m:[0m Request efa83f86-1bc6-4362-9540-0fa593e653b0: Root endpoint accessed
[2m2025-10-12T13:37:50.064204Z[0m [32m INFO[0m [2mlum_rust_ws::api::root_v4[0m[2m:[0m Request d350a938-33c3-417c-88b8-569f18eed59f: Root endpoint accessed
[2m2025-10-12T13:42:52.104952Z[0m [32m INFO[0m [2mlum_rust_ws::api::root_v4[0m[2m:[0m Request 50811240-97f7-447e-9e6c-7761233470ee: Root endpoint accessed
[2m2025-10-12T13:42:55.211689Z[0m [32m INFO[0m [2mlum_rust_ws::api::root_v4[0m[2m:[0m Request f53cae8b-0c89-4223-bcde-59f965e51ba6: Root endpoint accessed
[2m2025-10-12T13:42:55.317831Z[0m [33m WARN[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m Missing Authorization header
[2m2025-10-12T13:42:58.533216Z[0m [32m INFO[0m [2mlum_rust_ws::api::root_v4[0m[2m:[0m Request 4a0ad75c-fcd5-4552-81a1-f232fb7e68c0: Root endpoint accessed
[2m2025-10-12T14:11:02.603241Z[0m [33m WARN[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m Missing Authorization header
[2m2025-10-12T15:53:54.017162Z[0m [32m INFO[0m [2mlum_rust_ws::api::root_v4[0m[2m:[0m Request 235ece92-61a9-4cc2-a62c-92a713b0d64e: Root endpoint accessed
[2m2025-10-12T16:25:15.534026Z[0m [31mERROR[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m JWT validation failed: ExpiredSignature
[2m2025-10-12T16:25:25.625296Z[0m [33m WARN[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m Missing Authorization header
[2m2025-10-12T17:46:05.978960Z[0m [32m INFO[0m [2mlum_rust_ws::api::unified_auth_v4[0m[2m:[0m üîê Unified authentication request received [3mprovider[0m[2m=[0mGoogle [3mcreate_if_not_exists[0m[2m=[0mtrue [3mhas_linking_token[0m[2m=[0mfalse
[2m2025-10-12T17:46:05.979128Z[0m [32m INFO[0m [2mlum_rust_ws::services::unified_auth_simple[0m[2m:[0m üöÄ Starting unified authentication [3mrequest_id[0m[2m=[0m3720ca49-5364-4b2f-83da-2e1fa7d42284 [3mprovider[0m[2m=[0mGoogle { id_token: "eyJhbGciOiJSUzI1NiIsImtpZCI6ImM4YWI3MTUzMDk3MmJiYTIwYjQ5Zjc4YTA5Yzk4NTJjNDNmZjkxMTgiLCJ0eXAiOiJKV1QifQ.eyJpc3MiOiJodHRwczovL2FjY291bnRzLmdvb2dsZS5jb20iLCJhenAiOiI5MTY0MjMxNTU1MS1tdmx2cXNqcWthcWpubmw5cXA2MW1haGNsdmVhZHRlMC5hcHBzLmdvb2dsZXVzZXJjb250ZW50LmNvbSIsImF1ZCI6IjkxNjQyMzE1NTUxLXZjcXRkYTFsY2ZvYWcwbWVqdWJsMTU3aXV2NHE4c3JpLmFwcHMuZ29vZ2xldXNlcmNvbnRlbnQuY29tIiwic3ViIjoiMTAyOTQzOTEzMjU0Nzg5MzkxMjMzIiwiZW1haWwiOiJhbmRyZXNjYXJyaWVsYUBnbWFpbC5jb20iLCJlbWFpbF92ZXJpZmllZCI6dHJ1ZSwibmFtZSI6IkFuZHJlcyBDYXJyaWVsIiwicGljdHVyZSI6Imh0dHBzOi8vbGgzLmdvb2dsZXVzZXJjb250ZW50LmNvbS9hL0FDZzhvY0lxOTdFaGFyY19Ed21XUFVtbWlGSHoxVDB4OVFHWmZyejhKbjBGWlpHVzVfeWJySlp1TEE9czk2LWMiLCJnaXZlbl9uYW1lIjoiQW5kcmVzIiwiZmFtaWx5X25hbWUiOiJDYXJyaWVsIiwiaWF0IjoxNzYwMjkxMTU3LCJleHAiOjE3NjAyOTQ3NTd9.EugZa89ZyeHES2D9uJu05-acB5ke9bmfPk_dfSNgosYleKTXx9Vu2nOL8DfAbxWbO4o-wiSHe-lbcQp-6wcmq-SDF-8fg3JUADgDPuNMGkd4q53gLWI8OV84CHCBy6VPdm6eNq0GmR5EWvP1Ei7FQpGdXVMl1tpauu3hyjYeqc3Rx8pF6L7IanzdwewmODI0hvudkvHx1qyS23GC7ro_DDSlNN7gy7xdzYCG8eF_0-q5j_2jcjL8bGhAXAmNo2vfew251bypofHH6vIDvH5kGopecrp0k7wx1tMaE2g70YwnyijPuDb6d1OAkesqH9YmEHSWpmjIznTej9hhoBB31g", access_token: None }
[2m2025-10-12T17:46:05.979163Z[0m [32m INFO[0m [2mlum_rust_ws::services::unified_auth_simple[0m[2m:[0m üîë Google authentication
[2m2025-10-12T17:46:05.986254Z[0m [32m INFO[0m [2mlum_rust_ws::services::unified_auth_simple[0m[2m:[0m üìù Auth event logged to database [3mrequest_id[0m[2m=[0m3720ca49-5364-4b2f-83da-2e1fa7d42284 [3mevent_type[0m[2m=[0mgoogle_auth [3msuccess[0m[2m=[0mtrue
[2m2025-10-12T17:46:05.986357Z[0m [32m INFO[0m [2mlum_rust_ws::services::google_service[0m[2m:[0m üîç Starting Google ID token validation [3mrequest_id[0m[2m=[0m87d2f8fc-c4b3-4112-a46a-ecef6b8f6814
[2m2025-10-12T17:46:06.034548Z[0m [32m INFO[0m [2mlum_rust_ws::services::google_service[0m[2m:[0m ‚úÖ Google certificates fetched successfully [3mrequest_id[0m[2m=[0m87d2f8fc-c4b3-4112-a46a-ecef6b8f6814 [3mcert_count[0m[2m=[0m2
[2m2025-10-12T17:46:06.035359Z[0m [32m INFO[0m [2mlum_rust_ws::services::redis_service[0m[2m:[0m üîë Redis key set with TTL [3mkey[0m[2m=[0mauth:google:certificates [3mttl[0m[2m=[0m86400
[2m2025-10-12T17:46:06.035421Z[0m [32m INFO[0m [2mlum_rust_ws::services::google_service[0m[2m:[0m üíæ Google certificates cached [3mrequest_id[0m[2m=[0m87d2f8fc-c4b3-4112-a46a-ecef6b8f6814 [3mttl_hours[0m[2m=[0m24
[2m2025-10-12T17:46:06.035786Z[0m [32m INFO[0m [2mlum_rust_ws::services::google_service[0m[2m:[0m ‚úÖ Google ID token validated successfully [3mrequest_id[0m[2m=[0m87d2f8fc-c4b3-4112-a46a-ecef6b8f6814 [3muser_id[0m[2m=[0m102943913254789391233 [3memail[0m[2m=[0mandrescarriela@gmail.com [3mname[0m[2m=[0mSome("Andres Carriel") [3memail_verified[0m[2m=[0mtrue [3mexecution_time_ms[0m[2m=[0m49
[2m2025-10-12T17:46:06.046946Z[0m [32m INFO[0m [2mlum_rust_ws::services::token_service[0m[2m:[0m üîë Generated access token successfully [3muser_id[0m[2m=[0m2 [3memail[0m[2m=[0mandrescarriela@gmail.com [3mexpires_at[0m[2m=[0m2025-10-13 17:46:06.046820002 UTC
[2m2025-10-12T17:46:06.052142Z[0m [32m INFO[0m [2mlum_rust_ws::services::unified_auth_simple[0m[2m:[0m üìù Auth event logged to database [3mrequest_id[0m[2m=[0m3720ca49-5364-4b2f-83da-2e1fa7d42284 [3mevent_type[0m[2m=[0mlogin_success [3msuccess[0m[2m=[0mtrue
[2m2025-10-12T17:46:06.053471Z[0m [32m INFO[0m [2mlum_rust_ws::services::unified_auth_simple[0m[2m:[0m ‚úÖ Authentication successful [3mrequest_id[0m[2m=[0m3720ca49-5364-4b2f-83da-2e1fa7d42284 [3mexecution_time_ms[0m[2m=[0m74
[2m2025-10-12T17:46:23.998468Z[0m [32m INFO[0m [2mlum_rust_ws::api::unified_auth_v4[0m[2m:[0m üîê Unified authentication request received [3mprovider[0m[2m=[0mGoogle [3mcreate_if_not_exists[0m[2m=[0mtrue [3mhas_linking_token[0m[2m=[0mfalse
[2m2025-10-12T17:46:23.998629Z[0m [32m INFO[0m [2mlum_rust_ws::services::unified_auth_simple[0m[2m:[0m üöÄ Starting unified authentication [3mrequest_id[0m[2m=[0m43e78787-0c42-488f-855e-be1123246c94 [3mprovider[0m[2m=[0mGoogle { id_token: "eyJhbGciOiJSUzI1NiIsImtpZCI6ImM4YWI3MTUzMDk3MmJiYTIwYjQ5Zjc4YTA5Yzk4NTJjNDNmZjkxMTgiLCJ0eXAiOiJKV1QifQ.eyJpc3MiOiJodHRwczovL2FjY291bnRzLmdvb2dsZS5jb20iLCJhenAiOiI5MTY0MjMxNTU1MS1tdmx2cXNqcWthcWpubmw5cXA2MW1haGNsdmVhZHRlMC5hcHBzLmdvb2dsZXVzZXJjb250ZW50LmNvbSIsImF1ZCI6IjkxNjQyMzE1NTUxLXZjcXRkYTFsY2ZvYWcwbWVqdWJsMTU3aXV2NHE4c3JpLmFwcHMuZ29vZ2xldXNlcmNvbnRlbnQuY29tIiwic3ViIjoiMTAyOTQzOTEzMjU0Nzg5MzkxMjMzIiwiZW1haWwiOiJhbmRyZXNjYXJyaWVsYUBnbWFpbC5jb20iLCJlbWFpbF92ZXJpZmllZCI6dHJ1ZSwibmFtZSI6IkFuZHJlcyBDYXJyaWVsIiwicGljdHVyZSI6Imh0dHBzOi8vbGgzLmdvb2dsZXVzZXJjb250ZW50LmNvbS9hL0FDZzhvY0lxOTdFaGFyY19Ed21XUFVtbWlGSHoxVDB4OVFHWmZyejhKbjBGWlpHVzVfeWJySlp1TEE9czk2LWMiLCJnaXZlbl9uYW1lIjoiQW5kcmVzIiwiZmFtaWx5X25hbWUiOiJDYXJyaWVsIiwiaWF0IjoxNzYwMjkxMTU3LCJleHAiOjE3NjAyOTQ3NTd9.EugZa89ZyeHES2D9uJu05-acB5ke9bmfPk_dfSNgosYleKTXx9Vu2nOL8DfAbxWbO4o-wiSHe-lbcQp-6wcmq-SDF-8fg3JUADgDPuNMGkd4q53gLWI8OV84CHCBy6VPdm6eNq0GmR5EWvP1Ei7FQpGdXVMl1tpauu3hyjYeqc3Rx8pF6L7IanzdwewmODI0hvudkvHx1qyS23GC7ro_DDSlNN7gy7xdzYCG8eF_0-q5j_2jcjL8bGhAXAmNo2vfew251bypofHH6vIDvH5kGopecrp0k7wx1tMaE2g70YwnyijPuDb6d1OAkesqH9YmEHSWpmjIznTej9hhoBB31g", access_token: None }
[2m2025-10-12T17:46:23.998666Z[0m [32m INFO[0m [2mlum_rust_ws::services::unified_auth_simple[0m[2m:[0m üîë Google authentication
[2m2025-10-12T17:46:24.004275Z[0m [32m INFO[0m [2mlum_rust_ws::services::unified_auth_simple[0m[2m:[0m üìù Auth event logged to database [3mrequest_id[0m[2m=[0m43e78787-0c42-488f-855e-be1123246c94 [3mevent_type[0m[2m=[0mgoogle_auth [3msuccess[0m[2m=[0mtrue
[2m2025-10-12T17:46:24.004422Z[0m [32m INFO[0m [2mlum_rust_ws::services::google_service[0m[2m:[0m üîç Starting Google ID token validation [3mrequest_id[0m[2m=[0mf2f8f36c-98b7-4415-be79-fd2d26e8a552
[2m2025-10-12T17:46:24.005819Z[0m [32m INFO[0m [2mlum_rust_ws::services::google_service[0m[2m:[0m ‚úÖ Google ID token validated successfully [3mrequest_id[0m[2m=[0mf2f8f36c-98b7-4415-be79-fd2d26e8a552 [3muser_id[0m[2m=[0m102943913254789391233 [3memail[0m[2m=[0mandrescarriela@gmail.com [3mname[0m[2m=[0mSome("Andres Carriel") [3memail_verified[0m[2m=[0mtrue [3mexecution_time_ms[0m[2m=[0m1
[2m2025-10-12T17:46:24.013061Z[0m [32m INFO[0m [2mlum_rust_ws::services::token_service[0m[2m:[0m üîë Generated access token successfully [3muser_id[0m[2m=[0m2 [3memail[0m[2m=[0mandrescarriela@gmail.com [3mexpires_at[0m[2m=[0m2025-10-13 17:46:24.012979191 UTC
[2m2025-10-12T17:46:24.018148Z[0m [32m INFO[0m [2mlum_rust_ws::services::unified_auth_simple[0m[2m:[0m üìù Auth event logged to database [3mrequest_id[0m[2m=[0m43e78787-0c42-488f-855e-be1123246c94 [3mevent_type[0m[2m=[0mlogin_success [3msuccess[0m[2m=[0mtrue
[2m2025-10-12T17:46:24.018200Z[0m [32m INFO[0m [2mlum_rust_ws::services::unified_auth_simple[0m[2m:[0m ‚úÖ Authentication successful [3mrequest_id[0m[2m=[0m43e78787-0c42-488f-855e-be1123246c94 [3mexecution_time_ms[0m[2m=[0m19
[2m2025-10-12T17:46:43.486652Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_registration_v4[0m[2m:[0m Request 220eac9e-27c8-48f8-a2f5-811e83d49a41: Checking email existence: andrescarriela@gmail.com
[2m2025-10-12T17:46:43.488243Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_registration_v4[0m[2m:[0m Request 220eac9e-27c8-48f8-a2f5-811e83d49a41: Querying database for email: andrescarriela@gmail.com
[2m2025-10-12T17:46:43.491721Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_registration_v4[0m[2m:[0m Request 220eac9e-27c8-48f8-a2f5-811e83d49a41: Found existing user with ID: 2
[2m2025-10-12T17:46:43.491809Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_registration_v4[0m[2m:[0m Request 220eac9e-27c8-48f8-a2f5-811e83d49a41: Email andrescarriela@gmail.com exists with password: true
[2m2025-10-12T17:46:52.947707Z[0m [32m INFO[0m [2mlum_rust_ws::api::unified_auth_v4[0m[2m:[0m üîê Unified authentication request received [3mprovider[0m[2m=[0mEmail [3mcreate_if_not_exists[0m[2m=[0mfalse [3mhas_linking_token[0m[2m=[0mfalse
[2m2025-10-12T17:46:52.947807Z[0m [32m INFO[0m [2mlum_rust_ws::services::unified_auth_simple[0m[2m:[0m üöÄ Starting unified authentication [3mrequest_id[0m[2m=[0m4adca27c-74c9-49f2-a129-bc021b5a1aa6 [3mprovider[0m[2m=[0mEmail { email: "andrescarriela@gmail.com", password: "Andres123+", name: None }
[2m2025-10-12T17:46:52.947834Z[0m [32m INFO[0m [2mlum_rust_ws::services::unified_auth_simple[0m[2m:[0m üîë Email authentication [3memail[0m[2m=[0mandrescarriela@gmail.com
[2m2025-10-12T17:46:52.953431Z[0m [32m INFO[0m [2mlum_rust_ws::services::unified_auth_simple[0m[2m:[0m üìù Auth event logged to database [3mrequest_id[0m[2m=[0m4adca27c-74c9-49f2-a129-bc021b5a1aa6 [3mevent_type[0m[2m=[0mlogin_attempt [3msuccess[0m[2m=[0mtrue
[2m2025-10-12T17:46:53.896414Z[0m [32m INFO[0m [2mlum_rust_ws::services::token_service[0m[2m:[0m üîë Generated access token successfully [3muser_id[0m[2m=[0m2 [3memail[0m[2m=[0mandrescarriela@gmail.com [3mexpires_at[0m[2m=[0m2025-10-13 17:46:53.896278422 UTC
[2m2025-10-12T17:46:53.901579Z[0m [32m INFO[0m [2mlum_rust_ws::services::unified_auth_simple[0m[2m:[0m üìù Auth event logged to database [3mrequest_id[0m[2m=[0m4adca27c-74c9-49f2-a129-bc021b5a1aa6 [3mevent_type[0m[2m=[0mlogin_success [3msuccess[0m[2m=[0mtrue
[2m2025-10-12T17:46:53.901821Z[0m [32m INFO[0m [2mlum_rust_ws::services::unified_auth_simple[0m[2m:[0m ‚úÖ Authentication successful [3mrequest_id[0m[2m=[0m4adca27c-74c9-49f2-a129-bc021b5a1aa6 [3mexecution_time_ms[0m[2m=[0m954
[2m2025-10-12T17:47:01.312028Z[0m [32m INFO[0m [2mlum_rust_ws::api::unified_auth_v4[0m[2m:[0m üîê Unified authentication request received [3mprovider[0m[2m=[0mEmail [3mcreate_if_not_exists[0m[2m=[0mfalse [3mhas_linking_token[0m[2m=[0mfalse
[2m2025-10-12T17:47:01.312134Z[0m [32m INFO[0m [2mlum_rust_ws::services::unified_auth_simple[0m[2m:[0m üöÄ Starting unified authentication [3mrequest_id[0m[2m=[0mc035c4c5-3cef-40ca-9b8f-b50d70732875 [3mprovider[0m[2m=[0mEmail { email: "andrescarriela@gmail.com", password: "Andres123+", name: None }
[2m2025-10-12T17:47:01.312157Z[0m [32m INFO[0m [2mlum_rust_ws::services::unified_auth_simple[0m[2m:[0m üîë Email authentication [3memail[0m[2m=[0mandrescarriela@gmail.com
[2m2025-10-12T17:47:01.316831Z[0m [32m INFO[0m [2mlum_rust_ws::services::unified_auth_simple[0m[2m:[0m üìù Auth event logged to database [3mrequest_id[0m[2m=[0mc035c4c5-3cef-40ca-9b8f-b50d70732875 [3mevent_type[0m[2m=[0mlogin_attempt [3msuccess[0m[2m=[0mtrue
[2m2025-10-12T17:47:02.286682Z[0m [32m INFO[0m [2mlum_rust_ws::services::token_service[0m[2m:[0m üîë Generated access token successfully [3muser_id[0m[2m=[0m2 [3memail[0m[2m=[0mandrescarriela@gmail.com [3mexpires_at[0m[2m=[0m2025-10-13 17:47:02.286521386 UTC
[2m2025-10-12T17:47:02.290941Z[0m [32m INFO[0m [2mlum_rust_ws::services::unified_auth_simple[0m[2m:[0m üìù Auth event logged to database [3mrequest_id[0m[2m=[0mc035c4c5-3cef-40ca-9b8f-b50d70732875 [3mevent_type[0m[2m=[0mlogin_success [3msuccess[0m[2m=[0mtrue
[2m2025-10-12T17:47:02.291019Z[0m [32m INFO[0m [2mlum_rust_ws::services::unified_auth_simple[0m[2m:[0m ‚úÖ Authentication successful [3mrequest_id[0m[2m=[0mc035c4c5-3cef-40ca-9b8f-b50d70732875 [3mexecution_time_ms[0m[2m=[0m978
[2m2025-10-12T17:49:43.966683Z[0m [32m INFO[0m [2mlum_rust_ws::api::unified_auth_v4[0m[2m:[0m üîê Unified authentication request received [3mprovider[0m[2m=[0mGoogle [3mcreate_if_not_exists[0m[2m=[0mtrue [3mhas_linking_token[0m[2m=[0mfalse
[2m2025-10-12T17:49:43.966827Z[0m [32m INFO[0m [2mlum_rust_ws::services::unified_auth_simple[0m[2m:[0m üöÄ Starting unified authentication [3mrequest_id[0m[2m=[0m38e21b10-8a4b-4010-954f-e0673a0d08ef [3mprovider[0m[2m=[0mGoogle { id_token: "eyJhbGciOiJSUzI1NiIsImtpZCI6ImM4YWI3MTUzMDk3MmJiYTIwYjQ5Zjc4YTA5Yzk4NTJjNDNmZjkxMTgiLCJ0eXAiOiJKV1QifQ.eyJpc3MiOiJodHRwczovL2FjY291bnRzLmdvb2dsZS5jb20iLCJhenAiOiI5MTY0MjMxNTU1MS1tdmx2cXNqcWthcWpubmw5cXA2MW1haGNsdmVhZHRlMC5hcHBzLmdvb2dsZXVzZXJjb250ZW50LmNvbSIsImF1ZCI6IjkxNjQyMzE1NTUxLXZjcXRkYTFsY2ZvYWcwbWVqdWJsMTU3aXV2NHE4c3JpLmFwcHMuZ29vZ2xldXNlcmNvbnRlbnQuY29tIiwic3ViIjoiMTAyOTQzOTEzMjU0Nzg5MzkxMjMzIiwiZW1haWwiOiJhbmRyZXNjYXJyaWVsYUBnbWFpbC5jb20iLCJlbWFpbF92ZXJpZmllZCI6dHJ1ZSwibmFtZSI6IkFuZHJlcyBDYXJyaWVsIiwicGljdHVyZSI6Imh0dHBzOi8vbGgzLmdvb2dsZXVzZXJjb250ZW50LmNvbS9hL0FDZzhvY0lxOTdFaGFyY19Ed21XUFVtbWlGSHoxVDB4OVFHWmZyejhKbjBGWlpHVzVfeWJySlp1TEE9czk2LWMiLCJnaXZlbl9uYW1lIjoiQW5kcmVzIiwiZmFtaWx5X25hbWUiOiJDYXJyaWVsIiwiaWF0IjoxNzYwMjkxMTU3LCJleHAiOjE3NjAyOTQ3NTd9.EugZa89ZyeHES2D9uJu05-acB5ke9bmfPk_dfSNgosYleKTXx9Vu2nOL8DfAbxWbO4o-wiSHe-lbcQp-6wcmq-SDF-8fg3JUADgDPuNMGkd4q53gLWI8OV84CHCBy6VPdm6eNq0GmR5EWvP1Ei7FQpGdXVMl1tpauu3hyjYeqc3Rx8pF6L7IanzdwewmODI0hvudkvHx1qyS23GC7ro_DDSlNN7gy7xdzYCG8eF_0-q5j_2jcjL8bGhAXAmNo2vfew251bypofHH6vIDvH5kGopecrp0k7wx1tMaE2g70YwnyijPuDb6d1OAkesqH9YmEHSWpmjIznTej9hhoBB31g", access_token: None }
[2m2025-10-12T17:49:43.966852Z[0m [32m INFO[0m [2mlum_rust_ws::services::unified_auth_simple[0m[2m:[0m üîë Google authentication
[2m2025-10-12T17:49:43.972056Z[0m [32m INFO[0m [2mlum_rust_ws::services::unified_auth_simple[0m[2m:[0m üìù Auth event logged to database [3mrequest_id[0m[2m=[0m38e21b10-8a4b-4010-954f-e0673a0d08ef [3mevent_type[0m[2m=[0mgoogle_auth [3msuccess[0m[2m=[0mtrue
[2m2025-10-12T17:49:43.972122Z[0m [32m INFO[0m [2mlum_rust_ws::services::google_service[0m[2m:[0m üîç Starting Google ID token validation [3mrequest_id[0m[2m=[0m1a3b19df-a1ce-45f1-88b3-a128a5012756
[2m2025-10-12T17:49:43.973495Z[0m [32m INFO[0m [2mlum_rust_ws::services::google_service[0m[2m:[0m ‚úÖ Google ID token validated successfully [3mrequest_id[0m[2m=[0m1a3b19df-a1ce-45f1-88b3-a128a5012756 [3muser_id[0m[2m=[0m102943913254789391233 [3memail[0m[2m=[0mandrescarriela@gmail.com [3mname[0m[2m=[0mSome("Andres Carriel") [3memail_verified[0m[2m=[0mtrue [3mexecution_time_ms[0m[2m=[0m1
[2m2025-10-12T17:49:43.977946Z[0m [32m INFO[0m [2mlum_rust_ws::services::token_service[0m[2m:[0m üîë Generated access token successfully [3muser_id[0m[2m=[0m2 [3memail[0m[2m=[0mandrescarriela@gmail.com [3mexpires_at[0m[2m=[0m2025-10-13 17:49:43.977845456 UTC
[2m2025-10-12T17:49:43.982093Z[0m [32m INFO[0m [2mlum_rust_ws::services::unified_auth_simple[0m[2m:[0m üìù Auth event logged to database [3mrequest_id[0m[2m=[0m38e21b10-8a4b-4010-954f-e0673a0d08ef [3mevent_type[0m[2m=[0mlogin_success [3msuccess[0m[2m=[0mtrue
[2m2025-10-12T17:49:43.982151Z[0m [32m INFO[0m [2mlum_rust_ws::services::unified_auth_simple[0m[2m:[0m ‚úÖ Authentication successful [3mrequest_id[0m[2m=[0m38e21b10-8a4b-4010-954f-e0673a0d08ef [3mexecution_time_ms[0m[2m=[0m15
[2m2025-10-12T17:49:44.571313Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m2 [3memail[0m[2m=[0mandrescarriela@gmail.com
[2m2025-10-12T17:49:44.571880Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m Getting user balance for user_id: 2
[2m2025-10-12T17:49:44.573573Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m User balance retrieved successfully for user 2 in 2ms: 93 L√ºmis
[2m2025-10-12T17:49:44.577429Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m2 [3memail[0m[2m=[0mandrescarriela@gmail.com
[2m2025-10-12T17:49:44.577557Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m2 [3memail[0m[2m=[0mandrescarriela@gmail.com
[2m2025-10-12T17:49:44.577660Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m Fetching user data for user_id: 2
[2m2025-10-12T17:49:44.578904Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m User data retrieved in 1ms for user_id: 2 - email: Some("andrescarriela@gmail.com")
[2m2025-10-12T17:50:40.856739Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m2 [3memail[0m[2m=[0mandrescarriela@gmail.com
[2m2025-10-12T17:50:40.857119Z[0m [32m INFO[0m [2mlum_rust_ws::api::url_processing_v4[0m[2m:[0m Processing URL request for user 2: https://dgi-fep.mef.gob.pa/Consultas/FacturasPorQR?chFE=FE0120000057983-56-340439-6500012025092700098075140010110098075142&iAmb=1&digestValue=GBP9RJahdmAn4/058EPmKTzHIcFlwjaqgrvsmodxRx8=&jwt=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJjaEZFIjoiRkUwMTIwMDAwMDU3OTgzLTU2LTM0MDQzOS02NTAwMDEyMDI1MDkyNzAwMDk4MDc1MTQwMDEwMTEwMDk4MDc1MTQyIiwiaUFtYiI6IjEiLCJkaWdlc3RWYWx1ZSI6IkdCUDlSSmFoZG1BbjQvMDU4RVBtS1R6SEljRmx3amFxZ3J2c21vZHhSeDg9In0._zIwElI50XsqEZDCjh8f7PqOeW_i-7W37NBS15mKdsA
[2m2025-10-12T17:50:40.857182Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m Starting to scrape invoice from URL: https://dgi-fep.mef.gob.pa/Consultas/FacturasPorQR?chFE=FE0120000057983-56-340439-6500012025092700098075140010110098075142&iAmb=1&digestValue=GBP9RJahdmAn4/058EPmKTzHIcFlwjaqgrvsmodxRx8=&jwt=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJjaEZFIjoiRkUwMTIwMDAwMDU3OTgzLTU2LTM0MDQzOS02NTAwMDEyMDI1MDkyNzAwMDk4MDc1MTQwMDEwMTEwMDk4MDc1MTQyIiwiaUFtYiI6IjEiLCJkaWdlc3RWYWx1ZSI6IkdCUDlSSmFoZG1BbjQvMDU4RVBtS1R6SEljRmx3amFxZ3J2c21vZHhSeDg9In0._zIwElI50XsqEZDCjh8f7PqOeW_i-7W37NBS15mKdsA
[2m2025-10-12T17:50:40.857219Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m Fetching HTML with final URL tracking from: https://dgi-fep.mef.gob.pa/Consultas/FacturasPorQR?chFE=FE0120000057983-56-340439-6500012025092700098075140010110098075142&iAmb=1&digestValue=GBP9RJahdmAn4/058EPmKTzHIcFlwjaqgrvsmodxRx8=&jwt=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJjaEZFIjoiRkUwMTIwMDAwMDU3OTgzLTU2LTM0MDQzOS02NTAwMDEyMDI1MDkyNzAwMDk4MDc1MTQwMDEwMTEwMDk4MDc1MTQyIiwiaUFtYiI6IjEiLCJkaWdlc3RWYWx1ZSI6IkdCUDlSSmFoZG1BbjQvMDU4RVBtS1R6SEljRmx3amFxZ3J2c21vZHhSeDg9In0._zIwElI50XsqEZDCjh8f7PqOeW_i-7W37NBS15mKdsA
[2m2025-10-12T17:50:42.051250Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m Successfully fetched HTML content (32017 bytes) from final URL: https://dgi-fep.mef.gob.pa/Consultas/FacturasPorQR?chFE=FE0120000057983-56-340439-6500012025092700098075140010110098075142&iAmb=1&digestValue=GBP9RJahdmAn4/058EPmKTzHIcFlwjaqgrvsmodxRx8=&jwt=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJjaEZFIjoiRkUwMTIwMDAwMDU3OTgzLTU2LTM0MDQzOS02NTAwMDEyMDI1MDkyNzAwMDk4MDc1MTQwMDEwMTEwMDk4MDc1MTQyIiwiaUFtYiI6IjEiLCJkaWdlc3RWYWx1ZSI6IkdCUDlSSmFoZG1BbjQvMDU4RVBtS1R6SEljRmx3amFxZ3J2c21vZHhSeDg9In0._zIwElI50XsqEZDCjh8f7PqOeW_i-7W37NBS15mKdsA
[2m2025-10-12T17:50:42.059925Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m üîç DEBUG - HTML content length: 32017 bytes
[2m2025-10-12T17:50:42.060008Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m üîç DEBUG - HTML first 500 chars: 

<!DOCTYPE html>

<html lang="es-pa">
<head>
    <link rel="icon" type="image/png" href="/Images/favicon.png">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" /><title>
	
    Consultar Facturas Por QR

</title>

    <script type="text/javascript" src="/ruxitagentjs_ICA7NVfqrux_10323250822043923.js" data-dtconfig="rid=RID_300227326|rpid=1276401665|domain=mef.gob.pa|reportUrl=/rb_bf36044oye|app=042269121d25fae7|cuc=s94amosz|o
[2m2025-10-12T17:50:42.060251Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m üîç DEBUG - HTML saved to /tmp/scraped_invoice.html
[2m2025-10-12T17:50:42.060288Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m Extracting invoice header from document using ocr_extractor
[2m2025-10-12T17:50:42.062083Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m üîç DEBUG - Calling extract_main_info with HTML length: 31750
[2m2025-10-12T17:50:42.076027Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m üîç DEBUG - extract_main_info SUCCESS, header keys: ["emisor_ruc", "emisor_name", "emisor_dv", "receptor_name", "tot_itbms", "cufe", "emisor_phone", "total_pagado", "tot_amount", "emisor_address", "receptor_address", "no", "vuelto", "pasaporte", "date", "receptor_phone"]
[2m2025-10-12T17:50:42.076089Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m üîç DEBUG - Raw header_data keys: ["emisor_ruc", "emisor_name", "emisor_dv", "receptor_name", "tot_itbms", "cufe", "emisor_phone", "total_pagado", "tot_amount", "emisor_address", "receptor_address", "no", "vuelto", "pasaporte", "date", "receptor_phone"]
[2m2025-10-12T17:50:42.076111Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m üîç DEBUG - emisor_name value: Some("ELEKTRA NORESTE S.A (ENSA)")
[2m2025-10-12T17:50:42.076121Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m üîç DEBUG - tot_amount_str value: Some("176.24")
[2m2025-10-12T17:50:42.076147Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m üîç DEBUG - Extracted data - RUC: Some("57983-56-340439"), Nombre: Some("ELEKTRA NORESTE S.A (ENSA)"), Total: Some(176.24), ITBMS: Some(0.0)
[2m2025-10-12T17:50:42.076309Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m Found 14 potential detail rows
[2m2025-10-12T17:50:42.076558Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m Payment information extracted: forma_de_pago=None, total_pagado=Some("176.24")
[2m2025-10-12T17:50:42.078833Z[0m [32m INFO[0m [2mlum_rust_ws::api::database_persistence[0m[2m:[0m Saving invoice header with CUFE: FE0120000057983-56-340439-6500012025092700098075140010110098075142
[2m2025-10-12T17:50:42.081726Z[0m [32m INFO[0m [2msqlx::postgres::notice[0m[2m:[0m Usuario 2, sin redenci√≥n previa, buscando desde: 2025-09-15
[2m2025-10-12T17:50:42.082435Z[0m [32m INFO[0m [2msqlx::postgres::notice[0m[2m:[0m Usuario 2, contando desde semana m√°s reciente con facturas: 2025-10-06
[2m2025-10-12T17:50:42.083041Z[0m [32m INFO[0m [2msqlx::postgres::notice[0m[2m:[0m Semana 0 (desde 2025-10-06 hasta 2025-10-12 00:00:00): facturas = t
[2m2025-10-12T17:50:42.083374Z[0m [32m INFO[0m [2msqlx::postgres::notice[0m[2m:[0m Semana 1 (desde 2025-09-29 hasta 2025-10-05 00:00:00): facturas = t
[2m2025-10-12T17:50:42.083515Z[0m [32m INFO[0m [2msqlx::postgres::notice[0m[2m:[0m Semana 2 (desde 2025-09-22 hasta 2025-09-28 00:00:00): facturas = t
[2m2025-10-12T17:50:42.083551Z[0m [32m INFO[0m [2msqlx::postgres::notice[0m[2m:[0m Semana 3 (desde 2025-09-15 hasta 2025-09-21 00:00:00): facturas = t
[2m2025-10-12T17:50:42.083740Z[0m [32m INFO[0m [2msqlx::postgres::notice[0m[2m:[0m Resultado final para usuario 2: 4 semanas consecutivas (despu√©s de redenci√≥n: <NULL>)
[2m2025-10-12T17:50:42.132004Z[0m [32m INFO[0m [2mlum_rust_ws::api::database_persistence[0m[2m:[0m Saving 1 invoice details
[2m2025-10-12T17:50:42.132754Z[0m [32m INFO[0m [2mlum_rust_ws::api::database_persistence[0m[2m:[0m Saving 1 invoice payments
[2m2025-10-12T17:50:42.136179Z[0m [32m INFO[0m [2mlum_rust_ws::api::database_persistence[0m[2m:[0m üîç DEBUG - Creando respuesta con issuer_name: Some("ELEKTRA NORESTE S.A (ENSA)"), tot_amount: Some(176.24)
[2m2025-10-12T17:50:42.137718Z[0m [32m INFO[0m [2mlum_rust_ws::api::gamification_service[0m[2m:[0m ÔøΩÔøΩ Found accumulation rule: 'receipts' (id=0) with 1 Lumis
[2m2025-10-12T17:50:42.142110Z[0m [32m INFO[0m [2mlum_rust_ws::api::gamification_service[0m[2m:[0m ‚úÖ Recorded accumulation for user 2 - 1 Lumis (CUFE: FE0120000057983-56-340439-6500012025092700098075140010110098075142)
[2m2025-10-12T17:50:42.143493Z[0m [32m INFO[0m [2mlum_rust_ws::api::gamification_service[0m[2m:[0m üí∞ New balance for user 2: 94 Lumis
[2m2025-10-12T17:50:42.143556Z[0m [32m INFO[0m [2mlum_rust_ws::api::url_processing_v4[0m[2m:[0m ‚úÖ Successfully credited 1 Lumis to user 2. New balance: 94
[2m2025-10-12T18:05:23.678932Z[0m [32m INFO[0m [2mlum_rust_ws::api::root_v4[0m[2m:[0m Request 6ec20e27-80b7-4151-b4de-b0c3c3807c68: Root endpoint accessed
[2m2025-10-12T19:24:28.948028Z[0m [31mERROR[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m JWT validation failed: ExpiredSignature
[2m2025-10-12T19:24:31.442447Z[0m [33m WARN[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m Missing Authorization header
[2m2025-10-12T19:24:38.060012Z[0m [32m INFO[0m [2mlum_rust_ws::api::unified_auth_v4[0m[2m:[0m üîê Unified authentication request received [3mprovider[0m[2m=[0mGoogle [3mcreate_if_not_exists[0m[2m=[0mtrue [3mhas_linking_token[0m[2m=[0mfalse
[2m2025-10-12T19:24:38.060142Z[0m [32m INFO[0m [2mlum_rust_ws::services::unified_auth_simple[0m[2m:[0m üöÄ Starting unified authentication [3mrequest_id[0m[2m=[0m91815062-4d3d-4fbd-8ad3-9728a5f2c6ec [3mprovider[0m[2m=[0mGoogle { id_token: "eyJhbGciOiJSUzI1NiIsImtpZCI6ImM4YWI3MTUzMDk3MmJiYTIwYjQ5Zjc4YTA5Yzk4NTJjNDNmZjkxMTgiLCJ0eXAiOiJKV1QifQ.eyJpc3MiOiJodHRwczovL2FjY291bnRzLmdvb2dsZS5jb20iLCJhenAiOiI5MTY0MjMxNTU1MS1mNnBkNzBkMDkxYXRuZ2kxdXRuYnZ0OGxrdTdhMnB2Ni5hcHBzLmdvb2dsZXVzZXJjb250ZW50LmNvbSIsImF1ZCI6IjkxNjQyMzE1NTUxLXZjcXRkYTFsY2ZvYWcwbWVqdWJsMTU3aXV2NHE4c3JpLmFwcHMuZ29vZ2xldXNlcmNvbnRlbnQuY29tIiwic3ViIjoiMTA2MDYzOTM2NDI0NDM3NjIxMDgwIiwiZW1haWwiOiJhbmRyZXNmZWxpcGV2YWxlbmNpYWdAZ21haWwuY29tIiwiZW1haWxfdmVyaWZpZWQiOnRydWUsIm5hbWUiOiJBbmRyZXMgVmFsZW5jaWEiLCJwaWN0dXJlIjoiaHR0cHM6Ly9saDMuZ29vZ2xldXNlcmNvbnRlbnQuY29tL2EvQUNnOG9jSk9Xd083eUdDWVA1OHB4ZFZCd2R6MGJudWtITHdwcjk0RklVbGNEckxHYnVrYUFBPXM5Ni1jIiwiZ2l2ZW5fbmFtZSI6IkFuZHJlcyIsImZhbWlseV9uYW1lIjoiVmFsZW5jaWEiLCJpYXQiOjE3NjAyOTcwNjYsImV4cCI6MTc2MDMwMDY2Nn0.NxHWAbL4wyhKRs0KT9S6NtTqRoqU_mxrGczL9o7RKNN_xCrcvHdgMS-UhEC1od4fWA9adJK8nUJkxShU1kx67V-DCAi8RJT096OKICam_nYCHvuux9EcjfS6cAMDG_8CCkx0lwOgDm0v-eF_Y0WYZ9CRH2geDExREtgdJFGntcgvWWYAe8zsgDr9JAqZlPa-sAREAcefN6G0ayJAQOxUlguRMOJpQrPqjt8y2e607FSML8xEMx0WKZExxuTeRC4Q7FIdIn8IeYZOf4yWsGlKRCOBuxs06AIryR2zxVOwnGCs1dS6LrDIX63FyrDps6HbOOufgBcaFpiJ9O1YZLMN6Q", access_token: None }
[2m2025-10-12T19:24:38.060180Z[0m [32m INFO[0m [2mlum_rust_ws::services::unified_auth_simple[0m[2m:[0m üîë Google authentication
[2m2025-10-12T19:24:38.066414Z[0m [32m INFO[0m [2mlum_rust_ws::services::unified_auth_simple[0m[2m:[0m üìù Auth event logged to database [3mrequest_id[0m[2m=[0m91815062-4d3d-4fbd-8ad3-9728a5f2c6ec [3mevent_type[0m[2m=[0mgoogle_auth [3msuccess[0m[2m=[0mtrue
[2m2025-10-12T19:24:38.066481Z[0m [32m INFO[0m [2mlum_rust_ws::services::google_service[0m[2m:[0m üîç Starting Google ID token validation [3mrequest_id[0m[2m=[0mf47ce187-fa0d-4836-9186-8777cbc4a5ea
[2m2025-10-12T19:24:38.067972Z[0m [32m INFO[0m [2mlum_rust_ws::services::google_service[0m[2m:[0m ‚úÖ Google ID token validated successfully [3mrequest_id[0m[2m=[0mf47ce187-fa0d-4836-9186-8777cbc4a5ea [3muser_id[0m[2m=[0m106063936424437621080 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com [3mname[0m[2m=[0mSome("Andres Valencia") [3memail_verified[0m[2m=[0mtrue [3mexecution_time_ms[0m[2m=[0m1
[2m2025-10-12T19:24:38.074769Z[0m [32m INFO[0m [2mlum_rust_ws::services::token_service[0m[2m:[0m üîë Generated access token successfully [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com [3mexpires_at[0m[2m=[0m2025-10-13 19:24:38.074690685 UTC
[2m2025-10-12T19:24:38.079302Z[0m [32m INFO[0m [2mlum_rust_ws::services::unified_auth_simple[0m[2m:[0m üìù Auth event logged to database [3mrequest_id[0m[2m=[0m91815062-4d3d-4fbd-8ad3-9728a5f2c6ec [3mevent_type[0m[2m=[0mlogin_success [3msuccess[0m[2m=[0mtrue
[2m2025-10-12T19:24:38.079723Z[0m [32m INFO[0m [2mlum_rust_ws::services::unified_auth_simple[0m[2m:[0m ‚úÖ Authentication successful [3mrequest_id[0m[2m=[0m91815062-4d3d-4fbd-8ad3-9728a5f2c6ec [3mexecution_time_ms[0m[2m=[0m19
[2m2025-10-12T19:24:38.931359Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:24:38.931558Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:24:38.931667Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m Fetching user data for user_id: 1
[2m2025-10-12T19:24:38.933991Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m User data retrieved in 2ms for user_id: 1 - email: Some("andresfelipevalenciag@gmail.com")
[2m2025-10-12T19:24:38.942965Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:24:38.943070Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m Getting user balance for user_id: 1
[2m2025-10-12T19:24:38.944851Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m User balance retrieved successfully for user 1 in 1ms: 302 L√ºmis
[2m2025-10-12T19:25:32.754283Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:25:32.754542Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:25:32.754717Z[0m [32m INFO[0m [2mlum_rust_ws::api::upload_ocr_v4[0m[2m:[0m Upload OCR request from user: 1
[2m2025-10-12T19:25:33.068264Z[0m [32m INFO[0m [2mlum_rust_ws::api::upload_ocr_v4[0m[2m:[0m Received image file: optimized_1760297131563.jpg (75211 bytes)
[2m2025-10-12T19:25:33.068348Z[0m [32m INFO[0m [2mlum_rust_ws::api::upload_ocr_v4[0m[2m:[0m Using normal mode (1) for user 1
[2m2025-10-12T19:25:33.068392Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üîç Iniciando procesamiento OCR para usuario andresfelipevalenciag@gmail.com
[2m2025-10-12T19:25:33.068449Z[0m [32m INFO[0m [2mlum_rust_ws::shared::users[0m[2m:[0m Querying user by email: andresfelipevalenciag@gmail.com
[2m2025-10-12T19:25:33.071806Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m ü§ñ Iniciando procesamiento con Gemini OCR (mode: Normal)
[2m2025-10-12T19:25:35.738358Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üîç GEMINI RESPONSE COMPLETA: {
  "candidates": [
    {
      "avgLogprobs": -0.0012668724308646686,
      "content": {
        "parts": [
          {
            "text": "```json\n{\n  \"issuer_name\": \"PANAME√ëA DE HELADOS GELARTI\",\n  \"ruc\": \"456498-1-432343\",\n  \"dv\": \"46\",\n  \"address\": \"ANCON, AV. OMAR TORRIJOS, PASILLO HIPOPOTAMO, ALBROOK MALL, LOCAL P-10\",\n  \"invoice_number\": \"TFHKC20002334-00139553\",\n  \"date\": \"2025-10-12\",\n  \"total\": 3.25,\n  \"products\": [\n    {\n      \"name\": \"GALLETA CHOCOLATE SUPREME (E)\",\n      \"quantity\": 1,\n      \"unit_price\": 3.25,\n      \"total_price\": 3.25\n    }\n  ]\n}\n```"
          }
        ],
        "role": "model"
      },
      "finishReason": "STOP"
    }
  ],
  "modelVersion": "gemini-2.0-flash",
  "responseId": "rQDsaM-iFdLMqtsPyqq6kQY",
  "usageMetadata": {
    "candidatesTokenCount": 211,
    "candidatesTokensDetails": [
      {
        "modality": "TEXT",
        "tokenCount": 211
      }
    ],
    "promptTokenCount": 1779,
    "promptTokensDetails": [
      {
        "modality": "IMAGE",
        "tokenCount": 1290
      },
      {
        "modality": "TEXT",
        "tokenCount": 489
      }
    ],
    "totalTokenCount": 1990
  }
}
[2m2025-10-12T19:25:35.738503Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üîç TEXTO ORIGINAL DE GEMINI: '```json
{
  "issuer_name": "PANAME√ëA DE HELADOS GELARTI",
  "ruc": "456498-1-432343",
  "dv": "46",
  "address": "ANCON, AV. OMAR TORRIJOS, PASILLO HIPOPOTAMO, ALBROOK MALL, LOCAL P-10",
  "invoice_number": "TFHKC20002334-00139553",
  "date": "2025-10-12",
  "total": 3.25,
  "products": [
    {
      "name": "GALLETA CHOCOLATE SUPREME (E)",
      "quantity": 1,
      "unit_price": 3.25,
      "total_price": 3.25
    }
  ]
}
```'
[2m2025-10-12T19:25:35.738573Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üîç TEXTO LIMPIADO (sin markdown): '{
  "issuer_name": "PANAME√ëA DE HELADOS GELARTI",
  "ruc": "456498-1-432343",
  "dv": "46",
  "address": "ANCON, AV. OMAR TORRIJOS, PASILLO HIPOPOTAMO, ALBROOK MALL, LOCAL P-10",
  "invoice_number": "TFHKC20002334-00139553",
  "date": "2025-10-12",
  "total": 3.25,
  "products": [
    {
      "name": "GALLETA CHOCOLATE SUPREME (E)",
      "quantity": 1,
      "unit_price": 3.25,
      "total_price": 3.25
    }
  ]
}'
[2m2025-10-12T19:25:35.738714Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üîç OCR DATOS PARSEADOS:
[2m2025-10-12T19:25:35.738733Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üìÑ Issuer Name: Some("PANAME√ëA DE HELADOS GELARTI")
[2m2025-10-12T19:25:35.738746Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üè¢ RUC: Some("456498-1-432343")
[2m2025-10-12T19:25:35.738755Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üî¢ DV: Some("46")
[2m2025-10-12T19:25:35.738766Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üè† Address: Some("ANCON, AV. OMAR TORRIJOS, PASILLO HIPOPOTAMO, ALBROOK MALL, LOCAL P-10")
[2m2025-10-12T19:25:35.738792Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üìÑ Invoice Number: Some("TFHKC20002334-00139553")
[2m2025-10-12T19:25:35.738811Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üìÑ Date: Some("2025-10-12")
[2m2025-10-12T19:25:35.738826Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üìÑ Total: Some(3.25)
[2m2025-10-12T19:25:35.738850Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üìÑ Products Count: 1
[2m2025-10-12T19:25:35.738862Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m     üõí Product 1: 'GALLETA CHOCOLATE SUPREME (E)' - Qty: 1 - Price: 3.25 - Total: 3.25
[2m2025-10-12T19:25:35.738874Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m ‚úÖ OCR Gemini exitoso: Some("PANAME√ëA DE HELADOS GELARTI")
[2m2025-10-12T19:25:35.739009Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üè∑Ô∏è CUFE generado: OCR-456498143234346-20251012-TFHKC20002334_00139553 (RUC+DV: 456498143234346, Fecha: 20251012, N√∫mero: TFHKC20002334_00139553)
[2m2025-10-12T19:25:35.739037Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üîç VERIFICANDO DUPLICADOS:
[2m2025-10-12T19:25:35.739046Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üîç CUFE generado: OCR-456498143234346-20251012-TFHKC20002334_00139553
[2m2025-10-12T19:25:35.739056Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üîç Issuer Name: Some("PANAME√ëA DE HELADOS GELARTI")
[2m2025-10-12T19:25:35.739066Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üîç Invoice Number: Some("TFHKC20002334-00139553")
[2m2025-10-12T19:25:35.739075Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üîç Date: Some("2025-10-12")
[2m2025-10-12T19:25:35.739084Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üîç User ID: 1
[2m2025-10-12T19:25:35.744010Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üìã ‚úÖ NO SE ENCONTR√ì DUPLICADO - Procediendo a guardar factura
[2m2025-10-12T19:25:35.744081Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üîë Partkey asignado al producto 'GALLETA CHOCOLATE SUPREME (E)': OCR-456498143234346-20251012-TFHKC20002334_00139553|1
[2m2025-10-12T19:25:35.744110Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üíæ Guardando datos de factura en base de datos: OCR-456498143234346-20251012-TFHKC20002334_00139553
[2m2025-10-12T19:25:35.755285Z[0m [32m INFO[0m [2msqlx::postgres::notice[0m[2m:[0m Usuario 1, sin redenci√≥n previa, buscando desde: 2025-09-15
[2m2025-10-12T19:25:35.755942Z[0m [32m INFO[0m [2msqlx::postgres::notice[0m[2m:[0m Usuario 1, contando desde semana m√°s reciente con facturas: 2025-10-06
[2m2025-10-12T19:25:35.756531Z[0m [32m INFO[0m [2msqlx::postgres::notice[0m[2m:[0m Semana 0 (desde 2025-10-06 hasta 2025-10-12 00:00:00): facturas = t
[2m2025-10-12T19:25:35.756880Z[0m [32m INFO[0m [2msqlx::postgres::notice[0m[2m:[0m Semana 1 (desde 2025-09-29 hasta 2025-10-05 00:00:00): facturas = t
[2m2025-10-12T19:25:35.756943Z[0m [32m INFO[0m [2msqlx::postgres::notice[0m[2m:[0m Semana 2 (desde 2025-09-22 hasta 2025-09-28 00:00:00): facturas = t
[2m2025-10-12T19:25:35.756997Z[0m [32m INFO[0m [2msqlx::postgres::notice[0m[2m:[0m Semana 3 (desde 2025-09-15 hasta 2025-09-21 00:00:00): facturas = t
[2m2025-10-12T19:25:35.757045Z[0m [32m INFO[0m [2msqlx::postgres::notice[0m[2m:[0m Resultado final para usuario 1: 4 semanas consecutivas (despu√©s de redenci√≥n: <NULL>)
[2m2025-10-12T19:25:35.814333Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m ‚úÖ Datos de factura guardados exitosamente: OCR-456498143234346-20251012-TFHKC20002334_00139553
[2m2025-10-12T19:25:35.814410Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üìä OCR Attempt - User: andresfelipevalenciag@gmail.com, Status: success, Details: CUFE: OCR-456498143234346-20251012-TFHKC20002334_00139553
[2m2025-10-12T19:25:35.814437Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üìã PRODUCTOS CON PARTKEYS ASIGNADOS:
[2m2025-10-12T19:25:35.814464Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üîë Producto 1: 'GALLETA CHOCOLATE SUPREME (E)' | Partkey: OCR-456498143234346-20251012-TFHKC20002334_00139553|1
[2m2025-10-12T19:25:35.814525Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m ‚úÖ Procesamiento OCR completado exitosamente para andresfelipevalenciag@gmail.com
[2m2025-10-12T19:25:35.814649Z[0m [32m INFO[0m [2mlum_rust_ws::api::upload_ocr_v4[0m[2m:[0m ‚úÖ OCR processing successful for user 1: CUFE OCR-456498143234346-20251012-TFHKC20002334_00139553
[2m2025-10-12T19:25:55.970188Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:25:55.970403Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m Getting user balance for user_id: 1
[2m2025-10-12T19:25:55.972435Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m User balance retrieved successfully for user 1 in 2ms: 302 L√ºmis
[2m2025-10-12T19:26:00.658848Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:26:00.659007Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m Getting user balance for user_id: 1
[2m2025-10-12T19:26:00.660858Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m User balance retrieved successfully for user 1 in 1ms: 302 L√ºmis
[2m2025-10-12T19:26:02.305068Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:26:02.559950Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:26:02.562771Z[0m [31mERROR[0m [2mlum_rust_ws::api::gamification_v4[0m[2m:[0m Failed to track action: Database(PgDatabaseError { severity: Error, code: "23514", message: "no partition of relation \"fact_user_activity_log\" found for row", detail: Some("Partition key of the failing row contains (created_at) = (2025-10-12 19:26:02.56154+00)."), hint: None, position: None, where: Some("SQL statement \"INSERT INTO gamification.fact_user_activity_log (\n        user_id, activity_type, activity_data, created_at\n    ) VALUES (\n        p_user_id, p_action_type, \n        jsonb_build_object(\n            'channel', p_channel,\n            'metadata', p_metadata,\n            'timestamp', NOW()\n        ),\n        NOW()\n    )\"\nPL/pgSQL function gamification.track_user_action(integer,character varying,character varying,jsonb) line 13 at SQL statement"), schema: Some("gamification"), table: Some("fact_user_activity_log"), column: None, data_type: None, constraint: None, file: Some("execPartition.c"), line: Some(328), routine: Some("ExecFindPartition") })
[2m2025-10-12T19:26:02.563171Z[0m [31mERROR[0m [2mtower_http::trace::on_failure[0m[2m:[0m response failed [3mclassification[0m[2m=[0mStatus code: 500 Internal Server Error [3mlatency[0m[2m=[0m3 ms
[2m2025-10-12T19:26:02.568822Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:26:06.771454Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:26:06.771635Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m Getting user balance for user_id: 1
[2m2025-10-12T19:26:06.772568Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m User balance retrieved successfully for user 1 in 0ms: 302 L√ºmis
[2m2025-10-12T19:26:11.286186Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:26:11.286457Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:26:11.286638Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_issuers_v4[0m[2m:[0m üìã Fetching user issuers for user_id: 1 [acd205b3-ad6c-4423-ad0b-b536e9bc0e95]
[2m2025-10-12T19:26:11.286708Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_issuers_v4[0m[2m:[0m üîç Cache key: user_issuers_list_1_100_0_no_date_filter [acd205b3-ad6c-4423-ad0b-b536e9bc0e95]
[2m2025-10-12T19:26:11.295587Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_issuers_v4[0m[2m:[0m ‚úÖ Successfully fetched 100 issuers for user 1 (total: 97, date_filter: none) in 8ms [acd205b3-ad6c-4423-ad0b-b536e9bc0e95]
[2m2025-10-12T19:26:11.380219Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:26:11.380422Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:26:11.380520Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_issuers_v4[0m[2m:[0m üìã Fetching user issuers for user_id: 1 [0adb82da-06e0-424e-a4d7-568a2a759ee0]
[2m2025-10-12T19:26:11.380551Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_issuers_v4[0m[2m:[0m üîç Cache key: user_issuers_list_1_100_0_no_date_filter [0adb82da-06e0-424e-a4d7-568a2a759ee0]
[2m2025-10-12T19:26:11.387553Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_issuers_v4[0m[2m:[0m ‚úÖ Successfully fetched 100 issuers for user 1 (total: 97, date_filter: none) in 7ms [0adb82da-06e0-424e-a4d7-568a2a759ee0]
[2m2025-10-12T19:26:11.584818Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:26:11.585053Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:26:11.585171Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_products_v4[0m[2m:[0m üõí Fetching user products for user_id: 1 [74a6088c-6c19-40ca-81cf-ed29a201838c]
[2m2025-10-12T19:26:11.585236Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_products_v4[0m[2m:[0m üîç Cache key: user_products_list_1_20_0_no_date_filter [74a6088c-6c19-40ca-81cf-ed29a201838c]
[2m2025-10-12T19:26:11.600418Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_products_v4[0m[2m:[0m ‚úÖ Successfully fetched 20 products for user 1 (total: 1543, date_filter: none) in 15ms [74a6088c-6c19-40ca-81cf-ed29a201838c]
[2m2025-10-12T19:26:11.702967Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:26:11.703133Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:26:11.703206Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_products_v4[0m[2m:[0m üõí Fetching user products for user_id: 1 [3c24881c-5825-49a2-b705-a38885a706e8]
[2m2025-10-12T19:26:11.703233Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_products_v4[0m[2m:[0m üîç Cache key: user_products_list_1_20_0_no_date_filter [3c24881c-5825-49a2-b705-a38885a706e8]
[2m2025-10-12T19:26:11.715910Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_products_v4[0m[2m:[0m ‚úÖ Successfully fetched 20 products for user 1 (total: 1543, date_filter: none) in 12ms [3c24881c-5825-49a2-b705-a38885a706e8]
[2m2025-10-12T19:26:11.810158Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:26:11.810425Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0mdaaf5ed6-b165-419f-9d74-956238ef7325
[2m2025-10-12T19:26:11.810483Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request daaf5ed6-b165-419f-9d74-956238ef7325: Processing headers for user 1 with limit 50 offset 0
[2m2025-10-12T19:26:11.810522Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request daaf5ed6-b165-419f-9d74-956238ef7325: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            h.issuer_ruc,
            h.issuer_dv,
            h.issuer_address,
            h.issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T19:26:11.829562Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request daaf5ed6-b165-419f-9d74-956238ef7325: Retrieved 50 invoice headers (total: 343) in 19ms with enhanced filtering
[2m2025-10-12T19:26:12.130259Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:26:12.130472Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0mc692ae12-a988-4c6b-96eb-bc8f69b0d0a1
[2m2025-10-12T19:26:12.130502Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request c692ae12-a988-4c6b-96eb-bc8f69b0d0a1: Processing headers for user 1 with limit 50 offset 100
[2m2025-10-12T19:26:12.130528Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request c692ae12-a988-4c6b-96eb-bc8f69b0d0a1: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            h.issuer_ruc,
            h.issuer_dv,
            h.issuer_address,
            h.issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T19:26:12.140941Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request c692ae12-a988-4c6b-96eb-bc8f69b0d0a1: Retrieved 50 invoice headers (total: 343) in 10ms with enhanced filtering
[2m2025-10-12T19:26:12.155232Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:26:12.155413Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0m6b01af25-270d-4a82-a7cf-c9f4f2d54a25
[2m2025-10-12T19:26:12.155443Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 6b01af25-270d-4a82-a7cf-c9f4f2d54a25: Processing headers for user 1 with limit 50 offset 50
[2m2025-10-12T19:26:12.155466Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 6b01af25-270d-4a82-a7cf-c9f4f2d54a25: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            h.issuer_ruc,
            h.issuer_dv,
            h.issuer_address,
            h.issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T19:26:12.169523Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 6b01af25-270d-4a82-a7cf-c9f4f2d54a25: Retrieved 50 invoice headers (total: 343) in 14ms with enhanced filtering
[2m2025-10-12T19:26:14.129158Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:26:14.129521Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0mf04f8954-a341-4c2b-a83f-bc8d03025b80
[2m2025-10-12T19:26:14.129708Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request f04f8954-a341-4c2b-a83f-bc8d03025b80: Processing for user 1 with limit 100 offset 100 order_by date direction DESC
[2m2025-10-12T19:26:14.129735Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request f04f8954-a341-4c2b-a83f-bc8d03025b80: Querying details for user 1 with enhanced filters
[2m2025-10-12T19:26:14.129762Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request f04f8954-a341-4c2b-a83f-bc8d03025b80: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T19:26:14.130824Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:26:14.131067Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m6abf225e-6d53-4bfd-9beb-6f7732cff9a8
[2m2025-10-12T19:26:14.131097Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 6abf225e-6d53-4bfd-9beb-6f7732cff9a8: Processing for user 1 with limit 100 offset 200 order_by date direction DESC
[2m2025-10-12T19:26:14.131113Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 6abf225e-6d53-4bfd-9beb-6f7732cff9a8: Querying details for user 1 with enhanced filters
[2m2025-10-12T19:26:14.131142Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 6abf225e-6d53-4bfd-9beb-6f7732cff9a8: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T19:26:14.131788Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:26:14.134781Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0mb997cbd1-7cc3-49d0-88d6-0c212f675692
[2m2025-10-12T19:26:14.134913Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request b997cbd1-7cc3-49d0-88d6-0c212f675692: Processing for user 1 with limit 100 offset 0 order_by date direction DESC
[2m2025-10-12T19:26:14.135069Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request b997cbd1-7cc3-49d0-88d6-0c212f675692: Querying details for user 1 with enhanced filters
[2m2025-10-12T19:26:14.135136Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request b997cbd1-7cc3-49d0-88d6-0c212f675692: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T19:26:14.142254Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 6abf225e-6d53-4bfd-9beb-6f7732cff9a8: Retrieved 100 invoice details (total: 2539) in 11ms with enhanced pagination
[2m2025-10-12T19:26:14.144225Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request f04f8954-a341-4c2b-a83f-bc8d03025b80: Retrieved 100 invoice details (total: 2539) in 14ms with enhanced pagination
[2m2025-10-12T19:26:14.147745Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request b997cbd1-7cc3-49d0-88d6-0c212f675692: Retrieved 100 invoice details (total: 2539) in 12ms with enhanced pagination
[2m2025-10-12T19:26:54.348854Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:26:54.349050Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:26:54.349106Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m Fetching user data for user_id: 1
[2m2025-10-12T19:26:54.351097Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m User data retrieved in 1ms for user_id: 1 - email: Some("andresfelipevalenciag@gmail.com")
[2m2025-10-12T19:26:55.619493Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:26:55.619703Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m Getting user balance for user_id: 1
[2m2025-10-12T19:26:55.621645Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m User balance retrieved successfully for user 1 in 1ms: 302 L√ºmis
[2m2025-10-12T19:26:56.240381Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:26:56.240685Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0m7f6f8d0d-cbb5-4dec-bc3e-b8a36622d623
[2m2025-10-12T19:26:56.240728Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 7f6f8d0d-cbb5-4dec-bc3e-b8a36622d623: Processing headers for user 1 with limit 50 offset 0
[2m2025-10-12T19:26:56.240789Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 7f6f8d0d-cbb5-4dec-bc3e-b8a36622d623: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            h.issuer_ruc,
            h.issuer_dv,
            h.issuer_address,
            h.issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T19:26:56.253510Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 7f6f8d0d-cbb5-4dec-bc3e-b8a36622d623: Retrieved 50 invoice headers (total: 343) in 12ms with enhanced filtering
[2m2025-10-12T19:26:56.532788Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:26:56.533027Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0m0504a850-b051-457d-b950-8b00200737a4
[2m2025-10-12T19:26:56.533064Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 0504a850-b051-457d-b950-8b00200737a4: Processing headers for user 1 with limit 50 offset 50
[2m2025-10-12T19:26:56.533090Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 0504a850-b051-457d-b950-8b00200737a4: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            h.issuer_ruc,
            h.issuer_dv,
            h.issuer_address,
            h.issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T19:26:56.547150Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 0504a850-b051-457d-b950-8b00200737a4: Retrieved 50 invoice headers (total: 343) in 14ms with enhanced filtering
[2m2025-10-12T19:26:56.629140Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:26:56.629375Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0mb5c990dc-897b-4b24-b373-c780733e2167
[2m2025-10-12T19:26:56.629437Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request b5c990dc-897b-4b24-b373-c780733e2167: Processing headers for user 1 with limit 50 offset 100
[2m2025-10-12T19:26:56.629503Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request b5c990dc-897b-4b24-b373-c780733e2167: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            h.issuer_ruc,
            h.issuer_dv,
            h.issuer_address,
            h.issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T19:26:56.637193Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request b5c990dc-897b-4b24-b373-c780733e2167: Retrieved 50 invoice headers (total: 343) in 7ms with enhanced filtering
[2m2025-10-12T19:26:59.934113Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:26:59.934342Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0m089b78d5-b76f-4f0e-8b20-602ea5119a2c
[2m2025-10-12T19:26:59.934423Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 089b78d5-b76f-4f0e-8b20-602ea5119a2c: Processing headers for user 1 with limit 50 offset 150
[2m2025-10-12T19:26:59.934490Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 089b78d5-b76f-4f0e-8b20-602ea5119a2c: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            h.issuer_ruc,
            h.issuer_dv,
            h.issuer_address,
            h.issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T19:26:59.935971Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:26:59.936131Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0m02f73e56-b466-4426-8ce0-d15afce0631e
[2m2025-10-12T19:26:59.936168Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 02f73e56-b466-4426-8ce0-d15afce0631e: Processing headers for user 1 with limit 50 offset 250
[2m2025-10-12T19:26:59.936198Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 02f73e56-b466-4426-8ce0-d15afce0631e: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            h.issuer_ruc,
            h.issuer_dv,
            h.issuer_address,
            h.issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T19:26:59.936263Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:26:59.936477Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0m7308105b-9f16-44fd-ae18-8a4a68222106
[2m2025-10-12T19:26:59.936501Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 7308105b-9f16-44fd-ae18-8a4a68222106: Processing headers for user 1 with limit 50 offset 200
[2m2025-10-12T19:26:59.936526Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 7308105b-9f16-44fd-ae18-8a4a68222106: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            h.issuer_ruc,
            h.issuer_dv,
            h.issuer_address,
            h.issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T19:26:59.942286Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 089b78d5-b76f-4f0e-8b20-602ea5119a2c: Retrieved 50 invoice headers (total: 343) in 7ms with enhanced filtering
[2m2025-10-12T19:26:59.946500Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 02f73e56-b466-4426-8ce0-d15afce0631e: Retrieved 50 invoice headers (total: 343) in 10ms with enhanced filtering
[2m2025-10-12T19:26:59.946702Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 7308105b-9f16-44fd-ae18-8a4a68222106: Retrieved 50 invoice headers (total: 343) in 10ms with enhanced filtering
[2m2025-10-12T19:27:00.483332Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:27:00.483564Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0md8ef0127-73aa-4742-841e-7a07f1c0840c
[2m2025-10-12T19:27:00.483662Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request d8ef0127-73aa-4742-841e-7a07f1c0840c: Processing headers for user 1 with limit 50 offset 300
[2m2025-10-12T19:27:00.483695Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request d8ef0127-73aa-4742-841e-7a07f1c0840c: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            h.issuer_ruc,
            h.issuer_dv,
            h.issuer_address,
            h.issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T19:27:00.484692Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:27:00.484848Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:27:00.484916Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0m0ccb8505-3ad9-4423-9fba-a80bf99f6d57
[2m2025-10-12T19:27:00.484940Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 0ccb8505-3ad9-4423-9fba-a80bf99f6d57: Processing headers for user 1 with limit 50 offset 350
[2m2025-10-12T19:27:00.484971Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0m080d966a-6c3d-4246-a18e-f759e9a670f6
[2m2025-10-12T19:27:00.484990Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 080d966a-6c3d-4246-a18e-f759e9a670f6: Processing headers for user 1 with limit 50 offset 400
[2m2025-10-12T19:27:00.484966Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 0ccb8505-3ad9-4423-9fba-a80bf99f6d57: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            h.issuer_ruc,
            h.issuer_dv,
            h.issuer_address,
            h.issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T19:27:00.485007Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 080d966a-6c3d-4246-a18e-f759e9a670f6: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            h.issuer_ruc,
            h.issuer_dv,
            h.issuer_address,
            h.issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T19:27:00.490951Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 080d966a-6c3d-4246-a18e-f759e9a670f6: Retrieved 0 invoice headers (total: 343) in 5ms with enhanced filtering
[2m2025-10-12T19:27:00.492582Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request d8ef0127-73aa-4742-841e-7a07f1c0840c: Retrieved 43 invoice headers (total: 343) in 9ms with enhanced filtering
[2m2025-10-12T19:27:00.497524Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 0ccb8505-3ad9-4423-9fba-a80bf99f6d57: Retrieved 0 invoice headers (total: 343) in 12ms with enhanced filtering
[2m2025-10-12T19:27:00.834981Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:27:00.835157Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:27:00.835262Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_issuers_v4[0m[2m:[0m üìã Fetching user issuers for user_id: 1 [d9b004f5-8c8d-43ad-883e-8b10b473044b]
[2m2025-10-12T19:27:00.835294Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_issuers_v4[0m[2m:[0m üîç Cache key: user_issuers_list_1_100_0_no_date_filter [d9b004f5-8c8d-43ad-883e-8b10b473044b]
[2m2025-10-12T19:27:00.841891Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_issuers_v4[0m[2m:[0m ‚úÖ Successfully fetched 100 issuers for user 1 (total: 97, date_filter: none) in 6ms [d9b004f5-8c8d-43ad-883e-8b10b473044b]
[2m2025-10-12T19:27:00.846123Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:27:00.846281Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:27:00.846374Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_issuers_v4[0m[2m:[0m üìã Fetching user issuers for user_id: 1 [9491b118-27c5-4371-ba40-bfd9303b81cc]
[2m2025-10-12T19:27:00.846405Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_issuers_v4[0m[2m:[0m üîç Cache key: user_issuers_list_1_100_0_no_date_filter [9491b118-27c5-4371-ba40-bfd9303b81cc]
[2m2025-10-12T19:27:00.851703Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_issuers_v4[0m[2m:[0m ‚úÖ Successfully fetched 100 issuers for user 1 (total: 97, date_filter: none) in 5ms [9491b118-27c5-4371-ba40-bfd9303b81cc]
[2m2025-10-12T19:27:01.025423Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:27:01.025659Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0m29cba2a2-baea-4b33-b440-92de8aa2b9ae
[2m2025-10-12T19:27:01.025692Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 29cba2a2-baea-4b33-b440-92de8aa2b9ae: Processing headers for user 1 with limit 50 offset 450
[2m2025-10-12T19:27:01.025716Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 29cba2a2-baea-4b33-b440-92de8aa2b9ae: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            h.issuer_ruc,
            h.issuer_dv,
            h.issuer_address,
            h.issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T19:27:01.030654Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 29cba2a2-baea-4b33-b440-92de8aa2b9ae: Retrieved 0 invoice headers (total: 343) in 4ms with enhanced filtering
[2m2025-10-12T19:27:01.033161Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:27:01.033351Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0m549404b6-be6a-4a79-9431-6774e9b34a69
[2m2025-10-12T19:27:01.033218Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:27:01.033438Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 549404b6-be6a-4a79-9431-6774e9b34a69: Processing headers for user 1 with limit 50 offset 500
[2m2025-10-12T19:27:01.033499Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 549404b6-be6a-4a79-9431-6774e9b34a69: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            h.issuer_ruc,
            h.issuer_dv,
            h.issuer_address,
            h.issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T19:27:01.033568Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0m7ed5d3c4-e3bd-487f-bea2-65bc70809146
[2m2025-10-12T19:27:01.033589Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 7ed5d3c4-e3bd-487f-bea2-65bc70809146: Processing headers for user 1 with limit 50 offset 550
[2m2025-10-12T19:27:01.033636Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 7ed5d3c4-e3bd-487f-bea2-65bc70809146: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            h.issuer_ruc,
            h.issuer_dv,
            h.issuer_address,
            h.issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T19:27:01.041114Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 549404b6-be6a-4a79-9431-6774e9b34a69: Retrieved 0 invoice headers (total: 343) in 7ms with enhanced filtering
[2m2025-10-12T19:27:01.042107Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 7ed5d3c4-e3bd-487f-bea2-65bc70809146: Retrieved 0 invoice headers (total: 343) in 8ms with enhanced filtering
[2m2025-10-12T19:27:01.238847Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:27:01.239124Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m14a3ad14-96b6-46ee-8b9b-a5f4c1d4e50c
[2m2025-10-12T19:27:01.239157Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 14a3ad14-96b6-46ee-8b9b-a5f4c1d4e50c: Processing for user 1 with limit 100 offset 100 order_by date direction DESC
[2m2025-10-12T19:27:01.239174Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 14a3ad14-96b6-46ee-8b9b-a5f4c1d4e50c: Querying details for user 1 with enhanced filters
[2m2025-10-12T19:27:01.239201Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 14a3ad14-96b6-46ee-8b9b-a5f4c1d4e50c: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T19:27:01.239754Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:27:01.239893Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m6292bc4c-2bc4-4c35-a377-77dd99b4f2d3
[2m2025-10-12T19:27:01.239915Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 6292bc4c-2bc4-4c35-a377-77dd99b4f2d3: Processing for user 1 with limit 100 offset 0 order_by date direction DESC
[2m2025-10-12T19:27:01.239930Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 6292bc4c-2bc4-4c35-a377-77dd99b4f2d3: Querying details for user 1 with enhanced filters
[2m2025-10-12T19:27:01.239948Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 6292bc4c-2bc4-4c35-a377-77dd99b4f2d3: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T19:27:01.240994Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:27:01.241124Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0md56ac1a4-0db6-4993-b872-f32d1c96dec8
[2m2025-10-12T19:27:01.241149Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request d56ac1a4-0db6-4993-b872-f32d1c96dec8: Processing for user 1 with limit 100 offset 200 order_by date direction DESC
[2m2025-10-12T19:27:01.241162Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request d56ac1a4-0db6-4993-b872-f32d1c96dec8: Querying details for user 1 with enhanced filters
[2m2025-10-12T19:27:01.241178Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request d56ac1a4-0db6-4993-b872-f32d1c96dec8: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T19:27:01.246638Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 14a3ad14-96b6-46ee-8b9b-a5f4c1d4e50c: Retrieved 100 invoice details (total: 2539) in 7ms with enhanced pagination
[2m2025-10-12T19:27:01.250737Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 6292bc4c-2bc4-4c35-a377-77dd99b4f2d3: Retrieved 100 invoice details (total: 2539) in 10ms with enhanced pagination
[2m2025-10-12T19:27:01.254873Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request d56ac1a4-0db6-4993-b872-f32d1c96dec8: Retrieved 100 invoice details (total: 2539) in 13ms with enhanced pagination
[2m2025-10-12T19:27:01.864500Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:27:01.865045Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:27:01.867047Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_products_v4[0m[2m:[0m üõí Fetching user products for user_id: 1 [62f16f12-34a3-42f0-a939-d251d89f7a19]
[2m2025-10-12T19:27:01.867092Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_products_v4[0m[2m:[0m üîç Cache key: user_products_list_1_20_0_no_date_filter [62f16f12-34a3-42f0-a939-d251d89f7a19]
[2m2025-10-12T19:27:01.879085Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_products_v4[0m[2m:[0m ‚úÖ Successfully fetched 20 products for user 1 (total: 1543, date_filter: none) in 12ms [62f16f12-34a3-42f0-a939-d251d89f7a19]
[2m2025-10-12T19:27:02.080932Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:27:02.081133Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:27:02.081211Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_products_v4[0m[2m:[0m üõí Fetching user products for user_id: 1 [8dc13d3e-1c7f-4638-b1d3-2da1f412acdc]
[2m2025-10-12T19:27:02.081249Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_products_v4[0m[2m:[0m üîç Cache key: user_products_list_1_20_0_no_date_filter [8dc13d3e-1c7f-4638-b1d3-2da1f412acdc]
[2m2025-10-12T19:27:02.094128Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_products_v4[0m[2m:[0m ‚úÖ Successfully fetched 20 products for user 1 (total: 1543, date_filter: none) in 12ms [8dc13d3e-1c7f-4638-b1d3-2da1f412acdc]
[2m2025-10-12T19:27:02.270946Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:27:02.271222Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0mff6bcd70-4c6b-4769-9dc1-6e705b69fad6
[2m2025-10-12T19:27:02.271255Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request ff6bcd70-4c6b-4769-9dc1-6e705b69fad6: Processing for user 1 with limit 100 offset 300 order_by date direction DESC
[2m2025-10-12T19:27:02.271274Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request ff6bcd70-4c6b-4769-9dc1-6e705b69fad6: Querying details for user 1 with enhanced filters
[2m2025-10-12T19:27:02.271303Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request ff6bcd70-4c6b-4769-9dc1-6e705b69fad6: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T19:27:02.271393Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:27:02.271684Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m33ae5974-13fa-4b52-b0cb-a0ca6a2c10fe
[2m2025-10-12T19:27:02.271924Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 33ae5974-13fa-4b52-b0cb-a0ca6a2c10fe: Processing for user 1 with limit 100 offset 400 order_by date direction DESC
[2m2025-10-12T19:27:02.271971Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 33ae5974-13fa-4b52-b0cb-a0ca6a2c10fe: Querying details for user 1 with enhanced filters
[2m2025-10-12T19:27:02.272023Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 33ae5974-13fa-4b52-b0cb-a0ca6a2c10fe: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T19:27:02.272836Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:27:02.272965Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m629d1b50-b2b1-4999-afce-a563d8127fc2
[2m2025-10-12T19:27:02.272996Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 629d1b50-b2b1-4999-afce-a563d8127fc2: Processing for user 1 with limit 100 offset 500 order_by date direction DESC
[2m2025-10-12T19:27:02.273029Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 629d1b50-b2b1-4999-afce-a563d8127fc2: Querying details for user 1 with enhanced filters
[2m2025-10-12T19:27:02.273082Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 629d1b50-b2b1-4999-afce-a563d8127fc2: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T19:27:02.279178Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request ff6bcd70-4c6b-4769-9dc1-6e705b69fad6: Retrieved 100 invoice details (total: 2539) in 7ms with enhanced pagination
[2m2025-10-12T19:27:02.281921Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 33ae5974-13fa-4b52-b0cb-a0ca6a2c10fe: Retrieved 100 invoice details (total: 2539) in 10ms with enhanced pagination
[2m2025-10-12T19:27:02.283330Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 629d1b50-b2b1-4999-afce-a563d8127fc2: Retrieved 100 invoice details (total: 2539) in 10ms with enhanced pagination
[2m2025-10-12T19:27:02.867480Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:27:02.867764Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0md6372592-c41d-4371-abc0-3143018374ca
[2m2025-10-12T19:27:02.867816Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request d6372592-c41d-4371-abc0-3143018374ca: Processing for user 1 with limit 100 offset 600 order_by date direction DESC
[2m2025-10-12T19:27:02.867849Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request d6372592-c41d-4371-abc0-3143018374ca: Querying details for user 1 with enhanced filters
[2m2025-10-12T19:27:02.867886Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request d6372592-c41d-4371-abc0-3143018374ca: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T19:27:02.874178Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request d6372592-c41d-4371-abc0-3143018374ca: Retrieved 100 invoice details (total: 2539) in 6ms with enhanced pagination
[2m2025-10-12T19:27:02.879484Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:27:02.879668Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0me547dfef-837a-44c2-8a3e-d7e4b9f4fe02
[2m2025-10-12T19:27:02.879699Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request e547dfef-837a-44c2-8a3e-d7e4b9f4fe02: Processing for user 1 with limit 100 offset 700 order_by date direction DESC
[2m2025-10-12T19:27:02.879714Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request e547dfef-837a-44c2-8a3e-d7e4b9f4fe02: Querying details for user 1 with enhanced filters
[2m2025-10-12T19:27:02.879730Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request e547dfef-837a-44c2-8a3e-d7e4b9f4fe02: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T19:27:02.880115Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:27:02.880231Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m49f5c6dd-c2d8-4e6f-bbeb-0ff298098620
[2m2025-10-12T19:27:02.880250Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 49f5c6dd-c2d8-4e6f-bbeb-0ff298098620: Processing for user 1 with limit 100 offset 800 order_by date direction DESC
[2m2025-10-12T19:27:02.880271Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 49f5c6dd-c2d8-4e6f-bbeb-0ff298098620: Querying details for user 1 with enhanced filters
[2m2025-10-12T19:27:02.880289Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 49f5c6dd-c2d8-4e6f-bbeb-0ff298098620: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T19:27:02.888866Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request e547dfef-837a-44c2-8a3e-d7e4b9f4fe02: Retrieved 100 invoice details (total: 2539) in 9ms with enhanced pagination
[2m2025-10-12T19:27:02.889799Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 49f5c6dd-c2d8-4e6f-bbeb-0ff298098620: Retrieved 100 invoice details (total: 2539) in 9ms with enhanced pagination
[2m2025-10-12T19:27:03.604915Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:27:03.605135Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0mc01b877e-b616-4760-9c62-fa170eadd4a3
[2m2025-10-12T19:27:03.605170Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request c01b877e-b616-4760-9c62-fa170eadd4a3: Processing for user 1 with limit 100 offset 1000 order_by date direction DESC
[2m2025-10-12T19:27:03.605190Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request c01b877e-b616-4760-9c62-fa170eadd4a3: Querying details for user 1 with enhanced filters
[2m2025-10-12T19:27:03.605234Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request c01b877e-b616-4760-9c62-fa170eadd4a3: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T19:27:03.606011Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:27:03.606263Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m53e5b601-2dd8-49cf-8eb7-7676222d1cd2
[2m2025-10-12T19:27:03.606302Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 53e5b601-2dd8-49cf-8eb7-7676222d1cd2: Processing for user 1 with limit 100 offset 900 order_by date direction DESC
[2m2025-10-12T19:27:03.606322Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 53e5b601-2dd8-49cf-8eb7-7676222d1cd2: Querying details for user 1 with enhanced filters
[2m2025-10-12T19:27:03.606349Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 53e5b601-2dd8-49cf-8eb7-7676222d1cd2: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T19:27:03.607458Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:27:03.607635Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0mac15cb74-1e68-4e67-8956-98008e3271c8
[2m2025-10-12T19:27:03.607668Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request ac15cb74-1e68-4e67-8956-98008e3271c8: Processing for user 1 with limit 100 offset 1100 order_by date direction DESC
[2m2025-10-12T19:27:03.607683Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request ac15cb74-1e68-4e67-8956-98008e3271c8: Querying details for user 1 with enhanced filters
[2m2025-10-12T19:27:03.607702Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request ac15cb74-1e68-4e67-8956-98008e3271c8: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T19:27:03.613036Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request c01b877e-b616-4760-9c62-fa170eadd4a3: Retrieved 100 invoice details (total: 2539) in 7ms with enhanced pagination
[2m2025-10-12T19:27:03.615383Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 53e5b601-2dd8-49cf-8eb7-7676222d1cd2: Retrieved 100 invoice details (total: 2539) in 9ms with enhanced pagination
[2m2025-10-12T19:27:03.621783Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request ac15cb74-1e68-4e67-8956-98008e3271c8: Retrieved 100 invoice details (total: 2539) in 14ms with enhanced pagination
[2m2025-10-12T19:27:04.235772Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:27:04.236008Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m8953b205-7246-48eb-9636-b56364c923e5
[2m2025-10-12T19:27:04.236041Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 8953b205-7246-48eb-9636-b56364c923e5: Processing for user 1 with limit 100 offset 1300 order_by date direction DESC
[2m2025-10-12T19:27:04.236061Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 8953b205-7246-48eb-9636-b56364c923e5: Querying details for user 1 with enhanced filters
[2m2025-10-12T19:27:04.236087Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 8953b205-7246-48eb-9636-b56364c923e5: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T19:27:04.242370Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:27:04.242514Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m624d575d-ef9a-4c92-a320-5b76f232cebb
[2m2025-10-12T19:27:04.242403Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:27:04.242550Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 624d575d-ef9a-4c92-a320-5b76f232cebb: Processing for user 1 with limit 100 offset 1200 order_by date direction DESC
[2m2025-10-12T19:27:04.242571Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 624d575d-ef9a-4c92-a320-5b76f232cebb: Querying details for user 1 with enhanced filters
[2m2025-10-12T19:27:04.242595Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 624d575d-ef9a-4c92-a320-5b76f232cebb: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T19:27:04.242694Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0mdf1fba6b-4fb6-49dd-be54-99678424afab
[2m2025-10-12T19:27:04.242720Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request df1fba6b-4fb6-49dd-be54-99678424afab: Processing for user 1 with limit 100 offset 1400 order_by date direction DESC
[2m2025-10-12T19:27:04.242740Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request df1fba6b-4fb6-49dd-be54-99678424afab: Querying details for user 1 with enhanced filters
[2m2025-10-12T19:27:04.242764Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request df1fba6b-4fb6-49dd-be54-99678424afab: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T19:27:04.244521Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 8953b205-7246-48eb-9636-b56364c923e5: Retrieved 100 invoice details (total: 2539) in 8ms with enhanced pagination
[2m2025-10-12T19:27:04.251573Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request df1fba6b-4fb6-49dd-be54-99678424afab: Retrieved 100 invoice details (total: 2539) in 8ms with enhanced pagination
[2m2025-10-12T19:27:04.257271Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 624d575d-ef9a-4c92-a320-5b76f232cebb: Retrieved 100 invoice details (total: 2539) in 14ms with enhanced pagination
[2m2025-10-12T19:27:04.875848Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:27:04.876061Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0me4dd9d33-96bc-40c0-91ed-9d5a3cea1124
[2m2025-10-12T19:27:04.876322Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request e4dd9d33-96bc-40c0-91ed-9d5a3cea1124: Processing for user 1 with limit 100 offset 1600 order_by date direction DESC
[2m2025-10-12T19:27:04.876391Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request e4dd9d33-96bc-40c0-91ed-9d5a3cea1124: Querying details for user 1 with enhanced filters
[2m2025-10-12T19:27:04.876483Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request e4dd9d33-96bc-40c0-91ed-9d5a3cea1124: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T19:27:04.880056Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:27:04.880248Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m687ee4e8-448b-4551-ba39-28e543e44c01
[2m2025-10-12T19:27:04.880659Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 687ee4e8-448b-4551-ba39-28e543e44c01: Processing for user 1 with limit 100 offset 1500 order_by date direction DESC
[2m2025-10-12T19:27:04.880835Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 687ee4e8-448b-4551-ba39-28e543e44c01: Querying details for user 1 with enhanced filters
[2m2025-10-12T19:27:04.880936Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 687ee4e8-448b-4551-ba39-28e543e44c01: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T19:27:04.881314Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:27:04.881480Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0me87a3a0f-b65e-4307-89eb-671db6f328b9
[2m2025-10-12T19:27:04.881664Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request e87a3a0f-b65e-4307-89eb-671db6f328b9: Processing for user 1 with limit 100 offset 1700 order_by date direction DESC
[2m2025-10-12T19:27:04.881724Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request e87a3a0f-b65e-4307-89eb-671db6f328b9: Querying details for user 1 with enhanced filters
[2m2025-10-12T19:27:04.881743Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request e87a3a0f-b65e-4307-89eb-671db6f328b9: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T19:27:04.887482Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request e4dd9d33-96bc-40c0-91ed-9d5a3cea1124: Retrieved 100 invoice details (total: 2539) in 11ms with enhanced pagination
[2m2025-10-12T19:27:04.893813Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 687ee4e8-448b-4551-ba39-28e543e44c01: Retrieved 100 invoice details (total: 2539) in 13ms with enhanced pagination
[2m2025-10-12T19:27:04.894055Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request e87a3a0f-b65e-4307-89eb-671db6f328b9: Retrieved 100 invoice details (total: 2539) in 12ms with enhanced pagination
[2m2025-10-12T19:27:05.513839Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:27:05.514204Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m90c51f87-ba52-4205-9c4d-db166206bc79
[2m2025-10-12T19:27:05.514365Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 90c51f87-ba52-4205-9c4d-db166206bc79: Processing for user 1 with limit 100 offset 1900 order_by date direction DESC
[2m2025-10-12T19:27:05.514406Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 90c51f87-ba52-4205-9c4d-db166206bc79: Querying details for user 1 with enhanced filters
[2m2025-10-12T19:27:05.514448Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 90c51f87-ba52-4205-9c4d-db166206bc79: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T19:27:05.515984Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:27:05.516360Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m0f476c69-4ee3-4685-b590-d262d34f5429
[2m2025-10-12T19:27:05.516225Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:27:05.516755Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m45f860b3-3fe4-4a8a-a360-96d4d03c493f
[2m2025-10-12T19:27:05.516828Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 0f476c69-4ee3-4685-b590-d262d34f5429: Processing for user 1 with limit 100 offset 2000 order_by date direction DESC
[2m2025-10-12T19:27:05.516923Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 0f476c69-4ee3-4685-b590-d262d34f5429: Querying details for user 1 with enhanced filters
[2m2025-10-12T19:27:05.516945Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 0f476c69-4ee3-4685-b590-d262d34f5429: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T19:27:05.517292Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 45f860b3-3fe4-4a8a-a360-96d4d03c493f: Processing for user 1 with limit 100 offset 1800 order_by date direction DESC
[2m2025-10-12T19:27:05.517422Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 45f860b3-3fe4-4a8a-a360-96d4d03c493f: Querying details for user 1 with enhanced filters
[2m2025-10-12T19:27:05.520915Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 45f860b3-3fe4-4a8a-a360-96d4d03c493f: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T19:27:05.525219Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 90c51f87-ba52-4205-9c4d-db166206bc79: Retrieved 100 invoice details (total: 2539) in 11ms with enhanced pagination
[2m2025-10-12T19:27:05.533619Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 0f476c69-4ee3-4685-b590-d262d34f5429: Retrieved 100 invoice details (total: 2539) in 15ms with enhanced pagination
[2m2025-10-12T19:27:05.535413Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 45f860b3-3fe4-4a8a-a360-96d4d03c493f: Retrieved 100 invoice details (total: 2539) in 18ms with enhanced pagination
[2m2025-10-12T19:27:06.234411Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:27:06.234833Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0ma8f8d25e-e9ca-49f3-9c36-9d64b836fb98
[2m2025-10-12T19:27:06.235090Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request a8f8d25e-e9ca-49f3-9c36-9d64b836fb98: Processing for user 1 with limit 100 offset 2200 order_by date direction DESC
[2m2025-10-12T19:27:06.235114Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request a8f8d25e-e9ca-49f3-9c36-9d64b836fb98: Querying details for user 1 with enhanced filters
[2m2025-10-12T19:27:06.235141Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request a8f8d25e-e9ca-49f3-9c36-9d64b836fb98: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T19:27:06.235324Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:27:06.236497Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0mc4666ec4-14d2-42cc-92d8-18db52140e22
[2m2025-10-12T19:27:06.236525Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request c4666ec4-14d2-42cc-92d8-18db52140e22: Processing for user 1 with limit 100 offset 2100 order_by date direction DESC
[2m2025-10-12T19:27:06.236542Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request c4666ec4-14d2-42cc-92d8-18db52140e22: Querying details for user 1 with enhanced filters
[2m2025-10-12T19:27:06.236565Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request c4666ec4-14d2-42cc-92d8-18db52140e22: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T19:27:06.237311Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:27:06.237500Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m1ff10e84-d64b-43fe-8f61-d77fc995f098
[2m2025-10-12T19:27:06.237540Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 1ff10e84-d64b-43fe-8f61-d77fc995f098: Processing for user 1 with limit 100 offset 2300 order_by date direction DESC
[2m2025-10-12T19:27:06.237555Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 1ff10e84-d64b-43fe-8f61-d77fc995f098: Querying details for user 1 with enhanced filters
[2m2025-10-12T19:27:06.237571Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 1ff10e84-d64b-43fe-8f61-d77fc995f098: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T19:27:06.248370Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 1ff10e84-d64b-43fe-8f61-d77fc995f098: Retrieved 100 invoice details (total: 2539) in 10ms with enhanced pagination
[2m2025-10-12T19:27:06.254862Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request a8f8d25e-e9ca-49f3-9c36-9d64b836fb98: Retrieved 100 invoice details (total: 2539) in 20ms with enhanced pagination
[2m2025-10-12T19:27:06.254905Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request c4666ec4-14d2-42cc-92d8-18db52140e22: Retrieved 100 invoice details (total: 2539) in 18ms with enhanced pagination
[2m2025-10-12T19:27:06.873813Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:27:06.874178Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0mcd8ed5c5-0696-4c5f-966b-2b5ac3292b12
[2m2025-10-12T19:27:06.874368Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request cd8ed5c5-0696-4c5f-966b-2b5ac3292b12: Processing for user 1 with limit 100 offset 2500 order_by date direction DESC
[2m2025-10-12T19:27:06.874400Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request cd8ed5c5-0696-4c5f-966b-2b5ac3292b12: Querying details for user 1 with enhanced filters
[2m2025-10-12T19:27:06.874444Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request cd8ed5c5-0696-4c5f-966b-2b5ac3292b12: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T19:27:06.875146Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:27:06.875267Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m0c6ca155-a5a5-4bca-a622-9bd026586d8e
[2m2025-10-12T19:27:06.875286Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 0c6ca155-a5a5-4bca-a622-9bd026586d8e: Processing for user 1 with limit 100 offset 2400 order_by date direction DESC
[2m2025-10-12T19:27:06.875300Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 0c6ca155-a5a5-4bca-a622-9bd026586d8e: Querying details for user 1 with enhanced filters
[2m2025-10-12T19:27:06.875318Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 0c6ca155-a5a5-4bca-a622-9bd026586d8e: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T19:27:06.878777Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:27:06.878916Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m180b925f-57b5-4efa-b477-e498b9b02abc
[2m2025-10-12T19:27:06.878944Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 180b925f-57b5-4efa-b477-e498b9b02abc: Processing for user 1 with limit 100 offset 2600 order_by date direction DESC
[2m2025-10-12T19:27:06.878957Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 180b925f-57b5-4efa-b477-e498b9b02abc: Querying details for user 1 with enhanced filters
[2m2025-10-12T19:27:06.878973Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 180b925f-57b5-4efa-b477-e498b9b02abc: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T19:27:06.882376Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request cd8ed5c5-0696-4c5f-966b-2b5ac3292b12: Retrieved 39 invoice details (total: 2539) in 8ms with enhanced pagination
[2m2025-10-12T19:27:06.886242Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 0c6ca155-a5a5-4bca-a622-9bd026586d8e: Retrieved 100 invoice details (total: 2539) in 10ms with enhanced pagination
[2m2025-10-12T19:27:06.887480Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 180b925f-57b5-4efa-b477-e498b9b02abc: Retrieved 0 invoice details (total: 2539) in 8ms with enhanced pagination
[2m2025-10-12T19:27:07.450671Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:27:07.450887Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m6863ee9a-73ed-41aa-a3cf-964c74f66aa0
[2m2025-10-12T19:27:07.450920Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 6863ee9a-73ed-41aa-a3cf-964c74f66aa0: Processing for user 1 with limit 100 offset 2700 order_by date direction DESC
[2m2025-10-12T19:27:07.450939Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 6863ee9a-73ed-41aa-a3cf-964c74f66aa0: Querying details for user 1 with enhanced filters
[2m2025-10-12T19:27:07.450965Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 6863ee9a-73ed-41aa-a3cf-964c74f66aa0: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T19:27:07.451210Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:27:07.451523Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0mae71d295-75af-4680-97ef-e4d37ff077db
[2m2025-10-12T19:27:07.451563Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request ae71d295-75af-4680-97ef-e4d37ff077db: Processing for user 1 with limit 100 offset 2900 order_by date direction DESC
[2m2025-10-12T19:27:07.451583Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request ae71d295-75af-4680-97ef-e4d37ff077db: Querying details for user 1 with enhanced filters
[2m2025-10-12T19:27:07.451641Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request ae71d295-75af-4680-97ef-e4d37ff077db: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T19:27:07.456680Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 6863ee9a-73ed-41aa-a3cf-964c74f66aa0: Retrieved 0 invoice details (total: 2539) in 5ms with enhanced pagination
[2m2025-10-12T19:27:07.457671Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request ae71d295-75af-4680-97ef-e4d37ff077db: Retrieved 0 invoice details (total: 2539) in 6ms with enhanced pagination
[2m2025-10-12T19:27:07.459138Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:27:07.459356Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0ma387ec5e-76a7-43b9-9a5c-c2326ae11f3d
[2m2025-10-12T19:27:07.459400Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request a387ec5e-76a7-43b9-9a5c-c2326ae11f3d: Processing for user 1 with limit 100 offset 2800 order_by date direction DESC
[2m2025-10-12T19:27:07.459454Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request a387ec5e-76a7-43b9-9a5c-c2326ae11f3d: Querying details for user 1 with enhanced filters
[2m2025-10-12T19:27:07.459491Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request a387ec5e-76a7-43b9-9a5c-c2326ae11f3d: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T19:27:07.464452Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request a387ec5e-76a7-43b9-9a5c-c2326ae11f3d: Retrieved 0 invoice details (total: 2539) in 5ms with enhanced pagination
[2m2025-10-12T19:27:10.721117Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:27:10.721378Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0mbbf26cb4-b268-4384-b9c7-fb47e818403c
[2m2025-10-12T19:27:10.721418Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request bbf26cb4-b268-4384-b9c7-fb47e818403c: Processing headers for user 1 with limit 50 offset 50
[2m2025-10-12T19:27:10.721444Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request bbf26cb4-b268-4384-b9c7-fb47e818403c: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            h.issuer_ruc,
            h.issuer_dv,
            h.issuer_address,
            h.issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T19:27:10.723996Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:27:10.724229Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0mdca05a16-0244-430f-9c23-88e0357b9746
[2m2025-10-12T19:27:10.724338Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request dca05a16-0244-430f-9c23-88e0357b9746: Processing headers for user 1 with limit 50 offset 0
[2m2025-10-12T19:27:10.724430Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request dca05a16-0244-430f-9c23-88e0357b9746: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            h.issuer_ruc,
            h.issuer_dv,
            h.issuer_address,
            h.issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T19:27:10.725410Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request bbf26cb4-b268-4384-b9c7-fb47e818403c: Retrieved 0 invoice headers (total: 0) in 4ms with enhanced filtering
[2m2025-10-12T19:27:10.726814Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request dca05a16-0244-430f-9c23-88e0357b9746: Retrieved 0 invoice headers (total: 0) in 2ms with enhanced filtering
[2m2025-10-12T19:27:10.726845Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:27:10.727181Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0m56d9176e-ef64-4d8e-b66a-a79c5611102c
[2m2025-10-12T19:27:10.727390Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 56d9176e-ef64-4d8e-b66a-a79c5611102c: Processing headers for user 1 with limit 50 offset 100
[2m2025-10-12T19:27:10.727473Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 56d9176e-ef64-4d8e-b66a-a79c5611102c: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            h.issuer_ruc,
            h.issuer_dv,
            h.issuer_address,
            h.issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T19:27:10.729715Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 56d9176e-ef64-4d8e-b66a-a79c5611102c: Retrieved 0 invoice headers (total: 0) in 2ms with enhanced filtering
[2m2025-10-12T19:27:10.956160Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:27:10.956378Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0maf7d04bf-58b9-467c-a3f9-786147407926
[2m2025-10-12T19:27:10.956412Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request af7d04bf-58b9-467c-a3f9-786147407926: Processing for user 1 with limit 100 offset 0 order_by date direction DESC
[2m2025-10-12T19:27:10.956444Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request af7d04bf-58b9-467c-a3f9-786147407926: Querying details for user 1 with enhanced filters
[2m2025-10-12T19:27:10.956474Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request af7d04bf-58b9-467c-a3f9-786147407926: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T19:27:10.958190Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request af7d04bf-58b9-467c-a3f9-786147407926: Retrieved 0 invoice details (total: 0) in 1ms with enhanced pagination
[2m2025-10-12T19:27:10.977185Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:27:10.977325Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m84640ab1-4311-4835-acbd-e17f555f1ce0
[2m2025-10-12T19:27:10.977353Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 84640ab1-4311-4835-acbd-e17f555f1ce0: Processing for user 1 with limit 100 offset 100 order_by date direction DESC
[2m2025-10-12T19:27:10.977369Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 84640ab1-4311-4835-acbd-e17f555f1ce0: Querying details for user 1 with enhanced filters
[2m2025-10-12T19:27:10.977389Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 84640ab1-4311-4835-acbd-e17f555f1ce0: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T19:27:10.978996Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 84640ab1-4311-4835-acbd-e17f555f1ce0: Retrieved 0 invoice details (total: 0) in 1ms with enhanced pagination
[2m2025-10-12T19:27:10.980300Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:27:10.980533Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m5c0131b0-6adc-49b0-800c-e4a2239323b4
[2m2025-10-12T19:27:10.980655Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 5c0131b0-6adc-49b0-800c-e4a2239323b4: Processing for user 1 with limit 100 offset 200 order_by date direction DESC
[2m2025-10-12T19:27:10.980721Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 5c0131b0-6adc-49b0-800c-e4a2239323b4: Querying details for user 1 with enhanced filters
[2m2025-10-12T19:27:10.980781Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 5c0131b0-6adc-49b0-800c-e4a2239323b4: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T19:27:10.984707Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 5c0131b0-6adc-49b0-800c-e4a2239323b4: Retrieved 0 invoice details (total: 0) in 4ms with enhanced pagination
[2m2025-10-12T19:27:11.758117Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:27:11.758340Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0m8c5a6c89-fed1-4d84-a689-27d469f5b330
[2m2025-10-12T19:27:11.758364Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 8c5a6c89-fed1-4d84-a689-27d469f5b330: Processing headers for user 1 with limit 50 offset 50
[2m2025-10-12T19:27:11.758388Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 8c5a6c89-fed1-4d84-a689-27d469f5b330: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            h.issuer_ruc,
            h.issuer_dv,
            h.issuer_address,
            h.issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T19:27:11.759208Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:27:11.759429Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0m3c32f2b3-d555-441b-9fe9-c64bf70d6f2f
[2m2025-10-12T19:27:11.759455Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 3c32f2b3-d555-441b-9fe9-c64bf70d6f2f: Processing headers for user 1 with limit 50 offset 0
[2m2025-10-12T19:27:11.759479Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 3c32f2b3-d555-441b-9fe9-c64bf70d6f2f: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            h.issuer_ruc,
            h.issuer_dv,
            h.issuer_address,
            h.issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T19:27:11.761523Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:27:11.761908Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 8c5a6c89-fed1-4d84-a689-27d469f5b330: Retrieved 0 invoice headers (total: 0) in 3ms with enhanced filtering
[2m2025-10-12T19:27:11.762865Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0m5f87a05b-e0a3-457a-afe4-7171cf4a5eed
[2m2025-10-12T19:27:11.763047Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 5f87a05b-e0a3-457a-afe4-7171cf4a5eed: Processing headers for user 1 with limit 50 offset 100
[2m2025-10-12T19:27:11.763143Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 5f87a05b-e0a3-457a-afe4-7171cf4a5eed: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            h.issuer_ruc,
            h.issuer_dv,
            h.issuer_address,
            h.issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T19:27:11.763721Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 3c32f2b3-d555-441b-9fe9-c64bf70d6f2f: Retrieved 0 invoice headers (total: 0) in 4ms with enhanced filtering
[2m2025-10-12T19:27:11.765305Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 5f87a05b-e0a3-457a-afe4-7171cf4a5eed: Retrieved 0 invoice headers (total: 0) in 2ms with enhanced filtering
[2m2025-10-12T19:27:11.955916Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:27:11.956155Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m26435c5d-c346-4d57-b503-da8a38e7ebed
[2m2025-10-12T19:27:11.956192Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 26435c5d-c346-4d57-b503-da8a38e7ebed: Processing for user 1 with limit 100 offset 100 order_by date direction DESC
[2m2025-10-12T19:27:11.956211Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 26435c5d-c346-4d57-b503-da8a38e7ebed: Querying details for user 1 with enhanced filters
[2m2025-10-12T19:27:11.956239Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 26435c5d-c346-4d57-b503-da8a38e7ebed: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T19:27:11.957180Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:27:11.957332Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m275a64da-1d13-49be-9c9e-6ea05d49aedd
[2m2025-10-12T19:27:11.957362Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 275a64da-1d13-49be-9c9e-6ea05d49aedd: Processing for user 1 with limit 100 offset 0 order_by date direction DESC
[2m2025-10-12T19:27:11.957378Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 275a64da-1d13-49be-9c9e-6ea05d49aedd: Querying details for user 1 with enhanced filters
[2m2025-10-12T19:27:11.957399Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 275a64da-1d13-49be-9c9e-6ea05d49aedd: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T19:27:11.957980Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:27:11.958111Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0mc4b5d6db-f083-4724-ba2a-9502eb268bfd
[2m2025-10-12T19:27:11.958139Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request c4b5d6db-f083-4724-ba2a-9502eb268bfd: Processing for user 1 with limit 100 offset 200 order_by date direction DESC
[2m2025-10-12T19:27:11.958154Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request c4b5d6db-f083-4724-ba2a-9502eb268bfd: Querying details for user 1 with enhanced filters
[2m2025-10-12T19:27:11.958171Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request c4b5d6db-f083-4724-ba2a-9502eb268bfd: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T19:27:11.958388Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 26435c5d-c346-4d57-b503-da8a38e7ebed: Retrieved 0 invoice details (total: 0) in 2ms with enhanced pagination
[2m2025-10-12T19:27:11.959872Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request c4b5d6db-f083-4724-ba2a-9502eb268bfd: Retrieved 0 invoice details (total: 0) in 1ms with enhanced pagination
[2m2025-10-12T19:27:11.960025Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 275a64da-1d13-49be-9c9e-6ea05d49aedd: Retrieved 0 invoice details (total: 0) in 2ms with enhanced pagination
[2m2025-10-12T19:27:27.229792Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:27:27.230030Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0mda2150fc-661a-4e68-a5de-5c48ff4852a0
[2m2025-10-12T19:27:27.230087Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request da2150fc-661a-4e68-a5de-5c48ff4852a0: Processing headers for user 1 with limit 50 offset 50
[2m2025-10-12T19:27:27.230118Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:27:27.230116Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request da2150fc-661a-4e68-a5de-5c48ff4852a0: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            h.issuer_ruc,
            h.issuer_dv,
            h.issuer_address,
            h.issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T19:27:27.230254Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0m184f4ac9-2961-45db-8e67-160e47568cef
[2m2025-10-12T19:27:27.230282Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 184f4ac9-2961-45db-8e67-160e47568cef: Processing headers for user 1 with limit 50 offset 100
[2m2025-10-12T19:27:27.230302Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 184f4ac9-2961-45db-8e67-160e47568cef: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            h.issuer_ruc,
            h.issuer_dv,
            h.issuer_address,
            h.issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T19:27:27.232032Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 184f4ac9-2961-45db-8e67-160e47568cef: Retrieved 0 invoice headers (total: 0) in 1ms with enhanced filtering
[2m2025-10-12T19:27:27.232067Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request da2150fc-661a-4e68-a5de-5c48ff4852a0: Retrieved 0 invoice headers (total: 0) in 2ms with enhanced filtering
[2m2025-10-12T19:27:27.243979Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:27:27.244122Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0m930726d5-37fb-4616-bf41-3d889a722c32
[2m2025-10-12T19:27:27.244156Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 930726d5-37fb-4616-bf41-3d889a722c32: Processing headers for user 1 with limit 50 offset 0
[2m2025-10-12T19:27:27.244192Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 930726d5-37fb-4616-bf41-3d889a722c32: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            h.issuer_ruc,
            h.issuer_dv,
            h.issuer_address,
            h.issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T19:27:27.245712Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 930726d5-37fb-4616-bf41-3d889a722c32: Retrieved 0 invoice headers (total: 0) in 1ms with enhanced filtering
[2m2025-10-12T19:27:27.413594Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:27:27.413835Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m9fd42ceb-55d4-4394-a1f5-dffda393403b
[2m2025-10-12T19:27:27.413861Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 9fd42ceb-55d4-4394-a1f5-dffda393403b: Processing for user 1 with limit 100 offset 100 order_by date direction DESC
[2m2025-10-12T19:27:27.413878Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 9fd42ceb-55d4-4394-a1f5-dffda393403b: Querying details for user 1 with enhanced filters
[2m2025-10-12T19:27:27.413906Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 9fd42ceb-55d4-4394-a1f5-dffda393403b: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T19:27:27.414394Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:27:27.414683Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m634fede5-51d3-4902-a08d-167be1678e82
[2m2025-10-12T19:27:27.414731Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 634fede5-51d3-4902-a08d-167be1678e82: Processing for user 1 with limit 100 offset 0 order_by date direction DESC
[2m2025-10-12T19:27:27.414777Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 634fede5-51d3-4902-a08d-167be1678e82: Querying details for user 1 with enhanced filters
[2m2025-10-12T19:27:27.414817Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 634fede5-51d3-4902-a08d-167be1678e82: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T19:27:27.415109Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:27:27.415282Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m13300e79-b6fd-44a9-a4d7-330c8c2beca1
[2m2025-10-12T19:27:27.415348Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 13300e79-b6fd-44a9-a4d7-330c8c2beca1: Processing for user 1 with limit 100 offset 200 order_by date direction DESC
[2m2025-10-12T19:27:27.415414Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 13300e79-b6fd-44a9-a4d7-330c8c2beca1: Querying details for user 1 with enhanced filters
[2m2025-10-12T19:27:27.415444Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 13300e79-b6fd-44a9-a4d7-330c8c2beca1: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T19:27:27.416491Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 9fd42ceb-55d4-4394-a1f5-dffda393403b: Retrieved 0 invoice details (total: 0) in 2ms with enhanced pagination
[2m2025-10-12T19:27:27.418306Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 13300e79-b6fd-44a9-a4d7-330c8c2beca1: Retrieved 0 invoice details (total: 0) in 3ms with enhanced pagination
[2m2025-10-12T19:27:27.420864Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 634fede5-51d3-4902-a08d-167be1678e82: Retrieved 0 invoice details (total: 0) in 6ms with enhanced pagination
[2m2025-10-12T19:27:51.720323Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:27:51.720464Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m Getting user balance for user_id: 1
[2m2025-10-12T19:27:51.722085Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m User balance retrieved successfully for user 1 in 1ms: 302 L√ºmis
[2m2025-10-12T19:30:03.453987Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:30:03.454144Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:30:03.454197Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m Fetching user data for user_id: 1
[2m2025-10-12T19:30:03.455979Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m User data retrieved in 1ms for user_id: 1 - email: Some("andresfelipevalenciag@gmail.com")
[2m2025-10-12T19:30:38.464043Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:30:38.464240Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:30:38.464337Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m Fetching user data for user_id: 1
[2m2025-10-12T19:30:38.465393Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m User data retrieved in 1ms for user_id: 1 - email: Some("andresfelipevalenciag@gmail.com")
[2m2025-10-12T19:30:43.661690Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:30:43.661875Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:30:43.661937Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m Fetching user data for user_id: 1
[2m2025-10-12T19:30:43.663978Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m User data retrieved in 2ms for user_id: 1 - email: Some("andresfelipevalenciag@gmail.com")
[2m2025-10-12T19:30:47.821378Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:30:47.821747Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:30:47.822091Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m Updating user data for user_id: 1 with payload: UpdateUserData { name: None, date_of_birth: None, country_origin: None, country_residence: None, segment_activity: None, genre: Some("F"), ws_id: None }
[2m2025-10-12T19:30:47.822154Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m Generated UPDATE query: 
        UPDATE public.dim_users
        SET genre = $1, updated_at = $2
        WHERE id = $3
        RETURNING name, email, date_of_birth, country_origin, country_residence, 
                  segment_activity, genre, ws_id, updated_at
        
[2m2025-10-12T19:30:47.826864Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m User data updated in 4ms for user_id: 1 - email: Some("andresfelipevalenciag@gmail.com")
[2m2025-10-12T19:30:47.997243Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:30:47.997399Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:30:47.997462Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m Fetching user data for user_id: 1
[2m2025-10-12T19:30:47.998592Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m User data retrieved in 1ms for user_id: 1 - email: Some("andresfelipevalenciag@gmail.com")
[2m2025-10-12T19:30:52.262330Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:30:52.262531Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:30:52.262749Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m Updating user data for user_id: 1 with payload: UpdateUserData { name: None, date_of_birth: None, country_origin: None, country_residence: None, segment_activity: None, genre: Some("M"), ws_id: None }
[2m2025-10-12T19:30:52.262852Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m Generated UPDATE query: 
        UPDATE public.dim_users
        SET genre = $1, updated_at = $2
        WHERE id = $3
        RETURNING name, email, date_of_birth, country_origin, country_residence, 
                  segment_activity, genre, ws_id, updated_at
        
[2m2025-10-12T19:30:52.266507Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m User data updated in 3ms for user_id: 1 - email: Some("andresfelipevalenciag@gmail.com")
[2m2025-10-12T19:30:52.461991Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:30:52.462143Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:30:52.462192Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m Fetching user data for user_id: 1
[2m2025-10-12T19:30:52.463808Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m User data retrieved in 1ms for user_id: 1 - email: Some("andresfelipevalenciag@gmail.com")
[2m2025-10-12T19:31:04.987791Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:31:04.987954Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:31:04.988095Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m Updating user data for user_id: 1 with payload: UpdateUserData { name: None, date_of_birth: Some("28/04/1953"), country_origin: None, country_residence: None, segment_activity: None, genre: None, ws_id: None }
[2m2025-10-12T19:31:04.988148Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m Generated UPDATE query: 
        UPDATE public.dim_users
        SET date_of_birth = $1, updated_at = $2
        WHERE id = $3
        RETURNING name, email, date_of_birth, country_origin, country_residence, 
                  segment_activity, genre, ws_id, updated_at
        
[2m2025-10-12T19:31:04.991577Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m User data updated in 3ms for user_id: 1 - email: Some("andresfelipevalenciag@gmail.com")
[2m2025-10-12T19:31:05.147578Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:31:05.147772Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:31:05.147845Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m Fetching user data for user_id: 1
[2m2025-10-12T19:31:05.149792Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m User data retrieved in 1ms for user_id: 1 - email: Some("andresfelipevalenciag@gmail.com")
[2m2025-10-12T19:31:18.365328Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:31:18.365498Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:31:18.365703Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m Updating user data for user_id: 1 with payload: UpdateUserData { name: None, date_of_birth: Some("06/08/1987"), country_origin: None, country_residence: None, segment_activity: None, genre: None, ws_id: None }
[2m2025-10-12T19:31:18.365816Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m Generated UPDATE query: 
        UPDATE public.dim_users
        SET date_of_birth = $1, updated_at = $2
        WHERE id = $3
        RETURNING name, email, date_of_birth, country_origin, country_residence, 
                  segment_activity, genre, ws_id, updated_at
        
[2m2025-10-12T19:31:18.369334Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m User data updated in 3ms for user_id: 1 - email: Some("andresfelipevalenciag@gmail.com")
[2m2025-10-12T19:31:18.540828Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:31:18.541012Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T19:31:18.541082Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m Fetching user data for user_id: 1
[2m2025-10-12T19:31:18.542785Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m User data retrieved in 1ms for user_id: 1 - email: Some("andresfelipevalenciag@gmail.com")
[2m2025-10-12T20:09:09.348262Z[0m [32m INFO[0m [2mlum_rust_ws::api::root_v4[0m[2m:[0m Request 499f8549-79be-455b-8086-703e9fefa0f1: Root endpoint accessed
[2m2025-10-12T20:44:21.632255Z[0m [33m WARN[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m Missing Authorization header
[2m2025-10-12T21:23:56.824311Z[0m [32m INFO[0m [2mlum_rust_ws::api::root_v4[0m[2m:[0m Request 9b538364-2c91-46d1-b2eb-9ddffd55501d: Root endpoint accessed
[2m2025-10-12T21:30:38.153992Z[0m [32m INFO[0m [2mlum_rust_ws::api::root_v4[0m[2m:[0m Request 5313911a-740f-47fa-bd58-e54b11b9beb0: Root endpoint accessed
[2m2025-10-12T22:38:31.423048Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_registration_v4[0m[2m:[0m Request 77fb0406-7244-42d7-b592-186416b6e70e: Checking email existence: andresfelipevalenciag@gmail.com
[2m2025-10-12T22:38:31.424784Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_registration_v4[0m[2m:[0m Request 77fb0406-7244-42d7-b592-186416b6e70e: Querying database for email: andresfelipevalenciag@gmail.com
[2m2025-10-12T22:38:31.427933Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_registration_v4[0m[2m:[0m Request 77fb0406-7244-42d7-b592-186416b6e70e: Found existing user with ID: 1
[2m2025-10-12T22:38:31.427988Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_registration_v4[0m[2m:[0m Request 77fb0406-7244-42d7-b592-186416b6e70e: Email andresfelipevalenciag@gmail.com exists with password: false
[2m2025-10-12T22:38:31.614298Z[0m [32m INFO[0m [2mlum_rust_ws::api::unified_password[0m[2m:[0m üîê Processing password code request [3mrequest_id[0m[2m=[0mb3337090-7dfa-493b-9502-27506aba275e [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com [3mpurpose[0m[2m=[0memail_verification
[2m2025-10-12T22:38:31.616947Z[0m [32m INFO[0m [2mlum_rust_ws::api::unified_password[0m[2m:[0m üìß Email verification code requested [3mrequest_id[0m[2m=[0mb3337090-7dfa-493b-9502-27506aba275e [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T22:38:31.626206Z[0m [32m INFO[0m [2mlum_rust_ws::api::verification_v4[0m[2m:[0m üìß EMAIL CONTENT for andresfelipevalenciag@gmail.com (Request: b3337090-7dfa-493b-9502-27506aba275e)
üì¨ To: andresfelipevalenciag@gmail.com
üìã Subject: C√≥digo de Verificaci√≥n - L√ºm
üìù Format: HTML + Plain Text
üìù Code: 341714
[2m2025-10-12T22:38:31.626274Z[0m [32m INFO[0m [2mlum_rust_ws::api::verification_v4[0m[2m:[0m üöÄ SENDING HTML EMAIL via SMTP mail.lumapp.org to: andresfelipevalenciag@gmail.com
[2m2025-10-12T22:38:32.349780Z[0m [32m INFO[0m [2mlum_rust_ws::api::verification_v4[0m[2m:[0m ‚úÖ HTML Email sent successfully via SMTP to: andresfelipevalenciag@gmail.com (Request: b3337090-7dfa-493b-9502-27506aba275e) - Response: Response { code: Code { severity: PositiveCompletion, category: MailSystem, detail: Zero }, message: ["OK id=1v84i0-00000009FjM-0xNN"] }
[2m2025-10-12T22:38:32.349895Z[0m [32m INFO[0m [2mlum_rust_ws::api::unified_password[0m[2m:[0m ‚úÖ Verification email sent successfully [3mrequest_id[0m[2m=[0mb3337090-7dfa-493b-9502-27506aba275e [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T22:38:32.356003Z[0m [32m INFO[0m [2mlum_rust_ws::api::unified_password[0m[2m:[0m ‚úÖ Password code request processed successfully [3mrequest_id[0m[2m=[0mb3337090-7dfa-493b-9502-27506aba275e [3mprocessing_time_ms[0m[2m=[0m741
[2m2025-10-12T22:40:37.511946Z[0m [32m INFO[0m [2mlum_rust_ws::api::unified_password[0m[2m:[0m üîê Processing set password with email code request [3mrequest_id[0m[2m=[0m828dd3b6-0741-47cb-ae1b-0cccad0d9395 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T22:40:38.471720Z[0m [32m INFO[0m [2mlum_rust_ws::api::unified_password[0m[2m:[0m ‚úÖ Password set successfully with email verification code [3mrequest_id[0m[2m=[0m828dd3b6-0741-47cb-ae1b-0cccad0d9395 [3muser_id[0m[2m=[0m1 [3mprocessing_time_ms[0m[2m=[0m959
[2m2025-10-12T22:40:39.091768Z[0m [32m INFO[0m [2mlum_rust_ws::api::auth_v4[0m[2m:[0m üîê Processing user login request [3mrequest_id[0m[2m=[0mdead2c7a-9a6a-4d88-926c-c69433bab346 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com [3mremember_me[0m[2m=[0mfalse
[2m2025-10-12T22:40:40.047328Z[0m [32m INFO[0m [2mlum_rust_ws::api::auth_v4[0m[2m:[0m üéâ User login successful - JWT token generated for frontend compatibility [3mrequest_id[0m[2m=[0mdead2c7a-9a6a-4d88-926c-c69433bab346 [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com [3mexecution_time_ms[0m[2m=[0m955 [3mremember_me[0m[2m=[0mfalse
[2m2025-10-12T22:40:43.997811Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T22:40:43.997974Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m Getting user balance for user_id: 1
[2m2025-10-12T22:40:43.999583Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m User balance retrieved successfully for user 1 in 1ms: 302 L√ºmis
[2m2025-10-12T22:40:44.005519Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T22:40:44.005690Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T22:40:44.005763Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m Fetching user data for user_id: 1
[2m2025-10-12T22:40:44.007297Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m User data retrieved in 1ms for user_id: 1 - email: Some("andresfelipevalenciag@gmail.com")
[2m2025-10-12T22:40:48.330792Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T22:40:48.331210Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T22:40:48.331331Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_issuers_v4[0m[2m:[0m üìã Fetching user issuers for user_id: 1 [5847e8b3-1dd2-40c8-9507-0f302ecdbdfb]
[2m2025-10-12T22:40:48.331366Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_issuers_v4[0m[2m:[0m üîç Cache key: user_issuers_list_1_100_0_no_date_filter [5847e8b3-1dd2-40c8-9507-0f302ecdbdfb]
[2m2025-10-12T22:40:48.335143Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T22:40:48.335340Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T22:40:48.335867Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_issuers_v4[0m[2m:[0m üìã Fetching user issuers for user_id: 1 [263a2a99-f549-4087-8ddb-9e4717834c11]
[2m2025-10-12T22:40:48.335940Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_issuers_v4[0m[2m:[0m üîç Cache key: user_issuers_list_1_100_0_no_date_filter [263a2a99-f549-4087-8ddb-9e4717834c11]
[2m2025-10-12T22:40:48.339424Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_issuers_v4[0m[2m:[0m ‚úÖ Successfully fetched 100 issuers for user 1 (total: 97, date_filter: none) in 8ms [5847e8b3-1dd2-40c8-9507-0f302ecdbdfb]
[2m2025-10-12T22:40:48.344798Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_issuers_v4[0m[2m:[0m ‚úÖ Successfully fetched 100 issuers for user 1 (total: 97, date_filter: none) in 8ms [263a2a99-f549-4087-8ddb-9e4717834c11]
[2m2025-10-12T22:40:48.759889Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T22:40:48.760119Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T22:40:48.760215Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_products_v4[0m[2m:[0m üõí Fetching user products for user_id: 1 [c97ae549-288e-4111-9e98-3ba4a8ac0eb3]
[2m2025-10-12T22:40:48.760258Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_products_v4[0m[2m:[0m üîç Cache key: user_products_list_1_20_0_no_date_filter [c97ae549-288e-4111-9e98-3ba4a8ac0eb3]
[2m2025-10-12T22:40:48.776072Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_products_v4[0m[2m:[0m ‚úÖ Successfully fetched 20 products for user 1 (total: 1543, date_filter: none) in 15ms [c97ae549-288e-4111-9e98-3ba4a8ac0eb3]
[2m2025-10-12T22:40:48.905010Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T22:40:48.905201Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T22:40:48.905278Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_products_v4[0m[2m:[0m üõí Fetching user products for user_id: 1 [d1e7d232-7e40-4d26-906f-c6edf846bbc7]
[2m2025-10-12T22:40:48.905303Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_products_v4[0m[2m:[0m üîç Cache key: user_products_list_1_20_0_no_date_filter [d1e7d232-7e40-4d26-906f-c6edf846bbc7]
[2m2025-10-12T22:40:48.919615Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_products_v4[0m[2m:[0m ‚úÖ Successfully fetched 20 products for user 1 (total: 1543, date_filter: none) in 14ms [d1e7d232-7e40-4d26-906f-c6edf846bbc7]
[2m2025-10-12T22:40:49.006784Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T22:40:49.007027Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0me3fc5191-98f3-4122-82ed-5b2fc1ca21b8
[2m2025-10-12T22:40:49.007059Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request e3fc5191-98f3-4122-82ed-5b2fc1ca21b8: Processing headers for user 1 with limit 50 offset 0
[2m2025-10-12T22:40:49.007083Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request e3fc5191-98f3-4122-82ed-5b2fc1ca21b8: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            h.issuer_ruc,
            h.issuer_dv,
            h.issuer_address,
            h.issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T22:40:49.022187Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request e3fc5191-98f3-4122-82ed-5b2fc1ca21b8: Retrieved 50 invoice headers (total: 343) in 15ms with enhanced filtering
[2m2025-10-12T22:40:49.282089Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T22:40:49.282315Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0m1ab0af9d-80dd-49cc-b0e8-708d9da61b31
[2m2025-10-12T22:40:49.282353Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 1ab0af9d-80dd-49cc-b0e8-708d9da61b31: Processing headers for user 1 with limit 50 offset 100
[2m2025-10-12T22:40:49.282385Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 1ab0af9d-80dd-49cc-b0e8-708d9da61b31: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            h.issuer_ruc,
            h.issuer_dv,
            h.issuer_address,
            h.issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T22:40:49.291743Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 1ab0af9d-80dd-49cc-b0e8-708d9da61b31: Retrieved 50 invoice headers (total: 343) in 9ms with enhanced filtering
[2m2025-10-12T22:40:49.314510Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T22:40:49.314740Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0mf07ac7f8-73fd-4d51-957f-e4128ef44f86
[2m2025-10-12T22:40:49.314791Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request f07ac7f8-73fd-4d51-957f-e4128ef44f86: Processing headers for user 1 with limit 50 offset 50
[2m2025-10-12T22:40:49.314816Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request f07ac7f8-73fd-4d51-957f-e4128ef44f86: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            h.issuer_ruc,
            h.issuer_dv,
            h.issuer_address,
            h.issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T22:40:49.330353Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request f07ac7f8-73fd-4d51-957f-e4128ef44f86: Retrieved 50 invoice headers (total: 343) in 15ms with enhanced filtering
[2m2025-10-12T22:40:52.208550Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T22:40:52.208807Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0m9096df1b-c885-4faf-a316-6d16e81fc2e2
[2m2025-10-12T22:40:52.208867Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 9096df1b-c885-4faf-a316-6d16e81fc2e2: Processing headers for user 1 with limit 50 offset 200
[2m2025-10-12T22:40:52.208894Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 9096df1b-c885-4faf-a316-6d16e81fc2e2: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            h.issuer_ruc,
            h.issuer_dv,
            h.issuer_address,
            h.issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T22:40:52.209964Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T22:40:52.210234Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0m9953546d-b6a2-4cd5-8dce-aaf3dd45d361
[2m2025-10-12T22:40:52.210262Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 9953546d-b6a2-4cd5-8dce-aaf3dd45d361: Processing headers for user 1 with limit 50 offset 150
[2m2025-10-12T22:40:52.210292Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 9953546d-b6a2-4cd5-8dce-aaf3dd45d361: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            h.issuer_ruc,
            h.issuer_dv,
            h.issuer_address,
            h.issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T22:40:52.217479Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 9096df1b-c885-4faf-a316-6d16e81fc2e2: Retrieved 50 invoice headers (total: 343) in 8ms with enhanced filtering
[2m2025-10-12T22:40:52.222216Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T22:40:52.222312Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 9953546d-b6a2-4cd5-8dce-aaf3dd45d361: Retrieved 50 invoice headers (total: 343) in 12ms with enhanced filtering
[2m2025-10-12T22:40:52.222379Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0mbeb98d99-3698-424f-b892-9eaa10a67de2
[2m2025-10-12T22:40:52.222409Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request beb98d99-3698-424f-b892-9eaa10a67de2: Processing headers for user 1 with limit 50 offset 250
[2m2025-10-12T22:40:52.222431Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request beb98d99-3698-424f-b892-9eaa10a67de2: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            h.issuer_ruc,
            h.issuer_dv,
            h.issuer_address,
            h.issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T22:40:52.231701Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request beb98d99-3698-424f-b892-9eaa10a67de2: Retrieved 50 invoice headers (total: 343) in 9ms with enhanced filtering
[2m2025-10-12T22:40:52.619665Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T22:40:52.619901Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0mffecf87f-2870-4d82-8aa3-afd7e070170f
[2m2025-10-12T22:40:52.619928Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request ffecf87f-2870-4d82-8aa3-afd7e070170f: Processing headers for user 1 with limit 50 offset 350
[2m2025-10-12T22:40:52.619953Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request ffecf87f-2870-4d82-8aa3-afd7e070170f: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            h.issuer_ruc,
            h.issuer_dv,
            h.issuer_address,
            h.issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T22:40:52.620702Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T22:40:52.620855Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0m125051b6-5c58-4045-aa67-31b227480d7c
[2m2025-10-12T22:40:52.620883Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 125051b6-5c58-4045-aa67-31b227480d7c: Processing headers for user 1 with limit 50 offset 300
[2m2025-10-12T22:40:52.620903Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 125051b6-5c58-4045-aa67-31b227480d7c: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            h.issuer_ruc,
            h.issuer_dv,
            h.issuer_address,
            h.issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T22:40:52.627508Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request ffecf87f-2870-4d82-8aa3-afd7e070170f: Retrieved 0 invoice headers (total: 343) in 7ms with enhanced filtering
[2m2025-10-12T22:40:52.629113Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T22:40:52.631170Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0m3d2ee58f-e863-482a-b68c-a20320feebce
[2m2025-10-12T22:40:52.631254Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 3d2ee58f-e863-482a-b68c-a20320feebce: Processing headers for user 1 with limit 50 offset 400
[2m2025-10-12T22:40:52.631313Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 3d2ee58f-e863-482a-b68c-a20320feebce: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            h.issuer_ruc,
            h.issuer_dv,
            h.issuer_address,
            h.issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T22:40:52.630110Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 125051b6-5c58-4045-aa67-31b227480d7c: Retrieved 43 invoice headers (total: 343) in 9ms with enhanced filtering
[2m2025-10-12T22:40:52.639134Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 3d2ee58f-e863-482a-b68c-a20320feebce: Retrieved 0 invoice headers (total: 343) in 7ms with enhanced filtering
[2m2025-10-12T22:40:52.962016Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T22:40:52.962338Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0m14e842f8-e294-4bbd-83a8-0d78e754e77c
[2m2025-10-12T22:40:52.962374Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 14e842f8-e294-4bbd-83a8-0d78e754e77c: Processing headers for user 1 with limit 50 offset 500
[2m2025-10-12T22:40:52.962408Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 14e842f8-e294-4bbd-83a8-0d78e754e77c: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            h.issuer_ruc,
            h.issuer_dv,
            h.issuer_address,
            h.issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T22:40:52.962921Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T22:40:52.963199Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0ma31a13ea-95ed-4f10-82ab-e997c76e11e8
[2m2025-10-12T22:40:52.963235Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request a31a13ea-95ed-4f10-82ab-e997c76e11e8: Processing headers for user 1 with limit 50 offset 450
[2m2025-10-12T22:40:52.963263Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request a31a13ea-95ed-4f10-82ab-e997c76e11e8: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            h.issuer_ruc,
            h.issuer_dv,
            h.issuer_address,
            h.issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T22:40:52.968718Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 14e842f8-e294-4bbd-83a8-0d78e754e77c: Retrieved 0 invoice headers (total: 343) in 6ms with enhanced filtering
[2m2025-10-12T22:40:52.970257Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T22:40:52.970442Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0mc14b4fd3-25cd-4716-80ca-7576eaeefcf8
[2m2025-10-12T22:40:52.970475Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request c14b4fd3-25cd-4716-80ca-7576eaeefcf8: Processing headers for user 1 with limit 50 offset 550
[2m2025-10-12T22:40:52.970494Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request c14b4fd3-25cd-4716-80ca-7576eaeefcf8: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            h.issuer_ruc,
            h.issuer_dv,
            h.issuer_address,
            h.issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T22:40:52.971514Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request a31a13ea-95ed-4f10-82ab-e997c76e11e8: Retrieved 0 invoice headers (total: 343) in 8ms with enhanced filtering
[2m2025-10-12T22:40:52.974561Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request c14b4fd3-25cd-4716-80ca-7576eaeefcf8: Retrieved 0 invoice headers (total: 343) in 4ms with enhanced filtering
[2m2025-10-12T22:40:53.181971Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T22:40:53.182550Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m2b9da12e-5356-416a-9f3a-21ecff830fdf
[2m2025-10-12T22:40:53.182681Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 2b9da12e-5356-416a-9f3a-21ecff830fdf: Processing for user 1 with limit 100 offset 0 order_by date direction DESC
[2m2025-10-12T22:40:53.182713Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 2b9da12e-5356-416a-9f3a-21ecff830fdf: Querying details for user 1 with enhanced filters
[2m2025-10-12T22:40:53.182748Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 2b9da12e-5356-416a-9f3a-21ecff830fdf: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T22:40:53.185510Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T22:40:53.185860Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m8f08f39b-9f20-493c-80b8-2bce54cab989
[2m2025-10-12T22:40:53.185949Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 8f08f39b-9f20-493c-80b8-2bce54cab989: Processing for user 1 with limit 100 offset 100 order_by date direction DESC
[2m2025-10-12T22:40:53.185997Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 8f08f39b-9f20-493c-80b8-2bce54cab989: Querying details for user 1 with enhanced filters
[2m2025-10-12T22:40:53.186078Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 8f08f39b-9f20-493c-80b8-2bce54cab989: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T22:40:53.192042Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 2b9da12e-5356-416a-9f3a-21ecff830fdf: Retrieved 100 invoice details (total: 2539) in 9ms with enhanced pagination
[2m2025-10-12T22:40:53.194148Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T22:40:53.194315Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0mad1a2cc2-25c9-44d9-a199-fc9b4d207915
[2m2025-10-12T22:40:53.194421Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request ad1a2cc2-25c9-44d9-a199-fc9b4d207915: Processing for user 1 with limit 100 offset 200 order_by date direction DESC
[2m2025-10-12T22:40:53.194452Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request ad1a2cc2-25c9-44d9-a199-fc9b4d207915: Querying details for user 1 with enhanced filters
[2m2025-10-12T22:40:53.194474Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request ad1a2cc2-25c9-44d9-a199-fc9b4d207915: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T22:40:53.196645Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 8f08f39b-9f20-493c-80b8-2bce54cab989: Retrieved 100 invoice details (total: 2539) in 10ms with enhanced pagination
[2m2025-10-12T22:40:53.202023Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request ad1a2cc2-25c9-44d9-a199-fc9b4d207915: Retrieved 100 invoice details (total: 2539) in 7ms with enhanced pagination
[2m2025-10-12T22:40:53.871329Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T22:40:53.871548Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m67254677-095d-461d-965d-927c9691609d
[2m2025-10-12T22:40:53.871586Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 67254677-095d-461d-965d-927c9691609d: Processing for user 1 with limit 100 offset 400 order_by date direction DESC
[2m2025-10-12T22:40:53.871630Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 67254677-095d-461d-965d-927c9691609d: Querying details for user 1 with enhanced filters
[2m2025-10-12T22:40:53.871674Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 67254677-095d-461d-965d-927c9691609d: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T22:40:53.872557Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T22:40:53.872869Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m28b1ab80-b5b6-47e3-9f41-7d4f618cbbfd
[2m2025-10-12T22:40:53.872976Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 28b1ab80-b5b6-47e3-9f41-7d4f618cbbfd: Processing for user 1 with limit 100 offset 300 order_by date direction DESC
[2m2025-10-12T22:40:53.873000Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 28b1ab80-b5b6-47e3-9f41-7d4f618cbbfd: Querying details for user 1 with enhanced filters
[2m2025-10-12T22:40:53.873027Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 28b1ab80-b5b6-47e3-9f41-7d4f618cbbfd: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T22:40:53.878553Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 67254677-095d-461d-965d-927c9691609d: Retrieved 100 invoice details (total: 2539) in 6ms with enhanced pagination
[2m2025-10-12T22:40:53.883681Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 28b1ab80-b5b6-47e3-9f41-7d4f618cbbfd: Retrieved 100 invoice details (total: 2539) in 10ms with enhanced pagination
[2m2025-10-12T22:40:53.885568Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T22:40:53.885746Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m4f6f62a6-64a1-470b-8d5c-4a3b28c1a4fd
[2m2025-10-12T22:40:53.885783Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 4f6f62a6-64a1-470b-8d5c-4a3b28c1a4fd: Processing for user 1 with limit 100 offset 500 order_by date direction DESC
[2m2025-10-12T22:40:53.885798Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 4f6f62a6-64a1-470b-8d5c-4a3b28c1a4fd: Querying details for user 1 with enhanced filters
[2m2025-10-12T22:40:53.885817Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 4f6f62a6-64a1-470b-8d5c-4a3b28c1a4fd: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T22:40:53.892590Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 4f6f62a6-64a1-470b-8d5c-4a3b28c1a4fd: Retrieved 100 invoice details (total: 2539) in 6ms with enhanced pagination
[2m2025-10-12T22:40:54.388789Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T22:40:54.388996Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m4fd7e8c8-f70e-4a7d-b24c-73524e9da1b5
[2m2025-10-12T22:40:54.389140Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 4fd7e8c8-f70e-4a7d-b24c-73524e9da1b5: Processing for user 1 with limit 100 offset 600 order_by date direction DESC
[2m2025-10-12T22:40:54.389174Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 4fd7e8c8-f70e-4a7d-b24c-73524e9da1b5: Querying details for user 1 with enhanced filters
[2m2025-10-12T22:40:54.389202Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 4fd7e8c8-f70e-4a7d-b24c-73524e9da1b5: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T22:40:54.394800Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T22:40:54.395030Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m414ea8df-7825-4288-b5bf-7c2adb4ee15d
[2m2025-10-12T22:40:54.395065Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 414ea8df-7825-4288-b5bf-7c2adb4ee15d: Processing for user 1 with limit 100 offset 700 order_by date direction DESC
[2m2025-10-12T22:40:54.395082Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 414ea8df-7825-4288-b5bf-7c2adb4ee15d: Querying details for user 1 with enhanced filters
[2m2025-10-12T22:40:54.395108Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 414ea8df-7825-4288-b5bf-7c2adb4ee15d: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T22:40:54.396128Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 4fd7e8c8-f70e-4a7d-b24c-73524e9da1b5: Retrieved 100 invoice details (total: 2539) in 7ms with enhanced pagination
[2m2025-10-12T22:40:54.400386Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T22:40:54.400529Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m428ee079-067c-4d92-b844-7b71524e4193
[2m2025-10-12T22:40:54.400555Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 428ee079-067c-4d92-b844-7b71524e4193: Processing for user 1 with limit 100 offset 800 order_by date direction DESC
[2m2025-10-12T22:40:54.400575Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 428ee079-067c-4d92-b844-7b71524e4193: Querying details for user 1 with enhanced filters
[2m2025-10-12T22:40:54.400621Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 428ee079-067c-4d92-b844-7b71524e4193: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T22:40:54.401967Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 414ea8df-7825-4288-b5bf-7c2adb4ee15d: Retrieved 100 invoice details (total: 2539) in 6ms with enhanced pagination
[2m2025-10-12T22:40:54.410578Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 428ee079-067c-4d92-b844-7b71524e4193: Retrieved 100 invoice details (total: 2539) in 10ms with enhanced pagination
[2m2025-10-12T22:40:54.853551Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T22:40:54.853822Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m9b1c7d8b-63ab-41fb-a933-1cafe1b23629
[2m2025-10-12T22:40:54.853857Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 9b1c7d8b-63ab-41fb-a933-1cafe1b23629: Processing for user 1 with limit 100 offset 1000 order_by date direction DESC
[2m2025-10-12T22:40:54.853876Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 9b1c7d8b-63ab-41fb-a933-1cafe1b23629: Querying details for user 1 with enhanced filters
[2m2025-10-12T22:40:54.853902Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 9b1c7d8b-63ab-41fb-a933-1cafe1b23629: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T22:40:54.858130Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T22:40:54.858443Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0ma1d99ca5-3096-486a-b346-9c921b63d3a2
[2m2025-10-12T22:40:54.858679Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request a1d99ca5-3096-486a-b346-9c921b63d3a2: Processing for user 1 with limit 100 offset 900 order_by date direction DESC
[2m2025-10-12T22:40:54.858751Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request a1d99ca5-3096-486a-b346-9c921b63d3a2: Querying details for user 1 with enhanced filters
[2m2025-10-12T22:40:54.858809Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request a1d99ca5-3096-486a-b346-9c921b63d3a2: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T22:40:54.861996Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T22:40:54.862756Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0md08995af-cb41-4a2a-9f72-28c39ae49058
[2m2025-10-12T22:40:54.862840Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request d08995af-cb41-4a2a-9f72-28c39ae49058: Processing for user 1 with limit 100 offset 1100 order_by date direction DESC
[2m2025-10-12T22:40:54.864067Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request d08995af-cb41-4a2a-9f72-28c39ae49058: Querying details for user 1 with enhanced filters
[2m2025-10-12T22:40:54.864177Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request d08995af-cb41-4a2a-9f72-28c39ae49058: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T22:40:54.864029Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 9b1c7d8b-63ab-41fb-a933-1cafe1b23629: Retrieved 100 invoice details (total: 2539) in 10ms with enhanced pagination
[2m2025-10-12T22:40:54.877724Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request a1d99ca5-3096-486a-b346-9c921b63d3a2: Retrieved 100 invoice details (total: 2539) in 19ms with enhanced pagination
[2m2025-10-12T22:40:54.883011Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request d08995af-cb41-4a2a-9f72-28c39ae49058: Retrieved 100 invoice details (total: 2539) in 20ms with enhanced pagination
[2m2025-10-12T22:40:55.250865Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T22:40:55.251118Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0ma3e98d4b-e3e5-481a-bdc4-c7d52377e2a9
[2m2025-10-12T22:40:55.251153Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request a3e98d4b-e3e5-481a-bdc4-c7d52377e2a9: Processing for user 1 with limit 100 offset 1300 order_by date direction DESC
[2m2025-10-12T22:40:55.251172Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request a3e98d4b-e3e5-481a-bdc4-c7d52377e2a9: Querying details for user 1 with enhanced filters
[2m2025-10-12T22:40:55.251200Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request a3e98d4b-e3e5-481a-bdc4-c7d52377e2a9: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T22:40:55.252190Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T22:40:55.252409Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m0757fd14-3478-4feb-807e-ce6c0c46e02f
[2m2025-10-12T22:40:55.252498Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 0757fd14-3478-4feb-807e-ce6c0c46e02f: Processing for user 1 with limit 100 offset 1200 order_by date direction DESC
[2m2025-10-12T22:40:55.252517Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 0757fd14-3478-4feb-807e-ce6c0c46e02f: Querying details for user 1 with enhanced filters
[2m2025-10-12T22:40:55.252544Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 0757fd14-3478-4feb-807e-ce6c0c46e02f: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T22:40:55.259259Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 0757fd14-3478-4feb-807e-ce6c0c46e02f: Retrieved 100 invoice details (total: 2539) in 6ms with enhanced pagination
[2m2025-10-12T22:40:55.263399Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T22:40:55.263541Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m2fe20540-e5df-4857-96ae-f20564677ecc
[2m2025-10-12T22:40:55.263585Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 2fe20540-e5df-4857-96ae-f20564677ecc: Processing for user 1 with limit 100 offset 1400 order_by date direction DESC
[2m2025-10-12T22:40:55.263624Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 2fe20540-e5df-4857-96ae-f20564677ecc: Querying details for user 1 with enhanced filters
[2m2025-10-12T22:40:55.263664Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 2fe20540-e5df-4857-96ae-f20564677ecc: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T22:40:55.263883Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request a3e98d4b-e3e5-481a-bdc4-c7d52377e2a9: Retrieved 100 invoice details (total: 2539) in 12ms with enhanced pagination
[2m2025-10-12T22:40:55.270925Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 2fe20540-e5df-4857-96ae-f20564677ecc: Retrieved 100 invoice details (total: 2539) in 7ms with enhanced pagination
[2m2025-10-12T22:40:55.680486Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T22:40:55.680757Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m4001fd17-7582-41cd-8a40-d97ce40bc217
[2m2025-10-12T22:40:55.680804Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 4001fd17-7582-41cd-8a40-d97ce40bc217: Processing for user 1 with limit 100 offset 1500 order_by date direction DESC
[2m2025-10-12T22:40:55.680829Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 4001fd17-7582-41cd-8a40-d97ce40bc217: Querying details for user 1 with enhanced filters
[2m2025-10-12T22:40:55.680862Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 4001fd17-7582-41cd-8a40-d97ce40bc217: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T22:40:55.685988Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T22:40:55.686132Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m5cdd3a2b-d5cb-4e8f-b9aa-eb44cbd421c9
[2m2025-10-12T22:40:55.686154Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 5cdd3a2b-d5cb-4e8f-b9aa-eb44cbd421c9: Processing for user 1 with limit 100 offset 1600 order_by date direction DESC
[2m2025-10-12T22:40:55.686169Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 5cdd3a2b-d5cb-4e8f-b9aa-eb44cbd421c9: Querying details for user 1 with enhanced filters
[2m2025-10-12T22:40:55.686188Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 5cdd3a2b-d5cb-4e8f-b9aa-eb44cbd421c9: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T22:40:55.693570Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 4001fd17-7582-41cd-8a40-d97ce40bc217: Retrieved 100 invoice details (total: 2539) in 12ms with enhanced pagination
[2m2025-10-12T22:40:55.698012Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 5cdd3a2b-d5cb-4e8f-b9aa-eb44cbd421c9: Retrieved 100 invoice details (total: 2539) in 11ms with enhanced pagination
[2m2025-10-12T22:40:55.698809Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T22:40:55.700931Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m5cbda0aa-578a-4a15-9c20-94bb1062782f
[2m2025-10-12T22:40:55.701042Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 5cbda0aa-578a-4a15-9c20-94bb1062782f: Processing for user 1 with limit 100 offset 1700 order_by date direction DESC
[2m2025-10-12T22:40:55.701129Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 5cbda0aa-578a-4a15-9c20-94bb1062782f: Querying details for user 1 with enhanced filters
[2m2025-10-12T22:40:55.701221Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 5cbda0aa-578a-4a15-9c20-94bb1062782f: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T22:40:55.708475Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 5cbda0aa-578a-4a15-9c20-94bb1062782f: Retrieved 100 invoice details (total: 2539) in 7ms with enhanced pagination
[2m2025-10-12T22:40:56.074643Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T22:40:56.074880Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m3fd69381-fced-475c-a61c-e1a5cd7c0abe
[2m2025-10-12T22:40:56.074916Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 3fd69381-fced-475c-a61c-e1a5cd7c0abe: Processing for user 1 with limit 100 offset 1900 order_by date direction DESC
[2m2025-10-12T22:40:56.074937Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 3fd69381-fced-475c-a61c-e1a5cd7c0abe: Querying details for user 1 with enhanced filters
[2m2025-10-12T22:40:56.074966Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 3fd69381-fced-475c-a61c-e1a5cd7c0abe: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T22:40:56.075686Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T22:40:56.075909Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m3a8a4276-a6b0-4018-9e21-48f0d3680e04
[2m2025-10-12T22:40:56.075961Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 3a8a4276-a6b0-4018-9e21-48f0d3680e04: Processing for user 1 with limit 100 offset 1800 order_by date direction DESC
[2m2025-10-12T22:40:56.075979Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 3a8a4276-a6b0-4018-9e21-48f0d3680e04: Querying details for user 1 with enhanced filters
[2m2025-10-12T22:40:56.076006Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 3a8a4276-a6b0-4018-9e21-48f0d3680e04: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T22:40:56.082115Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 3fd69381-fced-475c-a61c-e1a5cd7c0abe: Retrieved 100 invoice details (total: 2539) in 7ms with enhanced pagination
[2m2025-10-12T22:40:56.087025Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T22:40:56.087179Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m1db60206-2e62-49cb-990e-b660972321ac
[2m2025-10-12T22:40:56.087218Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 1db60206-2e62-49cb-990e-b660972321ac: Processing for user 1 with limit 100 offset 2000 order_by date direction DESC
[2m2025-10-12T22:40:56.087182Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 3a8a4276-a6b0-4018-9e21-48f0d3680e04: Retrieved 100 invoice details (total: 2539) in 11ms with enhanced pagination
[2m2025-10-12T22:40:56.087234Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 1db60206-2e62-49cb-990e-b660972321ac: Querying details for user 1 with enhanced filters
[2m2025-10-12T22:40:56.087285Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 1db60206-2e62-49cb-990e-b660972321ac: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T22:40:56.093118Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 1db60206-2e62-49cb-990e-b660972321ac: Retrieved 100 invoice details (total: 2539) in 5ms with enhanced pagination
[2m2025-10-12T22:40:56.517289Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T22:40:56.517516Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m47ea3c2e-a5e4-4ca2-9386-eadb686bd6cb
[2m2025-10-12T22:40:56.517557Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 47ea3c2e-a5e4-4ca2-9386-eadb686bd6cb: Processing for user 1 with limit 100 offset 2200 order_by date direction DESC
[2m2025-10-12T22:40:56.517577Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 47ea3c2e-a5e4-4ca2-9386-eadb686bd6cb: Querying details for user 1 with enhanced filters
[2m2025-10-12T22:40:56.517661Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 47ea3c2e-a5e4-4ca2-9386-eadb686bd6cb: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T22:40:56.521257Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T22:40:56.521506Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m93211ab3-113c-4d7a-87e9-5f7950ce9b4c
[2m2025-10-12T22:40:56.521597Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 93211ab3-113c-4d7a-87e9-5f7950ce9b4c: Processing for user 1 with limit 100 offset 2100 order_by date direction DESC
[2m2025-10-12T22:40:56.521731Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 93211ab3-113c-4d7a-87e9-5f7950ce9b4c: Querying details for user 1 with enhanced filters
[2m2025-10-12T22:40:56.521802Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 93211ab3-113c-4d7a-87e9-5f7950ce9b4c: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T22:40:56.525204Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T22:40:56.529957Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0mcbfaf651-d1d8-4916-9e05-d53e40a10f1d
[2m2025-10-12T22:40:56.530040Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request cbfaf651-d1d8-4916-9e05-d53e40a10f1d: Processing for user 1 with limit 100 offset 2300 order_by date direction DESC
[2m2025-10-12T22:40:56.530096Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request cbfaf651-d1d8-4916-9e05-d53e40a10f1d: Querying details for user 1 with enhanced filters
[2m2025-10-12T22:40:56.530151Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request cbfaf651-d1d8-4916-9e05-d53e40a10f1d: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T22:40:56.529294Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 47ea3c2e-a5e4-4ca2-9386-eadb686bd6cb: Retrieved 100 invoice details (total: 2539) in 11ms with enhanced pagination
[2m2025-10-12T22:40:56.533398Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 93211ab3-113c-4d7a-87e9-5f7950ce9b4c: Retrieved 100 invoice details (total: 2539) in 11ms with enhanced pagination
[2m2025-10-12T22:40:56.538539Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request cbfaf651-d1d8-4916-9e05-d53e40a10f1d: Retrieved 100 invoice details (total: 2539) in 8ms with enhanced pagination
[2m2025-10-12T22:40:57.050193Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T22:40:57.050427Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m10ee5ba8-f7b6-4b99-aa90-d593fad56ed0
[2m2025-10-12T22:40:57.050557Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 10ee5ba8-f7b6-4b99-aa90-d593fad56ed0: Processing for user 1 with limit 100 offset 2400 order_by date direction DESC
[2m2025-10-12T22:40:57.050665Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 10ee5ba8-f7b6-4b99-aa90-d593fad56ed0: Querying details for user 1 with enhanced filters
[2m2025-10-12T22:40:57.050707Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 10ee5ba8-f7b6-4b99-aa90-d593fad56ed0: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T22:40:57.057946Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T22:40:57.058146Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m38e98118-ccc3-4125-bffe-a114a9ab01da
[2m2025-10-12T22:40:57.058209Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 38e98118-ccc3-4125-bffe-a114a9ab01da: Processing for user 1 with limit 100 offset 2500 order_by date direction DESC
[2m2025-10-12T22:40:57.058228Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 38e98118-ccc3-4125-bffe-a114a9ab01da: Querying details for user 1 with enhanced filters
[2m2025-10-12T22:40:57.058253Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 38e98118-ccc3-4125-bffe-a114a9ab01da: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T22:40:57.060147Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 10ee5ba8-f7b6-4b99-aa90-d593fad56ed0: Retrieved 100 invoice details (total: 2539) in 9ms with enhanced pagination
[2m2025-10-12T22:40:57.064350Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T22:40:57.064983Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m12022002-2d00-4f23-842e-1a5ee695adf2
[2m2025-10-12T22:40:57.065097Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 12022002-2d00-4f23-842e-1a5ee695adf2: Processing for user 1 with limit 100 offset 2600 order_by date direction DESC
[2m2025-10-12T22:40:57.065186Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 12022002-2d00-4f23-842e-1a5ee695adf2: Querying details for user 1 with enhanced filters
[2m2025-10-12T22:40:57.065274Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 12022002-2d00-4f23-842e-1a5ee695adf2: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T22:40:57.069341Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 38e98118-ccc3-4125-bffe-a114a9ab01da: Retrieved 39 invoice details (total: 2539) in 11ms with enhanced pagination
[2m2025-10-12T22:40:57.074302Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 12022002-2d00-4f23-842e-1a5ee695adf2: Retrieved 0 invoice details (total: 2539) in 9ms with enhanced pagination
[2m2025-10-12T22:40:57.435897Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T22:40:57.436112Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m61f3a273-97a9-4b1f-a8be-cb5a84b328b1
[2m2025-10-12T22:40:57.436144Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 61f3a273-97a9-4b1f-a8be-cb5a84b328b1: Processing for user 1 with limit 100 offset 2700 order_by date direction DESC
[2m2025-10-12T22:40:57.436162Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 61f3a273-97a9-4b1f-a8be-cb5a84b328b1: Querying details for user 1 with enhanced filters
[2m2025-10-12T22:40:57.436188Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 61f3a273-97a9-4b1f-a8be-cb5a84b328b1: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T22:40:57.440595Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T22:40:57.440810Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0mb3c5f2a9-ef46-4259-8f5b-a198ee462bcb
[2m2025-10-12T22:40:57.440840Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request b3c5f2a9-ef46-4259-8f5b-a198ee462bcb: Processing for user 1 with limit 100 offset 2800 order_by date direction DESC
[2m2025-10-12T22:40:57.440855Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request b3c5f2a9-ef46-4259-8f5b-a198ee462bcb: Querying details for user 1 with enhanced filters
[2m2025-10-12T22:40:57.440875Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request b3c5f2a9-ef46-4259-8f5b-a198ee462bcb: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T22:40:57.445391Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 61f3a273-97a9-4b1f-a8be-cb5a84b328b1: Retrieved 0 invoice details (total: 2539) in 9ms with enhanced pagination
[2m2025-10-12T22:40:57.447127Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request b3c5f2a9-ef46-4259-8f5b-a198ee462bcb: Retrieved 0 invoice details (total: 2539) in 6ms with enhanced pagination
[2m2025-10-12T22:40:57.448964Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T22:40:57.449095Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m1238e3d3-545e-43c6-b79a-e2eb0d2ef8d5
[2m2025-10-12T22:40:57.449123Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 1238e3d3-545e-43c6-b79a-e2eb0d2ef8d5: Processing for user 1 with limit 100 offset 2900 order_by date direction DESC
[2m2025-10-12T22:40:57.449139Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 1238e3d3-545e-43c6-b79a-e2eb0d2ef8d5: Querying details for user 1 with enhanced filters
[2m2025-10-12T22:40:57.449157Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 1238e3d3-545e-43c6-b79a-e2eb0d2ef8d5: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T22:40:57.454942Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 1238e3d3-545e-43c6-b79a-e2eb0d2ef8d5: Retrieved 0 invoice details (total: 2539) in 5ms with enhanced pagination
[2m2025-10-12T22:40:59.124535Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T22:40:59.124720Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m Getting user balance for user_id: 1
[2m2025-10-12T22:40:59.126102Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m User balance retrieved successfully for user 1 in 1ms: 302 L√ºmis
[2m2025-10-12T23:42:24.121907Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T23:42:24.122092Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T23:42:24.122192Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m Fetching user data for user_id: 1
[2m2025-10-12T23:42:24.125301Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m User data retrieved in 3ms for user_id: 1 - email: Some("andresfelipevalenciag@gmail.com")
[2m2025-10-12T23:42:25.054035Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T23:42:25.054316Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m Getting user balance for user_id: 1
[2m2025-10-12T23:42:25.056724Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m User balance retrieved successfully for user 1 in 2ms: 302 L√ºmis
[2m2025-10-12T23:42:25.559248Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T23:42:25.559543Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0m29ca37e4-3fd1-402c-b92d-bdbdfde6ff1b
[2m2025-10-12T23:42:25.559587Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 29ca37e4-3fd1-402c-b92d-bdbdfde6ff1b: Processing headers for user 1 with limit 50 offset 0
[2m2025-10-12T23:42:25.559645Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 29ca37e4-3fd1-402c-b92d-bdbdfde6ff1b: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            h.issuer_ruc,
            h.issuer_dv,
            h.issuer_address,
            h.issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T23:42:25.565284Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 29ca37e4-3fd1-402c-b92d-bdbdfde6ff1b: Retrieved 0 invoice headers (total: 0) in 5ms with enhanced filtering
[2m2025-10-12T23:42:25.817305Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T23:42:25.817513Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0m3b35186b-fe03-4ebe-be47-05898dd80099
[2m2025-10-12T23:42:25.817541Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 3b35186b-fe03-4ebe-be47-05898dd80099: Processing headers for user 1 with limit 50 offset 100
[2m2025-10-12T23:42:25.817565Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 3b35186b-fe03-4ebe-be47-05898dd80099: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            h.issuer_ruc,
            h.issuer_dv,
            h.issuer_address,
            h.issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T23:42:25.822591Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 3b35186b-fe03-4ebe-be47-05898dd80099: Retrieved 0 invoice headers (total: 0) in 5ms with enhanced filtering
[2m2025-10-12T23:42:25.824479Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T23:42:25.824694Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0m60d70588-c928-4346-b42e-a97055898a03
[2m2025-10-12T23:42:25.824780Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 60d70588-c928-4346-b42e-a97055898a03: Processing headers for user 1 with limit 50 offset 50
[2m2025-10-12T23:42:25.824839Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 60d70588-c928-4346-b42e-a97055898a03: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            h.issuer_ruc,
            h.issuer_dv,
            h.issuer_address,
            h.issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T23:42:25.829509Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 60d70588-c928-4346-b42e-a97055898a03: Retrieved 0 invoice headers (total: 0) in 4ms with enhanced filtering
[2m2025-10-12T23:42:25.967120Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T23:42:25.967334Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m71344829-e279-409f-a6bc-cde1455b4958
[2m2025-10-12T23:42:25.967382Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 71344829-e279-409f-a6bc-cde1455b4958: Processing for user 1 with limit 100 offset 100 order_by date direction DESC
[2m2025-10-12T23:42:25.967400Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 71344829-e279-409f-a6bc-cde1455b4958: Querying details for user 1 with enhanced filters
[2m2025-10-12T23:42:25.967431Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 71344829-e279-409f-a6bc-cde1455b4958: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T23:42:25.968471Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T23:42:25.968767Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m4bbb0e98-a352-43ab-956c-dbd2f1101364
[2m2025-10-12T23:42:25.968807Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 4bbb0e98-a352-43ab-956c-dbd2f1101364: Processing for user 1 with limit 100 offset 0 order_by date direction DESC
[2m2025-10-12T23:42:25.968826Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 4bbb0e98-a352-43ab-956c-dbd2f1101364: Querying details for user 1 with enhanced filters
[2m2025-10-12T23:42:25.968872Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 4bbb0e98-a352-43ab-956c-dbd2f1101364: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T23:42:25.972082Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T23:42:25.972218Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m6b9f10cd-0874-4d62-acc8-d0da276158e8
[2m2025-10-12T23:42:25.972238Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 6b9f10cd-0874-4d62-acc8-d0da276158e8: Processing for user 1 with limit 100 offset 200 order_by date direction DESC
[2m2025-10-12T23:42:25.972254Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 6b9f10cd-0874-4d62-acc8-d0da276158e8: Querying details for user 1 with enhanced filters
[2m2025-10-12T23:42:25.972273Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 6b9f10cd-0874-4d62-acc8-d0da276158e8: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-12T23:42:25.975112Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 4bbb0e98-a352-43ab-956c-dbd2f1101364: Retrieved 0 invoice details (total: 0) in 6ms with enhanced pagination
[2m2025-10-12T23:42:25.977414Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 6b9f10cd-0874-4d62-acc8-d0da276158e8: Retrieved 0 invoice details (total: 0) in 5ms with enhanced pagination
[2m2025-10-12T23:42:25.979529Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 71344829-e279-409f-a6bc-cde1455b4958: Retrieved 0 invoice details (total: 0) in 12ms with enhanced pagination
[2m2025-10-12T23:42:30.203982Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T23:42:30.204234Z[0m [32m INFO[0m [2mlum_rust_ws::api::url_processing_v4[0m[2m:[0m Processing URL request for user 1: https://dgi-fep.mef.gob.pa/Consultas/FacturasPorQR?chFE=FE0120000062137-36-351360-5400012025101200000287230240310185800047&iAmb=1&digestValue=dkfUABQBen5GX5VvBu4iQeTUkQFE+sAWvnRD+31ikxA=&jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJjaEZFIjoiRkUwMTIwMDAwMDYyMTM3LTM2LTM1MTM2MC01NDAwMDEyMDI1MTAxMjAwMDAwMjg3MjMwMjQwMzEwMTg1ODAwMDQ3IiwiaUFtYiI6IjEiLCJkaWdlc3RWYWx1ZSI6ImRrZlVBQlFCZW41R1g1VnZCdTRpUWVUVWtRRkUrc0FXdm5SRCszMWlreEE9In0.4_Lt62t5JljjlrRyTYQxgWvg-xbWg7b2lRdFq5wIhEM
[2m2025-10-12T23:42:30.204295Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m Starting to scrape invoice from URL: https://dgi-fep.mef.gob.pa/Consultas/FacturasPorQR?chFE=FE0120000062137-36-351360-5400012025101200000287230240310185800047&iAmb=1&digestValue=dkfUABQBen5GX5VvBu4iQeTUkQFE+sAWvnRD+31ikxA=&jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJjaEZFIjoiRkUwMTIwMDAwMDYyMTM3LTM2LTM1MTM2MC01NDAwMDEyMDI1MTAxMjAwMDAwMjg3MjMwMjQwMzEwMTg1ODAwMDQ3IiwiaUFtYiI6IjEiLCJkaWdlc3RWYWx1ZSI6ImRrZlVBQlFCZW41R1g1VnZCdTRpUWVUVWtRRkUrc0FXdm5SRCszMWlreEE9In0.4_Lt62t5JljjlrRyTYQxgWvg-xbWg7b2lRdFq5wIhEM
[2m2025-10-12T23:42:30.204346Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m Fetching HTML with final URL tracking from: https://dgi-fep.mef.gob.pa/Consultas/FacturasPorQR?chFE=FE0120000062137-36-351360-5400012025101200000287230240310185800047&iAmb=1&digestValue=dkfUABQBen5GX5VvBu4iQeTUkQFE+sAWvnRD+31ikxA=&jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJjaEZFIjoiRkUwMTIwMDAwMDYyMTM3LTM2LTM1MTM2MC01NDAwMDEyMDI1MTAxMjAwMDAwMjg3MjMwMjQwMzEwMTg1ODAwMDQ3IiwiaUFtYiI6IjEiLCJkaWdlc3RWYWx1ZSI6ImRrZlVBQlFCZW41R1g1VnZCdTRpUWVUVWtRRkUrc0FXdm5SRCszMWlreEE9In0.4_Lt62t5JljjlrRyTYQxgWvg-xbWg7b2lRdFq5wIhEM
[2m2025-10-12T23:42:31.721182Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m Successfully fetched HTML content (28046 bytes) from final URL: https://dgi-fep.mef.gob.pa/Consultas/FacturasPorQR?chFE=FE0120000062137-36-351360-5400012025101200000287230240310185800047&iAmb=1&digestValue=dkfUABQBen5GX5VvBu4iQeTUkQFE+sAWvnRD+31ikxA=&jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJjaEZFIjoiRkUwMTIwMDAwMDYyMTM3LTM2LTM1MTM2MC01NDAwMDEyMDI1MTAxMjAwMDAwMjg3MjMwMjQwMzEwMTg1ODAwMDQ3IiwiaUFtYiI6IjEiLCJkaWdlc3RWYWx1ZSI6ImRrZlVBQlFCZW41R1g1VnZCdTRpUWVUVWtRRkUrc0FXdm5SRCszMWlreEE9In0.4_Lt62t5JljjlrRyTYQxgWvg-xbWg7b2lRdFq5wIhEM
[2m2025-10-12T23:42:31.729755Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m üîç DEBUG - HTML content length: 28046 bytes
[2m2025-10-12T23:42:31.729833Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m üîç DEBUG - HTML first 500 chars: 

<!DOCTYPE html>

<html lang="es-pa">
<head>
    <link rel="icon" type="image/png" href="/Images/favicon.png">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" /><title>
	
    Consultar Facturas Por QR

</title>

    <script type="text/javascript" src="/ruxitagentjs_ICA7NVfqrux_10323250822043923.js" data-dtconfig="rid=RID_72387225|rpid=-1355371235|domain=mef.gob.pa|reportUrl=/rb_bf36044oye|app=042269121d25fae7|cuc=s94amosz|o
[2m2025-10-12T23:42:31.730059Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m üîç DEBUG - HTML saved to /tmp/scraped_invoice.html
[2m2025-10-12T23:42:31.730091Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m Extracting invoice header from document using ocr_extractor
[2m2025-10-12T23:42:31.731618Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m üîç DEBUG - Calling extract_main_info with HTML length: 27779
[2m2025-10-12T23:42:31.744344Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m üîç DEBUG - extract_main_info SUCCESS, header keys: ["cufe", "vuelto", "emisor_phone", "receptor_dv", "emisor_name", "date", "receptor_address", "receptor_ruc", "tot_itbms", "total_pagado", "no", "emisor_ruc", "emisor_address", "receptor_phone", "tot_amount", "receptor_name", "emisor_dv"]
[2m2025-10-12T23:42:31.744400Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m üîç DEBUG - Raw header_data keys: ["cufe", "vuelto", "emisor_phone", "receptor_dv", "emisor_name", "date", "receptor_address", "receptor_ruc", "tot_itbms", "total_pagado", "no", "emisor_ruc", "emisor_address", "receptor_phone", "tot_amount", "receptor_name", "emisor_dv"]
[2m2025-10-12T23:42:31.744420Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m üîç DEBUG - emisor_name value: Some("TARGET S A")
[2m2025-10-12T23:42:31.744430Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m üîç DEBUG - tot_amount_str value: Some("17.10")
[2m2025-10-12T23:42:31.744457Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m üîç DEBUG - Extracted data - RUC: Some("62137-36-351360"), Nombre: Some("TARGET S A"), Total: Some(17.1), ITBMS: Some(1.12)
[2m2025-10-12T23:42:31.744617Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m Found 11 potential detail rows
[2m2025-10-12T23:42:31.744844Z[0m [32m INFO[0m [2mlum_rust_ws::api::webscraping[0m[2m:[0m Payment information extracted: forma_de_pago=Some("Tarjeta Cr√©dito"), total_pagado=Some("17.10")
[2m2025-10-12T23:42:31.746742Z[0m [32m INFO[0m [2mlum_rust_ws::api::database_persistence[0m[2m:[0m Saving invoice header with CUFE: FE0120000062137-36-351360-5400012025101200000287230240310185800047
[2m2025-10-12T23:42:31.751023Z[0m [32m INFO[0m [2msqlx::postgres::notice[0m[2m:[0m Usuario 1, sin redenci√≥n previa, buscando desde: 2025-09-15
[2m2025-10-12T23:42:31.751365Z[0m [32m INFO[0m [2msqlx::postgres::notice[0m[2m:[0m Usuario 1, contando desde semana m√°s reciente con facturas: 2025-10-06
[2m2025-10-12T23:42:31.752068Z[0m [32m INFO[0m [2msqlx::postgres::notice[0m[2m:[0m Semana 0 (desde 2025-10-06 hasta 2025-10-12 00:00:00): facturas = t
[2m2025-10-12T23:42:31.752428Z[0m [32m INFO[0m [2msqlx::postgres::notice[0m[2m:[0m Semana 1 (desde 2025-09-29 hasta 2025-10-05 00:00:00): facturas = t
[2m2025-10-12T23:42:31.752556Z[0m [32m INFO[0m [2msqlx::postgres::notice[0m[2m:[0m Semana 2 (desde 2025-09-22 hasta 2025-09-28 00:00:00): facturas = t
[2m2025-10-12T23:42:31.752693Z[0m [32m INFO[0m [2msqlx::postgres::notice[0m[2m:[0m Semana 3 (desde 2025-09-15 hasta 2025-09-21 00:00:00): facturas = t
[2m2025-10-12T23:42:31.752751Z[0m [32m INFO[0m [2msqlx::postgres::notice[0m[2m:[0m Resultado final para usuario 1: 4 semanas consecutivas (despu√©s de redenci√≥n: <NULL>)
[2m2025-10-12T23:42:31.800571Z[0m [32m INFO[0m [2mlum_rust_ws::api::database_persistence[0m[2m:[0m Saving 1 invoice details
[2m2025-10-12T23:42:31.801573Z[0m [32m INFO[0m [2mlum_rust_ws::api::database_persistence[0m[2m:[0m Saving 1 invoice payments
[2m2025-10-12T23:42:31.808500Z[0m [32m INFO[0m [2mlum_rust_ws::api::database_persistence[0m[2m:[0m üîç DEBUG - Creando respuesta con issuer_name: Some("TARGET S A"), tot_amount: Some(17.1)
[2m2025-10-12T23:42:31.809906Z[0m [32m INFO[0m [2mlum_rust_ws::api::gamification_service[0m[2m:[0m ÔøΩÔøΩ Found accumulation rule: 'receipts' (id=0) with 1 Lumis
[2m2025-10-12T23:42:31.813971Z[0m [32m INFO[0m [2mlum_rust_ws::api::gamification_service[0m[2m:[0m ‚úÖ Recorded accumulation for user 1 - 1 Lumis (CUFE: FE0120000062137-36-351360-5400012025101200000287230240310185800047)
[2m2025-10-12T23:42:31.815277Z[0m [32m INFO[0m [2mlum_rust_ws::api::gamification_service[0m[2m:[0m üí∞ New balance for user 1: 303 Lumis
[2m2025-10-12T23:42:31.815395Z[0m [32m INFO[0m [2mlum_rust_ws::api::url_processing_v4[0m[2m:[0m ‚úÖ Successfully credited 1 Lumis to user 1. New balance: 303
[2m2025-10-12T23:42:37.239048Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T23:42:37.239209Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T23:42:37.239571Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m Fetching user data for user_id: 1
[2m2025-10-12T23:42:37.240811Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m User data retrieved in 1ms for user_id: 1 - email: Some("andresfelipevalenciag@gmail.com")
[2m2025-10-12T23:42:40.124736Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T23:42:40.124898Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m Getting user balance for user_id: 1
[2m2025-10-12T23:42:40.126135Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m User balance retrieved successfully for user 1 in 1ms: 303 L√ºmis
[2m2025-10-12T23:42:41.623911Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T23:42:41.815542Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-12T23:42:41.822533Z[0m [31mERROR[0m [2mlum_rust_ws::api::gamification_v4[0m[2m:[0m Failed to track action: Database(PgDatabaseError { severity: Error, code: "23514", message: "no partition of relation \"fact_user_activity_log\" found for row", detail: Some("Partition key of the failing row contains (created_at) = (2025-10-12 23:42:41.820818+00)."), hint: None, position: None, where: Some("SQL statement \"INSERT INTO gamification.fact_user_activity_log (\n        user_id, activity_type, activity_data, created_at\n    ) VALUES (\n        p_user_id, p_action_type, \n        jsonb_build_object(\n            'channel', p_channel,\n            'metadata', p_metadata,\n            'timestamp', NOW()\n        ),\n        NOW()\n    )\"\nPL/pgSQL function gamification.track_user_action(integer,character varying,character varying,jsonb) line 13 at SQL statement"), schema: Some("gamification"), table: Some("fact_user_activity_log"), column: None, data_type: None, constraint: None, file: Some("execPartition.c"), line: Some(328), routine: Some("ExecFindPartition") })
[2m2025-10-12T23:42:41.822905Z[0m [31mERROR[0m [2mtower_http::trace::on_failure[0m[2m:[0m response failed [3mclassification[0m[2m=[0mStatus code: 500 Internal Server Error [3mlatency[0m[2m=[0m7 ms
[2m2025-10-12T23:42:41.988471Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-13T00:44:37.434224Z[0m [32m INFO[0m [2mlum_rust_ws::api::root_v4[0m[2m:[0m Request a48cd3a2-bf14-4a88-9e3d-f7433963ac9f: Root endpoint accessed
[2m2025-10-13T01:05:26.534047Z[0m [32m INFO[0m [2mlum_rust_ws[0m[2m:[0m signal received, starting graceful shutdown
