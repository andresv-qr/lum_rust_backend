nohup: ignoring input
[2m2025-09-25T02:12:34.617938Z[0m [32m INFO[0m [2mlum_rust_ws::monitoring[0m[2m:[0m üîç Monitoring system initialized
[2m2025-09-25T02:12:34.618021Z[0m [32m INFO[0m [2mlum_rust_ws[0m[2m:[0m üîç Monitoring system initialized
[2m2025-09-25T02:12:34.618053Z[0m [32m INFO[0m [2mlum_rust_ws::optimization[0m[2m:[0m üîß Creating optimized database pool with 50 max connections
[2m2025-09-25T02:12:35.128417Z[0m [32m INFO[0m [2mlum_rust_ws::optimization[0m[2m:[0m ‚úÖ Database pool created successfully
[2m2025-09-25T02:12:35.128506Z[0m [32m INFO[0m [2mlum_rust_ws::optimization[0m[2m:[0m üîß Creating optimized Redis client
[2m2025-09-25T02:12:35.128614Z[0m [32m INFO[0m [2mlum_rust_ws::optimization[0m[2m:[0m ‚úÖ Redis client created successfully
[2m2025-09-25T02:12:35.179866Z[0m [32m INFO[0m [2mlum_rust_ws::domains::qr::service[0m[2m:[0m üöÄ Initializing optimized hybrid QR service (2-level cascade)
[2m2025-09-25T02:12:35.179901Z[0m [32m INFO[0m [2mlum_rust_ws::domains::qr::service[0m[2m:[0m üìä Expected performance: 85% success with Rust (5-15ms), 12% with Python fallback (30-50ms)
[2m2025-09-25T02:12:35.179990Z[0m [32m INFO[0m [2mlum_rust_ws::shared::performance[0m[2m:[0m üöÄ Initializing PerformanceManager with advanced configuration
[2m2025-09-25T02:12:35.180011Z[0m [32m INFO[0m [2mlum_rust_ws::shared::performance[0m[2m:[0m üìä QR Detection: 50 max concurrent
[2m2025-09-25T02:12:35.180020Z[0m [32m INFO[0m [2mlum_rust_ws::shared::performance[0m[2m:[0m üìä OCR Processing: 20 max concurrent
[2m2025-09-25T02:12:35.180027Z[0m [32m INFO[0m [2mlum_rust_ws::shared::performance[0m[2m:[0m üìä Webhook Processing: 100 max concurrent
[2m2025-09-25T02:12:35.180035Z[0m [32m INFO[0m [2mlum_rust_ws::shared::performance[0m[2m:[0m üìä API Requests: 200 max concurrent
[2m2025-09-25T02:12:35.180133Z[0m [32m INFO[0m [2mlum_rust_ws::webhook::deduplication[0m[2m:[0m üîÑ MessageDeduplicator initialized with TTL: 300s, max_entries: 10000
[2m2025-09-25T02:12:35.180165Z[0m [32m INFO[0m [2mlum_rust_ws::shared::performance[0m[2m:[0m üî• Starting performance warm-up process...
[2m2025-09-25T02:12:35.181267Z[0m [32m INFO[0m [2mlum_rust_ws::shared::performance[0m[2m:[0m ‚úÖ Database connection verified
[2m2025-09-25T02:12:35.181629Z[0m [32m INFO[0m [2mlum_rust_ws::shared::performance[0m[2m:[0m ‚úÖ Redis connection verified
[2m2025-09-25T02:12:35.181684Z[0m [32m INFO[0m [2mlum_rust_ws::shared::performance[0m[2m:[0m üî• Performance warm-up completed
[2m2025-09-25T02:12:35.181708Z[0m [32m INFO[0m [2mlum_rust_ws[0m[2m:[0m üöÄ Application state initialized with optimized configuration
[2m2025-09-25T02:12:35.186386Z[0m [32m INFO[0m [2mlum_rust_ws[0m[2m:[0m listening on 0.0.0.0:8000
[2m2025-09-25T02:13:59.921160Z[0m [32m INFO[0m [2mlum_rust_ws[0m[2m:[0m signal received, starting graceful shutdown
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.32s
     Running `target/debug/lum_rust_ws`
[2m2025-09-26T11:20:42.868458Z[0m [32m INFO[0m [2mlum_rust_ws::monitoring[0m[2m:[0m üîç Monitoring system initialized
[2m2025-09-26T11:20:42.868518Z[0m [32m INFO[0m [2mlum_rust_ws[0m[2m:[0m üîç Monitoring system initialized
[2m2025-09-26T11:20:42.868552Z[0m [32m INFO[0m [2mlum_rust_ws::optimization[0m[2m:[0m üîß Creating optimized database pool with 50 max connections
[2m2025-09-26T11:20:43.416656Z[0m [32m INFO[0m [2mlum_rust_ws::optimization[0m[2m:[0m ‚úÖ Database pool created successfully
[2m2025-09-26T11:20:43.416737Z[0m [32m INFO[0m [2mlum_rust_ws::optimization[0m[2m:[0m üîß Creating optimized Redis client
[2m2025-09-26T11:20:43.416845Z[0m [32m INFO[0m [2mlum_rust_ws::optimization[0m[2m:[0m ‚úÖ Redis client created successfully
[2m2025-09-26T11:20:43.469984Z[0m [32m INFO[0m [2mlum_rust_ws::domains::qr::service[0m[2m:[0m üöÄ Initializing optimized hybrid QR service (2-level cascade)
[2m2025-09-26T11:20:43.470026Z[0m [32m INFO[0m [2mlum_rust_ws::domains::qr::service[0m[2m:[0m üìä Expected performance: 85% success with Rust (5-15ms), 12% with Python fallback (30-50ms)
[2m2025-09-26T11:20:43.470123Z[0m [32m INFO[0m [2mlum_rust_ws::shared::performance[0m[2m:[0m üöÄ Initializing PerformanceManager with advanced configuration
[2m2025-09-26T11:20:43.470158Z[0m [32m INFO[0m [2mlum_rust_ws::shared::performance[0m[2m:[0m üìä QR Detection: 50 max concurrent
[2m2025-09-26T11:20:43.470167Z[0m [32m INFO[0m [2mlum_rust_ws::shared::performance[0m[2m:[0m üìä OCR Processing: 20 max concurrent
[2m2025-09-26T11:20:43.470175Z[0m [32m INFO[0m [2mlum_rust_ws::shared::performance[0m[2m:[0m üìä Webhook Processing: 100 max concurrent
[2m2025-09-26T11:20:43.470184Z[0m [32m INFO[0m [2mlum_rust_ws::shared::performance[0m[2m:[0m üìä API Requests: 200 max concurrent
[2m2025-09-26T11:20:43.470272Z[0m [32m INFO[0m [2mlum_rust_ws::webhook::deduplication[0m[2m:[0m üîÑ MessageDeduplicator initialized with TTL: 300s, max_entries: 10000
[2m2025-09-26T11:20:43.470298Z[0m [32m INFO[0m [2mlum_rust_ws::shared::performance[0m[2m:[0m üî• Starting performance warm-up process...
[2m2025-09-26T11:20:43.471398Z[0m [32m INFO[0m [2mlum_rust_ws::shared::performance[0m[2m:[0m ‚úÖ Database connection verified
[2m2025-09-26T11:20:43.471669Z[0m [32m INFO[0m [2mlum_rust_ws::shared::performance[0m[2m:[0m ‚úÖ Redis connection verified
[2m2025-09-26T11:20:43.471732Z[0m [32m INFO[0m [2mlum_rust_ws::shared::performance[0m[2m:[0m üî• Performance warm-up completed
[2m2025-09-26T11:20:43.471759Z[0m [32m INFO[0m [2mlum_rust_ws[0m[2m:[0m üöÄ Application state initialized with optimized configuration
[2m2025-09-26T11:20:43.476179Z[0m [32m INFO[0m [2mlum_rust_ws[0m[2m:[0m listening on 0.0.0.0:8000
[2m2025-09-26T12:30:53.804840Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_registration_v4[0m[2m:[0m Request fb949cf7-6d24-4da8-8603-5205c6ec74b7: Checking email existence: andrescarriela@gmail.com
[2m2025-09-26T12:30:53.806436Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_registration_v4[0m[2m:[0m Request fb949cf7-6d24-4da8-8603-5205c6ec74b7: Querying database for email: andrescarriela@gmail.com
[2m2025-09-26T12:30:53.809515Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_registration_v4[0m[2m:[0m Request fb949cf7-6d24-4da8-8603-5205c6ec74b7: Found existing user with ID: 2
[2m2025-09-26T12:30:53.809604Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_registration_v4[0m[2m:[0m Request fb949cf7-6d24-4da8-8603-5205c6ec74b7: Email andrescarriela@gmail.com exists with password: false
[2m2025-09-26T12:30:53.950461Z[0m [32m INFO[0m [2mlum_rust_ws::api::unified_password[0m[2m:[0m üîê Processing password code request [3mrequest_id[0m[2m=[0m25c3a8e0-bf04-437f-a564-5b4f2b6d591d [3memail[0m[2m=[0mandrescarriela@gmail.com [3mpurpose[0m[2m=[0memail_verification
[2m2025-09-26T12:30:53.953196Z[0m [32m INFO[0m [2mlum_rust_ws::api::unified_password[0m[2m:[0m üìß Email verification code requested [3mrequest_id[0m[2m=[0m25c3a8e0-bf04-437f-a564-5b4f2b6d591d [3memail[0m[2m=[0mandrescarriela@gmail.com
[2m2025-09-26T12:30:53.962299Z[0m [32m INFO[0m [2mlum_rust_ws::api::verification_v4[0m[2m:[0m üìß EMAIL CONTENT for andrescarriela@gmail.com (Request: 25c3a8e0-bf04-437f-a564-5b4f2b6d591d)
üì¨ To: andrescarriela@gmail.com
üìã Subject: C√≥digo de Verificaci√≥n - L√ºm
üìù Format: HTML + Plain Text
üìù Code: 637188
[2m2025-09-26T12:30:53.962392Z[0m [32m INFO[0m [2mlum_rust_ws::api::verification_v4[0m[2m:[0m üöÄ SENDING HTML EMAIL via SMTP mail.lumapp.org to: andrescarriela@gmail.com
[2m2025-09-26T12:30:54.623724Z[0m [32m INFO[0m [2mlum_rust_ws::api::verification_v4[0m[2m:[0m ‚úÖ HTML Email sent successfully via SMTP to: andrescarriela@gmail.com (Request: 25c3a8e0-bf04-437f-a564-5b4f2b6d591d) - Response: Response { code: Code { severity: PositiveCompletion, category: MailSystem, detail: Zero }, message: ["OK id=1v27bD-00000007VWI-0Aji"] }
[2m2025-09-26T12:30:54.623852Z[0m [32m INFO[0m [2mlum_rust_ws::api::unified_password[0m[2m:[0m ‚úÖ Verification email sent successfully [3mrequest_id[0m[2m=[0m25c3a8e0-bf04-437f-a564-5b4f2b6d591d [3memail[0m[2m=[0mandrescarriela@gmail.com
[2m2025-09-26T12:30:54.630567Z[0m [32m INFO[0m [2mlum_rust_ws::api::unified_password[0m[2m:[0m ‚úÖ Password code request processed successfully [3mrequest_id[0m[2m=[0m25c3a8e0-bf04-437f-a564-5b4f2b6d591d [3mprocessing_time_ms[0m[2m=[0m680
[2m2025-09-26T12:31:12.801358Z[0m [33m WARN[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m Missing Authorization header
[2m2025-09-26T12:32:56.753571Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_registration_v4[0m[2m:[0m Request 39b4a654-1c43-41e9-a58b-c6758ec4422a: Checking email existence: andrescarriela@gmail.com
[2m2025-09-26T12:32:56.754896Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_registration_v4[0m[2m:[0m Request 39b4a654-1c43-41e9-a58b-c6758ec4422a: Querying database for email: andrescarriela@gmail.com
[2m2025-09-26T12:32:56.757935Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_registration_v4[0m[2m:[0m Request 39b4a654-1c43-41e9-a58b-c6758ec4422a: Found existing user with ID: 2
[2m2025-09-26T12:32:56.757978Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_registration_v4[0m[2m:[0m Request 39b4a654-1c43-41e9-a58b-c6758ec4422a: Email andrescarriela@gmail.com exists with password: false
[2m2025-09-26T12:32:56.883095Z[0m [32m INFO[0m [2mlum_rust_ws::api::unified_password[0m[2m:[0m üîê Processing password code request [3mrequest_id[0m[2m=[0m6c0c4f42-f855-41d6-857b-50ce43f0587a [3memail[0m[2m=[0mandrescarriela@gmail.com [3mpurpose[0m[2m=[0memail_verification
[2m2025-09-26T12:32:56.885579Z[0m [32m INFO[0m [2mlum_rust_ws::api::unified_password[0m[2m:[0m üìß Email verification code requested [3mrequest_id[0m[2m=[0m6c0c4f42-f855-41d6-857b-50ce43f0587a [3memail[0m[2m=[0mandrescarriela@gmail.com
[2m2025-09-26T12:32:56.898638Z[0m [32m INFO[0m [2mlum_rust_ws::api::verification_v4[0m[2m:[0m üìß EMAIL CONTENT for andrescarriela@gmail.com (Request: 6c0c4f42-f855-41d6-857b-50ce43f0587a)
üì¨ To: andrescarriela@gmail.com
üìã Subject: C√≥digo de Verificaci√≥n - L√ºm
üìù Format: HTML + Plain Text
üìù Code: 848326
[2m2025-09-26T12:32:56.898686Z[0m [32m INFO[0m [2mlum_rust_ws::api::verification_v4[0m[2m:[0m üöÄ SENDING HTML EMAIL via SMTP mail.lumapp.org to: andrescarriela@gmail.com
[2m2025-09-26T12:32:57.299285Z[0m [32m INFO[0m [2mlum_rust_ws::api::verification_v4[0m[2m:[0m ‚úÖ HTML Email sent successfully via SMTP to: andrescarriela@gmail.com (Request: 6c0c4f42-f855-41d6-857b-50ce43f0587a) - Response: Response { code: Code { severity: PositiveCompletion, category: MailSystem, detail: Zero }, message: ["OK id=1v27dB-00000007Xif-33I0"] }
[2m2025-09-26T12:32:57.299406Z[0m [32m INFO[0m [2mlum_rust_ws::api::unified_password[0m[2m:[0m ‚úÖ Verification email sent successfully [3mrequest_id[0m[2m=[0m6c0c4f42-f855-41d6-857b-50ce43f0587a [3memail[0m[2m=[0mandrescarriela@gmail.com
[2m2025-09-26T12:32:57.304737Z[0m [32m INFO[0m [2mlum_rust_ws::api::unified_password[0m[2m:[0m ‚úÖ Password code request processed successfully [3mrequest_id[0m[2m=[0m6c0c4f42-f855-41d6-857b-50ce43f0587a [3mprocessing_time_ms[0m[2m=[0m421
[2m2025-09-26T12:33:20.851619Z[0m [33m WARN[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m Missing Authorization header
[2m2025-09-26T12:55:56.086965Z[0m [32m INFO[0m [2mlum_rust_ws::api::root_v4[0m[2m:[0m Request 66ea633a-2c6e-43a2-9d82-eab59f1ea0b6: Root endpoint accessed
[2m2025-09-26T12:55:57.639316Z[0m [33m WARN[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m Missing Authorization header
[2m2025-09-26T12:56:14.614608Z[0m [32m INFO[0m [2mlum_rust_ws::api::root_v4[0m[2m:[0m Request 677b6e36-eba7-4db3-9904-060cc4085bca: Root endpoint accessed
[2m2025-09-26T13:03:08.911807Z[0m [33m WARN[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m Missing Authorization header
[2m2025-09-26T13:32:22.544946Z[0m [32m INFO[0m [2mlum_rust_ws::api::root_v4[0m[2m:[0m Request ebcc0930-acee-4c70-bc75-6c55affb9da8: Root endpoint accessed
[2m2025-09-26T14:37:32.890393Z[0m [32m INFO[0m [2mlum_rust_ws::api::root_v4[0m[2m:[0m Request b6469ba5-d46a-4763-a3f0-40221e253755: Root endpoint accessed
[2m2025-09-26T17:40:24.642764Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m31 [3memail[0m[2m=[0mandfelval@yahoo.com
[2m2025-09-26T17:40:24.642937Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m Getting user balance for user_id: 31
[2m2025-09-26T17:40:24.645887Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m User balance retrieved successfully for user 31 in 2ms: 0 L√ºmis
[2m2025-09-26T17:40:24.646550Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m31 [3memail[0m[2m=[0mandfelval@yahoo.com
[2m2025-09-26T17:40:24.646728Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m31 [3memail[0m[2m=[0mandfelval@yahoo.com
[2m2025-09-26T17:40:24.646797Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m Fetching user data for user_id: 31
[2m2025-09-26T17:40:24.649313Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m User data retrieved in 2ms for user_id: 31 - email: Some("andfelval@yahoo.com")
[2m2025-09-26T17:40:29.784895Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m31 [3memail[0m[2m=[0mandfelval@yahoo.com
[2m2025-09-26T17:40:29.785050Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m31 [3memail[0m[2m=[0mandfelval@yahoo.com
[2m2025-09-26T17:40:29.785153Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_history_v4[0m[2m:[0m Fetching rewards history for user_id: 31
[2m2025-09-26T17:40:29.789291Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_history_v4[0m[2m:[0m Rewards history retrieved in 4ms for user_id: 31 - 0 items
[2m2025-09-26T17:40:29.800678Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m31 [3memail[0m[2m=[0mandfelval@yahoo.com
[2m2025-09-26T17:40:29.800817Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m31 [3memail[0m[2m=[0mandfelval@yahoo.com
[2m2025-09-26T17:40:29.800891Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_history_v4[0m[2m:[0m Fetching rewards history for user_id: 31
[2m2025-09-26T17:40:29.804831Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_history_v4[0m[2m:[0m Rewards history retrieved in 3ms for user_id: 31 - 0 items
[2m2025-09-26T17:40:29.823187Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m31 [3memail[0m[2m=[0mandfelval@yahoo.com
[2m2025-09-26T17:40:29.823283Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m Getting user balance for user_id: 31
[2m2025-09-26T17:40:29.824059Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m31 [3memail[0m[2m=[0mandfelval@yahoo.com
[2m2025-09-26T17:40:29.824212Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m31 [3memail[0m[2m=[0mandfelval@yahoo.com
[2m2025-09-26T17:40:29.824313Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_history_v4[0m[2m:[0m Fetching rewards history for user_id: 31
[2m2025-09-26T17:40:29.825674Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m User balance retrieved successfully for user 31 in 2ms: 0 L√ºmis
[2m2025-09-26T17:40:29.829317Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_history_v4[0m[2m:[0m Rewards history retrieved in 5ms for user_id: 31 - 0 items
[2m2025-09-26T17:40:30.405492Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m31 [3memail[0m[2m=[0mandfelval@yahoo.com
[2m2025-09-26T17:40:30.405671Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m Getting user balance for user_id: 31
[2m2025-09-26T17:40:30.407401Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m User balance retrieved successfully for user 31 in 1ms: 0 L√ºmis
[2m2025-09-26T17:42:26.202488Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m31 [3memail[0m[2m=[0mandfelval@yahoo.com
[2m2025-09-26T17:42:26.202649Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m31 [3memail[0m[2m=[0mandfelval@yahoo.com
[2m2025-09-26T17:42:26.202739Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_history_v4[0m[2m:[0m Fetching rewards history for user_id: 31
[2m2025-09-26T17:42:26.205412Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_history_v4[0m[2m:[0m Rewards history retrieved in 2ms for user_id: 31 - 0 items
[2m2025-09-26T17:42:26.386578Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m31 [3memail[0m[2m=[0mandfelval@yahoo.com
[2m2025-09-26T17:42:26.386719Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m Getting user balance for user_id: 31
[2m2025-09-26T17:42:26.388408Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m User balance retrieved successfully for user 31 in 1ms: 0 L√ºmis
[2m2025-09-26T17:42:55.394098Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m31 [3memail[0m[2m=[0mandfelval@yahoo.com
[2m2025-09-26T17:42:55.394257Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m31 [3memail[0m[2m=[0mandfelval@yahoo.com
[2m2025-09-26T17:42:55.394377Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_history_v4[0m[2m:[0m Fetching rewards history for user_id: 31
[2m2025-09-26T17:42:55.397969Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_history_v4[0m[2m:[0m Rewards history retrieved in 3ms for user_id: 31 - 0 items
[2m2025-09-26T17:42:55.537948Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m31 [3memail[0m[2m=[0mandfelval@yahoo.com
[2m2025-09-26T17:42:55.538065Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m Getting user balance for user_id: 31
[2m2025-09-26T17:42:55.539786Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m User balance retrieved successfully for user 31 in 1ms: 0 L√ºmis
[2m2025-09-26T18:32:42.674643Z[0m [32m INFO[0m [2mlum_rust_ws::api::root_v4[0m[2m:[0m Request 8f1abeac-2bb7-46ff-b449-490cee973a87: Root endpoint accessed
[2m2025-09-26T20:51:58.142658Z[0m [32m INFO[0m [2mlum_rust_ws::api::root_v4[0m[2m:[0m Request 9312a63e-5300-4763-9b2f-80f8cb4677a3: Root endpoint accessed
[2m2025-09-26T20:52:04.960762Z[0m [32m INFO[0m [2mlum_rust_ws::api::root_v4[0m[2m:[0m Request 14f9a3ba-34ab-4830-b944-e4732e63335b: Root endpoint accessed
[2m2025-09-26T20:52:05.494642Z[0m [33m WARN[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m Missing Authorization header
[2m2025-09-26T20:52:10.571440Z[0m [32m INFO[0m [2mlum_rust_ws::api::root_v4[0m[2m:[0m Request b0e41a4a-35e2-40ea-9163-df00997c0312: Root endpoint accessed
[2m2025-09-26T20:53:59.398513Z[0m [32m INFO[0m [2mlum_rust_ws::api::root_v4[0m[2m:[0m Request 8180a2bf-a31c-4c84-82ab-4d10cf0fab5a: Root endpoint accessed
[2m2025-09-26T21:39:13.759016Z[0m [32m INFO[0m [2mlum_rust_ws::api::root_v4[0m[2m:[0m Request 58961802-7adc-415a-b88f-88e406c84099: Root endpoint accessed
[2m2025-09-26T21:54:12.479846Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_registration_v4[0m[2m:[0m Request 341781fc-937f-4b4a-987c-0169d7e745d2: Checking email existence: andrescarriela@gmail.com
[2m2025-09-26T21:54:12.481134Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_registration_v4[0m[2m:[0m Request 341781fc-937f-4b4a-987c-0169d7e745d2: Querying database for email: andrescarriela@gmail.com
[2m2025-09-26T21:54:12.484556Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_registration_v4[0m[2m:[0m Request 341781fc-937f-4b4a-987c-0169d7e745d2: Found existing user with ID: 2
[2m2025-09-26T21:54:12.484582Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_registration_v4[0m[2m:[0m Request 341781fc-937f-4b4a-987c-0169d7e745d2: Email andrescarriela@gmail.com exists with password: false
[2m2025-09-26T21:54:12.628796Z[0m [32m INFO[0m [2mlum_rust_ws::api::unified_password[0m[2m:[0m üîê Processing password code request [3mrequest_id[0m[2m=[0m74605212-ee48-4531-922e-c8d548f02397 [3memail[0m[2m=[0mandrescarriela@gmail.com [3mpurpose[0m[2m=[0memail_verification
[2m2025-09-26T21:54:12.631436Z[0m [32m INFO[0m [2mlum_rust_ws::api::unified_password[0m[2m:[0m üìß Email verification code requested [3mrequest_id[0m[2m=[0m74605212-ee48-4531-922e-c8d548f02397 [3memail[0m[2m=[0mandrescarriela@gmail.com
[2m2025-09-26T21:54:12.642954Z[0m [32m INFO[0m [2mlum_rust_ws::api::verification_v4[0m[2m:[0m üìß EMAIL CONTENT for andrescarriela@gmail.com (Request: 74605212-ee48-4531-922e-c8d548f02397)
üì¨ To: andrescarriela@gmail.com
üìã Subject: C√≥digo de Verificaci√≥n - L√ºm
üìù Format: HTML + Plain Text
üìù Code: 162889
[2m2025-09-26T21:54:12.643009Z[0m [32m INFO[0m [2mlum_rust_ws::api::verification_v4[0m[2m:[0m üöÄ SENDING HTML EMAIL via SMTP mail.lumapp.org to: andrescarriela@gmail.com
[2m2025-09-26T21:54:13.222874Z[0m [32m INFO[0m [2mlum_rust_ws::api::verification_v4[0m[2m:[0m ‚úÖ HTML Email sent successfully via SMTP to: andrescarriela@gmail.com (Request: 74605212-ee48-4531-922e-c8d548f02397) - Response: Response { code: Code { severity: PositiveCompletion, category: MailSystem, detail: Zero }, message: ["OK id=1v2GOL-00000003ILO-0XFp"] }
[2m2025-09-26T21:54:13.222972Z[0m [32m INFO[0m [2mlum_rust_ws::api::unified_password[0m[2m:[0m ‚úÖ Verification email sent successfully [3mrequest_id[0m[2m=[0m74605212-ee48-4531-922e-c8d548f02397 [3memail[0m[2m=[0mandrescarriela@gmail.com
[2m2025-09-26T21:54:13.229186Z[0m [32m INFO[0m [2mlum_rust_ws::api::unified_password[0m[2m:[0m ‚úÖ Password code request processed successfully [3mrequest_id[0m[2m=[0m74605212-ee48-4531-922e-c8d548f02397 [3mprocessing_time_ms[0m[2m=[0m600
[2m2025-09-26T21:54:26.047552Z[0m [33m WARN[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m Missing Authorization header
[2m2025-09-26T22:03:25.978819Z[0m [32m INFO[0m [2mlum_rust_ws::api::root_v4[0m[2m:[0m Request 207a6469-d7cc-4304-8211-28ea43cac716: Root endpoint accessed
[2m2025-09-26T22:03:25.982819Z[0m [33m WARN[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m Missing Authorization header
[2m2025-09-26T22:16:16.789888Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_registration_v4[0m[2m:[0m Request b99408cc-fcd2-45d9-bdd2-956f7d72f499: Checking email existence: andrescarriela@gmail.com
[2m2025-09-26T22:16:16.791196Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_registration_v4[0m[2m:[0m Request b99408cc-fcd2-45d9-bdd2-956f7d72f499: Querying database for email: andrescarriela@gmail.com
[2m2025-09-26T22:16:16.794483Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_registration_v4[0m[2m:[0m Request b99408cc-fcd2-45d9-bdd2-956f7d72f499: Found existing user with ID: 2
[2m2025-09-26T22:16:16.794510Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_registration_v4[0m[2m:[0m Request b99408cc-fcd2-45d9-bdd2-956f7d72f499: Email andrescarriela@gmail.com exists with password: false
[2m2025-09-26T22:16:16.933480Z[0m [32m INFO[0m [2mlum_rust_ws::api::unified_password[0m[2m:[0m üîê Processing password code request [3mrequest_id[0m[2m=[0m046c6ae1-7f1b-4208-bc70-677296ac03a3 [3memail[0m[2m=[0mandrescarriela@gmail.com [3mpurpose[0m[2m=[0memail_verification
[2m2025-09-26T22:16:16.936277Z[0m [32m INFO[0m [2mlum_rust_ws::api::unified_password[0m[2m:[0m üìß Email verification code requested [3mrequest_id[0m[2m=[0m046c6ae1-7f1b-4208-bc70-677296ac03a3 [3memail[0m[2m=[0mandrescarriela@gmail.com
[2m2025-09-26T22:16:16.948827Z[0m [32m INFO[0m [2mlum_rust_ws::api::verification_v4[0m[2m:[0m üìß EMAIL CONTENT for andrescarriela@gmail.com (Request: 046c6ae1-7f1b-4208-bc70-677296ac03a3)
üì¨ To: andrescarriela@gmail.com
üìã Subject: C√≥digo de Verificaci√≥n - L√ºm
üìù Format: HTML + Plain Text
üìù Code: 464766
[2m2025-09-26T22:16:16.948878Z[0m [32m INFO[0m [2mlum_rust_ws::api::verification_v4[0m[2m:[0m üöÄ SENDING HTML EMAIL via SMTP mail.lumapp.org to: andrescarriela@gmail.com
[2m2025-09-26T22:16:17.518969Z[0m [32m INFO[0m [2mlum_rust_ws::api::verification_v4[0m[2m:[0m ‚úÖ HTML Email sent successfully via SMTP to: andrescarriela@gmail.com (Request: 046c6ae1-7f1b-4208-bc70-677296ac03a3) - Response: Response { code: Code { severity: PositiveCompletion, category: MailSystem, detail: Zero }, message: ["OK id=1v2Gjh-00000003tWU-1tYM"] }
[2m2025-09-26T22:16:17.519058Z[0m [32m INFO[0m [2mlum_rust_ws::api::unified_password[0m[2m:[0m ‚úÖ Verification email sent successfully [3mrequest_id[0m[2m=[0m046c6ae1-7f1b-4208-bc70-677296ac03a3 [3memail[0m[2m=[0mandrescarriela@gmail.com
[2m2025-09-26T22:16:17.525272Z[0m [32m INFO[0m [2mlum_rust_ws::api::unified_password[0m[2m:[0m ‚úÖ Password code request processed successfully [3mrequest_id[0m[2m=[0m046c6ae1-7f1b-4208-bc70-677296ac03a3 [3mprocessing_time_ms[0m[2m=[0m591
[2m2025-09-26T22:16:40.160541Z[0m [33m WARN[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m Missing Authorization header
[2m2025-09-26T22:28:40.704147Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_registration_v4[0m[2m:[0m Request c55f1789-f2f0-4775-a2ab-24e1d042b9e9: Checking email existence: andfelval@yahoo.com
[2m2025-09-26T22:28:40.706166Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_registration_v4[0m[2m:[0m Request c55f1789-f2f0-4775-a2ab-24e1d042b9e9: Querying database for email: andfelval@yahoo.com
[2m2025-09-26T22:28:40.709402Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_registration_v4[0m[2m:[0m Request c55f1789-f2f0-4775-a2ab-24e1d042b9e9: Found existing user with ID: 31
[2m2025-09-26T22:28:40.709434Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_registration_v4[0m[2m:[0m Request c55f1789-f2f0-4775-a2ab-24e1d042b9e9: Email andfelval@yahoo.com exists with password: true
[2m2025-09-26T22:35:30.936380Z[0m [32m INFO[0m [2mlum_rust_ws::api::root_v4[0m[2m:[0m Request 6dd683b2-3d97-4097-8882-8b07a2aa08c2: Root endpoint accessed
[2m2025-09-26T22:57:42.678656Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_registration_v4[0m[2m:[0m Request 1f9a894c-7228-47c8-8ad9-996ccfb7135a: Checking email existence: andrescarriela@gmail.com
[2m2025-09-26T22:57:42.679962Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_registration_v4[0m[2m:[0m Request 1f9a894c-7228-47c8-8ad9-996ccfb7135a: Querying database for email: andrescarriela@gmail.com
[2m2025-09-26T22:57:42.683208Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_registration_v4[0m[2m:[0m Request 1f9a894c-7228-47c8-8ad9-996ccfb7135a: Found existing user with ID: 2
[2m2025-09-26T22:57:42.683234Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_registration_v4[0m[2m:[0m Request 1f9a894c-7228-47c8-8ad9-996ccfb7135a: Email andrescarriela@gmail.com exists with password: false
[2m2025-09-26T22:57:42.821260Z[0m [32m INFO[0m [2mlum_rust_ws::api::unified_password[0m[2m:[0m üîê Processing password code request [3mrequest_id[0m[2m=[0m309ef44f-8b2d-43d2-ad23-2d15fcdd437f [3memail[0m[2m=[0mandrescarriela@gmail.com [3mpurpose[0m[2m=[0memail_verification
[2m2025-09-26T22:57:42.824458Z[0m [32m INFO[0m [2mlum_rust_ws::api::unified_password[0m[2m:[0m üìß Email verification code requested [3mrequest_id[0m[2m=[0m309ef44f-8b2d-43d2-ad23-2d15fcdd437f [3memail[0m[2m=[0mandrescarriela@gmail.com
[2m2025-09-26T22:57:42.838320Z[0m [32m INFO[0m [2mlum_rust_ws::api::verification_v4[0m[2m:[0m üìß EMAIL CONTENT for andrescarriela@gmail.com (Request: 309ef44f-8b2d-43d2-ad23-2d15fcdd437f)
üì¨ To: andrescarriela@gmail.com
üìã Subject: C√≥digo de Verificaci√≥n - L√ºm
üìù Format: HTML + Plain Text
üìù Code: 577756
[2m2025-09-26T22:57:42.838389Z[0m [32m INFO[0m [2mlum_rust_ws::api::verification_v4[0m[2m:[0m üöÄ SENDING HTML EMAIL via SMTP mail.lumapp.org to: andrescarriela@gmail.com
[2m2025-09-26T22:57:43.448605Z[0m [32m INFO[0m [2mlum_rust_ws::api::verification_v4[0m[2m:[0m ‚úÖ HTML Email sent successfully via SMTP to: andrescarriela@gmail.com (Request: 309ef44f-8b2d-43d2-ad23-2d15fcdd437f) - Response: Response { code: Code { severity: PositiveCompletion, category: MailSystem, detail: Zero }, message: ["OK id=1v2HNn-00000004x7P-1eQi"] }
[2m2025-09-26T22:57:43.448715Z[0m [32m INFO[0m [2mlum_rust_ws::api::unified_password[0m[2m:[0m ‚úÖ Verification email sent successfully [3mrequest_id[0m[2m=[0m309ef44f-8b2d-43d2-ad23-2d15fcdd437f [3memail[0m[2m=[0mandrescarriela@gmail.com
[2m2025-09-26T22:57:43.455483Z[0m [32m INFO[0m [2mlum_rust_ws::api::unified_password[0m[2m:[0m ‚úÖ Password code request processed successfully [3mrequest_id[0m[2m=[0m309ef44f-8b2d-43d2-ad23-2d15fcdd437f [3mprocessing_time_ms[0m[2m=[0m634
[2m2025-09-26T22:58:20.966399Z[0m [32m INFO[0m [2mlum_rust_ws::api::unified_password[0m[2m:[0m üîê Processing set password with email code request [3mrequest_id[0m[2m=[0mf209f300-bf6c-49dc-9351-a0ac1cca3b31 [3memail[0m[2m=[0mandrescarriela@gmail.com
[2m2025-09-26T22:58:21.922455Z[0m [32m INFO[0m [2mlum_rust_ws::api::unified_password[0m[2m:[0m ‚úÖ Password set successfully with email verification code [3mrequest_id[0m[2m=[0mf209f300-bf6c-49dc-9351-a0ac1cca3b31 [3muser_id[0m[2m=[0m2 [3mprocessing_time_ms[0m[2m=[0m956
[2m2025-09-26T22:58:23.734222Z[0m [31mERROR[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m JWT validation failed: JSON error: missing field `sub` at line 1 column 127
[2m2025-09-26T22:58:24.065607Z[0m [31mERROR[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m JWT validation failed: JSON error: missing field `sub` at line 1 column 127
[2m2025-09-26T22:59:13.821489Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_registration_v4[0m[2m:[0m Request f067ca6f-1bc5-41fa-a181-2c63b31a88a2: Checking email existence: andrescarriela@gmail.com
[2m2025-09-26T22:59:13.822986Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_registration_v4[0m[2m:[0m Request f067ca6f-1bc5-41fa-a181-2c63b31a88a2: Querying database for email: andrescarriela@gmail.com
[2m2025-09-26T22:59:13.824908Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_registration_v4[0m[2m:[0m Request f067ca6f-1bc5-41fa-a181-2c63b31a88a2: Found existing user with ID: 2
[2m2025-09-26T22:59:13.824964Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_registration_v4[0m[2m:[0m Request f067ca6f-1bc5-41fa-a181-2c63b31a88a2: Email andrescarriela@gmail.com exists with password: true
[2m2025-09-26T22:59:34.533541Z[0m [32m INFO[0m [2mlum_rust_ws::api::unified_auth_v4[0m[2m:[0m üîê Unified authentication request received [3mprovider[0m[2m=[0mEmail [3mcreate_if_not_exists[0m[2m=[0mfalse [3mhas_linking_token[0m[2m=[0mfalse
[2m2025-09-26T22:59:34.533634Z[0m [32m INFO[0m [2mlum_rust_ws::services::unified_auth_simple[0m[2m:[0m üöÄ Starting unified authentication [3mrequest_id[0m[2m=[0m0f31d64f-0182-41a6-a553-abf27bf9b991 [3mprovider[0m[2m=[0mEmail { email: "andrescarriela@gmail.com", password: "Andres123+", name: None }
[2m2025-09-26T22:59:34.533655Z[0m [32m INFO[0m [2mlum_rust_ws::services::unified_auth_simple[0m[2m:[0m üîë Email authentication [3memail[0m[2m=[0mandrescarriela@gmail.com
[2m2025-09-26T22:59:34.539192Z[0m [32m INFO[0m [2mlum_rust_ws::services::unified_auth_simple[0m[2m:[0m üìù Auth event logged to database [3mrequest_id[0m[2m=[0m0f31d64f-0182-41a6-a553-abf27bf9b991 [3mevent_type[0m[2m=[0mlogin_attempt [3msuccess[0m[2m=[0mtrue
[2m2025-09-26T22:59:35.459675Z[0m [32m INFO[0m [2mlum_rust_ws::services::token_service[0m[2m:[0m üîë Generated access token successfully [3muser_id[0m[2m=[0m2 [3memail[0m[2m=[0mandrescarriela@gmail.com [3mexpires_at[0m[2m=[0m2025-09-27 22:59:35.459538562 UTC
[2m2025-09-26T22:59:35.464587Z[0m [32m INFO[0m [2mlum_rust_ws::services::unified_auth_simple[0m[2m:[0m üìù Auth event logged to database [3mrequest_id[0m[2m=[0m0f31d64f-0182-41a6-a553-abf27bf9b991 [3mevent_type[0m[2m=[0mlogin_success [3msuccess[0m[2m=[0mtrue
[2m2025-09-26T22:59:35.464652Z[0m [32m INFO[0m [2mlum_rust_ws::services::unified_auth_simple[0m[2m:[0m ‚úÖ Authentication successful [3mrequest_id[0m[2m=[0m0f31d64f-0182-41a6-a553-abf27bf9b991 [3mexecution_time_ms[0m[2m=[0m931
[2m2025-09-26T23:40:59.127365Z[0m [32m INFO[0m [2mlum_rust_ws::api::unified_auth_v4[0m[2m:[0m üîê Unified authentication request received [3mprovider[0m[2m=[0mGoogle [3mcreate_if_not_exists[0m[2m=[0mtrue [3mhas_linking_token[0m[2m=[0mfalse
[2m2025-09-26T23:40:59.127473Z[0m [32m INFO[0m [2mlum_rust_ws::services::unified_auth_simple[0m[2m:[0m üöÄ Starting unified authentication [3mrequest_id[0m[2m=[0m41c470d0-5d8b-4826-878b-6c1ba539abf5 [3mprovider[0m[2m=[0mGoogle { id_token: "eyJhbGciOiJSUzI1NiIsImtpZCI6IjkyN2I4ZmI2N2JiYWQ3NzQ0NWU1ZmVhNGM3MWFhOTg0NmQ3ZGRkMDEiLCJ0eXAiOiJKV1QifQ.eyJpc3MiOiJodHRwczovL2FjY291bnRzLmdvb2dsZS5jb20iLCJhenAiOiI5MTY0MjMxNTU1MS1hcjQ0MzVhb2lzcDA5NzVvbmc4cmNpZHRuYm1pYzJnMS5hcHBzLmdvb2dsZXVzZXJjb250ZW50LmNvbSIsImF1ZCI6IjkxNjQyMzE1NTUxLXZjcXRkYTFsY2ZvYWcwbWVqdWJsMTU3aXV2NHE4c3JpLmFwcHMuZ29vZ2xldXNlcmNvbnRlbnQuY29tIiwic3ViIjoiMTA2MDYzOTM2NDI0NDM3NjIxMDgwIiwiZW1haWwiOiJhbmRyZXNmZWxpcGV2YWxlbmNpYWdAZ21haWwuY29tIiwiZW1haWxfdmVyaWZpZWQiOnRydWUsIm5hbWUiOiJBbmRyZXMgVmFsZW5jaWEiLCJwaWN0dXJlIjoiaHR0cHM6Ly9saDMuZ29vZ2xldXNlcmNvbnRlbnQuY29tL2EvQUNnOG9jSk9Xd083eUdDWVA1OHB4ZFZCd2R6MGJudWtITHdwcjk0RklVbGNEckxHYnVrYUFBPXM5Ni1jIiwiZ2l2ZW5fbmFtZSI6IkFuZHJlcyIsImZhbWlseV9uYW1lIjoiVmFsZW5jaWEiLCJpYXQiOjE3NTg5MzAwNTIsImV4cCI6MTc1ODkzMzY1Mn0.YjHQ4Aa__TF7GLPP5qh8P7Hbsg-aRunAdeCCDewpnXIl1Fg-czHL60xhgA25M1WTWLXur2PX5FLJ_yro5EXKu95mlBuHRxy3caIhsrbbn18u_JloKiahONg9hBOToaELfkT5Wo1W_kpzByln7p-H1O4pZutD8mcbtPi30NMPeM2XxpzfDihGBory9ZKdO_-I-kNi6C7_sA69uSSPpArGUtJlqC8d9pJ5Gv18BwVGrlVMWPDvj6g4ce7FP_LTVpwiw6t7LlGH_rbRE2gUq3vfbeGyiqwRIUSrwLBnpbrI3S2J-kfZ4HASkk8A7dPpOGYeW25kXehFlkg598g0ErsDiA", access_token: None }
[2m2025-09-26T23:40:59.127508Z[0m [32m INFO[0m [2mlum_rust_ws::services::unified_auth_simple[0m[2m:[0m üîë Google authentication
[2m2025-09-26T23:40:59.134733Z[0m [32m INFO[0m [2mlum_rust_ws::services::unified_auth_simple[0m[2m:[0m üìù Auth event logged to database [3mrequest_id[0m[2m=[0m41c470d0-5d8b-4826-878b-6c1ba539abf5 [3mevent_type[0m[2m=[0mgoogle_auth [3msuccess[0m[2m=[0mtrue
[2m2025-09-26T23:40:59.134865Z[0m [32m INFO[0m [2mlum_rust_ws::services::google_service[0m[2m:[0m üîç Starting Google ID token validation [3mrequest_id[0m[2m=[0m25600278-049d-4190-bceb-5b7ddf4173df
[2m2025-09-26T23:40:59.173180Z[0m [32m INFO[0m [2mlum_rust_ws::services::google_service[0m[2m:[0m ‚úÖ Google certificates fetched successfully [3mrequest_id[0m[2m=[0m25600278-049d-4190-bceb-5b7ddf4173df [3mcert_count[0m[2m=[0m2
[2m2025-09-26T23:40:59.174085Z[0m [32m INFO[0m [2mlum_rust_ws::services::redis_service[0m[2m:[0m üîë Redis key set with TTL [3mkey[0m[2m=[0mauth:google:certificates [3mttl[0m[2m=[0m86400
[2m2025-09-26T23:40:59.174141Z[0m [32m INFO[0m [2mlum_rust_ws::services::google_service[0m[2m:[0m üíæ Google certificates cached [3mrequest_id[0m[2m=[0m25600278-049d-4190-bceb-5b7ddf4173df [3mttl_hours[0m[2m=[0m24
[2m2025-09-26T23:40:59.174516Z[0m [32m INFO[0m [2mlum_rust_ws::services::google_service[0m[2m:[0m ‚úÖ Google ID token validated successfully [3mrequest_id[0m[2m=[0m25600278-049d-4190-bceb-5b7ddf4173df [3muser_id[0m[2m=[0m106063936424437621080 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com [3mname[0m[2m=[0mSome("Andres Valencia") [3memail_verified[0m[2m=[0mtrue [3mexecution_time_ms[0m[2m=[0m39
[2m2025-09-26T23:40:59.181750Z[0m [32m INFO[0m [2mlum_rust_ws::services::token_service[0m[2m:[0m üîë Generated access token successfully [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com [3mexpires_at[0m[2m=[0m2025-09-27 23:40:59.181647955 UTC
[2m2025-09-26T23:40:59.187441Z[0m [32m INFO[0m [2mlum_rust_ws::services::unified_auth_simple[0m[2m:[0m üìù Auth event logged to database [3mrequest_id[0m[2m=[0m41c470d0-5d8b-4826-878b-6c1ba539abf5 [3mevent_type[0m[2m=[0mlogin_success [3msuccess[0m[2m=[0mtrue
[2m2025-09-26T23:40:59.187482Z[0m [32m INFO[0m [2mlum_rust_ws::services::unified_auth_simple[0m[2m:[0m ‚úÖ Authentication successful [3mrequest_id[0m[2m=[0m41c470d0-5d8b-4826-878b-6c1ba539abf5 [3mexecution_time_ms[0m[2m=[0m60
[2m2025-09-26T23:41:00.381623Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-26T23:41:00.381756Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-26T23:41:00.381805Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m Fetching user data for user_id: 1
[2m2025-09-26T23:41:00.384754Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m User data retrieved in 2ms for user_id: 1 - email: Some("andresfelipevalenciag@gmail.com")
[2m2025-09-26T23:41:00.387020Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-26T23:41:00.387134Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m Getting user balance for user_id: 1
[2m2025-09-26T23:41:00.389509Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m User balance retrieved successfully for user 1 in 2ms: 285 L√ºmis
[2m2025-09-26T23:54:14.868978Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_registration_v4[0m[2m:[0m Request 5994db4c-29ef-41f3-95fe-debc9213a3cf: Checking email existence: andrescarriela@gmail.com
[2m2025-09-26T23:54:14.870630Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_registration_v4[0m[2m:[0m Request 5994db4c-29ef-41f3-95fe-debc9213a3cf: Querying database for email: andrescarriela@gmail.com
[2m2025-09-26T23:54:14.873710Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_registration_v4[0m[2m:[0m Request 5994db4c-29ef-41f3-95fe-debc9213a3cf: Found existing user with ID: 2
[2m2025-09-26T23:54:14.873738Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_registration_v4[0m[2m:[0m Request 5994db4c-29ef-41f3-95fe-debc9213a3cf: Email andrescarriela@gmail.com exists with password: true
[2m2025-09-26T23:54:25.369535Z[0m [32m INFO[0m [2mlum_rust_ws::api::unified_auth_v4[0m[2m:[0m üîê Unified authentication request received [3mprovider[0m[2m=[0mEmail [3mcreate_if_not_exists[0m[2m=[0mfalse [3mhas_linking_token[0m[2m=[0mfalse
[2m2025-09-26T23:54:25.369655Z[0m [32m INFO[0m [2mlum_rust_ws::services::unified_auth_simple[0m[2m:[0m üöÄ Starting unified authentication [3mrequest_id[0m[2m=[0mf413f33e-e0fe-41a7-a4c7-0d9bb1ea9c43 [3mprovider[0m[2m=[0mEmail { email: "andrescarriela@gmail.com", password: "Andres123+", name: None }
[2m2025-09-26T23:54:25.369677Z[0m [32m INFO[0m [2mlum_rust_ws::services::unified_auth_simple[0m[2m:[0m üîë Email authentication [3memail[0m[2m=[0mandrescarriela@gmail.com
[2m2025-09-26T23:54:25.375743Z[0m [32m INFO[0m [2mlum_rust_ws::services::unified_auth_simple[0m[2m:[0m üìù Auth event logged to database [3mrequest_id[0m[2m=[0mf413f33e-e0fe-41a7-a4c7-0d9bb1ea9c43 [3mevent_type[0m[2m=[0mlogin_attempt [3msuccess[0m[2m=[0mtrue
[2m2025-09-26T23:54:26.301349Z[0m [32m INFO[0m [2mlum_rust_ws::services::token_service[0m[2m:[0m üîë Generated access token successfully [3muser_id[0m[2m=[0m2 [3memail[0m[2m=[0mandrescarriela@gmail.com [3mexpires_at[0m[2m=[0m2025-09-27 23:54:26.301202381 UTC
[2m2025-09-26T23:54:26.307780Z[0m [32m INFO[0m [2mlum_rust_ws::services::unified_auth_simple[0m[2m:[0m üìù Auth event logged to database [3mrequest_id[0m[2m=[0mf413f33e-e0fe-41a7-a4c7-0d9bb1ea9c43 [3mevent_type[0m[2m=[0mlogin_success [3msuccess[0m[2m=[0mtrue
[2m2025-09-26T23:54:26.307830Z[0m [32m INFO[0m [2mlum_rust_ws::services::unified_auth_simple[0m[2m:[0m ‚úÖ Authentication successful [3mrequest_id[0m[2m=[0mf413f33e-e0fe-41a7-a4c7-0d9bb1ea9c43 [3mexecution_time_ms[0m[2m=[0m938
[2m2025-09-26T23:54:32.771988Z[0m [32m INFO[0m [2mlum_rust_ws::api::unified_auth_v4[0m[2m:[0m üîê Unified authentication request received [3mprovider[0m[2m=[0mEmail [3mcreate_if_not_exists[0m[2m=[0mfalse [3mhas_linking_token[0m[2m=[0mfalse
[2m2025-09-26T23:54:32.772077Z[0m [32m INFO[0m [2mlum_rust_ws::services::unified_auth_simple[0m[2m:[0m üöÄ Starting unified authentication [3mrequest_id[0m[2m=[0mf47b94f8-5f63-4e4f-b54d-7a76c3b714e5 [3mprovider[0m[2m=[0mEmail { email: "andrescarriela@gmail.com", password: "Andres123+", name: None }
[2m2025-09-26T23:54:32.772126Z[0m [32m INFO[0m [2mlum_rust_ws::services::unified_auth_simple[0m[2m:[0m üîë Email authentication [3memail[0m[2m=[0mandrescarriela@gmail.com
[2m2025-09-26T23:54:32.777277Z[0m [32m INFO[0m [2mlum_rust_ws::services::unified_auth_simple[0m[2m:[0m üìù Auth event logged to database [3mrequest_id[0m[2m=[0mf47b94f8-5f63-4e4f-b54d-7a76c3b714e5 [3mevent_type[0m[2m=[0mlogin_attempt [3msuccess[0m[2m=[0mtrue
[2m2025-09-26T23:54:33.702478Z[0m [32m INFO[0m [2mlum_rust_ws::services::token_service[0m[2m:[0m üîë Generated access token successfully [3muser_id[0m[2m=[0m2 [3memail[0m[2m=[0mandrescarriela@gmail.com [3mexpires_at[0m[2m=[0m2025-09-27 23:54:33.702343864 UTC
[2m2025-09-26T23:54:33.707958Z[0m [32m INFO[0m [2mlum_rust_ws::services::unified_auth_simple[0m[2m:[0m üìù Auth event logged to database [3mrequest_id[0m[2m=[0mf47b94f8-5f63-4e4f-b54d-7a76c3b714e5 [3mevent_type[0m[2m=[0mlogin_success [3msuccess[0m[2m=[0mtrue
[2m2025-09-26T23:54:33.708011Z[0m [32m INFO[0m [2mlum_rust_ws::services::unified_auth_simple[0m[2m:[0m ‚úÖ Authentication successful [3mrequest_id[0m[2m=[0mf47b94f8-5f63-4e4f-b54d-7a76c3b714e5 [3mexecution_time_ms[0m[2m=[0m935
[2m2025-09-27T00:05:25.317751Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-27T00:05:25.317915Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-27T00:05:25.317977Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m Fetching user data for user_id: 1
[2m2025-09-27T00:05:25.321131Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m User data retrieved in 3ms for user_id: 1 - email: Some("andresfelipevalenciag@gmail.com")
[2m2025-09-27T00:05:26.341442Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-27T00:05:26.341565Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m Getting user balance for user_id: 1
[2m2025-09-27T00:05:26.343914Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m User balance retrieved successfully for user 1 in 2ms: 285 L√ºmis
[2m2025-09-27T00:05:27.121298Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-27T00:05:27.121574Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0m9f1d889f-b8e6-4186-838e-450cf2b6fe3d
[2m2025-09-27T00:05:27.121608Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 9f1d889f-b8e6-4186-838e-450cf2b6fe3d: Processing headers for user 1 with limit 50 offset 0
[2m2025-09-27T00:05:27.121631Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 9f1d889f-b8e6-4186-838e-450cf2b6fe3d: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            '' as issuer_ruc,
            '' as issuer_dv,
            '' as issuer_address,
            '' as issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-09-27T00:05:27.143545Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 9f1d889f-b8e6-4186-838e-450cf2b6fe3d: Retrieved 50 invoice headers (total: 333) in 21ms with enhanced filtering
[2m2025-09-27T00:05:27.421107Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-27T00:05:27.421376Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0mea19b256-7bcc-4b82-94dd-a6b720872922
[2m2025-09-27T00:05:27.421405Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request ea19b256-7bcc-4b82-94dd-a6b720872922: Processing headers for user 1 with limit 50 offset 50
[2m2025-09-27T00:05:27.421453Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request ea19b256-7bcc-4b82-94dd-a6b720872922: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            '' as issuer_ruc,
            '' as issuer_dv,
            '' as issuer_address,
            '' as issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-09-27T00:05:27.428399Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-27T00:05:27.428552Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0m32d03aa2-d849-455c-9ae4-a24bf648e759
[2m2025-09-27T00:05:27.428573Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 32d03aa2-d849-455c-9ae4-a24bf648e759: Processing headers for user 1 with limit 50 offset 100
[2m2025-09-27T00:05:27.428594Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 32d03aa2-d849-455c-9ae4-a24bf648e759: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            '' as issuer_ruc,
            '' as issuer_dv,
            '' as issuer_address,
            '' as issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-09-27T00:05:27.429536Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request ea19b256-7bcc-4b82-94dd-a6b720872922: Retrieved 50 invoice headers (total: 333) in 8ms with enhanced filtering
[2m2025-09-27T00:05:27.435945Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 32d03aa2-d849-455c-9ae4-a24bf648e759: Retrieved 50 invoice headers (total: 333) in 7ms with enhanced filtering
[2m2025-09-27T00:05:28.686150Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-27T00:05:28.686312Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-27T00:05:28.686439Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_history_v4[0m[2m:[0m Fetching rewards history for user_id: 1
[2m2025-09-27T00:05:28.691250Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_history_v4[0m[2m:[0m Rewards history retrieved in 4ms for user_id: 1 - 20 items
[2m2025-09-27T00:05:28.693442Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-27T00:05:28.693542Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-27T00:05:28.693592Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_history_v4[0m[2m:[0m Fetching rewards history for user_id: 1
[2m2025-09-27T00:05:28.698073Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_history_v4[0m[2m:[0m Rewards history retrieved in 4ms for user_id: 1 - 20 items
[2m2025-09-27T00:05:29.049570Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-27T00:05:29.049701Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m Getting user balance for user_id: 1
[2m2025-09-27T00:05:29.052130Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m User balance retrieved successfully for user 1 in 2ms: 285 L√ºmis
[2m2025-09-27T00:05:29.056993Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-27T00:05:29.057090Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-27T00:05:29.057164Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_history_v4[0m[2m:[0m Fetching rewards history for user_id: 1
[2m2025-09-27T00:05:29.061050Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_history_v4[0m[2m:[0m Rewards history retrieved in 3ms for user_id: 1 - 20 items
[2m2025-09-27T00:05:29.374096Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-27T00:05:29.374214Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m Getting user balance for user_id: 1
[2m2025-09-27T00:05:29.375849Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m User balance retrieved successfully for user 1 in 1ms: 285 L√ºmis
[2m2025-09-27T00:05:30.321478Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-27T00:05:30.321690Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0m3beb9c32-13dc-430f-b5f8-e17d44f6605b
[2m2025-09-27T00:05:30.321711Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 3beb9c32-13dc-430f-b5f8-e17d44f6605b: Processing headers for user 1 with limit 50 offset 150
[2m2025-09-27T00:05:30.321734Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 3beb9c32-13dc-430f-b5f8-e17d44f6605b: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            '' as issuer_ruc,
            '' as issuer_dv,
            '' as issuer_address,
            '' as issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-09-27T00:05:30.328724Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-27T00:05:30.328904Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0m9d6cbfc1-0031-41fa-a340-86d39924d551
[2m2025-09-27T00:05:30.328945Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 9d6cbfc1-0031-41fa-a340-86d39924d551: Processing headers for user 1 with limit 50 offset 250
[2m2025-09-27T00:05:30.328976Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 9d6cbfc1-0031-41fa-a340-86d39924d551: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            '' as issuer_ruc,
            '' as issuer_dv,
            '' as issuer_address,
            '' as issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-09-27T00:05:30.330013Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 3beb9c32-13dc-430f-b5f8-e17d44f6605b: Retrieved 50 invoice headers (total: 333) in 8ms with enhanced filtering
[2m2025-09-27T00:05:30.330399Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-27T00:05:30.330540Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0m2430e109-ca13-47fe-ade5-47d0e8bc44d0
[2m2025-09-27T00:05:30.330557Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 2430e109-ca13-47fe-ade5-47d0e8bc44d0: Processing headers for user 1 with limit 50 offset 200
[2m2025-09-27T00:05:30.330573Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 2430e109-ca13-47fe-ade5-47d0e8bc44d0: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            '' as issuer_ruc,
            '' as issuer_dv,
            '' as issuer_address,
            '' as issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-09-27T00:05:30.336205Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 9d6cbfc1-0031-41fa-a340-86d39924d551: Retrieved 50 invoice headers (total: 333) in 7ms with enhanced filtering
[2m2025-09-27T00:05:30.339612Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 2430e109-ca13-47fe-ade5-47d0e8bc44d0: Retrieved 50 invoice headers (total: 333) in 9ms with enhanced filtering
[2m2025-09-27T00:05:30.791280Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-27T00:05:30.791543Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0mbb8a428e-7945-4e54-b53d-f4d8ce52b27b
[2m2025-09-27T00:05:30.791568Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request bb8a428e-7945-4e54-b53d-f4d8ce52b27b: Processing headers for user 1 with limit 50 offset 300
[2m2025-09-27T00:05:30.791593Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request bb8a428e-7945-4e54-b53d-f4d8ce52b27b: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            '' as issuer_ruc,
            '' as issuer_dv,
            '' as issuer_address,
            '' as issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-09-27T00:05:30.797040Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-27T00:05:30.797224Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0m155b0ca9-8d24-4f8e-9261-8468d0f06ebc
[2m2025-09-27T00:05:30.797247Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 155b0ca9-8d24-4f8e-9261-8468d0f06ebc: Processing headers for user 1 with limit 50 offset 400
[2m2025-09-27T00:05:30.797271Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 155b0ca9-8d24-4f8e-9261-8468d0f06ebc: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            '' as issuer_ruc,
            '' as issuer_dv,
            '' as issuer_address,
            '' as issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-09-27T00:05:30.797390Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-27T00:05:30.797486Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request bb8a428e-7945-4e54-b53d-f4d8ce52b27b: Retrieved 33 invoice headers (total: 333) in 5ms with enhanced filtering
[2m2025-09-27T00:05:30.797525Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0m73e4ade8-3f2b-4bc2-85aa-bc16082b5dd0
[2m2025-09-27T00:05:30.797542Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 73e4ade8-3f2b-4bc2-85aa-bc16082b5dd0: Processing headers for user 1 with limit 50 offset 350
[2m2025-09-27T00:05:30.797558Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 73e4ade8-3f2b-4bc2-85aa-bc16082b5dd0: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            '' as issuer_ruc,
            '' as issuer_dv,
            '' as issuer_address,
            '' as issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-09-27T00:05:30.802927Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 155b0ca9-8d24-4f8e-9261-8468d0f06ebc: Retrieved 0 invoice headers (total: 333) in 5ms with enhanced filtering
[2m2025-09-27T00:05:30.803491Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 73e4ade8-3f2b-4bc2-85aa-bc16082b5dd0: Retrieved 0 invoice headers (total: 333) in 5ms with enhanced filtering
[2m2025-09-27T00:05:31.184192Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-27T00:05:31.184437Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0m210fea56-0115-4fd8-a1cf-20d28d2d9224
[2m2025-09-27T00:05:31.184467Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 210fea56-0115-4fd8-a1cf-20d28d2d9224: Processing headers for user 1 with limit 50 offset 450
[2m2025-09-27T00:05:31.184496Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 210fea56-0115-4fd8-a1cf-20d28d2d9224: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            '' as issuer_ruc,
            '' as issuer_dv,
            '' as issuer_address,
            '' as issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-09-27T00:05:31.188745Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-27T00:05:31.188887Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0m3744bfb1-726c-4f68-afe4-28a2f5a4ea06
[2m2025-09-27T00:05:31.188909Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 3744bfb1-726c-4f68-afe4-28a2f5a4ea06: Processing headers for user 1 with limit 50 offset 550
[2m2025-09-27T00:05:31.188932Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 3744bfb1-726c-4f68-afe4-28a2f5a4ea06: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            '' as issuer_ruc,
            '' as issuer_dv,
            '' as issuer_address,
            '' as issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-09-27T00:05:31.189184Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 210fea56-0115-4fd8-a1cf-20d28d2d9224: Retrieved 0 invoice headers (total: 333) in 4ms with enhanced filtering
[2m2025-09-27T00:05:31.189436Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-27T00:05:31.189648Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0mffc4cc3f-0115-4bd1-8d48-6b631da5ce40
[2m2025-09-27T00:05:31.189673Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request ffc4cc3f-0115-4bd1-8d48-6b631da5ce40: Processing headers for user 1 with limit 50 offset 500
[2m2025-09-27T00:05:31.189724Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request ffc4cc3f-0115-4bd1-8d48-6b631da5ce40: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            '' as issuer_ruc,
            '' as issuer_dv,
            '' as issuer_address,
            '' as issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-09-27T00:05:31.193067Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 3744bfb1-726c-4f68-afe4-28a2f5a4ea06: Retrieved 0 invoice headers (total: 333) in 4ms with enhanced filtering
[2m2025-09-27T00:05:31.194183Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request ffc4cc3f-0115-4bd1-8d48-6b631da5ce40: Retrieved 0 invoice headers (total: 333) in 4ms with enhanced filtering
[2m2025-09-27T00:05:31.439239Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-27T00:05:31.439460Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m1ff40b4d-4278-4354-b914-f7e42b297eb7
[2m2025-09-27T00:05:31.439485Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 1ff40b4d-4278-4354-b914-f7e42b297eb7: Processing for user 1 with limit 100 offset 0 order_by date direction DESC
[2m2025-09-27T00:05:31.439501Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 1ff40b4d-4278-4354-b914-f7e42b297eb7: Querying details for user 1 with enhanced filters
[2m2025-09-27T00:05:31.439539Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 1ff40b4d-4278-4354-b914-f7e42b297eb7: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-09-27T00:05:31.439605Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-27T00:05:31.439716Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m1e94313b-662c-4da7-b105-64b2ee3cb56f
[2m2025-09-27T00:05:31.439733Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 1e94313b-662c-4da7-b105-64b2ee3cb56f: Processing for user 1 with limit 100 offset 200 order_by date direction DESC
[2m2025-09-27T00:05:31.439747Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 1e94313b-662c-4da7-b105-64b2ee3cb56f: Querying details for user 1 with enhanced filters
[2m2025-09-27T00:05:31.439762Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 1e94313b-662c-4da7-b105-64b2ee3cb56f: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-09-27T00:05:31.440623Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-27T00:05:31.440855Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m12c37cfe-bda1-428d-bfce-f49ae8cc8a32
[2m2025-09-27T00:05:31.440881Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 12c37cfe-bda1-428d-bfce-f49ae8cc8a32: Processing for user 1 with limit 100 offset 100 order_by date direction DESC
[2m2025-09-27T00:05:31.440906Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 12c37cfe-bda1-428d-bfce-f49ae8cc8a32: Querying details for user 1 with enhanced filters
[2m2025-09-27T00:05:31.440931Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 12c37cfe-bda1-428d-bfce-f49ae8cc8a32: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-09-27T00:05:31.446361Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 1ff40b4d-4278-4354-b914-f7e42b297eb7: Retrieved 100 invoice details (total: 2523) in 6ms with enhanced pagination
[2m2025-09-27T00:05:31.450992Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 1e94313b-662c-4da7-b105-64b2ee3cb56f: Retrieved 100 invoice details (total: 2523) in 11ms with enhanced pagination
[2m2025-09-27T00:05:31.451212Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 12c37cfe-bda1-428d-bfce-f49ae8cc8a32: Retrieved 100 invoice details (total: 2523) in 10ms with enhanced pagination
[2m2025-09-27T00:05:31.951073Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-27T00:05:31.951281Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m33aed70e-3ad8-4c99-a2d8-4048e6f95136
[2m2025-09-27T00:05:31.951303Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 33aed70e-3ad8-4c99-a2d8-4048e6f95136: Processing for user 1 with limit 100 offset 300 order_by date direction DESC
[2m2025-09-27T00:05:31.951319Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 33aed70e-3ad8-4c99-a2d8-4048e6f95136: Querying details for user 1 with enhanced filters
[2m2025-09-27T00:05:31.951372Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 33aed70e-3ad8-4c99-a2d8-4048e6f95136: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-09-27T00:05:31.953766Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-27T00:05:31.953882Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0ma91e8b22-99c3-422e-bb3f-1f1685b81a3d
[2m2025-09-27T00:05:31.953910Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request a91e8b22-99c3-422e-bb3f-1f1685b81a3d: Processing for user 1 with limit 100 offset 400 order_by date direction DESC
[2m2025-09-27T00:05:31.953924Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request a91e8b22-99c3-422e-bb3f-1f1685b81a3d: Querying details for user 1 with enhanced filters
[2m2025-09-27T00:05:31.953939Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request a91e8b22-99c3-422e-bb3f-1f1685b81a3d: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-09-27T00:05:31.958006Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 33aed70e-3ad8-4c99-a2d8-4048e6f95136: Retrieved 100 invoice details (total: 2523) in 6ms with enhanced pagination
[2m2025-09-27T00:05:31.962217Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-27T00:05:31.962372Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m9c3b15fe-78d2-4b9f-85a7-79f5e13425ee
[2m2025-09-27T00:05:31.962398Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 9c3b15fe-78d2-4b9f-85a7-79f5e13425ee: Processing for user 1 with limit 100 offset 500 order_by date direction DESC
[2m2025-09-27T00:05:31.962411Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 9c3b15fe-78d2-4b9f-85a7-79f5e13425ee: Querying details for user 1 with enhanced filters
[2m2025-09-27T00:05:31.962449Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 9c3b15fe-78d2-4b9f-85a7-79f5e13425ee: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-09-27T00:05:31.962697Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request a91e8b22-99c3-422e-bb3f-1f1685b81a3d: Retrieved 100 invoice details (total: 2523) in 8ms with enhanced pagination
[2m2025-09-27T00:05:31.968398Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 9c3b15fe-78d2-4b9f-85a7-79f5e13425ee: Retrieved 100 invoice details (total: 2523) in 6ms with enhanced pagination
[2m2025-09-27T00:05:32.694164Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-27T00:05:32.694437Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0mde7d8820-fd91-4eef-a6f4-1faf4547bc51
[2m2025-09-27T00:05:32.694463Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request de7d8820-fd91-4eef-a6f4-1faf4547bc51: Processing for user 1 with limit 100 offset 600 order_by date direction DESC
[2m2025-09-27T00:05:32.694481Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request de7d8820-fd91-4eef-a6f4-1faf4547bc51: Querying details for user 1 with enhanced filters
[2m2025-09-27T00:05:32.694507Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request de7d8820-fd91-4eef-a6f4-1faf4547bc51: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-09-27T00:05:32.695707Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-27T00:05:32.695749Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-27T00:05:32.695868Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0me8327367-c906-4695-b1ff-4439b1cffde5
[2m2025-09-27T00:05:32.695885Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request e8327367-c906-4695-b1ff-4439b1cffde5: Processing for user 1 with limit 100 offset 700 order_by date direction DESC
[2m2025-09-27T00:05:32.695898Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request e8327367-c906-4695-b1ff-4439b1cffde5: Querying details for user 1 with enhanced filters
[2m2025-09-27T00:05:32.695912Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request e8327367-c906-4695-b1ff-4439b1cffde5: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-09-27T00:05:32.695956Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0mba892ae2-74e1-4419-acf6-0e5e707f640c
[2m2025-09-27T00:05:32.695986Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request ba892ae2-74e1-4419-acf6-0e5e707f640c: Processing for user 1 with limit 100 offset 800 order_by date direction DESC
[2m2025-09-27T00:05:32.696007Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request ba892ae2-74e1-4419-acf6-0e5e707f640c: Querying details for user 1 with enhanced filters
[2m2025-09-27T00:05:32.696038Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request ba892ae2-74e1-4419-acf6-0e5e707f640c: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-09-27T00:05:32.702753Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request de7d8820-fd91-4eef-a6f4-1faf4547bc51: Retrieved 100 invoice details (total: 2523) in 8ms with enhanced pagination
[2m2025-09-27T00:05:32.707378Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request ba892ae2-74e1-4419-acf6-0e5e707f640c: Retrieved 100 invoice details (total: 2523) in 11ms with enhanced pagination
[2m2025-09-27T00:05:32.707475Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request e8327367-c906-4695-b1ff-4439b1cffde5: Retrieved 100 invoice details (total: 2523) in 11ms with enhanced pagination
[2m2025-09-27T00:05:33.202070Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-27T00:05:33.202295Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0mc010359f-79c9-4e9e-bcd8-b1bbfa4713a9
[2m2025-09-27T00:05:33.202319Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request c010359f-79c9-4e9e-bcd8-b1bbfa4713a9: Processing for user 1 with limit 100 offset 900 order_by date direction DESC
[2m2025-09-27T00:05:33.202370Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request c010359f-79c9-4e9e-bcd8-b1bbfa4713a9: Querying details for user 1 with enhanced filters
[2m2025-09-27T00:05:33.202394Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request c010359f-79c9-4e9e-bcd8-b1bbfa4713a9: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-09-27T00:05:33.210287Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request c010359f-79c9-4e9e-bcd8-b1bbfa4713a9: Retrieved 100 invoice details (total: 2523) in 7ms with enhanced pagination
[2m2025-09-27T00:05:33.217264Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-27T00:05:33.217521Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0med95e1be-b9a5-4211-a03e-720023c31352
[2m2025-09-27T00:05:33.217544Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request ed95e1be-b9a5-4211-a03e-720023c31352: Processing for user 1 with limit 100 offset 1100 order_by date direction DESC
[2m2025-09-27T00:05:33.217555Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request ed95e1be-b9a5-4211-a03e-720023c31352: Querying details for user 1 with enhanced filters
[2m2025-09-27T00:05:33.217573Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request ed95e1be-b9a5-4211-a03e-720023c31352: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-09-27T00:05:33.218185Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-27T00:05:33.218299Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m784f95a2-b4f7-4716-a64d-c3759211b892
[2m2025-09-27T00:05:33.218317Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 784f95a2-b4f7-4716-a64d-c3759211b892: Processing for user 1 with limit 100 offset 1000 order_by date direction DESC
[2m2025-09-27T00:05:33.218356Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 784f95a2-b4f7-4716-a64d-c3759211b892: Querying details for user 1 with enhanced filters
[2m2025-09-27T00:05:33.218373Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 784f95a2-b4f7-4716-a64d-c3759211b892: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-09-27T00:05:33.223390Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request ed95e1be-b9a5-4211-a03e-720023c31352: Retrieved 100 invoice details (total: 2523) in 5ms with enhanced pagination
[2m2025-09-27T00:05:33.227539Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 784f95a2-b4f7-4716-a64d-c3759211b892: Retrieved 100 invoice details (total: 2523) in 9ms with enhanced pagination
[2m2025-09-27T00:05:33.799103Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-27T00:05:33.799366Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0mac667568-da48-4a0a-89c0-86432140d285
[2m2025-09-27T00:05:33.799397Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request ac667568-da48-4a0a-89c0-86432140d285: Processing for user 1 with limit 100 offset 1200 order_by date direction DESC
[2m2025-09-27T00:05:33.799469Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request ac667568-da48-4a0a-89c0-86432140d285: Querying details for user 1 with enhanced filters
[2m2025-09-27T00:05:33.799495Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request ac667568-da48-4a0a-89c0-86432140d285: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-09-27T00:05:33.803658Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-27T00:05:33.803781Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0mc2bb7e99-013d-4a79-ac6b-290f143a63ed
[2m2025-09-27T00:05:33.803798Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request c2bb7e99-013d-4a79-ac6b-290f143a63ed: Processing for user 1 with limit 100 offset 1400 order_by date direction DESC
[2m2025-09-27T00:05:33.803811Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request c2bb7e99-013d-4a79-ac6b-290f143a63ed: Querying details for user 1 with enhanced filters
[2m2025-09-27T00:05:33.803828Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request c2bb7e99-013d-4a79-ac6b-290f143a63ed: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-09-27T00:05:33.804387Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-27T00:05:33.804556Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m1050ec7f-c08f-4b50-8b92-8e02d27af0cd
[2m2025-09-27T00:05:33.804580Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 1050ec7f-c08f-4b50-8b92-8e02d27af0cd: Processing for user 1 with limit 100 offset 1300 order_by date direction DESC
[2m2025-09-27T00:05:33.804613Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 1050ec7f-c08f-4b50-8b92-8e02d27af0cd: Querying details for user 1 with enhanced filters
[2m2025-09-27T00:05:33.804635Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 1050ec7f-c08f-4b50-8b92-8e02d27af0cd: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-09-27T00:05:33.807190Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request ac667568-da48-4a0a-89c0-86432140d285: Retrieved 100 invoice details (total: 2523) in 7ms with enhanced pagination
[2m2025-09-27T00:05:33.811182Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request c2bb7e99-013d-4a79-ac6b-290f143a63ed: Retrieved 100 invoice details (total: 2523) in 7ms with enhanced pagination
[2m2025-09-27T00:05:33.813231Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 1050ec7f-c08f-4b50-8b92-8e02d27af0cd: Retrieved 100 invoice details (total: 2523) in 8ms with enhanced pagination
[2m2025-09-27T00:05:34.289456Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-27T00:05:34.289654Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m8e0cf0a8-70c1-4673-94cc-0eb37e82fdb7
[2m2025-09-27T00:05:34.289674Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 8e0cf0a8-70c1-4673-94cc-0eb37e82fdb7: Processing for user 1 with limit 100 offset 1500 order_by date direction DESC
[2m2025-09-27T00:05:34.289689Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 8e0cf0a8-70c1-4673-94cc-0eb37e82fdb7: Querying details for user 1 with enhanced filters
[2m2025-09-27T00:05:34.289711Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 8e0cf0a8-70c1-4673-94cc-0eb37e82fdb7: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-09-27T00:05:34.296163Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 8e0cf0a8-70c1-4673-94cc-0eb37e82fdb7: Retrieved 100 invoice details (total: 2523) in 6ms with enhanced pagination
[2m2025-09-27T00:05:34.303643Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-27T00:05:34.303799Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m83fbde68-07a2-4e6c-b0be-04804436ad5e
[2m2025-09-27T00:05:34.303817Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 83fbde68-07a2-4e6c-b0be-04804436ad5e: Processing for user 1 with limit 100 offset 1700 order_by date direction DESC
[2m2025-09-27T00:05:34.303829Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 83fbde68-07a2-4e6c-b0be-04804436ad5e: Querying details for user 1 with enhanced filters
[2m2025-09-27T00:05:34.303847Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 83fbde68-07a2-4e6c-b0be-04804436ad5e: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-09-27T00:05:34.304982Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-27T00:05:34.305096Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m0313679c-3ac9-45c2-8ea4-c09c484be73a
[2m2025-09-27T00:05:34.305111Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 0313679c-3ac9-45c2-8ea4-c09c484be73a: Processing for user 1 with limit 100 offset 1600 order_by date direction DESC
[2m2025-09-27T00:05:34.305122Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 0313679c-3ac9-45c2-8ea4-c09c484be73a: Querying details for user 1 with enhanced filters
[2m2025-09-27T00:05:34.305135Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 0313679c-3ac9-45c2-8ea4-c09c484be73a: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-09-27T00:05:34.309995Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 83fbde68-07a2-4e6c-b0be-04804436ad5e: Retrieved 100 invoice details (total: 2523) in 6ms with enhanced pagination
[2m2025-09-27T00:05:34.311107Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 0313679c-3ac9-45c2-8ea4-c09c484be73a: Retrieved 100 invoice details (total: 2523) in 6ms with enhanced pagination
[2m2025-09-27T00:05:34.821771Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-27T00:05:34.821968Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m8359c90f-f7ed-4b39-9d28-f55f68c07ccd
[2m2025-09-27T00:05:34.821989Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 8359c90f-f7ed-4b39-9d28-f55f68c07ccd: Processing for user 1 with limit 100 offset 1800 order_by date direction DESC
[2m2025-09-27T00:05:34.822004Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 8359c90f-f7ed-4b39-9d28-f55f68c07ccd: Querying details for user 1 with enhanced filters
[2m2025-09-27T00:05:34.822027Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 8359c90f-f7ed-4b39-9d28-f55f68c07ccd: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-09-27T00:05:34.828752Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 8359c90f-f7ed-4b39-9d28-f55f68c07ccd: Retrieved 100 invoice details (total: 2523) in 6ms with enhanced pagination
[2m2025-09-27T00:05:34.833181Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-27T00:05:34.833404Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m07d358b6-af6f-4e6c-89ec-ae8110c51795
[2m2025-09-27T00:05:34.833441Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 07d358b6-af6f-4e6c-89ec-ae8110c51795: Processing for user 1 with limit 100 offset 2000 order_by date direction DESC
[2m2025-09-27T00:05:34.833454Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 07d358b6-af6f-4e6c-89ec-ae8110c51795: Querying details for user 1 with enhanced filters
[2m2025-09-27T00:05:34.833468Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 07d358b6-af6f-4e6c-89ec-ae8110c51795: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-09-27T00:05:34.833770Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-27T00:05:34.833905Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m130411c1-250c-4548-adb3-b815ac683d53
[2m2025-09-27T00:05:34.833926Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 130411c1-250c-4548-adb3-b815ac683d53: Processing for user 1 with limit 100 offset 1900 order_by date direction DESC
[2m2025-09-27T00:05:34.833943Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 130411c1-250c-4548-adb3-b815ac683d53: Querying details for user 1 with enhanced filters
[2m2025-09-27T00:05:34.833962Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 130411c1-250c-4548-adb3-b815ac683d53: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-09-27T00:05:34.840089Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 07d358b6-af6f-4e6c-89ec-ae8110c51795: Retrieved 100 invoice details (total: 2523) in 6ms with enhanced pagination
[2m2025-09-27T00:05:34.844684Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 130411c1-250c-4548-adb3-b815ac683d53: Retrieved 100 invoice details (total: 2523) in 10ms with enhanced pagination
[2m2025-09-27T00:05:35.413023Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-27T00:05:35.413225Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0mc8723d4f-1f3c-4abb-84c8-49f6dc836baa
[2m2025-09-27T00:05:35.413245Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request c8723d4f-1f3c-4abb-84c8-49f6dc836baa: Processing for user 1 with limit 100 offset 2100 order_by date direction DESC
[2m2025-09-27T00:05:35.413261Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request c8723d4f-1f3c-4abb-84c8-49f6dc836baa: Querying details for user 1 with enhanced filters
[2m2025-09-27T00:05:35.413283Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request c8723d4f-1f3c-4abb-84c8-49f6dc836baa: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-09-27T00:05:35.418739Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-27T00:05:35.418931Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0mdd7b8647-d098-4c03-9db1-d6401772a6b7
[2m2025-09-27T00:05:35.418951Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request dd7b8647-d098-4c03-9db1-d6401772a6b7: Processing for user 1 with limit 100 offset 2300 order_by date direction DESC
[2m2025-09-27T00:05:35.418967Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request dd7b8647-d098-4c03-9db1-d6401772a6b7: Querying details for user 1 with enhanced filters
[2m2025-09-27T00:05:35.418990Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request dd7b8647-d098-4c03-9db1-d6401772a6b7: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-09-27T00:05:35.419091Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-27T00:05:35.419240Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m178c17b1-4529-4afc-8902-5dcbcd38ff4f
[2m2025-09-27T00:05:35.419258Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 178c17b1-4529-4afc-8902-5dcbcd38ff4f: Processing for user 1 with limit 100 offset 2200 order_by date direction DESC
[2m2025-09-27T00:05:35.419271Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 178c17b1-4529-4afc-8902-5dcbcd38ff4f: Querying details for user 1 with enhanced filters
[2m2025-09-27T00:05:35.419288Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 178c17b1-4529-4afc-8902-5dcbcd38ff4f: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-09-27T00:05:35.420897Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request c8723d4f-1f3c-4abb-84c8-49f6dc836baa: Retrieved 100 invoice details (total: 2523) in 7ms with enhanced pagination
[2m2025-09-27T00:05:35.426373Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 178c17b1-4529-4afc-8902-5dcbcd38ff4f: Retrieved 100 invoice details (total: 2523) in 7ms with enhanced pagination
[2m2025-09-27T00:05:35.431522Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request dd7b8647-d098-4c03-9db1-d6401772a6b7: Retrieved 100 invoice details (total: 2523) in 12ms with enhanced pagination
[2m2025-09-27T00:05:36.049683Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-27T00:05:36.049905Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m27859e64-2ccc-4a12-ad02-b2a860950680
[2m2025-09-27T00:05:36.049928Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 27859e64-2ccc-4a12-ad02-b2a860950680: Processing for user 1 with limit 100 offset 2400 order_by date direction DESC
[2m2025-09-27T00:05:36.049943Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 27859e64-2ccc-4a12-ad02-b2a860950680: Querying details for user 1 with enhanced filters
[2m2025-09-27T00:05:36.049965Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 27859e64-2ccc-4a12-ad02-b2a860950680: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-09-27T00:05:36.057507Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 27859e64-2ccc-4a12-ad02-b2a860950680: Retrieved 100 invoice details (total: 2523) in 7ms with enhanced pagination
[2m2025-09-27T00:05:36.064025Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-27T00:05:36.064162Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m7cd94076-ee9e-472a-ace9-9a633a0864f0
[2m2025-09-27T00:05:36.064180Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 7cd94076-ee9e-472a-ace9-9a633a0864f0: Processing for user 1 with limit 100 offset 2600 order_by date direction DESC
[2m2025-09-27T00:05:36.064193Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 7cd94076-ee9e-472a-ace9-9a633a0864f0: Querying details for user 1 with enhanced filters
[2m2025-09-27T00:05:36.064212Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 7cd94076-ee9e-472a-ace9-9a633a0864f0: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-09-27T00:05:36.065093Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-27T00:05:36.065204Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m7344d7cb-3242-4a18-9363-a133b832dd90
[2m2025-09-27T00:05:36.065220Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 7344d7cb-3242-4a18-9363-a133b832dd90: Processing for user 1 with limit 100 offset 2500 order_by date direction DESC
[2m2025-09-27T00:05:36.065232Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 7344d7cb-3242-4a18-9363-a133b832dd90: Querying details for user 1 with enhanced filters
[2m2025-09-27T00:05:36.065247Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 7344d7cb-3242-4a18-9363-a133b832dd90: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-09-27T00:05:36.069837Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 7cd94076-ee9e-472a-ace9-9a633a0864f0: Retrieved 0 invoice details (total: 2523) in 5ms with enhanced pagination
[2m2025-09-27T00:05:36.071119Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 7344d7cb-3242-4a18-9363-a133b832dd90: Retrieved 23 invoice details (total: 2523) in 5ms with enhanced pagination
[2m2025-09-27T00:05:36.629485Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-27T00:05:36.629704Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m38318ee8-1fed-4714-9aef-7a9bfbd8c6c7
[2m2025-09-27T00:05:36.629726Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 38318ee8-1fed-4714-9aef-7a9bfbd8c6c7: Processing for user 1 with limit 100 offset 2700 order_by date direction DESC
[2m2025-09-27T00:05:36.629741Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 38318ee8-1fed-4714-9aef-7a9bfbd8c6c7: Querying details for user 1 with enhanced filters
[2m2025-09-27T00:05:36.629768Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 38318ee8-1fed-4714-9aef-7a9bfbd8c6c7: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-09-27T00:05:36.633492Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-27T00:05:36.633614Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m8cb27ad6-4aae-4700-8603-4d2d043867fe
[2m2025-09-27T00:05:36.633630Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 8cb27ad6-4aae-4700-8603-4d2d043867fe: Processing for user 1 with limit 100 offset 2900 order_by date direction DESC
[2m2025-09-27T00:05:36.633643Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 8cb27ad6-4aae-4700-8603-4d2d043867fe: Querying details for user 1 with enhanced filters
[2m2025-09-27T00:05:36.633658Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 8cb27ad6-4aae-4700-8603-4d2d043867fe: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-09-27T00:05:36.635659Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 38318ee8-1fed-4714-9aef-7a9bfbd8c6c7: Retrieved 0 invoice details (total: 2523) in 5ms with enhanced pagination
[2m2025-09-27T00:05:36.635675Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-27T00:05:36.635873Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m31e512ee-c0e6-4113-aaf5-bd291445009b
[2m2025-09-27T00:05:36.635909Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 31e512ee-c0e6-4113-aaf5-bd291445009b: Processing for user 1 with limit 100 offset 2800 order_by date direction DESC
[2m2025-09-27T00:05:36.635923Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 31e512ee-c0e6-4113-aaf5-bd291445009b: Querying details for user 1 with enhanced filters
[2m2025-09-27T00:05:36.635945Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 31e512ee-c0e6-4113-aaf5-bd291445009b: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-09-27T00:05:36.639230Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 8cb27ad6-4aae-4700-8603-4d2d043867fe: Retrieved 0 invoice details (total: 2523) in 5ms with enhanced pagination
[2m2025-09-27T00:05:36.641997Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 31e512ee-c0e6-4113-aaf5-bd291445009b: Retrieved 0 invoice details (total: 2523) in 6ms with enhanced pagination
[2m2025-09-27T00:05:38.607541Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-27T00:05:38.607763Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0m39b8fdb8-4c85-4746-b653-4872a2a708bf
[2m2025-09-27T00:05:38.607787Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 39b8fdb8-4c85-4746-b653-4872a2a708bf: Processing headers for user 1 with limit 50 offset 100
[2m2025-09-27T00:05:38.607814Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 39b8fdb8-4c85-4746-b653-4872a2a708bf: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            '' as issuer_ruc,
            '' as issuer_dv,
            '' as issuer_address,
            '' as issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-09-27T00:05:38.608076Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-27T00:05:38.608289Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0m7709b025-c74e-45ce-9f92-35d29b2da58e
[2m2025-09-27T00:05:38.608312Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 7709b025-c74e-45ce-9f92-35d29b2da58e: Processing headers for user 1 with limit 50 offset 50
[2m2025-09-27T00:05:38.608383Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 7709b025-c74e-45ce-9f92-35d29b2da58e: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            '' as issuer_ruc,
            '' as issuer_dv,
            '' as issuer_address,
            '' as issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-09-27T00:05:38.608618Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-27T00:05:38.608826Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0m5447f887-9851-4a42-a523-a03b567dee08
[2m2025-09-27T00:05:38.608846Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 5447f887-9851-4a42-a523-a03b567dee08: Processing headers for user 1 with limit 50 offset 0
[2m2025-09-27T00:05:38.608870Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 5447f887-9851-4a42-a523-a03b567dee08: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            '' as issuer_ruc,
            '' as issuer_dv,
            '' as issuer_address,
            '' as issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-09-27T00:05:38.609568Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 39b8fdb8-4c85-4746-b653-4872a2a708bf: Retrieved 0 invoice headers (total: 0) in 1ms with enhanced filtering
[2m2025-09-27T00:05:38.611039Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 7709b025-c74e-45ce-9f92-35d29b2da58e: Retrieved 0 invoice headers (total: 0) in 2ms with enhanced filtering
[2m2025-09-27T00:05:38.611147Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 5447f887-9851-4a42-a523-a03b567dee08: Retrieved 0 invoice headers (total: 0) in 2ms with enhanced filtering
[2m2025-09-27T00:05:38.799478Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-27T00:05:38.799686Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m3e58b623-4cd0-47ba-9e5d-d23f70c99dfb
[2m2025-09-27T00:05:38.799705Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 3e58b623-4cd0-47ba-9e5d-d23f70c99dfb: Processing for user 1 with limit 100 offset 0 order_by date direction DESC
[2m2025-09-27T00:05:38.799722Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 3e58b623-4cd0-47ba-9e5d-d23f70c99dfb: Querying details for user 1 with enhanced filters
[2m2025-09-27T00:05:38.799747Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 3e58b623-4cd0-47ba-9e5d-d23f70c99dfb: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-09-27T00:05:38.801812Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 3e58b623-4cd0-47ba-9e5d-d23f70c99dfb: Retrieved 0 invoice details (total: 0) in 2ms with enhanced pagination
[2m2025-09-27T00:05:38.806752Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-27T00:05:38.806914Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m802730c1-2e81-467d-aade-a3110e6a99d5
[2m2025-09-27T00:05:38.806932Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 802730c1-2e81-467d-aade-a3110e6a99d5: Processing for user 1 with limit 100 offset 200 order_by date direction DESC
[2m2025-09-27T00:05:38.806947Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 802730c1-2e81-467d-aade-a3110e6a99d5: Querying details for user 1 with enhanced filters
[2m2025-09-27T00:05:38.806967Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 802730c1-2e81-467d-aade-a3110e6a99d5: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-09-27T00:05:38.808385Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-27T00:05:38.808474Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 802730c1-2e81-467d-aade-a3110e6a99d5: Retrieved 0 invoice details (total: 0) in 1ms with enhanced pagination
[2m2025-09-27T00:05:38.808539Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m584f4d3e-b9e6-4063-83b8-e84221603228
[2m2025-09-27T00:05:38.808557Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 584f4d3e-b9e6-4063-83b8-e84221603228: Processing for user 1 with limit 100 offset 100 order_by date direction DESC
[2m2025-09-27T00:05:38.808572Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 584f4d3e-b9e6-4063-83b8-e84221603228: Querying details for user 1 with enhanced filters
[2m2025-09-27T00:05:38.808602Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 584f4d3e-b9e6-4063-83b8-e84221603228: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-09-27T00:05:38.810283Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 584f4d3e-b9e6-4063-83b8-e84221603228: Retrieved 0 invoice details (total: 0) in 1ms with enhanced pagination
[2m2025-09-27T00:05:39.277744Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-27T00:05:39.277919Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-27T00:05:39.277994Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_history_v4[0m[2m:[0m Fetching rewards history for user_id: 1
[2m2025-09-27T00:05:39.281761Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_history_v4[0m[2m:[0m Rewards history retrieved in 3ms for user_id: 1 - 20 items
[2m2025-09-27T00:05:39.332947Z[0m [32m INFO[0m [2mlum_rust_ws::api::unified_auth_v4[0m[2m:[0m üîê Unified authentication request received [3mprovider[0m[2m=[0mGoogle [3mcreate_if_not_exists[0m[2m=[0mtrue [3mhas_linking_token[0m[2m=[0mfalse
[2m2025-09-27T00:05:39.333026Z[0m [32m INFO[0m [2mlum_rust_ws::services::unified_auth_simple[0m[2m:[0m üöÄ Starting unified authentication [3mrequest_id[0m[2m=[0md68bf1ee-4240-4aff-a0f4-69bd79af8b86 [3mprovider[0m[2m=[0mGoogle { id_token: "eyJhbGciOiJSUzI1NiIsImtpZCI6IjkyN2I4ZmI2N2JiYWQ3NzQ0NWU1ZmVhNGM3MWFhOTg0NmQ3ZGRkMDEiLCJ0eXAiOiJKV1QifQ.eyJpc3MiOiJodHRwczovL2FjY291bnRzLmdvb2dsZS5jb20iLCJhenAiOiI5MTY0MjMxNTU1MS1hcjQ0MzVhb2lzcDA5NzVvbmc4cmNpZHRuYm1pYzJnMS5hcHBzLmdvb2dsZXVzZXJjb250ZW50LmNvbSIsImF1ZCI6IjkxNjQyMzE1NTUxLXZjcXRkYTFsY2ZvYWcwbWVqdWJsMTU3aXV2NHE4c3JpLmFwcHMuZ29vZ2xldXNlcmNvbnRlbnQuY29tIiwic3ViIjoiMTA5NjkzNjUyNjM1MDUwNTI1Nzk2IiwiZW1haWwiOiJhbnZhbGVuY2lhZ0BnbWFpbC5jb20iLCJlbWFpbF92ZXJpZmllZCI6dHJ1ZSwibmFtZSI6IkFuZHJlcyBWIiwicGljdHVyZSI6Imh0dHBzOi8vbGgzLmdvb2dsZXVzZXJjb250ZW50LmNvbS9hL0FDZzhvY0lxMWxLWWZnckotc3VHTHdKNjk2R0p4WllXQ0twaUFIV3pjU3VxRmFjbkVnaFRxNkE9czk2LWMiLCJnaXZlbl9uYW1lIjoiQW5kcmVzIiwiZmFtaWx5X25hbWUiOiJWIiwiaWF0IjoxNzU4OTMxNTM4LCJleHAiOjE3NTg5MzUxMzh9.WcVxIw3XXwE9WPULa0FnE7CYFajFQ44sOz6YztGoo7v-HZtDLImEip2bg0ivzAqhjEN0qgD4cWC1Ld_jaNsCO8UiLbvYWpBXZ3xQadRCmVWQ5xlFZOzxKDVu7o5k3lrqgURr-VjiNUic6zCZuWcELzpYlNmUZTAFtLqGtS8GLxfT2_TbQOB0ae2crGKMncYfGXO5dVDK4PCqd7Kp_HW-Gxh4t_1gWQZp2zC-oV5a6ZXjBugTZvVrGs8vnNKsIEl2g8c_9zRWlmpL9nfuyV74AnYYlWpXTbLAG7stmwIuPAA-iMR3W5GFxu1atvmLdlFIrroPKTrJQxHC61jnIWKhCw", access_token: None }
[2m2025-09-27T00:05:39.333046Z[0m [32m INFO[0m [2mlum_rust_ws::services::unified_auth_simple[0m[2m:[0m üîë Google authentication
[2m2025-09-27T00:05:39.337851Z[0m [32m INFO[0m [2mlum_rust_ws::services::unified_auth_simple[0m[2m:[0m üìù Auth event logged to database [3mrequest_id[0m[2m=[0md68bf1ee-4240-4aff-a0f4-69bd79af8b86 [3mevent_type[0m[2m=[0mgoogle_auth [3msuccess[0m[2m=[0mtrue
[2m2025-09-27T00:05:39.337920Z[0m [32m INFO[0m [2mlum_rust_ws::services::google_service[0m[2m:[0m üîç Starting Google ID token validation [3mrequest_id[0m[2m=[0m72fc1806-0e35-4b67-a237-decca9290e2e
[2m2025-09-27T00:05:39.339106Z[0m [32m INFO[0m [2mlum_rust_ws::services::google_service[0m[2m:[0m ‚úÖ Google ID token validated successfully [3mrequest_id[0m[2m=[0m72fc1806-0e35-4b67-a237-decca9290e2e [3muser_id[0m[2m=[0m109693652635050525796 [3memail[0m[2m=[0manvalenciag@gmail.com [3mname[0m[2m=[0mSome("Andres V") [3memail_verified[0m[2m=[0mtrue [3mexecution_time_ms[0m[2m=[0m1
[2m2025-09-27T00:05:39.345916Z[0m [32m INFO[0m [2mlum_rust_ws::services::token_service[0m[2m:[0m üîë Generated access token successfully [3muser_id[0m[2m=[0m70 [3memail[0m[2m=[0manvalenciag@gmail.com [3mexpires_at[0m[2m=[0m2025-09-28 00:05:39.345844127 UTC
[2m2025-09-27T00:05:39.348839Z[0m [32m INFO[0m [2mlum_rust_ws::services::unified_auth_simple[0m[2m:[0m üìù Auth event logged to database [3mrequest_id[0m[2m=[0md68bf1ee-4240-4aff-a0f4-69bd79af8b86 [3mevent_type[0m[2m=[0mlogin_success [3msuccess[0m[2m=[0mtrue
[2m2025-09-27T00:05:39.348878Z[0m [32m INFO[0m [2mlum_rust_ws::services::unified_auth_simple[0m[2m:[0m ‚úÖ Authentication successful [3mrequest_id[0m[2m=[0md68bf1ee-4240-4aff-a0f4-69bd79af8b86 [3mexecution_time_ms[0m[2m=[0m15
[2m2025-09-27T00:05:39.450663Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-27T00:05:39.450750Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m Getting user balance for user_id: 1
[2m2025-09-27T00:05:39.452274Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m User balance retrieved successfully for user 1 in 1ms: 285 L√ºmis
[2m2025-09-27T00:05:39.663922Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-27T00:05:39.664054Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-27T00:05:39.664103Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m Fetching user data for user_id: 1
[2m2025-09-27T00:05:39.665625Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m User data retrieved in 1ms for user_id: 1 - email: Some("andresfelipevalenciag@gmail.com")
[2m2025-09-27T00:05:46.474671Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-27T00:05:46.474844Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-27T00:05:46.474937Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_history_v4[0m[2m:[0m Fetching rewards history for user_id: 1
[2m2025-09-27T00:05:46.478673Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_history_v4[0m[2m:[0m Rewards history retrieved in 3ms for user_id: 1 - 20 items
[2m2025-09-27T00:05:46.491400Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-27T00:05:46.491532Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-27T00:05:46.491601Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_history_v4[0m[2m:[0m Fetching rewards history for user_id: 1
[2m2025-09-27T00:05:46.494272Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_history_v4[0m[2m:[0m Rewards history retrieved in 2ms for user_id: 1 - 20 items
[2m2025-09-27T00:05:46.505282Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-27T00:05:46.505464Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-27T00:05:46.505536Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_history_v4[0m[2m:[0m Fetching rewards history for user_id: 1
[2m2025-09-27T00:05:46.507704Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_history_v4[0m[2m:[0m Rewards history retrieved in 2ms for user_id: 1 - 20 items
[2m2025-09-27T00:05:46.515603Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-27T00:05:46.515721Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m Getting user balance for user_id: 1
[2m2025-09-27T00:05:46.516360Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m User balance retrieved successfully for user 1 in 0ms: 285 L√ºmis
[2m2025-09-27T00:05:47.033462Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-27T00:05:47.033589Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m Getting user balance for user_id: 1
[2m2025-09-27T00:05:47.034967Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m User balance retrieved successfully for user 1 in 1ms: 285 L√ºmis
[2m2025-09-27T00:06:05.189793Z[0m [32m INFO[0m [2mlum_rust_ws::api::unified_auth_v4[0m[2m:[0m üîê Unified authentication request received [3mprovider[0m[2m=[0mGoogle [3mcreate_if_not_exists[0m[2m=[0mtrue [3mhas_linking_token[0m[2m=[0mfalse
[2m2025-09-27T00:06:05.189930Z[0m [32m INFO[0m [2mlum_rust_ws::services::unified_auth_simple[0m[2m:[0m üöÄ Starting unified authentication [3mrequest_id[0m[2m=[0m08c26fb3-52f1-4ce3-a696-ba2ca8ce74b0 [3mprovider[0m[2m=[0mGoogle { id_token: "eyJhbGciOiJSUzI1NiIsImtpZCI6IjkyN2I4ZmI2N2JiYWQ3NzQ0NWU1ZmVhNGM3MWFhOTg0NmQ3ZGRkMDEiLCJ0eXAiOiJKV1QifQ.eyJpc3MiOiJodHRwczovL2FjY291bnRzLmdvb2dsZS5jb20iLCJhenAiOiI5MTY0MjMxNTU1MS1hcjQ0MzVhb2lzcDA5NzVvbmc4cmNpZHRuYm1pYzJnMS5hcHBzLmdvb2dsZXVzZXJjb250ZW50LmNvbSIsImF1ZCI6IjkxNjQyMzE1NTUxLXZjcXRkYTFsY2ZvYWcwbWVqdWJsMTU3aXV2NHE4c3JpLmFwcHMuZ29vZ2xldXNlcmNvbnRlbnQuY29tIiwic3ViIjoiMTA3MTkwNzE2NjAyOTQyMjAxNDUzIiwiZW1haWwiOiJsdW1hcHAyNUBnbWFpbC5jb20iLCJlbWFpbF92ZXJpZmllZCI6dHJ1ZSwibmFtZSI6Imx1bSIsInBpY3R1cmUiOiJodHRwczovL2xoMy5nb29nbGV1c2VyY29udGVudC5jb20vYS9BQ2c4b2NMczBYRzFFOEc5bWxqNUZlRWxuOTJEeVdEdUtjQWNZcFJOVmFrX2hjeFBLN1JiWlE9czk2LWMiLCJnaXZlbl9uYW1lIjoibHVtIiwiaWF0IjoxNzU4OTMxNTY0LCJleHAiOjE3NTg5MzUxNjR9.chHwXq6ufZhTLdbUlBsyCJVypCGqBGKTwfKtWLelH3LQwdzDUX62-e6KUU5VNp0ZPl5_4eIxGt5M9QkXGWaQi6oWd6JXfyLlQnpjFn-BupcApJf_pPfD2SK1R2oQH9YzCOFj6KZR9wi58pKhOxfX2FcIK8jVY18U8X4HN2IdAre28Gnkg3MESG1jKwPA9NQSf5diK0wc-d6DvZvPSkf8Um1pSI4qClVaLrLsaqe3MNlDOyKMuTeQXPl9iiU6bKE3UigHlLR2v8gL8Rud46DD3lWsIRgO9FDaXxSvh20Lg-BmHcpZaTHmCoAMRWPNovvAx0gaR_6RjR4WSjCL-8TGpw", access_token: None }
[2m2025-09-27T00:06:05.189960Z[0m [32m INFO[0m [2mlum_rust_ws::services::unified_auth_simple[0m[2m:[0m üîë Google authentication
[2m2025-09-27T00:06:05.194264Z[0m [32m INFO[0m [2mlum_rust_ws::services::unified_auth_simple[0m[2m:[0m üìù Auth event logged to database [3mrequest_id[0m[2m=[0m08c26fb3-52f1-4ce3-a696-ba2ca8ce74b0 [3mevent_type[0m[2m=[0mgoogle_auth [3msuccess[0m[2m=[0mtrue
[2m2025-09-27T00:06:05.194306Z[0m [32m INFO[0m [2mlum_rust_ws::services::google_service[0m[2m:[0m üîç Starting Google ID token validation [3mrequest_id[0m[2m=[0me5f9eca4-4d56-4a66-9811-f03668dc1709
[2m2025-09-27T00:06:05.195662Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-27T00:06:05.195689Z[0m [32m INFO[0m [2mlum_rust_ws::services::google_service[0m[2m:[0m ‚úÖ Google ID token validated successfully [3mrequest_id[0m[2m=[0me5f9eca4-4d56-4a66-9811-f03668dc1709 [3muser_id[0m[2m=[0m107190716602942201453 [3memail[0m[2m=[0mlumapp25@gmail.com [3mname[0m[2m=[0mSome("lum") [3memail_verified[0m[2m=[0mtrue [3mexecution_time_ms[0m[2m=[0m1
[2m2025-09-27T00:06:05.195761Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-27T00:06:05.195841Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_history_v4[0m[2m:[0m Fetching rewards history for user_id: 1
[2m2025-09-27T00:06:05.198509Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_history_v4[0m[2m:[0m Rewards history retrieved in 2ms for user_id: 1 - 20 items
[2m2025-09-27T00:06:05.202924Z[0m [32m INFO[0m [2mlum_rust_ws::services::token_service[0m[2m:[0m üîë Generated access token successfully [3muser_id[0m[2m=[0m72 [3memail[0m[2m=[0mlumapp25@gmail.com [3mexpires_at[0m[2m=[0m2025-09-28 00:06:05.202852931 UTC
[2m2025-09-27T00:06:05.206754Z[0m [32m INFO[0m [2mlum_rust_ws::services::unified_auth_simple[0m[2m:[0m üìù Auth event logged to database [3mrequest_id[0m[2m=[0m08c26fb3-52f1-4ce3-a696-ba2ca8ce74b0 [3mevent_type[0m[2m=[0mregister_success [3msuccess[0m[2m=[0mtrue
[2m2025-09-27T00:06:05.206792Z[0m [32m INFO[0m [2mlum_rust_ws::services::unified_auth_simple[0m[2m:[0m ‚úÖ Authentication successful [3mrequest_id[0m[2m=[0m08c26fb3-52f1-4ce3-a696-ba2ca8ce74b0 [3mexecution_time_ms[0m[2m=[0m16
[2m2025-09-27T00:06:05.439775Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-27T00:06:05.440112Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-27T00:06:05.440201Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m Fetching user data for user_id: 1
[2m2025-09-27T00:06:05.443110Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m User data retrieved in 2ms for user_id: 1 - email: Some("andresfelipevalenciag@gmail.com")
[2m2025-09-27T00:06:05.839615Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-27T00:06:05.839734Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m Getting user balance for user_id: 1
[2m2025-09-27T00:06:05.841500Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m User balance retrieved successfully for user 1 in 1ms: 285 L√ºmis
[2m2025-09-27T00:06:11.385782Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-27T00:06:11.385921Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-27T00:06:11.385999Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_history_v4[0m[2m:[0m Fetching rewards history for user_id: 1
[2m2025-09-27T00:06:11.388280Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_history_v4[0m[2m:[0m Rewards history retrieved in 2ms for user_id: 1 - 20 items
[2m2025-09-27T00:06:11.400257Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-27T00:06:11.400313Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-27T00:06:11.400381Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-27T00:06:11.400501Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_history_v4[0m[2m:[0m Fetching rewards history for user_id: 1
[2m2025-09-27T00:06:11.400522Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m Getting user balance for user_id: 1
[2m2025-09-27T00:06:11.401982Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m User balance retrieved successfully for user 1 in 1ms: 285 L√ºmis
[2m2025-09-27T00:06:11.404074Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_history_v4[0m[2m:[0m Rewards history retrieved in 3ms for user_id: 1 - 20 items
[2m2025-09-27T00:06:11.409074Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-27T00:06:11.409172Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-27T00:06:11.409244Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_history_v4[0m[2m:[0m Fetching rewards history for user_id: 1
[2m2025-09-27T00:06:11.412875Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_history_v4[0m[2m:[0m Rewards history retrieved in 3ms for user_id: 1 - 20 items
[2m2025-09-27T00:06:11.676049Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-27T00:06:11.676208Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m Getting user balance for user_id: 1
[2m2025-09-27T00:06:11.678557Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m User balance retrieved successfully for user 1 in 2ms: 285 L√ºmis
[2m2025-09-27T00:06:11.960839Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-27T00:06:11.960985Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m Getting user balance for user_id: 1
[2m2025-09-27T00:06:11.962814Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m User balance retrieved successfully for user 1 in 1ms: 285 L√ºmis
[2m2025-09-27T00:20:24.067562Z[0m [32m INFO[0m [2mlum_rust_ws::api::root_v4[0m[2m:[0m Request afa1e6dc-10f0-4eee-a961-0542be99398e: Root endpoint accessed
[2m2025-09-27T01:21:13.820562Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_registration_v4[0m[2m:[0m Request 97a10855-a40f-431d-92b8-949b5d61e7a2: Checking email existence: andfelval@yahoo.com
[2m2025-09-27T01:21:13.821905Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_registration_v4[0m[2m:[0m Request 97a10855-a40f-431d-92b8-949b5d61e7a2: Querying database for email: andfelval@yahoo.com
[2m2025-09-27T01:21:13.825191Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_registration_v4[0m[2m:[0m Request 97a10855-a40f-431d-92b8-949b5d61e7a2: Found existing user with ID: 31
[2m2025-09-27T01:21:13.825254Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_registration_v4[0m[2m:[0m Request 97a10855-a40f-431d-92b8-949b5d61e7a2: Email andfelval@yahoo.com exists with password: false
[2m2025-09-27T01:21:14.006103Z[0m [32m INFO[0m [2mlum_rust_ws::api::unified_password[0m[2m:[0m üîê Processing password code request [3mrequest_id[0m[2m=[0m273261af-4714-4bab-8b77-672732c15981 [3memail[0m[2m=[0mandfelval@yahoo.com [3mpurpose[0m[2m=[0memail_verification
[2m2025-09-27T01:21:14.008412Z[0m [32m INFO[0m [2mlum_rust_ws::api::unified_password[0m[2m:[0m üìß Email verification code requested [3mrequest_id[0m[2m=[0m273261af-4714-4bab-8b77-672732c15981 [3memail[0m[2m=[0mandfelval@yahoo.com
[2m2025-09-27T01:21:14.017471Z[0m [32m INFO[0m [2mlum_rust_ws::api::verification_v4[0m[2m:[0m üìß EMAIL CONTENT for andfelval@yahoo.com (Request: 273261af-4714-4bab-8b77-672732c15981)
üì¨ To: andfelval@yahoo.com
üìã Subject: C√≥digo de Verificaci√≥n - L√ºm
üìù Format: HTML + Plain Text
üìù Code: 348857
[2m2025-09-27T01:21:14.017526Z[0m [32m INFO[0m [2mlum_rust_ws::api::verification_v4[0m[2m:[0m üöÄ SENDING HTML EMAIL via SMTP mail.lumapp.org to: andfelval@yahoo.com
[2m2025-09-27T01:21:14.620080Z[0m [32m INFO[0m [2mlum_rust_ws::api::verification_v4[0m[2m:[0m ‚úÖ HTML Email sent successfully via SMTP to: andfelval@yahoo.com (Request: 273261af-4714-4bab-8b77-672732c15981) - Response: Response { code: Code { severity: PositiveCompletion, category: MailSystem, detail: Zero }, message: ["OK id=1v2Jcg-00000007uyy-2Kml"] }
[2m2025-09-27T01:21:14.620162Z[0m [32m INFO[0m [2mlum_rust_ws::api::unified_password[0m[2m:[0m ‚úÖ Verification email sent successfully [3mrequest_id[0m[2m=[0m273261af-4714-4bab-8b77-672732c15981 [3memail[0m[2m=[0mandfelval@yahoo.com
[2m2025-09-27T01:21:14.626373Z[0m [32m INFO[0m [2mlum_rust_ws::api::unified_password[0m[2m:[0m ‚úÖ Password code request processed successfully [3mrequest_id[0m[2m=[0m273261af-4714-4bab-8b77-672732c15981 [3mprocessing_time_ms[0m[2m=[0m620
[2m2025-09-27T01:23:25.973477Z[0m [32m INFO[0m [2mlum_rust_ws::api::unified_password[0m[2m:[0m üîê Processing set password with email code request [3mrequest_id[0m[2m=[0m8df56e1f-7413-4e93-9a39-e4fc4c221a09 [3memail[0m[2m=[0mandfelval@yahoo.com
[2m2025-09-27T01:23:26.953745Z[0m [32m INFO[0m [2mlum_rust_ws::api::unified_password[0m[2m:[0m ‚úÖ Password set successfully with email verification code [3mrequest_id[0m[2m=[0m8df56e1f-7413-4e93-9a39-e4fc4c221a09 [3muser_id[0m[2m=[0m31 [3mprocessing_time_ms[0m[2m=[0m980
[2m2025-09-27T01:23:29.326719Z[0m [31mERROR[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m JWT validation failed: JSON error: missing field `sub` at line 1 column 123
[2m2025-09-27T01:23:29.598074Z[0m [31mERROR[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m JWT validation failed: JSON error: missing field `sub` at line 1 column 123
[2m2025-09-27T01:29:03.136077Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_registration_v4[0m[2m:[0m Request f241e68c-ea0e-4916-a7de-f9626deeb14c: Checking email existence: andfelval@yahoo.com
[2m2025-09-27T01:29:03.137819Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_registration_v4[0m[2m:[0m Request f241e68c-ea0e-4916-a7de-f9626deeb14c: Querying database for email: andfelval@yahoo.com
[2m2025-09-27T01:29:03.140522Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_registration_v4[0m[2m:[0m Request f241e68c-ea0e-4916-a7de-f9626deeb14c: Found existing user with ID: 31
[2m2025-09-27T01:29:03.140567Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_registration_v4[0m[2m:[0m Request f241e68c-ea0e-4916-a7de-f9626deeb14c: Email andfelval@yahoo.com exists with password: false
[2m2025-09-27T01:29:03.314720Z[0m [32m INFO[0m [2mlum_rust_ws::api::unified_password[0m[2m:[0m üîê Processing password code request [3mrequest_id[0m[2m=[0mb128b91e-6542-44de-8aec-e99b81d833da [3memail[0m[2m=[0mandfelval@yahoo.com [3mpurpose[0m[2m=[0memail_verification
[2m2025-09-27T01:29:03.316899Z[0m [32m INFO[0m [2mlum_rust_ws::api::unified_password[0m[2m:[0m üìß Email verification code requested [3mrequest_id[0m[2m=[0mb128b91e-6542-44de-8aec-e99b81d833da [3memail[0m[2m=[0mandfelval@yahoo.com
[2m2025-09-27T01:29:03.324796Z[0m [32m INFO[0m [2mlum_rust_ws::api::verification_v4[0m[2m:[0m üìß EMAIL CONTENT for andfelval@yahoo.com (Request: b128b91e-6542-44de-8aec-e99b81d833da)
üì¨ To: andfelval@yahoo.com
üìã Subject: C√≥digo de Verificaci√≥n - L√ºm
üìù Format: HTML + Plain Text
üìù Code: 697060
[2m2025-09-27T01:29:03.324862Z[0m [32m INFO[0m [2mlum_rust_ws::api::verification_v4[0m[2m:[0m üöÄ SENDING HTML EMAIL via SMTP mail.lumapp.org to: andfelval@yahoo.com
[2m2025-09-27T01:29:03.882932Z[0m [32m INFO[0m [2mlum_rust_ws::api::verification_v4[0m[2m:[0m ‚úÖ HTML Email sent successfully via SMTP to: andfelval@yahoo.com (Request: b128b91e-6542-44de-8aec-e99b81d833da) - Response: Response { code: Code { severity: PositiveCompletion, category: MailSystem, detail: Zero }, message: ["OK id=1v2JkF-0000000881R-3RZx"] }
[2m2025-09-27T01:29:03.883055Z[0m [32m INFO[0m [2mlum_rust_ws::api::unified_password[0m[2m:[0m ‚úÖ Verification email sent successfully [3mrequest_id[0m[2m=[0mb128b91e-6542-44de-8aec-e99b81d833da [3memail[0m[2m=[0mandfelval@yahoo.com
[2m2025-09-27T01:29:03.888800Z[0m [32m INFO[0m [2mlum_rust_ws::api::unified_password[0m[2m:[0m ‚úÖ Password code request processed successfully [3mrequest_id[0m[2m=[0mb128b91e-6542-44de-8aec-e99b81d833da [3mprocessing_time_ms[0m[2m=[0m574
[2m2025-09-27T01:29:35.710485Z[0m [32m INFO[0m [2mlum_rust_ws::api::unified_password[0m[2m:[0m üîê Processing set password with email code request [3mrequest_id[0m[2m=[0m65a5a7f9-7b9a-40d3-a255-1c335e0899e2 [3memail[0m[2m=[0mandfelval@yahoo.com
[2m2025-09-27T01:29:36.696473Z[0m [32m INFO[0m [2mlum_rust_ws::api::unified_password[0m[2m:[0m ‚úÖ Password set successfully with email verification code [3mrequest_id[0m[2m=[0m65a5a7f9-7b9a-40d3-a255-1c335e0899e2 [3muser_id[0m[2m=[0m31 [3mprocessing_time_ms[0m[2m=[0m986
[2m2025-09-27T01:29:39.080800Z[0m [31mERROR[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m JWT validation failed: JSON error: missing field `sub` at line 1 column 123
[2m2025-09-27T01:29:39.391646Z[0m [31mERROR[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m JWT validation failed: JSON error: missing field `sub` at line 1 column 123
[2m2025-09-27T01:33:39.066249Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_registration_v4[0m[2m:[0m Request d8ab5178-d660-418f-8038-6f90f21dca1c: Checking email existence: andfelval@yahoo.com
[2m2025-09-27T01:33:39.067713Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_registration_v4[0m[2m:[0m Request d8ab5178-d660-418f-8038-6f90f21dca1c: Querying database for email: andfelval@yahoo.com
[2m2025-09-27T01:33:39.069719Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_registration_v4[0m[2m:[0m Request d8ab5178-d660-418f-8038-6f90f21dca1c: Found existing user with ID: 31
[2m2025-09-27T01:33:39.069744Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_registration_v4[0m[2m:[0m Request d8ab5178-d660-418f-8038-6f90f21dca1c: Email andfelval@yahoo.com exists with password: false
[2m2025-09-27T01:33:39.242900Z[0m [32m INFO[0m [2mlum_rust_ws::api::unified_password[0m[2m:[0m üîê Processing password code request [3mrequest_id[0m[2m=[0m4a91b07b-aeb4-4d9f-8fe5-9106e58f2f94 [3memail[0m[2m=[0mandfelval@yahoo.com [3mpurpose[0m[2m=[0memail_verification
[2m2025-09-27T01:33:39.245136Z[0m [32m INFO[0m [2mlum_rust_ws::api::unified_password[0m[2m:[0m üìß Email verification code requested [3mrequest_id[0m[2m=[0m4a91b07b-aeb4-4d9f-8fe5-9106e58f2f94 [3memail[0m[2m=[0mandfelval@yahoo.com
[2m2025-09-27T01:33:39.251873Z[0m [32m INFO[0m [2mlum_rust_ws::api::verification_v4[0m[2m:[0m üìß EMAIL CONTENT for andfelval@yahoo.com (Request: 4a91b07b-aeb4-4d9f-8fe5-9106e58f2f94)
üì¨ To: andfelval@yahoo.com
üìã Subject: C√≥digo de Verificaci√≥n - L√ºm
üìù Format: HTML + Plain Text
üìù Code: 956706
[2m2025-09-27T01:33:39.251925Z[0m [32m INFO[0m [2mlum_rust_ws::api::verification_v4[0m[2m:[0m üöÄ SENDING HTML EMAIL via SMTP mail.lumapp.org to: andfelval@yahoo.com
[2m2025-09-27T01:33:39.602493Z[0m [32m INFO[0m [2mlum_rust_ws::api::verification_v4[0m[2m:[0m ‚úÖ HTML Email sent successfully via SMTP to: andfelval@yahoo.com (Request: 4a91b07b-aeb4-4d9f-8fe5-9106e58f2f94) - Response: Response { code: Code { severity: PositiveCompletion, category: MailSystem, detail: Zero }, message: ["OK id=1v2Joh-00000008KlP-2HUz"] }
[2m2025-09-27T01:33:39.602572Z[0m [32m INFO[0m [2mlum_rust_ws::api::unified_password[0m[2m:[0m ‚úÖ Verification email sent successfully [3mrequest_id[0m[2m=[0m4a91b07b-aeb4-4d9f-8fe5-9106e58f2f94 [3memail[0m[2m=[0mandfelval@yahoo.com
[2m2025-09-27T01:33:39.607738Z[0m [32m INFO[0m [2mlum_rust_ws::api::unified_password[0m[2m:[0m ‚úÖ Password code request processed successfully [3mrequest_id[0m[2m=[0m4a91b07b-aeb4-4d9f-8fe5-9106e58f2f94 [3mprocessing_time_ms[0m[2m=[0m364
[2m2025-09-27T01:34:06.330554Z[0m [32m INFO[0m [2mlum_rust_ws::api::unified_password[0m[2m:[0m üîê Processing set password with email code request [3mrequest_id[0m[2m=[0m44087ad3-7b6a-43d9-8876-5835ccd12462 [3memail[0m[2m=[0mandfelval@yahoo.com
[2m2025-09-27T01:34:07.275800Z[0m [32m INFO[0m [2mlum_rust_ws::api::unified_password[0m[2m:[0m ‚úÖ Password set successfully with email verification code [3mrequest_id[0m[2m=[0m44087ad3-7b6a-43d9-8876-5835ccd12462 [3muser_id[0m[2m=[0m31 [3mprocessing_time_ms[0m[2m=[0m945
[2m2025-09-27T01:34:09.649236Z[0m [31mERROR[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m JWT validation failed: JSON error: missing field `sub` at line 1 column 123
[2m2025-09-27T01:34:09.959849Z[0m [31mERROR[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m JWT validation failed: JSON error: missing field `sub` at line 1 column 123
[2m2025-09-27T01:34:45.557578Z[0m [33m WARN[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m Missing Authorization header
[2m2025-09-27T01:34:45.863663Z[0m [32m INFO[0m [2mlum_rust_ws::api::root_v4[0m[2m:[0m Request 0b07e380-41d1-4127-a8cd-8661411b1fa9: Root endpoint accessed
[2m2025-09-27T01:34:46.634112Z[0m [32m INFO[0m [2mlum_rust_ws::api::root_v4[0m[2m:[0m Request b8de628c-0b4c-4d88-b09c-2f289c38a5db: Root endpoint accessed
[2m2025-09-27T01:34:47.287717Z[0m [33m WARN[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m Missing Authorization header
[2m2025-09-27T01:39:21.542753Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_registration_v4[0m[2m:[0m Request 815e9362-9c14-40b7-8376-6561748a5324: Checking email existence: andfelval@yahoo.com
[2m2025-09-27T01:39:21.544410Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_registration_v4[0m[2m:[0m Request 815e9362-9c14-40b7-8376-6561748a5324: Querying database for email: andfelval@yahoo.com
[2m2025-09-27T01:39:21.546735Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_registration_v4[0m[2m:[0m Request 815e9362-9c14-40b7-8376-6561748a5324: Found existing user with ID: 31
[2m2025-09-27T01:39:21.546788Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_registration_v4[0m[2m:[0m Request 815e9362-9c14-40b7-8376-6561748a5324: Email andfelval@yahoo.com exists with password: false
[2m2025-09-27T01:39:21.775628Z[0m [32m INFO[0m [2mlum_rust_ws::api::unified_password[0m[2m:[0m üîê Processing password code request [3mrequest_id[0m[2m=[0m9dd3dd49-824b-4ca5-b2ce-96757fe7b552 [3memail[0m[2m=[0mandfelval@yahoo.com [3mpurpose[0m[2m=[0memail_verification
[2m2025-09-27T01:39:21.777275Z[0m [32m INFO[0m [2mlum_rust_ws::api::unified_password[0m[2m:[0m üìß Email verification code requested [3mrequest_id[0m[2m=[0m9dd3dd49-824b-4ca5-b2ce-96757fe7b552 [3memail[0m[2m=[0mandfelval@yahoo.com
[2m2025-09-27T01:39:21.778527Z[0m [33m WARN[0m [2mlum_rust_ws::api::unified_password[0m[2m:[0m ‚ö†Ô∏è Rate limit exceeded for password code requests [3mrequest_id[0m[2m=[0m9dd3dd49-824b-4ca5-b2ce-96757fe7b552 [3memail[0m[2m=[0mandfelval@yahoo.com
[2m2025-09-27T01:40:13.266970Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_registration_v4[0m[2m:[0m Request f5f006e4-3eaf-4dcb-a610-a7638cdb72d5: Checking email existence: andresfelipeval@yahoo.com
[2m2025-09-27T01:40:13.268478Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_registration_v4[0m[2m:[0m Request f5f006e4-3eaf-4dcb-a610-a7638cdb72d5: Querying database for email: andresfelipeval@yahoo.com
[2m2025-09-27T01:40:13.270488Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_registration_v4[0m[2m:[0m Request f5f006e4-3eaf-4dcb-a610-a7638cdb72d5: Found existing user with ID: 31
[2m2025-09-27T01:40:13.270520Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_registration_v4[0m[2m:[0m Request f5f006e4-3eaf-4dcb-a610-a7638cdb72d5: Email andresfelipeval@yahoo.com exists with password: false
[2m2025-09-27T01:40:13.413212Z[0m [32m INFO[0m [2mlum_rust_ws::api::unified_password[0m[2m:[0m üîê Processing password code request [3mrequest_id[0m[2m=[0mca01c92d-61c9-469f-8619-0c0c63b2bdff [3memail[0m[2m=[0mandresfelipeval@yahoo.com [3mpurpose[0m[2m=[0memail_verification
[2m2025-09-27T01:40:13.414663Z[0m [32m INFO[0m [2mlum_rust_ws::api::unified_password[0m[2m:[0m üìß Email verification code requested [3mrequest_id[0m[2m=[0mca01c92d-61c9-469f-8619-0c0c63b2bdff [3memail[0m[2m=[0mandresfelipeval@yahoo.com
[2m2025-09-27T01:40:13.420134Z[0m [32m INFO[0m [2mlum_rust_ws::api::verification_v4[0m[2m:[0m üìß EMAIL CONTENT for andresfelipeval@yahoo.com (Request: ca01c92d-61c9-469f-8619-0c0c63b2bdff)
üì¨ To: andresfelipeval@yahoo.com
üìã Subject: C√≥digo de Verificaci√≥n - L√ºm
üìù Format: HTML + Plain Text
üìù Code: 287858
[2m2025-09-27T01:40:13.420167Z[0m [32m INFO[0m [2mlum_rust_ws::api::verification_v4[0m[2m:[0m üöÄ SENDING HTML EMAIL via SMTP mail.lumapp.org to: andresfelipeval@yahoo.com
[2m2025-09-27T01:40:15.373445Z[0m [32m INFO[0m [2mlum_rust_ws::api::verification_v4[0m[2m:[0m ‚úÖ HTML Email sent successfully via SMTP to: andresfelipeval@yahoo.com (Request: ca01c92d-61c9-469f-8619-0c0c63b2bdff) - Response: Response { code: Code { severity: PositiveCompletion, category: MailSystem, detail: Zero }, message: ["OK id=1v2Jv5-00000008Qqs-1Ia3"] }
[2m2025-09-27T01:40:15.373552Z[0m [32m INFO[0m [2mlum_rust_ws::api::unified_password[0m[2m:[0m ‚úÖ Verification email sent successfully [3mrequest_id[0m[2m=[0mca01c92d-61c9-469f-8619-0c0c63b2bdff [3memail[0m[2m=[0mandresfelipeval@yahoo.com
[2m2025-09-27T01:40:15.376676Z[0m [32m INFO[0m [2mlum_rust_ws::api::unified_password[0m[2m:[0m ‚úÖ Password code request processed successfully [3mrequest_id[0m[2m=[0mca01c92d-61c9-469f-8619-0c0c63b2bdff [3mprocessing_time_ms[0m[2m=[0m1963
[2m2025-09-27T01:41:06.426764Z[0m [32m INFO[0m [2mlum_rust_ws::api::unified_password[0m[2m:[0m üîê Processing set password with email code request [3mrequest_id[0m[2m=[0m48867954-0905-4eb5-8f20-03b415641ae5 [3memail[0m[2m=[0mandresfelipeval@yahoo.com
[2m2025-09-27T01:41:07.362817Z[0m [32m INFO[0m [2mlum_rust_ws::api::unified_password[0m[2m:[0m ‚úÖ Password set successfully with email verification code [3mrequest_id[0m[2m=[0m48867954-0905-4eb5-8f20-03b415641ae5 [3muser_id[0m[2m=[0m31 [3mprocessing_time_ms[0m[2m=[0m936
[2m2025-09-27T01:41:14.223079Z[0m [31mERROR[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m JWT validation failed: JSON error: missing field `sub` at line 1 column 129
[2m2025-09-27T01:41:14.230674Z[0m [31mERROR[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m JWT validation failed: JSON error: missing field `sub` at line 1 column 129
[2m2025-09-27T01:47:42.788501Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_registration_v4[0m[2m:[0m Request 50e483c5-fb01-4504-a3fe-dc397a4166f6: Checking email existence: andresfelipeval@yahoo.com
[2m2025-09-27T01:47:42.789801Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_registration_v4[0m[2m:[0m Request 50e483c5-fb01-4504-a3fe-dc397a4166f6: Querying database for email: andresfelipeval@yahoo.com
[2m2025-09-27T01:47:42.792011Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_registration_v4[0m[2m:[0m Request 50e483c5-fb01-4504-a3fe-dc397a4166f6: Found existing user with ID: 31
[2m2025-09-27T01:47:42.792035Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_registration_v4[0m[2m:[0m Request 50e483c5-fb01-4504-a3fe-dc397a4166f6: Email andresfelipeval@yahoo.com exists with password: false
[2m2025-09-27T01:47:43.018353Z[0m [32m INFO[0m [2mlum_rust_ws::api::unified_password[0m[2m:[0m üîê Processing password code request [3mrequest_id[0m[2m=[0m29ed5d51-dfb6-4f37-90c6-5a1b75944bb5 [3memail[0m[2m=[0mandresfelipeval@yahoo.com [3mpurpose[0m[2m=[0memail_verification
[2m2025-09-27T01:47:43.020235Z[0m [32m INFO[0m [2mlum_rust_ws::api::unified_password[0m[2m:[0m üìß Email verification code requested [3mrequest_id[0m[2m=[0m29ed5d51-dfb6-4f37-90c6-5a1b75944bb5 [3memail[0m[2m=[0mandresfelipeval@yahoo.com
[2m2025-09-27T01:47:43.025593Z[0m [32m INFO[0m [2mlum_rust_ws::api::verification_v4[0m[2m:[0m üìß EMAIL CONTENT for andresfelipeval@yahoo.com (Request: 29ed5d51-dfb6-4f37-90c6-5a1b75944bb5)
üì¨ To: andresfelipeval@yahoo.com
üìã Subject: C√≥digo de Verificaci√≥n - L√ºm
üìù Format: HTML + Plain Text
üìù Code: 685807
[2m2025-09-27T01:47:43.025631Z[0m [32m INFO[0m [2mlum_rust_ws::api::verification_v4[0m[2m:[0m üöÄ SENDING HTML EMAIL via SMTP mail.lumapp.org to: andresfelipeval@yahoo.com
[2m2025-09-27T01:47:43.493924Z[0m [32m INFO[0m [2mlum_rust_ws::api::verification_v4[0m[2m:[0m ‚úÖ HTML Email sent successfully via SMTP to: andresfelipeval@yahoo.com (Request: 29ed5d51-dfb6-4f37-90c6-5a1b75944bb5) - Response: Response { code: Code { severity: PositiveCompletion, category: MailSystem, detail: Zero }, message: ["OK id=1v2K2J-00000008Yba-1oQ5"] }
[2m2025-09-27T01:47:43.494045Z[0m [32m INFO[0m [2mlum_rust_ws::api::unified_password[0m[2m:[0m ‚úÖ Verification email sent successfully [3mrequest_id[0m[2m=[0m29ed5d51-dfb6-4f37-90c6-5a1b75944bb5 [3memail[0m[2m=[0mandresfelipeval@yahoo.com
[2m2025-09-27T01:47:43.499843Z[0m [32m INFO[0m [2mlum_rust_ws::api::unified_password[0m[2m:[0m ‚úÖ Password code request processed successfully [3mrequest_id[0m[2m=[0m29ed5d51-dfb6-4f37-90c6-5a1b75944bb5 [3mprocessing_time_ms[0m[2m=[0m481
[2m2025-09-27T01:48:13.006324Z[0m [32m INFO[0m [2mlum_rust_ws::api::unified_password[0m[2m:[0m üîê Processing set password with email code request [3mrequest_id[0m[2m=[0mff43840e-d6d8-4eb5-82ae-f255dab7604c [3memail[0m[2m=[0mandresfelipeval@yahoo.com
[2m2025-09-27T01:48:13.929464Z[0m [32m INFO[0m [2mlum_rust_ws::api::unified_password[0m[2m:[0m ‚úÖ Password set successfully with email verification code [3mrequest_id[0m[2m=[0mff43840e-d6d8-4eb5-82ae-f255dab7604c [3muser_id[0m[2m=[0m31 [3mprocessing_time_ms[0m[2m=[0m923
[2m2025-09-27T01:48:14.153697Z[0m [32m INFO[0m [2mlum_rust_ws::api::auth_v4[0m[2m:[0m üîê Processing user login request [3mrequest_id[0m[2m=[0m803af68f-2439-45e3-b10a-8e7fb6973bdb [3memail[0m[2m=[0mandresfelipeval@yahoo.com [3mremember_me[0m[2m=[0mfalse
[2m2025-09-27T01:48:15.087966Z[0m [32m INFO[0m [2mlum_rust_ws::api::auth_v4[0m[2m:[0m üéâ User login successful - JWT token generated for frontend compatibility [3mrequest_id[0m[2m=[0m803af68f-2439-45e3-b10a-8e7fb6973bdb [3muser_id[0m[2m=[0m31 [3memail[0m[2m=[0mandresfelipeval@yahoo.com [3mexecution_time_ms[0m[2m=[0m934 [3mremember_me[0m[2m=[0mfalse
[2m2025-09-27T01:48:19.100710Z[0m [31mERROR[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m JWT validation failed: JSON error: missing field `sub` at line 1 column 129
[2m2025-09-27T01:48:19.103698Z[0m [31mERROR[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m JWT validation failed: JSON error: missing field `sub` at line 1 column 129
[2m2025-09-27T01:58:15.476906Z[0m [32m INFO[0m [2mlum_rust_ws[0m[2m:[0m signal received, starting graceful shutdown
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.30s
     Running `target/debug/lum_rust_ws`
[2m2025-09-28T10:14:51.461237Z[0m [32m INFO[0m [2mlum_rust_ws::monitoring[0m[2m:[0m üîç Monitoring system initialized
[2m2025-09-28T10:14:51.461307Z[0m [32m INFO[0m [2mlum_rust_ws[0m[2m:[0m üîç Monitoring system initialized
[2m2025-09-28T10:14:51.461387Z[0m [32m INFO[0m [2mlum_rust_ws::optimization[0m[2m:[0m üîß Creating optimized database pool with 50 max connections
[2m2025-09-28T10:14:52.016265Z[0m [32m INFO[0m [2mlum_rust_ws::optimization[0m[2m:[0m ‚úÖ Database pool created successfully
[2m2025-09-28T10:14:52.016377Z[0m [32m INFO[0m [2mlum_rust_ws::optimization[0m[2m:[0m üîß Creating optimized Redis client
[2m2025-09-28T10:14:52.016507Z[0m [32m INFO[0m [2mlum_rust_ws::optimization[0m[2m:[0m ‚úÖ Redis client created successfully
[2m2025-09-28T10:14:52.074439Z[0m [32m INFO[0m [2mlum_rust_ws::domains::qr::service[0m[2m:[0m üöÄ Initializing optimized hybrid QR service (2-level cascade)
[2m2025-09-28T10:14:52.074473Z[0m [32m INFO[0m [2mlum_rust_ws::domains::qr::service[0m[2m:[0m üìä Expected performance: 85% success with Rust (5-15ms), 12% with Python fallback (30-50ms)
[2m2025-09-28T10:14:52.074550Z[0m [32m INFO[0m [2mlum_rust_ws::shared::performance[0m[2m:[0m üöÄ Initializing PerformanceManager with advanced configuration
[2m2025-09-28T10:14:52.074558Z[0m [32m INFO[0m [2mlum_rust_ws::shared::performance[0m[2m:[0m üìä QR Detection: 50 max concurrent
[2m2025-09-28T10:14:52.074564Z[0m [32m INFO[0m [2mlum_rust_ws::shared::performance[0m[2m:[0m üìä OCR Processing: 20 max concurrent
[2m2025-09-28T10:14:52.074570Z[0m [32m INFO[0m [2mlum_rust_ws::shared::performance[0m[2m:[0m üìä Webhook Processing: 100 max concurrent
[2m2025-09-28T10:14:52.074576Z[0m [32m INFO[0m [2mlum_rust_ws::shared::performance[0m[2m:[0m üìä API Requests: 200 max concurrent
[2m2025-09-28T10:14:52.074662Z[0m [32m INFO[0m [2mlum_rust_ws::webhook::deduplication[0m[2m:[0m üîÑ MessageDeduplicator initialized with TTL: 300s, max_entries: 10000
[2m2025-09-28T10:14:52.074679Z[0m [32m INFO[0m [2mlum_rust_ws::shared::performance[0m[2m:[0m üî• Starting performance warm-up process...
[2m2025-09-28T10:14:52.075811Z[0m [32m INFO[0m [2mlum_rust_ws::shared::performance[0m[2m:[0m ‚úÖ Database connection verified
[2m2025-09-28T10:14:52.076107Z[0m [32m INFO[0m [2mlum_rust_ws::shared::performance[0m[2m:[0m ‚úÖ Redis connection verified
[2m2025-09-28T10:14:52.076153Z[0m [32m INFO[0m [2mlum_rust_ws::shared::performance[0m[2m:[0m üî• Performance warm-up completed
[2m2025-09-28T10:14:52.076170Z[0m [32m INFO[0m [2mlum_rust_ws[0m[2m:[0m üöÄ Application state initialized with optimized configuration
[2m2025-09-28T10:14:52.080835Z[0m [32m INFO[0m [2mlum_rust_ws[0m[2m:[0m listening on 0.0.0.0:8000
[2m2025-09-28T10:16:52.204804Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-28T10:16:52.204983Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-28T10:16:52.205086Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_history_v4[0m[2m:[0m Fetching rewards history for user_id: 1
[2m2025-09-28T10:16:52.210231Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_history_v4[0m[2m:[0m Rewards history retrieved in 5ms for user_id: 1 - 20 items
[2m2025-09-28T10:16:52.336828Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-28T10:16:52.336951Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m Getting user balance for user_id: 1
[2m2025-09-28T10:16:52.339322Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m User balance retrieved successfully for user 1 in 2ms: 287 L√ºmis
[2m2025-09-28T10:17:01.234859Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-28T10:17:01.234979Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m Getting user balance for user_id: 1
[2m2025-09-28T10:17:01.237237Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m User balance retrieved successfully for user 1 in 2ms: 287 L√ºmis
[2m2025-09-28T10:18:33.865553Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-28T10:18:33.865691Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-28T10:18:33.865778Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_history_v4[0m[2m:[0m Fetching rewards history for user_id: 1
[2m2025-09-28T10:18:33.871002Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_history_v4[0m[2m:[0m Rewards history retrieved in 5ms for user_id: 1 - 20 items
[2m2025-09-28T10:18:33.996777Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-28T10:18:33.996859Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m Getting user balance for user_id: 1
[2m2025-09-28T10:18:33.998615Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m User balance retrieved successfully for user 1 in 1ms: 287 L√ºmis
[2m2025-09-28T10:19:43.944753Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-28T10:19:43.944904Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-28T10:19:43.944990Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_history_v4[0m[2m:[0m Fetching rewards history for user_id: 1
[2m2025-09-28T10:19:43.950131Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_history_v4[0m[2m:[0m Rewards history retrieved in 5ms for user_id: 1 - 20 items
[2m2025-09-28T10:19:44.076959Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-28T10:19:44.077093Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m Getting user balance for user_id: 1
[2m2025-09-28T10:19:44.078764Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m User balance retrieved successfully for user 1 in 1ms: 287 L√ºmis
[2m2025-09-28T10:19:44.248467Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-28T10:19:44.252245Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-28T10:19:44.381850Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-28T10:19:44.390846Z[0m [32m INFO[0m [2msqlx::postgres::notice[0m[2m:[0m Sincronizado: Usuario 1 gan√≥ 2 puntos por daily_login (accumulation_id: 2)
[2m2025-09-28T10:19:45.023144Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-28T10:20:04.398417Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-28T10:20:04.527716Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-28T10:20:12.637172Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-28T10:20:12.637303Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-28T10:20:12.637408Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_history_v4[0m[2m:[0m Fetching rewards history for user_id: 1
[2m2025-09-28T10:20:12.642485Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_history_v4[0m[2m:[0m Rewards history retrieved in 5ms for user_id: 1 - 20 items
[2m2025-09-28T10:20:12.766016Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-28T10:20:12.766149Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m Getting user balance for user_id: 1
[2m2025-09-28T10:20:12.767805Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m User balance retrieved successfully for user 1 in 1ms: 289 L√ºmis
[2m2025-09-28T10:20:31.822857Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-28T10:20:31.822975Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m Getting user balance for user_id: 1
[2m2025-09-28T10:20:31.824089Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m User balance retrieved successfully for user 1 in 1ms: 289 L√ºmis
[2m2025-09-28T10:21:02.948276Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-28T10:21:02.948465Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-28T10:21:02.948558Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_history_v4[0m[2m:[0m Fetching rewards history for user_id: 1
[2m2025-09-28T10:21:02.953804Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_history_v4[0m[2m:[0m Rewards history retrieved in 5ms for user_id: 1 - 20 items
[2m2025-09-28T10:21:03.102045Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-28T10:21:03.102201Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m Getting user balance for user_id: 1
[2m2025-09-28T10:21:03.104317Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m User balance retrieved successfully for user 1 in 2ms: 289 L√ºmis
[2m2025-09-28T10:21:53.269952Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-28T10:21:53.270110Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-28T10:21:53.270181Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_history_v4[0m[2m:[0m Fetching rewards history for user_id: 1
[2m2025-09-28T10:21:53.272501Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_history_v4[0m[2m:[0m Rewards history retrieved in 2ms for user_id: 1 - 20 items
[2m2025-09-28T10:21:53.462110Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-28T10:21:53.462220Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m Getting user balance for user_id: 1
[2m2025-09-28T10:21:53.463014Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m User balance retrieved successfully for user 1 in 0ms: 289 L√ºmis
[2m2025-09-28T10:21:56.383125Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-28T10:21:56.383234Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m Getting user balance for user_id: 1
[2m2025-09-28T10:21:56.384450Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m User balance retrieved successfully for user 1 in 1ms: 289 L√ºmis
[2m2025-09-28T10:24:32.644623Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-28T10:24:32.644815Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-28T10:24:32.644927Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_history_v4[0m[2m:[0m Fetching rewards history for user_id: 1
[2m2025-09-28T10:24:32.649058Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_history_v4[0m[2m:[0m Rewards history retrieved in 4ms for user_id: 1 - 20 items
[2m2025-09-28T10:24:33.509678Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-28T10:24:33.509789Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m Getting user balance for user_id: 1
[2m2025-09-28T10:24:33.511018Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m User balance retrieved successfully for user 1 in 1ms: 289 L√ºmis
[2m2025-09-28T10:30:18.425843Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-28T10:30:18.426008Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-28T10:30:18.426118Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_history_v4[0m[2m:[0m Fetching rewards history for user_id: 1
[2m2025-09-28T10:30:18.432440Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_history_v4[0m[2m:[0m Rewards history retrieved in 6ms for user_id: 1 - 20 items
[2m2025-09-28T10:30:18.556116Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-28T10:30:18.556230Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m Getting user balance for user_id: 1
[2m2025-09-28T10:30:18.558313Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m User balance retrieved successfully for user 1 in 2ms: 289 L√ºmis
[2m2025-09-28T10:56:22.668681Z[0m [32m INFO[0m [2mlum_rust_ws::api::root_v4[0m[2m:[0m Request e9b87757-cbab-4f65-bb1f-d62aeaf0e651: Root endpoint accessed
[2m2025-09-28T10:56:58.484612Z[0m [33m WARN[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m Missing Authorization header
[2m2025-09-28T11:05:22.422859Z[0m [32m INFO[0m [2mlum_rust_ws::api::root_v4[0m[2m:[0m Request 4b9b9d76-c1cb-49a4-a6b5-13fae6ab6d86: Root endpoint accessed
[2m2025-09-28T11:11:52.660498Z[0m [32m INFO[0m [2mlum_rust_ws::api::root_v4[0m[2m:[0m Request 5a18947d-4ef1-4739-98b4-6c267a7ec523: Root endpoint accessed
[2m2025-09-28T11:25:08.779875Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_registration_v4[0m[2m:[0m Request 537e0ddf-6b5b-449a-9793-f06cbd9e0305: Checking email existence: andresfelipevalenciag@gmail.com
[2m2025-09-28T11:25:08.781365Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_registration_v4[0m[2m:[0m Request 537e0ddf-6b5b-449a-9793-f06cbd9e0305: Querying database for email: andresfelipevalenciag@gmail.com
[2m2025-09-28T11:25:08.784530Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_registration_v4[0m[2m:[0m Request 537e0ddf-6b5b-449a-9793-f06cbd9e0305: Found existing user with ID: 1
[2m2025-09-28T11:25:08.784560Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_registration_v4[0m[2m:[0m Request 537e0ddf-6b5b-449a-9793-f06cbd9e0305: Email andresfelipevalenciag@gmail.com exists with password: true
[2m2025-09-28T11:25:19.029856Z[0m [32m INFO[0m [2mlum_rust_ws::api::unified_auth_v4[0m[2m:[0m üîê Unified authentication request received [3mprovider[0m[2m=[0mEmail [3mcreate_if_not_exists[0m[2m=[0mfalse [3mhas_linking_token[0m[2m=[0mfalse
[2m2025-09-28T11:25:19.029978Z[0m [32m INFO[0m [2mlum_rust_ws::services::unified_auth_simple[0m[2m:[0m üöÄ Starting unified authentication [3mrequest_id[0m[2m=[0ma60276c1-33d6-489b-b2da-5b29ee6b9837 [3mprovider[0m[2m=[0mEmail { email: "andresfelipevalenciag@gmail.com", password: "fcxbna", name: None }
[2m2025-09-28T11:25:19.030000Z[0m [32m INFO[0m [2mlum_rust_ws::services::unified_auth_simple[0m[2m:[0m üîë Email authentication [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-28T11:25:19.037615Z[0m [32m INFO[0m [2mlum_rust_ws::services::unified_auth_simple[0m[2m:[0m üìù Auth event logged to database [3mrequest_id[0m[2m=[0ma60276c1-33d6-489b-b2da-5b29ee6b9837 [3mevent_type[0m[2m=[0mlogin_attempt [3msuccess[0m[2m=[0mtrue
[2m2025-09-28T11:25:19.967158Z[0m [32m INFO[0m [2mlum_rust_ws::services::unified_auth_simple[0m[2m:[0m üìù Auth event logged to database [3mrequest_id[0m[2m=[0ma60276c1-33d6-489b-b2da-5b29ee6b9837 [3mevent_type[0m[2m=[0mlogin_failure [3msuccess[0m[2m=[0mfalse
[2m2025-09-28T11:25:19.967221Z[0m [31mERROR[0m [2mlum_rust_ws::services::unified_auth_simple[0m[2m:[0m ‚ùå Authentication failed [3mrequest_id[0m[2m=[0ma60276c1-33d6-489b-b2da-5b29ee6b9837 [3mexecution_time_ms[0m[2m=[0m937 [3merror[0m[2m=[0mInvalid credentials
[2m2025-09-28T11:25:19.967239Z[0m [31mERROR[0m [2mlum_rust_ws::api::unified_auth_v4[0m[2m:[0m Authentication failed: Invalid credentials
[2m2025-09-28T11:27:30.141354Z[0m [33m WARN[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m Missing Authorization header
[2m2025-09-28T11:27:34.786536Z[0m [33m WARN[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m Missing Authorization header
[2m2025-09-28T11:27:38.983315Z[0m [33m WARN[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m Missing Authorization header
[2m2025-09-28T11:27:46.313914Z[0m [33m WARN[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m Missing Authorization header
[2m2025-09-28T11:27:52.288043Z[0m [33m WARN[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m Missing Authorization header
[2m2025-09-28T11:27:59.174249Z[0m [33m WARN[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m Missing Authorization header
[2m2025-09-28T11:28:07.152806Z[0m [33m WARN[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m Missing Authorization header
[2m2025-09-28T11:28:12.084560Z[0m [33m WARN[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m Missing Authorization header
[2m2025-09-28T11:28:16.577633Z[0m [33m WARN[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m Missing Authorization header
[2m2025-09-28T11:28:39.930988Z[0m [33m WARN[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m Missing Authorization header
[2m2025-09-28T12:51:23.995633Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-28T12:51:23.995766Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-28T12:51:23.995828Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m Fetching user data for user_id: 1
[2m2025-09-28T12:51:23.998313Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m User data retrieved in 2ms for user_id: 1 - email: Some("andresfelipevalenciag@gmail.com")
[2m2025-09-28T12:51:24.195594Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-28T12:51:24.195710Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m Getting user balance for user_id: 1
[2m2025-09-28T12:51:24.197669Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m User balance retrieved successfully for user 1 in 1ms: 289 L√ºmis
[2m2025-09-28T12:51:24.720559Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-28T12:51:24.720769Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0m063cde87-0077-40e4-a6c0-51e674cc6f09
[2m2025-09-28T12:51:24.720789Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 063cde87-0077-40e4-a6c0-51e674cc6f09: Processing headers for user 1 with limit 50 offset 0
[2m2025-09-28T12:51:24.720858Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 063cde87-0077-40e4-a6c0-51e674cc6f09: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            '' as issuer_ruc,
            '' as issuer_dv,
            '' as issuer_address,
            '' as issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-09-28T12:51:24.725608Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 063cde87-0077-40e4-a6c0-51e674cc6f09: Retrieved 0 invoice headers (total: 0) in 4ms with enhanced filtering
[2m2025-09-28T12:51:25.030655Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-28T12:51:25.030872Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0mb83f9fc7-cfbf-4e0c-bcf0-f435e943ab56
[2m2025-09-28T12:51:25.030894Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request b83f9fc7-cfbf-4e0c-bcf0-f435e943ab56: Processing headers for user 1 with limit 50 offset 100
[2m2025-09-28T12:51:25.030917Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request b83f9fc7-cfbf-4e0c-bcf0-f435e943ab56: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            '' as issuer_ruc,
            '' as issuer_dv,
            '' as issuer_address,
            '' as issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-09-28T12:51:25.035163Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-28T12:51:25.035357Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0med0caeb6-68aa-4f6c-8ed6-4d1732336c08
[2m2025-09-28T12:51:25.035378Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request ed0caeb6-68aa-4f6c-8ed6-4d1732336c08: Processing headers for user 1 with limit 50 offset 50
[2m2025-09-28T12:51:25.035396Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request ed0caeb6-68aa-4f6c-8ed6-4d1732336c08: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            '' as issuer_ruc,
            '' as issuer_dv,
            '' as issuer_address,
            '' as issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-09-28T12:51:25.036834Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request b83f9fc7-cfbf-4e0c-bcf0-f435e943ab56: Retrieved 0 invoice headers (total: 0) in 5ms with enhanced filtering
[2m2025-09-28T12:51:25.040046Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request ed0caeb6-68aa-4f6c-8ed6-4d1732336c08: Retrieved 0 invoice headers (total: 0) in 4ms with enhanced filtering
[2m2025-09-28T12:51:25.205587Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-28T12:51:25.205806Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0me0963f21-649d-4b9c-ac96-122a50a37979
[2m2025-09-28T12:51:25.205827Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request e0963f21-649d-4b9c-ac96-122a50a37979: Processing for user 1 with limit 100 offset 0 order_by date direction DESC
[2m2025-09-28T12:51:25.205844Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request e0963f21-649d-4b9c-ac96-122a50a37979: Querying details for user 1 with enhanced filters
[2m2025-09-28T12:51:25.205888Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request e0963f21-649d-4b9c-ac96-122a50a37979: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-09-28T12:51:25.210611Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request e0963f21-649d-4b9c-ac96-122a50a37979: Retrieved 0 invoice details (total: 0) in 4ms with enhanced pagination
[2m2025-09-28T12:51:25.211578Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-28T12:51:25.211703Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0md1fc3e9c-232b-43cb-aa2a-737de8cc197f
[2m2025-09-28T12:51:25.211718Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request d1fc3e9c-232b-43cb-aa2a-737de8cc197f: Processing for user 1 with limit 100 offset 100 order_by date direction DESC
[2m2025-09-28T12:51:25.211730Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request d1fc3e9c-232b-43cb-aa2a-737de8cc197f: Querying details for user 1 with enhanced filters
[2m2025-09-28T12:51:25.211746Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request d1fc3e9c-232b-43cb-aa2a-737de8cc197f: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-09-28T12:51:25.212355Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-28T12:51:25.212472Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m092acffc-2bb0-45b2-a985-081a2f64c9b2
[2m2025-09-28T12:51:25.212488Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 092acffc-2bb0-45b2-a985-081a2f64c9b2: Processing for user 1 with limit 100 offset 200 order_by date direction DESC
[2m2025-09-28T12:51:25.212498Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 092acffc-2bb0-45b2-a985-081a2f64c9b2: Querying details for user 1 with enhanced filters
[2m2025-09-28T12:51:25.212512Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 092acffc-2bb0-45b2-a985-081a2f64c9b2: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-09-28T12:51:25.215474Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 092acffc-2bb0-45b2-a985-081a2f64c9b2: Retrieved 0 invoice details (total: 0) in 2ms with enhanced pagination
[2m2025-09-28T12:51:25.217398Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request d1fc3e9c-232b-43cb-aa2a-737de8cc197f: Retrieved 0 invoice details (total: 0) in 5ms with enhanced pagination
[2m2025-09-28T12:51:31.716024Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-28T12:51:31.720357Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-28T12:51:33.170627Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-28T12:51:33.310465Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-28T12:51:33.440427Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-28T12:51:33.588797Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-28T12:52:29.450152Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-28T12:52:29.603796Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-28T12:53:04.323114Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-28T12:53:04.323378Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-28T12:56:37.024543Z[0m [32m INFO[0m [2mlum_rust_ws::api::root_v4[0m[2m:[0m Request 4b1d6f35-75ce-43ee-ab78-cee834b6ae1d: Root endpoint accessed
[2m2025-09-28T12:56:37.289679Z[0m [33m WARN[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m Missing Authorization header
[2m2025-09-28T12:56:41.525006Z[0m [32m INFO[0m [2mlum_rust_ws::api::root_v4[0m[2m:[0m Request ec012a4e-4e0f-40e0-ace6-6196a84d5319: Root endpoint accessed
[2m2025-09-28T13:24:37.950667Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-28T13:24:37.950825Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-28T13:24:37.950886Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m Fetching user data for user_id: 1
[2m2025-09-28T13:24:37.953747Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m User data retrieved in 2ms for user_id: 1 - email: Some("andresfelipevalenciag@gmail.com")
[2m2025-09-28T13:24:38.129816Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-28T13:24:38.129926Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m Getting user balance for user_id: 1
[2m2025-09-28T13:24:38.132533Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m User balance retrieved successfully for user 1 in 2ms: 289 L√ºmis
[2m2025-09-28T13:24:38.644744Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-28T13:24:38.645034Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0mfacd07f1-6ee7-4119-a2c7-46f2ecd91b8a
[2m2025-09-28T13:24:38.645057Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request facd07f1-6ee7-4119-a2c7-46f2ecd91b8a: Processing headers for user 1 with limit 50 offset 0
[2m2025-09-28T13:24:38.645108Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request facd07f1-6ee7-4119-a2c7-46f2ecd91b8a: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            '' as issuer_ruc,
            '' as issuer_dv,
            '' as issuer_address,
            '' as issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-09-28T13:24:38.650620Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request facd07f1-6ee7-4119-a2c7-46f2ecd91b8a: Retrieved 0 invoice headers (total: 0) in 5ms with enhanced filtering
[2m2025-09-28T13:24:38.912862Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-28T13:24:38.913060Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0m42068ea0-d0df-4b96-8bc3-fae5805aae71
[2m2025-09-28T13:24:38.913079Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 42068ea0-d0df-4b96-8bc3-fae5805aae71: Processing headers for user 1 with limit 50 offset 50
[2m2025-09-28T13:24:38.913113Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 42068ea0-d0df-4b96-8bc3-fae5805aae71: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            '' as issuer_ruc,
            '' as issuer_dv,
            '' as issuer_address,
            '' as issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-09-28T13:24:38.917856Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 42068ea0-d0df-4b96-8bc3-fae5805aae71: Retrieved 0 invoice headers (total: 0) in 4ms with enhanced filtering
[2m2025-09-28T13:24:38.932399Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-28T13:24:38.932545Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0m21b01b1f-88ae-4d01-bf34-c3c2daf71e7c
[2m2025-09-28T13:24:38.932626Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 21b01b1f-88ae-4d01-bf34-c3c2daf71e7c: Processing headers for user 1 with limit 50 offset 100
[2m2025-09-28T13:24:38.932648Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 21b01b1f-88ae-4d01-bf34-c3c2daf71e7c: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            '' as issuer_ruc,
            '' as issuer_dv,
            '' as issuer_address,
            '' as issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-09-28T13:24:38.936833Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 21b01b1f-88ae-4d01-bf34-c3c2daf71e7c: Retrieved 0 invoice headers (total: 0) in 4ms with enhanced filtering
[2m2025-09-28T13:24:39.083366Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-28T13:24:39.083566Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m81b68470-4d7b-456c-b408-a4186edbd313
[2m2025-09-28T13:24:39.083604Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 81b68470-4d7b-456c-b408-a4186edbd313: Processing for user 1 with limit 100 offset 0 order_by date direction DESC
[2m2025-09-28T13:24:39.083622Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 81b68470-4d7b-456c-b408-a4186edbd313: Querying details for user 1 with enhanced filters
[2m2025-09-28T13:24:39.083645Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 81b68470-4d7b-456c-b408-a4186edbd313: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-09-28T13:24:39.088765Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 81b68470-4d7b-456c-b408-a4186edbd313: Retrieved 0 invoice details (total: 0) in 5ms with enhanced pagination
[2m2025-09-28T13:24:39.090808Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-28T13:24:39.090964Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0me79be1ee-d7c1-404d-b0fe-d0cd8890b284
[2m2025-09-28T13:24:39.090982Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request e79be1ee-d7c1-404d-b0fe-d0cd8890b284: Processing for user 1 with limit 100 offset 200 order_by date direction DESC
[2m2025-09-28T13:24:39.091009Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request e79be1ee-d7c1-404d-b0fe-d0cd8890b284: Querying details for user 1 with enhanced filters
[2m2025-09-28T13:24:39.091028Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request e79be1ee-d7c1-404d-b0fe-d0cd8890b284: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-09-28T13:24:39.092905Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-28T13:24:39.093034Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m78a96cc4-b680-44c5-ad0d-07571a3d71ad
[2m2025-09-28T13:24:39.093052Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 78a96cc4-b680-44c5-ad0d-07571a3d71ad: Processing for user 1 with limit 100 offset 100 order_by date direction DESC
[2m2025-09-28T13:24:39.093063Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 78a96cc4-b680-44c5-ad0d-07571a3d71ad: Querying details for user 1 with enhanced filters
[2m2025-09-28T13:24:39.093077Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 78a96cc4-b680-44c5-ad0d-07571a3d71ad: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-09-28T13:24:39.095830Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request e79be1ee-d7c1-404d-b0fe-d0cd8890b284: Retrieved 0 invoice details (total: 0) in 4ms with enhanced pagination
[2m2025-09-28T13:24:39.097452Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 78a96cc4-b680-44c5-ad0d-07571a3d71ad: Retrieved 0 invoice details (total: 0) in 4ms with enhanced pagination
[2m2025-09-28T13:24:51.748186Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-28T13:24:51.748356Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-28T13:24:51.748410Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m Fetching user data for user_id: 1
[2m2025-09-28T13:24:51.750928Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m User data retrieved in 2ms for user_id: 1 - email: Some("andresfelipevalenciag@gmail.com")
[2m2025-09-28T13:24:51.941752Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-28T13:24:51.941879Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m Getting user balance for user_id: 1
[2m2025-09-28T13:24:51.943784Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m User balance retrieved successfully for user 1 in 1ms: 289 L√ºmis
[2m2025-09-28T13:24:52.435803Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-28T13:24:52.436084Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0m9a931b61-d53d-4892-8af4-8e0b523533e4
[2m2025-09-28T13:24:52.436106Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 9a931b61-d53d-4892-8af4-8e0b523533e4: Processing headers for user 1 with limit 50 offset 0
[2m2025-09-28T13:24:52.436134Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 9a931b61-d53d-4892-8af4-8e0b523533e4: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            '' as issuer_ruc,
            '' as issuer_dv,
            '' as issuer_address,
            '' as issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-09-28T13:24:52.442606Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 9a931b61-d53d-4892-8af4-8e0b523533e4: Retrieved 0 invoice headers (total: 0) in 6ms with enhanced filtering
[2m2025-09-28T13:24:52.723688Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-28T13:24:52.723937Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0mda4f6c8b-cdb7-4f0e-a6b9-48b1b61316a7
[2m2025-09-28T13:24:52.723959Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request da4f6c8b-cdb7-4f0e-a6b9-48b1b61316a7: Processing headers for user 1 with limit 50 offset 100
[2m2025-09-28T13:24:52.723985Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request da4f6c8b-cdb7-4f0e-a6b9-48b1b61316a7: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            '' as issuer_ruc,
            '' as issuer_dv,
            '' as issuer_address,
            '' as issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-09-28T13:24:52.727859Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request da4f6c8b-cdb7-4f0e-a6b9-48b1b61316a7: Retrieved 0 invoice headers (total: 0) in 3ms with enhanced filtering
[2m2025-09-28T13:24:52.737756Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-28T13:24:52.737896Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0m850a91c5-f028-472e-8cf9-f2817f3cc38f
[2m2025-09-28T13:24:52.737914Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 850a91c5-f028-472e-8cf9-f2817f3cc38f: Processing headers for user 1 with limit 50 offset 50
[2m2025-09-28T13:24:52.737930Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 850a91c5-f028-472e-8cf9-f2817f3cc38f: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            '' as issuer_ruc,
            '' as issuer_dv,
            '' as issuer_address,
            '' as issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-09-28T13:24:52.740763Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 850a91c5-f028-472e-8cf9-f2817f3cc38f: Retrieved 0 invoice headers (total: 0) in 2ms with enhanced filtering
[2m2025-09-28T13:24:52.893507Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-28T13:24:52.893769Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m02171de2-2ec6-4ce4-b792-7ccc0ebffd92
[2m2025-09-28T13:24:52.893795Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 02171de2-2ec6-4ce4-b792-7ccc0ebffd92: Processing for user 1 with limit 100 offset 0 order_by date direction DESC
[2m2025-09-28T13:24:52.893816Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 02171de2-2ec6-4ce4-b792-7ccc0ebffd92: Querying details for user 1 with enhanced filters
[2m2025-09-28T13:24:52.893845Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 02171de2-2ec6-4ce4-b792-7ccc0ebffd92: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-09-28T13:24:52.896440Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 02171de2-2ec6-4ce4-b792-7ccc0ebffd92: Retrieved 0 invoice details (total: 0) in 2ms with enhanced pagination
[2m2025-09-28T13:24:52.900726Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-28T13:24:52.900899Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0mcef5981b-c402-421e-a7f0-4e4578b761d1
[2m2025-09-28T13:24:52.900925Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request cef5981b-c402-421e-a7f0-4e4578b761d1: Processing for user 1 with limit 100 offset 100 order_by date direction DESC
[2m2025-09-28T13:24:52.900945Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request cef5981b-c402-421e-a7f0-4e4578b761d1: Querying details for user 1 with enhanced filters
[2m2025-09-28T13:24:52.900978Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-28T13:24:52.900969Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request cef5981b-c402-421e-a7f0-4e4578b761d1: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-09-28T13:24:52.901101Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m32f1749c-5658-4ec2-b8a2-6a6392050052
[2m2025-09-28T13:24:52.901118Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 32f1749c-5658-4ec2-b8a2-6a6392050052: Processing for user 1 with limit 100 offset 200 order_by date direction DESC
[2m2025-09-28T13:24:52.901131Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 32f1749c-5658-4ec2-b8a2-6a6392050052: Querying details for user 1 with enhanced filters
[2m2025-09-28T13:24:52.901147Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 32f1749c-5658-4ec2-b8a2-6a6392050052: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-09-28T13:24:52.905743Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 32f1749c-5658-4ec2-b8a2-6a6392050052: Retrieved 0 invoice details (total: 0) in 4ms with enhanced pagination
[2m2025-09-28T13:24:52.907067Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request cef5981b-c402-421e-a7f0-4e4578b761d1: Retrieved 0 invoice details (total: 0) in 6ms with enhanced pagination
[2m2025-09-28T13:24:54.133850Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-28T13:24:54.405185Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-28T13:25:10.657930Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-28T13:25:14.460806Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-28T13:25:15.405847Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-28T13:25:29.012368Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-28T13:25:29.021248Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-28T13:25:29.168947Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-28T13:25:29.174529Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-28T13:37:31.741309Z[0m [32m INFO[0m [2mlum_rust_ws::api::root_v4[0m[2m:[0m Request 4cb5fe5e-73ca-450c-9565-87dc619c88ed: Root endpoint accessed
[2m2025-09-28T16:33:00.661798Z[0m [32m INFO[0m [2mlum_rust_ws::api::root_v4[0m[2m:[0m Request 16b6c8ec-e99d-49af-ad0c-2e984714b002: Root endpoint accessed
[2m2025-09-28T19:55:05.685279Z[0m [32m INFO[0m [2mlum_rust_ws::api::root_v4[0m[2m:[0m Request ef2b9065-c02c-4925-81cc-586aa525871d: Root endpoint accessed
[2m2025-09-28T20:00:25.122826Z[0m [32m INFO[0m [2mlum_rust_ws::api::root_v4[0m[2m:[0m Request ea856bbc-89fc-4830-b29a-4e95bd59aa65: Root endpoint accessed
[2m2025-09-28T20:12:34.104579Z[0m [32m INFO[0m [2mlum_rust_ws::api::root_v4[0m[2m:[0m Request f5296e41-cb38-407a-bd60-43d01c1cf4cc: Root endpoint accessed
[2m2025-09-28T21:48:41.038991Z[0m [32m INFO[0m [2mlum_rust_ws::api::root_v4[0m[2m:[0m Request baa98aad-9d2f-4fa8-8635-7515e45b0d1f: Root endpoint accessed
[2m2025-09-28T22:24:41.809924Z[0m [32m INFO[0m [2mlum_rust_ws::api::root_v4[0m[2m:[0m Request 63a06aa4-9a02-4166-b55e-b82e8f23f81f: Root endpoint accessed
[2m2025-09-28T22:24:41.815023Z[0m [33m WARN[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m Missing Authorization header
[2m2025-09-29T00:39:43.135257Z[0m [32m INFO[0m [2mlum_rust_ws::api::unified_auth_v4[0m[2m:[0m üîê Unified authentication request received [3mprovider[0m[2m=[0mGoogle [3mcreate_if_not_exists[0m[2m=[0mtrue [3mhas_linking_token[0m[2m=[0mfalse
[2m2025-09-29T00:39:43.135373Z[0m [32m INFO[0m [2mlum_rust_ws::services::unified_auth_simple[0m[2m:[0m üöÄ Starting unified authentication [3mrequest_id[0m[2m=[0ma89d223d-ce49-46bd-a118-409528346cb3 [3mprovider[0m[2m=[0mGoogle { id_token: "eyJhbGciOiJSUzI1NiIsImtpZCI6IjkyN2I4ZmI2N2JiYWQ3NzQ0NWU1ZmVhNGM3MWFhOTg0NmQ3ZGRkMDEiLCJ0eXAiOiJKV1QifQ.eyJpc3MiOiJodHRwczovL2FjY291bnRzLmdvb2dsZS5jb20iLCJhenAiOiI5MTY0MjMxNTU1MS1hcjQ0MzVhb2lzcDA5NzVvbmc4cmNpZHRuYm1pYzJnMS5hcHBzLmdvb2dsZXVzZXJjb250ZW50LmNvbSIsImF1ZCI6IjkxNjQyMzE1NTUxLXZjcXRkYTFsY2ZvYWcwbWVqdWJsMTU3aXV2NHE4c3JpLmFwcHMuZ29vZ2xldXNlcmNvbnRlbnQuY29tIiwic3ViIjoiMTA2MDYzOTM2NDI0NDM3NjIxMDgwIiwiZW1haWwiOiJhbmRyZXNmZWxpcGV2YWxlbmNpYWdAZ21haWwuY29tIiwiZW1haWxfdmVyaWZpZWQiOnRydWUsIm5hbWUiOiJBbmRyZXMgVmFsZW5jaWEiLCJwaWN0dXJlIjoiaHR0cHM6Ly9saDMuZ29vZ2xldXNlcmNvbnRlbnQuY29tL2EvQUNnOG9jSk9Xd083eUdDWVA1OHB4ZFZCd2R6MGJudWtITHdwcjk0RklVbGNEckxHYnVrYUFBPXM5Ni1jIiwiZ2l2ZW5fbmFtZSI6IkFuZHJlcyIsImZhbWlseV9uYW1lIjoiVmFsZW5jaWEiLCJpYXQiOjE3NTkxMDYzNzYsImV4cCI6MTc1OTEwOTk3Nn0.enZcVS5bdt2tKWInNI18TeLG8UqkF_ey1GhJdXaJ0438dgsV7gmIYr3wyPR-1_Ghyayv4HfJeXBYld4Exew-u8_nvIAMLUmvx2AIEfVud49yCB4wZiuBQrip2FGCLLRbGW9tQ34ZyRTwV-2Lg9iX_oI3FQe0AM_6NsfvxBB66hKREXcTGxs89MuCjPDEs8RF-WFcOKPE9dBv4xXLiEerGW3d_Rw8ahD5feSkBMuuGhLlmp74Nk_7-vyl69J3viQM9qc75B6n11-Ef6XuftFOKtMHEESnBtcO3Gxpa3ZhUeJrP7lWqgECQha4T83I2vAeCmCJTF6uPGIsOXzqqSnXpA", access_token: None }
[2m2025-09-29T00:39:43.135406Z[0m [32m INFO[0m [2mlum_rust_ws::services::unified_auth_simple[0m[2m:[0m üîë Google authentication
[2m2025-09-29T00:39:43.145098Z[0m [32m INFO[0m [2mlum_rust_ws::services::unified_auth_simple[0m[2m:[0m üìù Auth event logged to database [3mrequest_id[0m[2m=[0ma89d223d-ce49-46bd-a118-409528346cb3 [3mevent_type[0m[2m=[0mgoogle_auth [3msuccess[0m[2m=[0mtrue
[2m2025-09-29T00:39:43.145191Z[0m [32m INFO[0m [2mlum_rust_ws::services::google_service[0m[2m:[0m üîç Starting Google ID token validation [3mrequest_id[0m[2m=[0m3d1c7302-78f5-46ce-9ae6-2973bcb5e16c
[2m2025-09-29T00:39:43.146745Z[0m [32m INFO[0m [2mlum_rust_ws::services::google_service[0m[2m:[0m ‚úÖ Google ID token validated successfully [3mrequest_id[0m[2m=[0m3d1c7302-78f5-46ce-9ae6-2973bcb5e16c [3muser_id[0m[2m=[0m106063936424437621080 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com [3mname[0m[2m=[0mSome("Andres Valencia") [3memail_verified[0m[2m=[0mtrue [3mexecution_time_ms[0m[2m=[0m1
[2m2025-09-29T00:39:43.153406Z[0m [32m INFO[0m [2mlum_rust_ws::services::token_service[0m[2m:[0m üîë Generated access token successfully [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com [3mexpires_at[0m[2m=[0m2025-09-30 00:39:43.153313092 UTC
[2m2025-09-29T00:39:43.158360Z[0m [32m INFO[0m [2mlum_rust_ws::services::unified_auth_simple[0m[2m:[0m üìù Auth event logged to database [3mrequest_id[0m[2m=[0ma89d223d-ce49-46bd-a118-409528346cb3 [3mevent_type[0m[2m=[0mlogin_success [3msuccess[0m[2m=[0mtrue
[2m2025-09-29T00:39:43.158414Z[0m [32m INFO[0m [2mlum_rust_ws::services::unified_auth_simple[0m[2m:[0m ‚úÖ Authentication successful [3mrequest_id[0m[2m=[0ma89d223d-ce49-46bd-a118-409528346cb3 [3mexecution_time_ms[0m[2m=[0m23
[2m2025-09-29T00:39:44.539272Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-29T00:39:44.539519Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-29T00:39:44.539599Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m Fetching user data for user_id: 1
[2m2025-09-29T00:39:44.542215Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m User data retrieved in 2ms for user_id: 1 - email: Some("andresfelipevalenciag@gmail.com")
[2m2025-09-29T00:39:44.543542Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-29T00:39:44.543662Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m Getting user balance for user_id: 1
[2m2025-09-29T00:39:44.545530Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m User balance retrieved successfully for user 1 in 1ms: 289 L√ºmis
[2m2025-09-29T00:39:50.571914Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-29T00:39:50.667344Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-29T00:39:50.762033Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-29T00:39:50.779301Z[0m [32m INFO[0m [2msqlx::postgres::notice[0m[2m:[0m Sincronizado: Usuario 1 gan√≥ 2 puntos por daily_login (accumulation_id: 2)
[2m2025-09-29T00:39:51.489602Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-29T00:41:17.242530Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-29T00:41:17.243935Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-29T00:41:17.454970Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-29T00:41:17.462000Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-29T00:41:17.720069Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-29T00:41:17.720313Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0m1032c8fc-8c99-4d7e-96ee-52531aa5bf82
[2m2025-09-29T00:41:17.720376Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 1032c8fc-8c99-4d7e-96ee-52531aa5bf82: Processing headers for user 1 with limit 50 offset 0
[2m2025-09-29T00:41:17.720415Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 1032c8fc-8c99-4d7e-96ee-52531aa5bf82: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            '' as issuer_ruc,
            '' as issuer_dv,
            '' as issuer_address,
            '' as issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-09-29T00:41:17.721254Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-29T00:41:17.721439Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0m0d8a6247-05fe-4ead-94f1-9c11393cae8a
[2m2025-09-29T00:41:17.721482Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 0d8a6247-05fe-4ead-94f1-9c11393cae8a: Processing headers for user 1 with limit 50 offset 50
[2m2025-09-29T00:41:17.721512Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 0d8a6247-05fe-4ead-94f1-9c11393cae8a: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            '' as issuer_ruc,
            '' as issuer_dv,
            '' as issuer_address,
            '' as issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-09-29T00:41:17.729421Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 0d8a6247-05fe-4ead-94f1-9c11393cae8a: Retrieved 50 invoice headers (total: 334) in 7ms with enhanced filtering
[2m2025-09-29T00:41:17.743217Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 1032c8fc-8c99-4d7e-96ee-52531aa5bf82: Retrieved 50 invoice headers (total: 334) in 22ms with enhanced filtering
[2m2025-09-29T00:41:18.022440Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-29T00:41:18.022635Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0m316ea4b4-2db4-441c-a3a3-168da54a613d
[2m2025-09-29T00:41:18.022669Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 316ea4b4-2db4-441c-a3a3-168da54a613d: Processing headers for user 1 with limit 50 offset 100
[2m2025-09-29T00:41:18.022698Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 316ea4b4-2db4-441c-a3a3-168da54a613d: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            '' as issuer_ruc,
            '' as issuer_dv,
            '' as issuer_address,
            '' as issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-09-29T00:41:18.031382Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 316ea4b4-2db4-441c-a3a3-168da54a613d: Retrieved 50 invoice headers (total: 334) in 8ms with enhanced filtering
[2m2025-09-29T00:41:21.622106Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-29T00:41:21.622444Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0mb347f149-f08f-4703-a5af-5d843da18465
[2m2025-09-29T00:41:21.622511Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request b347f149-f08f-4703-a5af-5d843da18465: Processing headers for user 1 with limit 50 offset 150
[2m2025-09-29T00:41:21.622558Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request b347f149-f08f-4703-a5af-5d843da18465: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            '' as issuer_ruc,
            '' as issuer_dv,
            '' as issuer_address,
            '' as issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-09-29T00:41:21.632284Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request b347f149-f08f-4703-a5af-5d843da18465: Retrieved 50 invoice headers (total: 334) in 9ms with enhanced filtering
[2m2025-09-29T00:41:21.917743Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-29T00:41:21.918023Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0mbd98e848-ad63-4121-ae7c-064926526b1b
[2m2025-09-29T00:41:21.918064Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request bd98e848-ad63-4121-ae7c-064926526b1b: Processing headers for user 1 with limit 50 offset 200
[2m2025-09-29T00:41:21.918104Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request bd98e848-ad63-4121-ae7c-064926526b1b: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            '' as issuer_ruc,
            '' as issuer_dv,
            '' as issuer_address,
            '' as issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-09-29T00:41:21.921900Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-29T00:41:21.922171Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0m968e2671-8389-42ee-a248-536075220e81
[2m2025-09-29T00:41:21.922224Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 968e2671-8389-42ee-a248-536075220e81: Processing headers for user 1 with limit 50 offset 250
[2m2025-09-29T00:41:21.922279Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 968e2671-8389-42ee-a248-536075220e81: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            '' as issuer_ruc,
            '' as issuer_dv,
            '' as issuer_address,
            '' as issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-09-29T00:41:21.934080Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request bd98e848-ad63-4121-ae7c-064926526b1b: Retrieved 50 invoice headers (total: 334) in 16ms with enhanced filtering
[2m2025-09-29T00:41:21.939290Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 968e2671-8389-42ee-a248-536075220e81: Retrieved 50 invoice headers (total: 334) in 17ms with enhanced filtering
[2m2025-09-29T00:41:22.369575Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-29T00:41:22.369954Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0m17328cec-4fed-41ef-a673-6889811db265
[2m2025-09-29T00:41:22.370014Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 17328cec-4fed-41ef-a673-6889811db265: Processing headers for user 1 with limit 50 offset 300
[2m2025-09-29T00:41:22.370055Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 17328cec-4fed-41ef-a673-6889811db265: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            '' as issuer_ruc,
            '' as issuer_dv,
            '' as issuer_address,
            '' as issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-09-29T00:41:22.371665Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-29T00:41:22.371862Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0m91de020c-d0cb-4be8-8fd7-9d5ac23bdcb7
[2m2025-09-29T00:41:22.371886Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 91de020c-d0cb-4be8-8fd7-9d5ac23bdcb7: Processing headers for user 1 with limit 50 offset 350
[2m2025-09-29T00:41:22.371907Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 91de020c-d0cb-4be8-8fd7-9d5ac23bdcb7: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            '' as issuer_ruc,
            '' as issuer_dv,
            '' as issuer_address,
            '' as issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-09-29T00:41:22.375860Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-29T00:41:22.376037Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0m04220857-e707-4799-b317-856f507aa94c
[2m2025-09-29T00:41:22.376062Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 04220857-e707-4799-b317-856f507aa94c: Processing headers for user 1 with limit 50 offset 400
[2m2025-09-29T00:41:22.376521Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 04220857-e707-4799-b317-856f507aa94c: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            '' as issuer_ruc,
            '' as issuer_dv,
            '' as issuer_address,
            '' as issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-09-29T00:41:22.379652Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 17328cec-4fed-41ef-a673-6889811db265: Retrieved 34 invoice headers (total: 334) in 9ms with enhanced filtering
[2m2025-09-29T00:41:22.385591Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 91de020c-d0cb-4be8-8fd7-9d5ac23bdcb7: Retrieved 0 invoice headers (total: 334) in 13ms with enhanced filtering
[2m2025-09-29T00:41:22.388756Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 04220857-e707-4799-b317-856f507aa94c: Retrieved 0 invoice headers (total: 334) in 12ms with enhanced filtering
[2m2025-09-29T00:41:22.730935Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-29T00:41:22.731248Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0mc681bd5a-fb9e-4e9d-a5a7-9bb2ce173f3b
[2m2025-09-29T00:41:22.731300Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request c681bd5a-fb9e-4e9d-a5a7-9bb2ce173f3b: Processing headers for user 1 with limit 50 offset 450
[2m2025-09-29T00:41:22.731348Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request c681bd5a-fb9e-4e9d-a5a7-9bb2ce173f3b: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            '' as issuer_ruc,
            '' as issuer_dv,
            '' as issuer_address,
            '' as issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-09-29T00:41:22.732893Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-29T00:41:22.733152Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0m00139fa6-ae74-49f4-bfca-adf7371be7c8
[2m2025-09-29T00:41:22.733189Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 00139fa6-ae74-49f4-bfca-adf7371be7c8: Processing headers for user 1 with limit 50 offset 500
[2m2025-09-29T00:41:22.733237Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 00139fa6-ae74-49f4-bfca-adf7371be7c8: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            '' as issuer_ruc,
            '' as issuer_dv,
            '' as issuer_address,
            '' as issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-09-29T00:41:22.735324Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-29T00:41:22.735492Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0m71635600-f558-4ec6-84ec-826ec1a6b521
[2m2025-09-29T00:41:22.735520Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 71635600-f558-4ec6-84ec-826ec1a6b521: Processing headers for user 1 with limit 50 offset 550
[2m2025-09-29T00:41:22.735541Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 71635600-f558-4ec6-84ec-826ec1a6b521: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            '' as issuer_ruc,
            '' as issuer_dv,
            '' as issuer_address,
            '' as issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-09-29T00:41:22.739419Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request c681bd5a-fb9e-4e9d-a5a7-9bb2ce173f3b: Retrieved 0 invoice headers (total: 334) in 8ms with enhanced filtering
[2m2025-09-29T00:41:22.740891Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 00139fa6-ae74-49f4-bfca-adf7371be7c8: Retrieved 0 invoice headers (total: 334) in 7ms with enhanced filtering
[2m2025-09-29T00:41:22.743686Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 71635600-f558-4ec6-84ec-826ec1a6b521: Retrieved 0 invoice headers (total: 334) in 8ms with enhanced filtering
[2m2025-09-29T00:41:22.903222Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-29T00:41:22.903435Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m62d5cb7f-8263-49ac-b359-e31aa9f811a1
[2m2025-09-29T00:41:22.903482Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 62d5cb7f-8263-49ac-b359-e31aa9f811a1: Processing for user 1 with limit 100 offset 0 order_by date direction DESC
[2m2025-09-29T00:41:22.903505Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 62d5cb7f-8263-49ac-b359-e31aa9f811a1: Querying details for user 1 with enhanced filters
[2m2025-09-29T00:41:22.903537Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 62d5cb7f-8263-49ac-b359-e31aa9f811a1: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-09-29T00:41:22.906472Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-29T00:41:22.906738Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0meae67c17-d33d-4bdf-bdee-0c481ab1f609
[2m2025-09-29T00:41:22.906773Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request eae67c17-d33d-4bdf-bdee-0c481ab1f609: Processing for user 1 with limit 100 offset 100 order_by date direction DESC
[2m2025-09-29T00:41:22.906796Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request eae67c17-d33d-4bdf-bdee-0c481ab1f609: Querying details for user 1 with enhanced filters
[2m2025-09-29T00:41:22.906831Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request eae67c17-d33d-4bdf-bdee-0c481ab1f609: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-09-29T00:41:22.908801Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-29T00:41:22.909055Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m0dd0fac1-5315-4b67-af0a-3432843e144c
[2m2025-09-29T00:41:22.909164Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 0dd0fac1-5315-4b67-af0a-3432843e144c: Processing for user 1 with limit 100 offset 200 order_by date direction DESC
[2m2025-09-29T00:41:22.909360Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 0dd0fac1-5315-4b67-af0a-3432843e144c: Querying details for user 1 with enhanced filters
[2m2025-09-29T00:41:22.909502Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 0dd0fac1-5315-4b67-af0a-3432843e144c: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-09-29T00:41:22.912825Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 62d5cb7f-8263-49ac-b359-e31aa9f811a1: Retrieved 100 invoice details (total: 2526) in 9ms with enhanced pagination
[2m2025-09-29T00:41:22.915364Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request eae67c17-d33d-4bdf-bdee-0c481ab1f609: Retrieved 100 invoice details (total: 2526) in 8ms with enhanced pagination
[2m2025-09-29T00:41:22.918537Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 0dd0fac1-5315-4b67-af0a-3432843e144c: Retrieved 100 invoice details (total: 2526) in 9ms with enhanced pagination
[2m2025-09-29T00:41:23.583156Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-29T00:41:23.583486Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0mf2cc6740-20fe-434f-beda-92c349bf38f8
[2m2025-09-29T00:41:23.583534Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request f2cc6740-20fe-434f-beda-92c349bf38f8: Processing for user 1 with limit 100 offset 300 order_by date direction DESC
[2m2025-09-29T00:41:23.583555Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request f2cc6740-20fe-434f-beda-92c349bf38f8: Querying details for user 1 with enhanced filters
[2m2025-09-29T00:41:23.583580Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request f2cc6740-20fe-434f-beda-92c349bf38f8: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-09-29T00:41:23.586530Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-29T00:41:23.586736Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m389b82e9-9b26-4aa3-8ecb-c9aa39f74022
[2m2025-09-29T00:41:23.586772Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 389b82e9-9b26-4aa3-8ecb-c9aa39f74022: Processing for user 1 with limit 100 offset 500 order_by date direction DESC
[2m2025-09-29T00:41:23.586790Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 389b82e9-9b26-4aa3-8ecb-c9aa39f74022: Querying details for user 1 with enhanced filters
[2m2025-09-29T00:41:23.586816Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 389b82e9-9b26-4aa3-8ecb-c9aa39f74022: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-09-29T00:41:23.590352Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-29T00:41:23.590588Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m08db8053-99b9-4d30-8113-537e08b5fcc0
[2m2025-09-29T00:41:23.590618Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 08db8053-99b9-4d30-8113-537e08b5fcc0: Processing for user 1 with limit 100 offset 400 order_by date direction DESC
[2m2025-09-29T00:41:23.590635Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 08db8053-99b9-4d30-8113-537e08b5fcc0: Querying details for user 1 with enhanced filters
[2m2025-09-29T00:41:23.590657Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 08db8053-99b9-4d30-8113-537e08b5fcc0: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-09-29T00:41:23.591846Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request f2cc6740-20fe-434f-beda-92c349bf38f8: Retrieved 100 invoice details (total: 2526) in 8ms with enhanced pagination
[2m2025-09-29T00:41:23.594256Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 389b82e9-9b26-4aa3-8ecb-c9aa39f74022: Retrieved 100 invoice details (total: 2526) in 7ms with enhanced pagination
[2m2025-09-29T00:41:23.597619Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 08db8053-99b9-4d30-8113-537e08b5fcc0: Retrieved 100 invoice details (total: 2526) in 7ms with enhanced pagination
[2m2025-09-29T00:41:24.255931Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-29T00:41:24.256149Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0mdf48875a-6c22-4fb2-8075-20b0d45137ae
[2m2025-09-29T00:41:24.256188Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request df48875a-6c22-4fb2-8075-20b0d45137ae: Processing for user 1 with limit 100 offset 600 order_by date direction DESC
[2m2025-09-29T00:41:24.256222Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request df48875a-6c22-4fb2-8075-20b0d45137ae: Querying details for user 1 with enhanced filters
[2m2025-09-29T00:41:24.256251Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request df48875a-6c22-4fb2-8075-20b0d45137ae: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-09-29T00:41:24.260458Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-29T00:41:24.260673Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m880e97cd-b346-4d39-9dd6-5068078045b7
[2m2025-09-29T00:41:24.260704Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 880e97cd-b346-4d39-9dd6-5068078045b7: Processing for user 1 with limit 100 offset 700 order_by date direction DESC
[2m2025-09-29T00:41:24.260726Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 880e97cd-b346-4d39-9dd6-5068078045b7: Querying details for user 1 with enhanced filters
[2m2025-09-29T00:41:24.260760Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 880e97cd-b346-4d39-9dd6-5068078045b7: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-09-29T00:41:24.261542Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-29T00:41:24.261663Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0mc557c96e-adf1-476e-81a3-121e284cb5a8
[2m2025-09-29T00:41:24.261689Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request c557c96e-adf1-476e-81a3-121e284cb5a8: Processing for user 1 with limit 100 offset 800 order_by date direction DESC
[2m2025-09-29T00:41:24.261720Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request c557c96e-adf1-476e-81a3-121e284cb5a8: Querying details for user 1 with enhanced filters
[2m2025-09-29T00:41:24.261754Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request c557c96e-adf1-476e-81a3-121e284cb5a8: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-09-29T00:41:24.266472Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 880e97cd-b346-4d39-9dd6-5068078045b7: Retrieved 100 invoice details (total: 2526) in 5ms with enhanced pagination
[2m2025-09-29T00:41:24.267069Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request df48875a-6c22-4fb2-8075-20b0d45137ae: Retrieved 100 invoice details (total: 2526) in 10ms with enhanced pagination
[2m2025-09-29T00:41:24.270671Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request c557c96e-adf1-476e-81a3-121e284cb5a8: Retrieved 100 invoice details (total: 2526) in 9ms with enhanced pagination
[2m2025-09-29T00:41:24.889667Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-29T00:41:24.889874Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m1b64ca2a-c5a3-4d96-96d3-239a0d3e4fcf
[2m2025-09-29T00:41:24.889909Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 1b64ca2a-c5a3-4d96-96d3-239a0d3e4fcf: Processing for user 1 with limit 100 offset 900 order_by date direction DESC
[2m2025-09-29T00:41:24.889928Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 1b64ca2a-c5a3-4d96-96d3-239a0d3e4fcf: Querying details for user 1 with enhanced filters
[2m2025-09-29T00:41:24.889953Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 1b64ca2a-c5a3-4d96-96d3-239a0d3e4fcf: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-09-29T00:41:24.897297Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 1b64ca2a-c5a3-4d96-96d3-239a0d3e4fcf: Retrieved 100 invoice details (total: 2526) in 7ms with enhanced pagination
[2m2025-09-29T00:41:24.901738Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-29T00:41:24.901931Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0ma5610ee4-58a3-4a67-be38-99911a7a33f9
[2m2025-09-29T00:41:24.901972Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request a5610ee4-58a3-4a67-be38-99911a7a33f9: Processing for user 1 with limit 100 offset 1000 order_by date direction DESC
[2m2025-09-29T00:41:24.902000Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request a5610ee4-58a3-4a67-be38-99911a7a33f9: Querying details for user 1 with enhanced filters
[2m2025-09-29T00:41:24.902026Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request a5610ee4-58a3-4a67-be38-99911a7a33f9: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-09-29T00:41:24.902879Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-29T00:41:24.903130Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m6b4b0a44-21a3-4023-bb24-4415089f6cfd
[2m2025-09-29T00:41:24.903256Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 6b4b0a44-21a3-4023-bb24-4415089f6cfd: Processing for user 1 with limit 100 offset 1100 order_by date direction DESC
[2m2025-09-29T00:41:24.903420Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 6b4b0a44-21a3-4023-bb24-4415089f6cfd: Querying details for user 1 with enhanced filters
[2m2025-09-29T00:41:24.903552Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 6b4b0a44-21a3-4023-bb24-4415089f6cfd: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-09-29T00:41:24.910822Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request a5610ee4-58a3-4a67-be38-99911a7a33f9: Retrieved 100 invoice details (total: 2526) in 8ms with enhanced pagination
[2m2025-09-29T00:41:24.915553Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 6b4b0a44-21a3-4023-bb24-4415089f6cfd: Retrieved 100 invoice details (total: 2526) in 12ms with enhanced pagination
[2m2025-09-29T00:41:25.500140Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-29T00:41:25.500386Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m21b992e4-ae63-4e54-a7ea-d2fcf15dbeeb
[2m2025-09-29T00:41:25.500423Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 21b992e4-ae63-4e54-a7ea-d2fcf15dbeeb: Processing for user 1 with limit 100 offset 1200 order_by date direction DESC
[2m2025-09-29T00:41:25.500441Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 21b992e4-ae63-4e54-a7ea-d2fcf15dbeeb: Querying details for user 1 with enhanced filters
[2m2025-09-29T00:41:25.500464Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 21b992e4-ae63-4e54-a7ea-d2fcf15dbeeb: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-09-29T00:41:25.506459Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 21b992e4-ae63-4e54-a7ea-d2fcf15dbeeb: Retrieved 100 invoice details (total: 2526) in 6ms with enhanced pagination
[2m2025-09-29T00:41:25.511836Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-29T00:41:25.511979Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m50f793aa-8721-4082-8157-dfe526af3ab2
[2m2025-09-29T00:41:25.512005Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 50f793aa-8721-4082-8157-dfe526af3ab2: Processing for user 1 with limit 100 offset 1300 order_by date direction DESC
[2m2025-09-29T00:41:25.512018Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 50f793aa-8721-4082-8157-dfe526af3ab2: Querying details for user 1 with enhanced filters
[2m2025-09-29T00:41:25.512034Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 50f793aa-8721-4082-8157-dfe526af3ab2: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-09-29T00:41:25.512259Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-29T00:41:25.512411Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0md5013ba0-a42e-460a-abad-76d4056879e2
[2m2025-09-29T00:41:25.512444Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request d5013ba0-a42e-460a-abad-76d4056879e2: Processing for user 1 with limit 100 offset 1400 order_by date direction DESC
[2m2025-09-29T00:41:25.512458Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request d5013ba0-a42e-460a-abad-76d4056879e2: Querying details for user 1 with enhanced filters
[2m2025-09-29T00:41:25.512475Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request d5013ba0-a42e-460a-abad-76d4056879e2: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-09-29T00:41:25.519278Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 50f793aa-8721-4082-8157-dfe526af3ab2: Retrieved 100 invoice details (total: 2526) in 7ms with enhanced pagination
[2m2025-09-29T00:41:25.523718Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request d5013ba0-a42e-460a-abad-76d4056879e2: Retrieved 100 invoice details (total: 2526) in 11ms with enhanced pagination
[2m2025-09-29T00:41:26.139841Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-29T00:41:26.140050Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0maa242159-02c2-4fb5-a8af-190396a82931
[2m2025-09-29T00:41:26.140088Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request aa242159-02c2-4fb5-a8af-190396a82931: Processing for user 1 with limit 100 offset 1500 order_by date direction DESC
[2m2025-09-29T00:41:26.140107Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request aa242159-02c2-4fb5-a8af-190396a82931: Querying details for user 1 with enhanced filters
[2m2025-09-29T00:41:26.140138Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request aa242159-02c2-4fb5-a8af-190396a82931: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-09-29T00:41:26.147352Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request aa242159-02c2-4fb5-a8af-190396a82931: Retrieved 100 invoice details (total: 2526) in 7ms with enhanced pagination
[2m2025-09-29T00:41:26.151960Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-29T00:41:26.152095Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m9112641d-1c0f-4713-9820-6e968d52e237
[2m2025-09-29T00:41:26.152120Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 9112641d-1c0f-4713-9820-6e968d52e237: Processing for user 1 with limit 100 offset 1600 order_by date direction DESC
[2m2025-09-29T00:41:26.152134Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 9112641d-1c0f-4713-9820-6e968d52e237: Querying details for user 1 with enhanced filters
[2m2025-09-29T00:41:26.152149Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 9112641d-1c0f-4713-9820-6e968d52e237: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-09-29T00:41:26.152460Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-29T00:41:26.152609Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0mfc67fab9-273c-4811-8934-3fa7a7c612ba
[2m2025-09-29T00:41:26.152640Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request fc67fab9-273c-4811-8934-3fa7a7c612ba: Processing for user 1 with limit 100 offset 1700 order_by date direction DESC
[2m2025-09-29T00:41:26.152656Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request fc67fab9-273c-4811-8934-3fa7a7c612ba: Querying details for user 1 with enhanced filters
[2m2025-09-29T00:41:26.152673Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request fc67fab9-273c-4811-8934-3fa7a7c612ba: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-09-29T00:41:26.159241Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request fc67fab9-273c-4811-8934-3fa7a7c612ba: Retrieved 100 invoice details (total: 2526) in 6ms with enhanced pagination
[2m2025-09-29T00:41:26.163997Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 9112641d-1c0f-4713-9820-6e968d52e237: Retrieved 100 invoice details (total: 2526) in 11ms with enhanced pagination
[2m2025-09-29T00:41:26.871482Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-29T00:41:26.871709Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m6557dc40-625b-4690-91a6-83d00ece39e1
[2m2025-09-29T00:41:26.871742Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 6557dc40-625b-4690-91a6-83d00ece39e1: Processing for user 1 with limit 100 offset 1800 order_by date direction DESC
[2m2025-09-29T00:41:26.871761Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 6557dc40-625b-4690-91a6-83d00ece39e1: Querying details for user 1 with enhanced filters
[2m2025-09-29T00:41:26.871786Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 6557dc40-625b-4690-91a6-83d00ece39e1: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-09-29T00:41:26.876780Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-29T00:41:26.876967Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m80ecbbde-b764-4ad4-ae97-0f2d1bc6fba5
[2m2025-09-29T00:41:26.877094Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 80ecbbde-b764-4ad4-ae97-0f2d1bc6fba5: Processing for user 1 with limit 100 offset 1900 order_by date direction DESC
[2m2025-09-29T00:41:26.877185Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 80ecbbde-b764-4ad4-ae97-0f2d1bc6fba5: Querying details for user 1 with enhanced filters
[2m2025-09-29T00:41:26.877269Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 80ecbbde-b764-4ad4-ae97-0f2d1bc6fba5: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-09-29T00:41:26.878079Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-29T00:41:26.878269Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0mcfa4a612-23c8-44e2-9060-d1985cbf87b8
[2m2025-09-29T00:41:26.878418Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request cfa4a612-23c8-44e2-9060-d1985cbf87b8: Processing for user 1 with limit 100 offset 2000 order_by date direction DESC
[2m2025-09-29T00:41:26.878478Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request cfa4a612-23c8-44e2-9060-d1985cbf87b8: Querying details for user 1 with enhanced filters
[2m2025-09-29T00:41:26.878511Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request cfa4a612-23c8-44e2-9060-d1985cbf87b8: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-09-29T00:41:26.879613Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 6557dc40-625b-4690-91a6-83d00ece39e1: Retrieved 100 invoice details (total: 2526) in 7ms with enhanced pagination
[2m2025-09-29T00:41:26.887262Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 80ecbbde-b764-4ad4-ae97-0f2d1bc6fba5: Retrieved 100 invoice details (total: 2526) in 10ms with enhanced pagination
[2m2025-09-29T00:41:26.892090Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request cfa4a612-23c8-44e2-9060-d1985cbf87b8: Retrieved 100 invoice details (total: 2526) in 13ms with enhanced pagination
[2m2025-09-29T00:41:27.482210Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-29T00:41:27.482452Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0med83992a-eb7f-4f8b-a663-5ffd4d047085
[2m2025-09-29T00:41:27.482495Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request ed83992a-eb7f-4f8b-a663-5ffd4d047085: Processing for user 1 with limit 100 offset 2100 order_by date direction DESC
[2m2025-09-29T00:41:27.482527Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request ed83992a-eb7f-4f8b-a663-5ffd4d047085: Querying details for user 1 with enhanced filters
[2m2025-09-29T00:41:27.482558Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request ed83992a-eb7f-4f8b-a663-5ffd4d047085: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-09-29T00:41:27.484043Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-29T00:41:27.484287Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m38532bc3-934b-4cb9-8608-3058e6d0d11b
[2m2025-09-29T00:41:27.484321Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 38532bc3-934b-4cb9-8608-3058e6d0d11b: Processing for user 1 with limit 100 offset 2200 order_by date direction DESC
[2m2025-09-29T00:41:27.484368Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 38532bc3-934b-4cb9-8608-3058e6d0d11b: Querying details for user 1 with enhanced filters
[2m2025-09-29T00:41:27.484396Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 38532bc3-934b-4cb9-8608-3058e6d0d11b: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-09-29T00:41:27.485915Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-29T00:41:27.486138Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0mb3098597-a6da-4436-90ff-603f8c349a72
[2m2025-09-29T00:41:27.486353Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request b3098597-a6da-4436-90ff-603f8c349a72: Processing for user 1 with limit 100 offset 2300 order_by date direction DESC
[2m2025-09-29T00:41:27.486418Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request b3098597-a6da-4436-90ff-603f8c349a72: Querying details for user 1 with enhanced filters
[2m2025-09-29T00:41:27.486444Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request b3098597-a6da-4436-90ff-603f8c349a72: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-09-29T00:41:27.490056Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request ed83992a-eb7f-4f8b-a663-5ffd4d047085: Retrieved 100 invoice details (total: 2526) in 7ms with enhanced pagination
[2m2025-09-29T00:41:27.494794Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 38532bc3-934b-4cb9-8608-3058e6d0d11b: Retrieved 100 invoice details (total: 2526) in 10ms with enhanced pagination
[2m2025-09-29T00:41:27.494969Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request b3098597-a6da-4436-90ff-603f8c349a72: Retrieved 100 invoice details (total: 2526) in 8ms with enhanced pagination
[2m2025-09-29T00:41:28.070357Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-29T00:41:28.070594Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m7e8f7d28-f6fa-41f1-b6c7-fb3537aecdec
[2m2025-09-29T00:41:28.070638Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 7e8f7d28-f6fa-41f1-b6c7-fb3537aecdec: Processing for user 1 with limit 100 offset 2400 order_by date direction DESC
[2m2025-09-29T00:41:28.070660Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 7e8f7d28-f6fa-41f1-b6c7-fb3537aecdec: Querying details for user 1 with enhanced filters
[2m2025-09-29T00:41:28.070692Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 7e8f7d28-f6fa-41f1-b6c7-fb3537aecdec: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-09-29T00:41:28.072420Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-29T00:41:28.072626Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0mb23de473-7e8f-4bff-869e-48f6661e349c
[2m2025-09-29T00:41:28.072652Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request b23de473-7e8f-4bff-869e-48f6661e349c: Processing for user 1 with limit 100 offset 2500 order_by date direction DESC
[2m2025-09-29T00:41:28.072671Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request b23de473-7e8f-4bff-869e-48f6661e349c: Querying details for user 1 with enhanced filters
[2m2025-09-29T00:41:28.072698Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request b23de473-7e8f-4bff-869e-48f6661e349c: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-09-29T00:41:28.073639Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-29T00:41:28.073826Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0mc700f142-db6d-4a19-bebb-946109835bb1
[2m2025-09-29T00:41:28.073960Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request c700f142-db6d-4a19-bebb-946109835bb1: Processing for user 1 with limit 100 offset 2600 order_by date direction DESC
[2m2025-09-29T00:41:28.074019Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request c700f142-db6d-4a19-bebb-946109835bb1: Querying details for user 1 with enhanced filters
[2m2025-09-29T00:41:28.074078Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request c700f142-db6d-4a19-bebb-946109835bb1: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-09-29T00:41:28.078857Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 7e8f7d28-f6fa-41f1-b6c7-fb3537aecdec: Retrieved 100 invoice details (total: 2526) in 8ms with enhanced pagination
[2m2025-09-29T00:41:28.082184Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request c700f142-db6d-4a19-bebb-946109835bb1: Retrieved 0 invoice details (total: 2526) in 8ms with enhanced pagination
[2m2025-09-29T00:41:28.082563Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request b23de473-7e8f-4bff-869e-48f6661e349c: Retrieved 26 invoice details (total: 2526) in 9ms with enhanced pagination
[2m2025-09-29T00:41:28.639187Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-29T00:41:28.639563Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m8ceedc8e-f7ca-4428-a5c8-6d6a7eaef334
[2m2025-09-29T00:41:28.639605Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 8ceedc8e-f7ca-4428-a5c8-6d6a7eaef334: Processing for user 1 with limit 100 offset 2700 order_by date direction DESC
[2m2025-09-29T00:41:28.639628Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 8ceedc8e-f7ca-4428-a5c8-6d6a7eaef334: Querying details for user 1 with enhanced filters
[2m2025-09-29T00:41:28.639654Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 8ceedc8e-f7ca-4428-a5c8-6d6a7eaef334: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-09-29T00:41:28.644145Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-29T00:41:28.644319Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m49d1d6d1-1cc0-4149-b5ba-f248b94e57f5
[2m2025-09-29T00:41:28.644489Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 49d1d6d1-1cc0-4149-b5ba-f248b94e57f5: Processing for user 1 with limit 100 offset 2800 order_by date direction DESC
[2m2025-09-29T00:41:28.644549Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 49d1d6d1-1cc0-4149-b5ba-f248b94e57f5: Querying details for user 1 with enhanced filters
[2m2025-09-29T00:41:28.644606Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 49d1d6d1-1cc0-4149-b5ba-f248b94e57f5: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-09-29T00:41:28.645310Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-29T00:41:28.645532Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m73cb9f6d-96bf-4e92-9c3f-28e139883f7e
[2m2025-09-29T00:41:28.645904Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 8ceedc8e-f7ca-4428-a5c8-6d6a7eaef334: Retrieved 0 invoice details (total: 2526) in 6ms with enhanced pagination
[2m2025-09-29T00:41:28.649371Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 73cb9f6d-96bf-4e92-9c3f-28e139883f7e: Processing for user 1 with limit 100 offset 2900 order_by date direction DESC
[2m2025-09-29T00:41:28.649412Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 73cb9f6d-96bf-4e92-9c3f-28e139883f7e: Querying details for user 1 with enhanced filters
[2m2025-09-29T00:41:28.649432Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 73cb9f6d-96bf-4e92-9c3f-28e139883f7e: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-09-29T00:41:28.654298Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 49d1d6d1-1cc0-4149-b5ba-f248b94e57f5: Retrieved 0 invoice details (total: 2526) in 9ms with enhanced pagination
[2m2025-09-29T00:41:28.655356Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 73cb9f6d-96bf-4e92-9c3f-28e139883f7e: Retrieved 0 invoice details (total: 2526) in 9ms with enhanced pagination
[2m2025-09-29T00:44:23.545659Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-29T00:44:23.545838Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m Getting user balance for user_id: 1
[2m2025-09-29T00:44:23.547764Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m User balance retrieved successfully for user 1 in 1ms: 291 L√ºmis
[2m2025-09-29T00:50:47.032434Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-29T00:50:47.032652Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-29T00:50:47.032728Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m Fetching user data for user_id: 1
[2m2025-09-29T00:50:47.033439Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-29T00:50:47.033588Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m Getting user balance for user_id: 1
[2m2025-09-29T00:50:47.035171Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m User data retrieved in 2ms for user_id: 1 - email: Some("andresfelipevalenciag@gmail.com")
[2m2025-09-29T00:50:47.035985Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m User balance retrieved successfully for user 1 in 2ms: 291 L√ºmis
[2m2025-09-29T00:50:50.956494Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-29T00:50:51.112403Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-29T00:50:52.330231Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-29T01:09:22.139830Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-29T01:09:22.140004Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m Getting user balance for user_id: 1
[2m2025-09-29T01:09:22.141511Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-29T01:09:22.141651Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-29T01:09:22.141705Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m Fetching user data for user_id: 1
[2m2025-09-29T01:09:22.142351Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m User balance retrieved successfully for user 1 in 2ms: 291 L√ºmis
[2m2025-09-29T01:09:22.144139Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m User data retrieved in 2ms for user_id: 1 - email: Some("andresfelipevalenciag@gmail.com")
[2m2025-09-29T01:09:26.998950Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-29T01:09:27.151423Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-29T01:09:28.727575Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-29T01:09:30.882172Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-29T01:14:12.866246Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-29T01:14:12.866451Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m Getting user balance for user_id: 1
[2m2025-09-29T01:14:12.866272Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-29T01:14:12.867430Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-29T01:14:12.867494Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m Fetching user data for user_id: 1
[2m2025-09-29T01:14:12.868900Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m User balance retrieved successfully for user 1 in 2ms: 291 L√ºmis
[2m2025-09-29T01:14:12.871109Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m User data retrieved in 3ms for user_id: 1 - email: Some("andresfelipevalenciag@gmail.com")
[2m2025-09-29T01:14:17.527293Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-29T01:14:17.732963Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-29T01:14:18.840195Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-29T01:21:56.118684Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-29T01:21:56.118875Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-29T01:21:56.118966Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m Fetching user data for user_id: 1
[2m2025-09-29T01:21:56.121408Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-29T01:21:56.121519Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m Getting user balance for user_id: 1
[2m2025-09-29T01:21:56.122305Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m User data retrieved in 3ms for user_id: 1 - email: Some("andresfelipevalenciag@gmail.com")
[2m2025-09-29T01:21:56.124224Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m User balance retrieved successfully for user 1 in 2ms: 291 L√ºmis
[2m2025-09-29T01:21:57.805585Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-29T01:21:58.314512Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-29T01:21:59.786202Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-29T01:36:31.913366Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-29T01:36:31.913549Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m Getting user balance for user_id: 1
[2m2025-09-29T01:36:31.914942Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-29T01:36:31.915089Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-29T01:36:31.915157Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m Fetching user data for user_id: 1
[2m2025-09-29T01:36:31.915801Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m User balance retrieved successfully for user 1 in 2ms: 291 L√ºmis
[2m2025-09-29T01:36:31.917584Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m User data retrieved in 2ms for user_id: 1 - email: Some("andresfelipevalenciag@gmail.com")
[2m2025-09-29T01:36:34.879301Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-29T01:36:35.259043Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-29T01:36:36.313288Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-29T02:44:41.532549Z[0m [32m INFO[0m [2mlum_rust_ws::api::root_v4[0m[2m:[0m Request 17d478ec-8659-4c8b-8f93-34c4cf7a5f37: Root endpoint accessed
[2m2025-09-29T08:14:47.914830Z[0m [32m INFO[0m [2mlum_rust_ws::api::root_v4[0m[2m:[0m Request 58c5ba2f-8d31-4845-aed7-59557f32e89d: Root endpoint accessed
[2m2025-09-29T08:14:53.836291Z[0m [32m INFO[0m [2mlum_rust_ws::api::root_v4[0m[2m:[0m Request 8cc493f9-7b82-4302-bca5-62c0f1a03173: Root endpoint accessed
[2m2025-09-29T08:14:53.948027Z[0m [33m WARN[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m Missing Authorization header
[2m2025-09-29T08:14:59.422640Z[0m [32m INFO[0m [2mlum_rust_ws::api::root_v4[0m[2m:[0m Request 025b086c-19a1-4967-a8ec-3f9974ef38f1: Root endpoint accessed
[2m2025-09-29T08:26:17.407994Z[0m [32m INFO[0m [2mlum_rust_ws::api::root_v4[0m[2m:[0m Request 7208c1e9-7406-40f2-9d25-3f7446e39179: Root endpoint accessed
[2m2025-09-29T09:58:53.232298Z[0m [32m INFO[0m [2mlum_rust_ws::api::root_v4[0m[2m:[0m Request 830c7a12-4776-451b-a7f4-eda0674aa791: Root endpoint accessed
[2m2025-09-29T10:14:45.756648Z[0m [32m INFO[0m [2mlum_rust_ws::api::root_v4[0m[2m:[0m Request 54369a4a-12df-41d1-98d8-f8c061a95f7a: Root endpoint accessed
[2m2025-09-29T12:07:27.691612Z[0m [32m INFO[0m [2mlum_rust_ws::api::root_v4[0m[2m:[0m Request 62d6a958-ef2f-4e50-9e1f-54a26bd1a582: Root endpoint accessed
[2m2025-09-29T12:07:47.437062Z[0m [33m WARN[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m Missing Authorization header
[2m2025-09-29T12:07:51.967879Z[0m [32m INFO[0m [2mlum_rust_ws::api::root_v4[0m[2m:[0m Request 47d8229a-8060-41bc-99c7-8f065d6fa646: Root endpoint accessed
[2m2025-09-29T12:07:58.337959Z[0m [33m WARN[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m Missing Authorization header
[2m2025-09-29T12:56:15.368211Z[0m [32m INFO[0m [2mlum_rust_ws::api::root_v4[0m[2m:[0m Request dc5c97ab-2aa1-4464-a75f-844126dc2659: Root endpoint accessed
[2m2025-09-29T12:56:15.627706Z[0m [33m WARN[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m Missing Authorization header
[2m2025-09-29T12:56:17.444443Z[0m [32m INFO[0m [2mlum_rust_ws::api::root_v4[0m[2m:[0m Request 161671a3-838d-4069-92e9-d59893ffe114: Root endpoint accessed
[2m2025-09-29T12:56:17.611300Z[0m [33m WARN[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m Missing Authorization header
[2m2025-09-29T12:56:17.675661Z[0m [32m INFO[0m [2mlum_rust_ws::api::root_v4[0m[2m:[0m Request f562d94a-f741-4d4e-b7c2-136d07df901d: Root endpoint accessed
[2m2025-09-29T12:56:17.727415Z[0m [33m WARN[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m Missing Authorization header
[2m2025-09-29T12:56:17.858665Z[0m [32m INFO[0m [2mlum_rust_ws::api::root_v4[0m[2m:[0m Request 7b78b7d8-f436-4ac7-ba9c-b8585789255b: Root endpoint accessed
[2m2025-09-29T12:56:18.063646Z[0m [33m WARN[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m Missing Authorization header
[2m2025-09-29T12:56:18.266564Z[0m [33m WARN[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m Missing Authorization header
[2m2025-09-29T12:56:37.697818Z[0m [32m INFO[0m [2mlum_rust_ws::api::root_v4[0m[2m:[0m Request 51eadeec-8860-4582-9832-181eddc1a9c3: Root endpoint accessed
[2m2025-09-29T13:40:22.776141Z[0m [32m INFO[0m [2mlum_rust_ws::api::root_v4[0m[2m:[0m Request 3e62074a-ab77-403f-9d6a-373b5615ae8b: Root endpoint accessed
[2m2025-09-29T15:49:44.235804Z[0m [32m INFO[0m [2mlum_rust_ws::api::root_v4[0m[2m:[0m Request 47b0a73f-aef5-4e98-a0e9-b6184f63165c: Root endpoint accessed
[2m2025-09-29T15:49:47.202527Z[0m [32m INFO[0m [2mlum_rust_ws::api::root_v4[0m[2m:[0m Request 2292857b-2ee5-400c-949f-c1fe875e7ab3: Root endpoint accessed
[2m2025-09-29T16:00:27.600708Z[0m [32m INFO[0m [2mlum_rust_ws::api::root_v4[0m[2m:[0m Request 821e0fc3-cc46-4330-bde8-beedd1ef7847: Root endpoint accessed
[2m2025-09-29T19:10:51.681217Z[0m [32m INFO[0m [2mlum_rust_ws::api::root_v4[0m[2m:[0m Request c9342803-7055-4e98-a82f-b08a0c0fcfed: Root endpoint accessed
[2m2025-09-29T19:11:22.766619Z[0m [32m INFO[0m [2mlum_rust_ws::api::root_v4[0m[2m:[0m Request 49409a8e-0fb8-4918-997c-53a373792ef3: Root endpoint accessed
[2m2025-09-29T19:11:24.035549Z[0m [33m WARN[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m Missing Authorization header
[2m2025-09-29T19:11:24.395793Z[0m [33m WARN[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m Missing Authorization header
[2m2025-09-29T19:48:30.645886Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_registration_v4[0m[2m:[0m Request da4cd797-b355-4202-b0d6-f5d2cea552e2: Checking email existence: dummy@example.com
[2m2025-09-29T19:48:30.647170Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_registration_v4[0m[2m:[0m Request da4cd797-b355-4202-b0d6-f5d2cea552e2: Querying database for email: dummy@example.com
[2m2025-09-29T19:48:30.649928Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_registration_v4[0m[2m:[0m Request da4cd797-b355-4202-b0d6-f5d2cea552e2: No existing user found for email
[2m2025-09-29T19:48:30.649956Z[0m [32m INFO[0m [2mlum_rust_ws::api::user_registration_v4[0m[2m:[0m Request da4cd797-b355-4202-b0d6-f5d2cea552e2: Email dummy@example.com is available
[2m2025-09-29T20:30:46.498460Z[0m [32m INFO[0m [2mlum_rust_ws::api::root_v4[0m[2m:[0m Request 72d2aa62-281e-400f-abc5-2ac86e8555e6: Root endpoint accessed
[2m2025-09-29T21:23:14.079832Z[0m [32m INFO[0m [2mlum_rust_ws::api::root_v4[0m[2m:[0m Request a2250829-14b0-4cff-9d16-130d214a82eb: Root endpoint accessed
[2m2025-09-29T21:23:14.224200Z[0m [33m WARN[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m Missing Authorization header
[2m2025-09-29T21:45:42.653889Z[0m [33m WARN[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m Missing Authorization header
[2m2025-09-29T22:51:29.566771Z[0m [32m INFO[0m [2mlum_rust_ws::api::root_v4[0m[2m:[0m Request 813a7268-5376-4548-84ae-038c81541888: Root endpoint accessed
[2m2025-09-29T22:51:30.438246Z[0m [33m WARN[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m Missing Authorization header
[2m2025-09-30T00:00:56.610305Z[0m [33m WARN[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m Missing Authorization header
[2m2025-09-30T00:00:56.913524Z[0m [32m INFO[0m [2mlum_rust_ws::api::root_v4[0m[2m:[0m Request 1a570eb1-d48b-4acd-bcaf-b9058c46205a: Root endpoint accessed
[2m2025-09-30T00:00:57.685853Z[0m [32m INFO[0m [2mlum_rust_ws::api::root_v4[0m[2m:[0m Request 517d48f2-a562-49b5-8fe7-6035ef62645d: Root endpoint accessed
[2m2025-09-30T00:00:58.169714Z[0m [33m WARN[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m Missing Authorization header
[2m2025-09-30T00:05:30.614086Z[0m [32m INFO[0m [2mlum_rust_ws::api::root_v4[0m[2m:[0m Request 6ce8509f-6d3f-4c3e-a3b4-8bbd208f7367: Root endpoint accessed
[2m2025-09-30T02:38:10.821577Z[0m [32m INFO[0m [2mlum_rust_ws[0m[2m:[0m signal received, starting graceful shutdown
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.30s
     Running `target/debug/lum_rust_ws`
[2m2025-09-30T20:20:36.579414Z[0m [32m INFO[0m [2mlum_rust_ws::monitoring[0m[2m:[0m üîç Monitoring system initialized
[2m2025-09-30T20:20:36.579505Z[0m [32m INFO[0m [2mlum_rust_ws[0m[2m:[0m üîç Monitoring system initialized
[2m2025-09-30T20:20:36.579574Z[0m [32m INFO[0m [2mlum_rust_ws::optimization[0m[2m:[0m üîß Creating optimized database pool with 50 max connections
[2m2025-09-30T20:20:37.171894Z[0m [32m INFO[0m [2mlum_rust_ws::optimization[0m[2m:[0m ‚úÖ Database pool created successfully
[2m2025-09-30T20:20:37.171971Z[0m [32m INFO[0m [2mlum_rust_ws::optimization[0m[2m:[0m üîß Creating optimized Redis client
[2m2025-09-30T20:20:37.172082Z[0m [32m INFO[0m [2mlum_rust_ws::optimization[0m[2m:[0m ‚úÖ Redis client created successfully
[2m2025-09-30T20:20:37.221345Z[0m [32m INFO[0m [2mlum_rust_ws::domains::qr::service[0m[2m:[0m üöÄ Initializing optimized hybrid QR service (2-level cascade)
[2m2025-09-30T20:20:37.221390Z[0m [32m INFO[0m [2mlum_rust_ws::domains::qr::service[0m[2m:[0m üìä Expected performance: 85% success with Rust (5-15ms), 12% with Python fallback (30-50ms)
[2m2025-09-30T20:20:37.221864Z[0m [32m INFO[0m [2mlum_rust_ws::shared::performance[0m[2m:[0m üöÄ Initializing PerformanceManager with advanced configuration
[2m2025-09-30T20:20:37.221896Z[0m [32m INFO[0m [2mlum_rust_ws::shared::performance[0m[2m:[0m üìä QR Detection: 50 max concurrent
[2m2025-09-30T20:20:37.221908Z[0m [32m INFO[0m [2mlum_rust_ws::shared::performance[0m[2m:[0m üìä OCR Processing: 20 max concurrent
[2m2025-09-30T20:20:37.221917Z[0m [32m INFO[0m [2mlum_rust_ws::shared::performance[0m[2m:[0m üìä Webhook Processing: 100 max concurrent
[2m2025-09-30T20:20:37.221928Z[0m [32m INFO[0m [2mlum_rust_ws::shared::performance[0m[2m:[0m üìä API Requests: 200 max concurrent
[2m2025-09-30T20:20:37.222038Z[0m [32m INFO[0m [2mlum_rust_ws::webhook::deduplication[0m[2m:[0m üîÑ MessageDeduplicator initialized with TTL: 300s, max_entries: 10000
[2m2025-09-30T20:20:37.222064Z[0m [32m INFO[0m [2mlum_rust_ws::shared::performance[0m[2m:[0m üî• Starting performance warm-up process...
[2m2025-09-30T20:20:37.223277Z[0m [32m INFO[0m [2mlum_rust_ws::shared::performance[0m[2m:[0m ‚úÖ Database connection verified
[2m2025-09-30T20:20:37.223539Z[0m [32m INFO[0m [2mlum_rust_ws::shared::performance[0m[2m:[0m ‚úÖ Redis connection verified
[2m2025-09-30T20:20:37.223603Z[0m [32m INFO[0m [2mlum_rust_ws::shared::performance[0m[2m:[0m üî• Performance warm-up completed
[2m2025-09-30T20:20:37.223636Z[0m [32m INFO[0m [2mlum_rust_ws[0m[2m:[0m üöÄ Application state initialized with optimized configuration
[2m2025-09-30T20:20:37.228559Z[0m [32m INFO[0m [2mlum_rust_ws[0m[2m:[0m listening on 0.0.0.0:8000
[2m2025-09-30T20:46:25.633431Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-30T20:46:25.633649Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m Getting user balance for user_id: 1
[2m2025-09-30T20:46:25.636035Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m User balance retrieved successfully for user 1 in 2ms: 295 L√ºmis
[2m2025-09-30T20:46:25.638358Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-30T20:46:25.638501Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-30T20:46:25.638565Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m Fetching user data for user_id: 1
[2m2025-09-30T20:46:25.641460Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m User data retrieved in 2ms for user_id: 1 - email: Some("andresfelipevalenciag@gmail.com")
[2m2025-09-30T20:46:47.036055Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-30T20:46:47.036316Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-09-30T20:46:47.036479Z[0m [32m INFO[0m [2mlum_rust_ws::api::upload_ocr_v4[0m[2m:[0m Upload OCR request from user: 1
[2m2025-09-30T20:46:47.449688Z[0m [32m INFO[0m [2mlum_rust_ws::api::upload_ocr_v4[0m[2m:[0m Received image file: optimized_1759265205549.jpg (151619 bytes)
[2m2025-09-30T20:46:47.449808Z[0m [32m INFO[0m [2mlum_rust_ws::api::upload_ocr_v4[0m[2m:[0m Using normal mode (1) for user 1
[2m2025-09-30T20:46:47.449868Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üîç Iniciando procesamiento OCR para usuario andresfelipevalenciag@gmail.com
[2m2025-09-30T20:46:47.449922Z[0m [32m INFO[0m [2mlum_rust_ws::shared::users[0m[2m:[0m Querying user by email: andresfelipevalenciag@gmail.com
get_user_ocr_limits called for user: andresfelipevalenciag@gmail.com
[2m2025-09-30T20:46:47.455824Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üí∞ Deduciendo 5 L√ºmis del usuario andresfelipevalenciag@gmail.com para procesamiento OCR
[2m2025-09-30T20:46:47.463944Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m ü§ñ Iniciando procesamiento con Gemini OCR (mode: Normal)
[2m2025-09-30T20:46:50.195382Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üîç GEMINI RESPONSE COMPLETA: {
  "candidates": [
    {
      "avgLogprobs": -0.0027704559976146335,
      "content": {
        "parts": [
          {
            "text": "```json\n{\n  \"issuer_name\": \"FARMA VALUE\",\n  \"ruc\": \"755-247-117717\",\n  \"invoice_number\": \"TFHKC50003376-00040642\",\n  \"date\": \"2025-09-21\",\n  \"total\": 4.95,\n  \"products\": [\n    {\n      \"name\": \"Aero-OM Antiflatulento Gotas 15ml (E)\",\n      \"quantity\": 1,\n      \"unit_price\": 4.95,\n      \"total_price\": 4.95\n    }\n  ]\n}\n```"
          }
        ],
        "role": "model"
      },
      "finishReason": "STOP"
    }
  ],
  "modelVersion": "gemini-2.0-flash",
  "responseId": "t0HcaJqVKsvrz7IPqqmAyA0",
  "usageMetadata": {
    "candidatesTokenCount": 168,
    "candidatesTokensDetails": [
      {
        "modality": "TEXT",
        "tokenCount": 168
      }
    ],
    "promptTokenCount": 1495,
    "promptTokensDetails": [
      {
        "modality": "IMAGE",
        "tokenCount": 1290
      },
      {
        "modality": "TEXT",
        "tokenCount": 205
      }
    ],
    "totalTokenCount": 1663
  }
}
[2m2025-09-30T20:46:50.195561Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üîç TEXTO ORIGINAL DE GEMINI: '```json
{
  "issuer_name": "FARMA VALUE",
  "ruc": "755-247-117717",
  "invoice_number": "TFHKC50003376-00040642",
  "date": "2025-09-21",
  "total": 4.95,
  "products": [
    {
      "name": "Aero-OM Antiflatulento Gotas 15ml (E)",
      "quantity": 1,
      "unit_price": 4.95,
      "total_price": 4.95
    }
  ]
}
```'
[2m2025-09-30T20:46:50.195619Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üîç TEXTO LIMPIADO (sin markdown): '{
  "issuer_name": "FARMA VALUE",
  "ruc": "755-247-117717",
  "invoice_number": "TFHKC50003376-00040642",
  "date": "2025-09-21",
  "total": 4.95,
  "products": [
    {
      "name": "Aero-OM Antiflatulento Gotas 15ml (E)",
      "quantity": 1,
      "unit_price": 4.95,
      "total_price": 4.95
    }
  ]
}'
[2m2025-09-30T20:46:50.195704Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üîç OCR DATOS PARSEADOS:
[2m2025-09-30T20:46:50.195724Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üìÑ Issuer Name: 'FARMA VALUE'
[2m2025-09-30T20:46:50.195759Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üè¢ RUC: Some("755-247-117717")
[2m2025-09-30T20:46:50.195782Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üìÑ Invoice Number: 'TFHKC50003376-00040642'
[2m2025-09-30T20:46:50.195793Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üìÑ Date: '2025-09-21'
[2m2025-09-30T20:46:50.195803Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üìÑ Total: 4.95
[2m2025-09-30T20:46:50.195817Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üìÑ Products Count: 1
[2m2025-09-30T20:46:50.195841Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m     üõí Product 1: 'Aero-OM Antiflatulento Gotas 15ml (E)' - Qty: 1 - Price: 4.95 - Total: 4.95
[2m2025-09-30T20:46:50.195858Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m ‚úÖ OCR Gemini exitoso: FARMA VALUE
[2m2025-09-30T20:46:50.195980Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üîç VERIFICANDO DUPLICADOS:
[2m2025-09-30T20:46:50.196004Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üîç Issuer Name: 'FARMA VALUE'
[2m2025-09-30T20:46:50.196013Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üîç Invoice Number: 'TFHKC50003376-00040642'
[2m2025-09-30T20:46:50.196022Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üîç Date: '2025-09-21'
[2m2025-09-30T20:46:50.196032Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üîç User ID: 1
[2m2025-09-30T20:46:50.200598Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üìã ‚úÖ NO SE ENCONTR√ì DUPLICADO - Procediendo a guardar factura
[2m2025-09-30T20:46:50.200741Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üè∑Ô∏è CUFE generado: OCR-FARMA_VALUE-20250921-TFHKC50003376_00040642 (Comercio: FARMA_VALUE, Fecha: 20250921, N√∫mero: TFHKC50003376_00040642)
[2m2025-09-30T20:46:50.200837Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üîë Partkey asignado al producto 'Aero-OM Antiflatulento Gotas 1': OCR-FARMA_VALUE-20250921-TFHKC50003376_00040642|1
[2m2025-09-30T20:46:50.200862Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üíæ Guardando datos de factura en base de datos: OCR-FARMA_VALUE-20250921-TFHKC50003376_00040642
[2m2025-09-30T20:46:50.213475Z[0m [32m INFO[0m [2msqlx::postgres::notice[0m[2m:[0m Usuario 1, sin redenci√≥n previa, buscando desde: 2025-09-08
[2m2025-09-30T20:46:50.214202Z[0m [32m INFO[0m [2msqlx::postgres::notice[0m[2m:[0m Usuario 1, contando desde semana m√°s reciente con facturas: 2025-09-29
[2m2025-09-30T20:46:50.214802Z[0m [32m INFO[0m [2msqlx::postgres::notice[0m[2m:[0m Semana 0 (desde 2025-09-29 hasta 2025-10-05 00:00:00): facturas = t
[2m2025-09-30T20:46:50.214956Z[0m [32m INFO[0m [2msqlx::postgres::notice[0m[2m:[0m Semana 1 (desde 2025-09-22 hasta 2025-09-28 00:00:00): facturas = t
[2m2025-09-30T20:46:50.215016Z[0m [32m INFO[0m [2msqlx::postgres::notice[0m[2m:[0m Semana 2 (desde 2025-09-15 hasta 2025-09-21 00:00:00): facturas = t
[2m2025-09-30T20:46:50.215073Z[0m [32m INFO[0m [2msqlx::postgres::notice[0m[2m:[0m Semana 3 (desde 2025-09-08 hasta 2025-09-14 00:00:00): facturas = t
[2m2025-09-30T20:46:50.215129Z[0m [32m INFO[0m [2msqlx::postgres::notice[0m[2m:[0m Resultado final para usuario 1: 4 semanas consecutivas (despu√©s de redenci√≥n: <NULL>)
[2m2025-09-30T20:46:50.276112Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m ‚úÖ Datos de factura guardados exitosamente: OCR-FARMA_VALUE-20250921-TFHKC50003376_00040642
[2m2025-09-30T20:46:50.276184Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üìä OCR Attempt - User: andresfelipevalenciag@gmail.com, Status: success, Details: CUFE: OCR-FARMA_VALUE-20250921-TFHKC50003376_00040642
[2m2025-09-30T20:46:50.276226Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üìã PRODUCTOS CON PARTKEYS ASIGNADOS:
[2m2025-09-30T20:46:50.276247Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üîë Producto 1: 'Aero-OM Antiflatulento Gotas 15ml (E)' | Partkey: OCR-FARMA_VALUE-20250921-TFHKC50003376_00040642|1
[2m2025-09-30T20:46:50.276262Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m ‚úÖ Procesamiento OCR completado exitosamente para andresfelipevalenciag@gmail.com
[2m2025-09-30T20:46:50.276349Z[0m [32m INFO[0m [2mlum_rust_ws::api::upload_ocr_v4[0m[2m:[0m ‚úÖ OCR processing successful for user 1: CUFE OCR-FARMA_VALUE-20250921-TFHKC50003376_00040642
[2m2025-09-30T21:07:48.818082Z[0m [32m INFO[0m [2mlum_rust_ws[0m[2m:[0m signal received, starting graceful shutdown
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.33s
     Running `target/debug/lum_rust_ws`
[2m2025-10-01T16:10:40.423000Z[0m [32m INFO[0m [2mlum_rust_ws::monitoring[0m[2m:[0m üîç Monitoring system initialized
[2m2025-10-01T16:10:40.423070Z[0m [32m INFO[0m [2mlum_rust_ws[0m[2m:[0m üîç Monitoring system initialized
[2m2025-10-01T16:10:40.423111Z[0m [32m INFO[0m [2mlum_rust_ws::optimization[0m[2m:[0m üîß Creating optimized database pool with 50 max connections
[2m2025-10-01T16:10:40.962013Z[0m [32m INFO[0m [2mlum_rust_ws::optimization[0m[2m:[0m ‚úÖ Database pool created successfully
[2m2025-10-01T16:10:40.962095Z[0m [32m INFO[0m [2mlum_rust_ws::optimization[0m[2m:[0m üîß Creating optimized Redis client
[2m2025-10-01T16:10:40.962236Z[0m [32m INFO[0m [2mlum_rust_ws::optimization[0m[2m:[0m ‚úÖ Redis client created successfully
[2m2025-10-01T16:10:41.015052Z[0m [32m INFO[0m [2mlum_rust_ws::domains::qr::service[0m[2m:[0m üöÄ Initializing optimized hybrid QR service (2-level cascade)
[2m2025-10-01T16:10:41.015105Z[0m [32m INFO[0m [2mlum_rust_ws::domains::qr::service[0m[2m:[0m üìä Expected performance: 85% success with Rust (5-15ms), 12% with Python fallback (30-50ms)
[2m2025-10-01T16:10:41.015236Z[0m [32m INFO[0m [2mlum_rust_ws::shared::performance[0m[2m:[0m üöÄ Initializing PerformanceManager with advanced configuration
[2m2025-10-01T16:10:41.015270Z[0m [32m INFO[0m [2mlum_rust_ws::shared::performance[0m[2m:[0m üìä QR Detection: 50 max concurrent
[2m2025-10-01T16:10:41.015287Z[0m [32m INFO[0m [2mlum_rust_ws::shared::performance[0m[2m:[0m üìä OCR Processing: 20 max concurrent
[2m2025-10-01T16:10:41.015303Z[0m [32m INFO[0m [2mlum_rust_ws::shared::performance[0m[2m:[0m üìä Webhook Processing: 100 max concurrent
[2m2025-10-01T16:10:41.015317Z[0m [32m INFO[0m [2mlum_rust_ws::shared::performance[0m[2m:[0m üìä API Requests: 200 max concurrent
[2m2025-10-01T16:10:41.015455Z[0m [32m INFO[0m [2mlum_rust_ws::webhook::deduplication[0m[2m:[0m üîÑ MessageDeduplicator initialized with TTL: 300s, max_entries: 10000
[2m2025-10-01T16:10:41.015504Z[0m [32m INFO[0m [2mlum_rust_ws::shared::performance[0m[2m:[0m üî• Starting performance warm-up process...
[2m2025-10-01T16:10:41.016716Z[0m [32m INFO[0m [2mlum_rust_ws::shared::performance[0m[2m:[0m ‚úÖ Database connection verified
[2m2025-10-01T16:10:41.017126Z[0m [32m INFO[0m [2mlum_rust_ws::shared::performance[0m[2m:[0m ‚úÖ Redis connection verified
[2m2025-10-01T16:10:41.017218Z[0m [32m INFO[0m [2mlum_rust_ws::shared::performance[0m[2m:[0m üî• Performance warm-up completed
[2m2025-10-01T16:10:41.017266Z[0m [32m INFO[0m [2mlum_rust_ws[0m[2m:[0m üöÄ Application state initialized with optimized configuration
[2m2025-10-01T16:10:41.022325Z[0m [32m INFO[0m [2mlum_rust_ws[0m[2m:[0m listening on 0.0.0.0:8000
[2m2025-10-01T16:19:44.087777Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-01T16:19:44.087970Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-01T16:19:44.088049Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m Fetching user data for user_id: 1
[2m2025-10-01T16:19:44.090589Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m User data retrieved in 2ms for user_id: 1 - email: Some("andresfelipevalenciag@gmail.com")
[2m2025-10-01T16:19:45.078562Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-01T16:19:45.078788Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m Getting user balance for user_id: 1
[2m2025-10-01T16:19:45.080816Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m User balance retrieved successfully for user 1 in 2ms: 295 L√ºmis
[2m2025-10-01T16:19:45.589859Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-01T16:19:45.590119Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0mf30f83ad-8f6d-4dbf-8d2d-1ce5c1ed9e11
[2m2025-10-01T16:19:45.590196Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request f30f83ad-8f6d-4dbf-8d2d-1ce5c1ed9e11: Processing headers for user 1 with limit 50 offset 0
[2m2025-10-01T16:19:45.590236Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request f30f83ad-8f6d-4dbf-8d2d-1ce5c1ed9e11: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            '' as issuer_ruc,
            '' as issuer_dv,
            '' as issuer_address,
            '' as issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-10-01T16:19:45.594739Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request f30f83ad-8f6d-4dbf-8d2d-1ce5c1ed9e11: Retrieved 0 invoice headers (total: 0) in 4ms with enhanced filtering
[2m2025-10-01T16:19:45.857485Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-01T16:19:45.857751Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0m29489000-c8f7-41c1-8dae-12a7a0f6dad0
[2m2025-10-01T16:19:45.857789Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 29489000-c8f7-41c1-8dae-12a7a0f6dad0: Processing headers for user 1 with limit 50 offset 50
[2m2025-10-01T16:19:45.857815Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 29489000-c8f7-41c1-8dae-12a7a0f6dad0: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            '' as issuer_ruc,
            '' as issuer_dv,
            '' as issuer_address,
            '' as issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-10-01T16:19:45.861892Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-01T16:19:45.862045Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0m29790315-9bcf-4772-8337-0269569125ee
[2m2025-10-01T16:19:45.862081Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 29790315-9bcf-4772-8337-0269569125ee: Processing headers for user 1 with limit 50 offset 100
[2m2025-10-01T16:19:45.862101Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 29790315-9bcf-4772-8337-0269569125ee: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            '' as issuer_ruc,
            '' as issuer_dv,
            '' as issuer_address,
            '' as issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-10-01T16:19:45.862327Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 29489000-c8f7-41c1-8dae-12a7a0f6dad0: Retrieved 0 invoice headers (total: 0) in 4ms with enhanced filtering
[2m2025-10-01T16:19:45.865875Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 29790315-9bcf-4772-8337-0269569125ee: Retrieved 0 invoice headers (total: 0) in 3ms with enhanced filtering
[2m2025-10-01T16:19:46.017320Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-01T16:19:46.017538Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0me36d212a-b6ea-4200-a1db-c281d320cb05
[2m2025-10-01T16:19:46.017590Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request e36d212a-b6ea-4200-a1db-c281d320cb05: Processing for user 1 with limit 100 offset 100 order_by date direction DESC
[2m2025-10-01T16:19:46.017631Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request e36d212a-b6ea-4200-a1db-c281d320cb05: Querying details for user 1 with enhanced filters
[2m2025-10-01T16:19:46.017651Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-01T16:19:46.017707Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request e36d212a-b6ea-4200-a1db-c281d320cb05: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-01T16:19:46.017793Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m3cb65edd-f5da-46a4-8aa7-24043a36bbbe
[2m2025-10-01T16:19:46.017826Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 3cb65edd-f5da-46a4-8aa7-24043a36bbbe: Processing for user 1 with limit 100 offset 0 order_by date direction DESC
[2m2025-10-01T16:19:46.017843Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 3cb65edd-f5da-46a4-8aa7-24043a36bbbe: Querying details for user 1 with enhanced filters
[2m2025-10-01T16:19:46.017861Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 3cb65edd-f5da-46a4-8aa7-24043a36bbbe: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-01T16:19:46.021794Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request e36d212a-b6ea-4200-a1db-c281d320cb05: Retrieved 0 invoice details (total: 0) in 4ms with enhanced pagination
[2m2025-10-01T16:19:46.022194Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-01T16:19:46.022349Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m19fa6af7-5308-4d19-a9be-29c4450702fb
[2m2025-10-01T16:19:46.022380Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 19fa6af7-5308-4d19-a9be-29c4450702fb: Processing for user 1 with limit 100 offset 200 order_by date direction DESC
[2m2025-10-01T16:19:46.022394Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 19fa6af7-5308-4d19-a9be-29c4450702fb: Querying details for user 1 with enhanced filters
[2m2025-10-01T16:19:46.022410Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 19fa6af7-5308-4d19-a9be-29c4450702fb: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-01T16:19:46.024029Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 3cb65edd-f5da-46a4-8aa7-24043a36bbbe: Retrieved 0 invoice details (total: 0) in 6ms with enhanced pagination
[2m2025-10-01T16:19:46.025851Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 19fa6af7-5308-4d19-a9be-29c4450702fb: Retrieved 0 invoice details (total: 0) in 3ms with enhanced pagination
[2m2025-10-01T16:20:54.036081Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-01T16:20:54.036313Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-01T16:20:54.036435Z[0m [32m INFO[0m [2mlum_rust_ws::api::upload_ocr_v4[0m[2m:[0m Upload OCR request from user: 1
[2m2025-10-01T16:20:54.448323Z[0m [32m INFO[0m [2mlum_rust_ws::api::upload_ocr_v4[0m[2m:[0m Received image file: optimized_1759335651907.jpg (151619 bytes)
[2m2025-10-01T16:20:54.448455Z[0m [32m INFO[0m [2mlum_rust_ws::api::upload_ocr_v4[0m[2m:[0m Using normal mode (1) for user 1
[2m2025-10-01T16:20:54.448503Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üîç Iniciando procesamiento OCR para usuario andresfelipevalenciag@gmail.com
[2m2025-10-01T16:20:54.448541Z[0m [32m INFO[0m [2mlum_rust_ws::shared::users[0m[2m:[0m Querying user by email: andresfelipevalenciag@gmail.com
[2m2025-10-01T16:20:54.451401Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m ü§ñ Iniciando procesamiento con Gemini OCR (mode: Normal)
[2m2025-10-01T16:20:56.936724Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üîç GEMINI RESPONSE COMPLETA: {
  "candidates": [
    {
      "avgLogprobs": -0.003256249982257222,
      "content": {
        "parts": [
          {
            "text": "```json\n{\n  \"issuer_name\": \"FARMACIAS EUROPEAS PN, S.A\",\n  \"ruc\": \"755-247-117717\",\n  \"dv\": \"75\",\n  \"address\": \"San francisco, Calle 50, Entre Calle 70\\ny 75 Este Plaza Sonoma, Local 3.\",\n  \"invoice_number\": \"TFHKC50003376-00040642\",\n  \"date\": \"2025-09-21\",\n  \"total\": 4.95,\n  \"products\": [\n    {\n      \"name\": \"Aero-OM Antiflatulento Gotas 15ml (E)\",\n      \"quantity\": 1,\n      \"unit_price\": 4.95,\n      \"total_price\": 4.95\n    }\n  ]\n}\n```"
          }
        ],
        "role": "model"
      },
      "finishReason": "STOP"
    }
  ],
  "modelVersion": "gemini-2.0-flash",
  "responseId": "5lTdaPjKL_idz7IPmqfOwAY",
  "usageMetadata": {
    "candidatesTokenCount": 215,
    "candidatesTokensDetails": [
      {
        "modality": "TEXT",
        "tokenCount": 215
      }
    ],
    "promptTokenCount": 1779,
    "promptTokensDetails": [
      {
        "modality": "TEXT",
        "tokenCount": 489
      },
      {
        "modality": "IMAGE",
        "tokenCount": 1290
      }
    ],
    "totalTokenCount": 1994
  }
}
[2m2025-10-01T16:20:56.936880Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üîç TEXTO ORIGINAL DE GEMINI: '```json
{
  "issuer_name": "FARMACIAS EUROPEAS PN, S.A",
  "ruc": "755-247-117717",
  "dv": "75",
  "address": "San francisco, Calle 50, Entre Calle 70\ny 75 Este Plaza Sonoma, Local 3.",
  "invoice_number": "TFHKC50003376-00040642",
  "date": "2025-09-21",
  "total": 4.95,
  "products": [
    {
      "name": "Aero-OM Antiflatulento Gotas 15ml (E)",
      "quantity": 1,
      "unit_price": 4.95,
      "total_price": 4.95
    }
  ]
}
```'
[2m2025-10-01T16:20:56.936943Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üîç TEXTO LIMPIADO (sin markdown): '{
  "issuer_name": "FARMACIAS EUROPEAS PN, S.A",
  "ruc": "755-247-117717",
  "dv": "75",
  "address": "San francisco, Calle 50, Entre Calle 70\ny 75 Este Plaza Sonoma, Local 3.",
  "invoice_number": "TFHKC50003376-00040642",
  "date": "2025-09-21",
  "total": 4.95,
  "products": [
    {
      "name": "Aero-OM Antiflatulento Gotas 15ml (E)",
      "quantity": 1,
      "unit_price": 4.95,
      "total_price": 4.95
    }
  ]
}'
[2m2025-10-01T16:20:56.937066Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üîç OCR DATOS PARSEADOS:
[2m2025-10-01T16:20:56.937092Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üìÑ Issuer Name: Some("FARMACIAS EUROPEAS PN, S.A")
[2m2025-10-01T16:20:56.937106Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üè¢ RUC: Some("755-247-117717")
[2m2025-10-01T16:20:56.937118Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üî¢ DV: Some("75")
[2m2025-10-01T16:20:56.937128Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üè† Address: Some("San francisco, Calle 50, Entre Calle 70\ny 75 Este Plaza Sonoma, Local 3.")
[2m2025-10-01T16:20:56.937142Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üìÑ Invoice Number: Some("TFHKC50003376-00040642")
[2m2025-10-01T16:20:56.937184Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üìÑ Date: Some("2025-09-21")
[2m2025-10-01T16:20:56.937196Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üìÑ Total: Some(4.95)
[2m2025-10-01T16:20:56.937209Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üìÑ Products Count: 1
[2m2025-10-01T16:20:56.937227Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m     üõí Product 1: 'Aero-OM Antiflatulento Gotas 15ml (E)' - Qty: 1 - Price: 4.95 - Total: 4.95
[2m2025-10-01T16:20:56.937243Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m ‚úÖ OCR Gemini exitoso: Some("FARMACIAS EUROPEAS PN, S.A")
[2m2025-10-01T16:20:56.937393Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üè∑Ô∏è CUFE generado: OCR-FARMACIAS_EUROPEAS_PN_SA-20250921-TFHKC50003376_00040642 (Comercio: FARMACIAS_EUROPEAS_PN_SA, Fecha: 20250921, N√∫mero: TFHKC50003376_00040642)
[2m2025-10-01T16:20:56.937434Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üîç VERIFICANDO DUPLICADOS:
[2m2025-10-01T16:20:56.937447Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üîç CUFE generado: OCR-FARMACIAS_EUROPEAS_PN_SA-20250921-TFHKC50003376_00040642
[2m2025-10-01T16:20:56.937461Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üîç Issuer Name: Some("FARMACIAS EUROPEAS PN, S.A")
[2m2025-10-01T16:20:56.937473Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üîç Invoice Number: Some("TFHKC50003376-00040642")
[2m2025-10-01T16:20:56.937486Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üîç Date: Some("2025-09-21")
[2m2025-10-01T16:20:56.937497Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üîç User ID: 1
[2m2025-10-01T16:20:56.939037Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üîç Duplicado encontrado por CUFE: OCR-FARMACIAS_EUROPEAS_PN_SA-20250921-TFHKC50003376_00040642
[2m2025-10-01T16:20:56.939077Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üìã ‚úÖ FACTURA DUPLICADA DETECTADA para andresfelipevalenciag@gmail.com: CUFE existente OCR-FARMACIAS_EUROPEAS_PN_SA-20250921-TFHKC50003376_00040642
[2m2025-10-01T16:20:56.939097Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üìä OCR Attempt - User: andresfelipevalenciag@gmail.com, Status: duplicate_invoice, Details: Existing CUFE: OCR-FARMACIAS_EUROPEAS_PN_SA-20250921-TFHKC50003376_00040642
[2m2025-10-01T16:20:56.939211Z[0m [33m WARN[0m [2mlum_rust_ws::api::upload_ocr_v4[0m[2m:[0m ‚ùå OCR processing failed for user 1: Esta factura ya fue registrada anteriormente.
[2m2025-10-01T16:30:20.565568Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-01T16:30:20.565784Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-01T16:30:20.565843Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m Fetching user data for user_id: 1
[2m2025-10-01T16:30:20.566564Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-01T16:30:20.566679Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m Getting user balance for user_id: 1
[2m2025-10-01T16:30:20.568577Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m User balance retrieved successfully for user 1 in 1ms: 295 L√ºmis
[2m2025-10-01T16:30:20.568634Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m User data retrieved in 2ms for user_id: 1 - email: Some("andresfelipevalenciag@gmail.com")
[2m2025-10-01T16:30:43.937007Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-01T16:30:43.937231Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-01T16:30:43.937336Z[0m [32m INFO[0m [2mlum_rust_ws::api::upload_ocr_v4[0m[2m:[0m Upload OCR request from user: 1
[2m2025-10-01T16:30:44.365509Z[0m [32m INFO[0m [2mlum_rust_ws::api::upload_ocr_v4[0m[2m:[0m Received image file: optimized_1759336241848.jpg (151619 bytes)
[2m2025-10-01T16:30:44.365585Z[0m [32m INFO[0m [2mlum_rust_ws::api::upload_ocr_v4[0m[2m:[0m Using normal mode (1) for user 1
[2m2025-10-01T16:30:44.365622Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üîç Iniciando procesamiento OCR para usuario andresfelipevalenciag@gmail.com
[2m2025-10-01T16:30:44.365639Z[0m [32m INFO[0m [2mlum_rust_ws::shared::users[0m[2m:[0m Querying user by email: andresfelipevalenciag@gmail.com
[2m2025-10-01T16:30:44.368362Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m ü§ñ Iniciando procesamiento con Gemini OCR (mode: Normal)
[2m2025-10-01T16:30:47.104035Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üîç GEMINI RESPONSE COMPLETA: {
  "candidates": [
    {
      "avgLogprobs": -0.003256249982257222,
      "content": {
        "parts": [
          {
            "text": "```json\n{\n  \"issuer_name\": \"FARMACIAS EUROPEAS PN, S.A\",\n  \"ruc\": \"755-247-117717\",\n  \"dv\": \"75\",\n  \"address\": \"San francisco, Calle 50, Entre Calle 70\\ny 75 Este Plaza Sonoma, Local 3.\",\n  \"invoice_number\": \"TFHKC50003376-00040642\",\n  \"date\": \"2025-09-21\",\n  \"total\": 4.95,\n  \"products\": [\n    {\n      \"name\": \"Aero-OM Antiflatulento Gotas 15ml (E)\",\n      \"quantity\": 1,\n      \"unit_price\": 4.95,\n      \"total_price\": 4.95\n    }\n  ]\n}\n```"
          }
        ],
        "role": "model"
      },
      "finishReason": "STOP"
    }
  ],
  "modelVersion": "gemini-2.0-flash",
  "responseId": "NFfdaLrBKsi6qtsPqpiNsAw",
  "usageMetadata": {
    "candidatesTokenCount": 215,
    "candidatesTokensDetails": [
      {
        "modality": "TEXT",
        "tokenCount": 215
      }
    ],
    "promptTokenCount": 1779,
    "promptTokensDetails": [
      {
        "modality": "TEXT",
        "tokenCount": 489
      },
      {
        "modality": "IMAGE",
        "tokenCount": 1290
      }
    ],
    "totalTokenCount": 1994
  }
}
[2m2025-10-01T16:30:47.104217Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üîç TEXTO ORIGINAL DE GEMINI: '```json
{
  "issuer_name": "FARMACIAS EUROPEAS PN, S.A",
  "ruc": "755-247-117717",
  "dv": "75",
  "address": "San francisco, Calle 50, Entre Calle 70\ny 75 Este Plaza Sonoma, Local 3.",
  "invoice_number": "TFHKC50003376-00040642",
  "date": "2025-09-21",
  "total": 4.95,
  "products": [
    {
      "name": "Aero-OM Antiflatulento Gotas 15ml (E)",
      "quantity": 1,
      "unit_price": 4.95,
      "total_price": 4.95
    }
  ]
}
```'
[2m2025-10-01T16:30:47.104277Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üîç TEXTO LIMPIADO (sin markdown): '{
  "issuer_name": "FARMACIAS EUROPEAS PN, S.A",
  "ruc": "755-247-117717",
  "dv": "75",
  "address": "San francisco, Calle 50, Entre Calle 70\ny 75 Este Plaza Sonoma, Local 3.",
  "invoice_number": "TFHKC50003376-00040642",
  "date": "2025-09-21",
  "total": 4.95,
  "products": [
    {
      "name": "Aero-OM Antiflatulento Gotas 15ml (E)",
      "quantity": 1,
      "unit_price": 4.95,
      "total_price": 4.95
    }
  ]
}'
[2m2025-10-01T16:30:47.104357Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üîç OCR DATOS PARSEADOS:
[2m2025-10-01T16:30:47.104370Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üìÑ Issuer Name: Some("FARMACIAS EUROPEAS PN, S.A")
[2m2025-10-01T16:30:47.104382Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üè¢ RUC: Some("755-247-117717")
[2m2025-10-01T16:30:47.104391Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üî¢ DV: Some("75")
[2m2025-10-01T16:30:47.104400Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üè† Address: Some("San francisco, Calle 50, Entre Calle 70\ny 75 Este Plaza Sonoma, Local 3.")
[2m2025-10-01T16:30:47.104413Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üìÑ Invoice Number: Some("TFHKC50003376-00040642")
[2m2025-10-01T16:30:47.104423Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üìÑ Date: Some("2025-09-21")
[2m2025-10-01T16:30:47.104431Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üìÑ Total: Some(4.95)
[2m2025-10-01T16:30:47.104444Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üìÑ Products Count: 1
[2m2025-10-01T16:30:47.104454Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m     üõí Product 1: 'Aero-OM Antiflatulento Gotas 15ml (E)' - Qty: 1 - Price: 4.95 - Total: 4.95
[2m2025-10-01T16:30:47.104467Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m ‚úÖ OCR Gemini exitoso: Some("FARMACIAS EUROPEAS PN, S.A")
[2m2025-10-01T16:30:47.104558Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üè∑Ô∏è CUFE generado: OCR-FARMACIAS_EUROPEAS_PN_SA-20250921-TFHKC50003376_00040642 (Comercio: FARMACIAS_EUROPEAS_PN_SA, Fecha: 20250921, N√∫mero: TFHKC50003376_00040642)
[2m2025-10-01T16:30:47.104617Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üîç VERIFICANDO DUPLICADOS:
[2m2025-10-01T16:30:47.104628Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üîç CUFE generado: OCR-FARMACIAS_EUROPEAS_PN_SA-20250921-TFHKC50003376_00040642
[2m2025-10-01T16:30:47.104639Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üîç Issuer Name: Some("FARMACIAS EUROPEAS PN, S.A")
[2m2025-10-01T16:30:47.104649Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üîç Invoice Number: Some("TFHKC50003376-00040642")
[2m2025-10-01T16:30:47.104658Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üîç Date: Some("2025-09-21")
[2m2025-10-01T16:30:47.104668Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üîç User ID: 1
[2m2025-10-01T16:30:47.107972Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üîç Duplicado encontrado por CUFE: OCR-FARMACIAS_EUROPEAS_PN_SA-20250921-TFHKC50003376_00040642
[2m2025-10-01T16:30:47.108060Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üìã ‚úÖ FACTURA DUPLICADA DETECTADA para andresfelipevalenciag@gmail.com: CUFE existente OCR-FARMACIAS_EUROPEAS_PN_SA-20250921-TFHKC50003376_00040642
[2m2025-10-01T16:30:47.108111Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üìä OCR Attempt - User: andresfelipevalenciag@gmail.com, Status: duplicate_invoice, Details: Existing CUFE: OCR-FARMACIAS_EUROPEAS_PN_SA-20250921-TFHKC50003376_00040642
[2m2025-10-01T16:30:47.108190Z[0m [33m WARN[0m [2mlum_rust_ws::api::upload_ocr_v4[0m[2m:[0m ‚ùå OCR processing failed for user 1: Esta factura ya fue registrada anteriormente.
[2m2025-10-01T16:47:24.232636Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-01T16:47:24.232795Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-01T16:47:24.232883Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m Fetching user data for user_id: 1
[2m2025-10-01T16:47:24.235466Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m User data retrieved in 2ms for user_id: 1 - email: Some("andresfelipevalenciag@gmail.com")
[2m2025-10-01T16:47:25.671075Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-01T16:47:25.671237Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m Getting user balance for user_id: 1
[2m2025-10-01T16:47:25.674107Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m User balance retrieved successfully for user 1 in 2ms: 295 L√ºmis
[2m2025-10-01T16:47:26.171534Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-01T16:47:26.171760Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0md1d3799f-1a4f-4c92-90ef-793b07b2c844
[2m2025-10-01T16:47:26.171798Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request d1d3799f-1a4f-4c92-90ef-793b07b2c844: Processing headers for user 1 with limit 50 offset 0
[2m2025-10-01T16:47:26.171827Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request d1d3799f-1a4f-4c92-90ef-793b07b2c844: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            '' as issuer_ruc,
            '' as issuer_dv,
            '' as issuer_address,
            '' as issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-10-01T16:47:26.176448Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request d1d3799f-1a4f-4c92-90ef-793b07b2c844: Retrieved 0 invoice headers (total: 0) in 4ms with enhanced filtering
[2m2025-10-01T16:47:26.673516Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-01T16:47:26.673803Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0m75abad04-e1bf-4655-81e1-01f460f16a16
[2m2025-10-01T16:47:26.673840Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 75abad04-e1bf-4655-81e1-01f460f16a16: Processing headers for user 1 with limit 50 offset 50
[2m2025-10-01T16:47:26.673877Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 75abad04-e1bf-4655-81e1-01f460f16a16: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            '' as issuer_ruc,
            '' as issuer_dv,
            '' as issuer_address,
            '' as issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-10-01T16:47:26.678702Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 75abad04-e1bf-4655-81e1-01f460f16a16: Retrieved 0 invoice headers (total: 0) in 4ms with enhanced filtering
[2m2025-10-01T16:47:26.745574Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-01T16:47:26.745745Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0mdd7ca9c2-8906-4f10-8c7c-9dd23a99437f
[2m2025-10-01T16:47:26.745774Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request dd7ca9c2-8906-4f10-8c7c-9dd23a99437f: Processing headers for user 1 with limit 50 offset 100
[2m2025-10-01T16:47:26.745800Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request dd7ca9c2-8906-4f10-8c7c-9dd23a99437f: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            '' as issuer_ruc,
            '' as issuer_dv,
            '' as issuer_address,
            '' as issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-10-01T16:47:26.750790Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request dd7ca9c2-8906-4f10-8c7c-9dd23a99437f: Retrieved 0 invoice headers (total: 0) in 5ms with enhanced filtering
[2m2025-10-01T16:47:26.951052Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-01T16:47:26.951306Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0med487765-659a-44c2-abc5-f19e46d71ab6
[2m2025-10-01T16:47:26.951347Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request ed487765-659a-44c2-abc5-f19e46d71ab6: Processing for user 1 with limit 100 offset 0 order_by date direction DESC
[2m2025-10-01T16:47:26.951367Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request ed487765-659a-44c2-abc5-f19e46d71ab6: Querying details for user 1 with enhanced filters
[2m2025-10-01T16:47:26.951393Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request ed487765-659a-44c2-abc5-f19e46d71ab6: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-01T16:47:26.955911Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request ed487765-659a-44c2-abc5-f19e46d71ab6: Retrieved 0 invoice details (total: 0) in 4ms with enhanced pagination
[2m2025-10-01T16:47:26.970585Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-01T16:47:26.970756Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0me313b93f-f983-44cc-b0a3-aad46db0a2aa
[2m2025-10-01T16:47:26.970792Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request e313b93f-f983-44cc-b0a3-aad46db0a2aa: Processing for user 1 with limit 100 offset 100 order_by date direction DESC
[2m2025-10-01T16:47:26.970807Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request e313b93f-f983-44cc-b0a3-aad46db0a2aa: Querying details for user 1 with enhanced filters
[2m2025-10-01T16:47:26.970827Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request e313b93f-f983-44cc-b0a3-aad46db0a2aa: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-01T16:47:26.974548Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request e313b93f-f983-44cc-b0a3-aad46db0a2aa: Retrieved 0 invoice details (total: 0) in 3ms with enhanced pagination
[2m2025-10-01T16:47:26.980467Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-01T16:47:26.980651Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m64eebad4-13aa-4fbb-8328-8a53f53b99a3
[2m2025-10-01T16:47:26.980684Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 64eebad4-13aa-4fbb-8328-8a53f53b99a3: Processing for user 1 with limit 100 offset 200 order_by date direction DESC
[2m2025-10-01T16:47:26.980723Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 64eebad4-13aa-4fbb-8328-8a53f53b99a3: Querying details for user 1 with enhanced filters
[2m2025-10-01T16:47:26.980748Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 64eebad4-13aa-4fbb-8328-8a53f53b99a3: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-01T16:47:26.983945Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 64eebad4-13aa-4fbb-8328-8a53f53b99a3: Retrieved 0 invoice details (total: 0) in 3ms with enhanced pagination
[2m2025-10-01T16:47:57.173207Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-01T16:47:57.173400Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-01T16:47:57.173496Z[0m [32m INFO[0m [2mlum_rust_ws::api::upload_ocr_v4[0m[2m:[0m Upload OCR request from user: 1
[2m2025-10-01T16:47:58.660635Z[0m [32m INFO[0m [2mlum_rust_ws::api::upload_ocr_v4[0m[2m:[0m Received image file: optimized_1759337274653.jpg (151619 bytes)
[2m2025-10-01T16:47:58.660728Z[0m [32m INFO[0m [2mlum_rust_ws::api::upload_ocr_v4[0m[2m:[0m Using normal mode (1) for user 1
[2m2025-10-01T16:47:58.660746Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üîç Iniciando procesamiento OCR para usuario andresfelipevalenciag@gmail.com
[2m2025-10-01T16:47:58.660764Z[0m [32m INFO[0m [2mlum_rust_ws::shared::users[0m[2m:[0m Querying user by email: andresfelipevalenciag@gmail.com
[2m2025-10-01T16:47:58.663402Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m ü§ñ Iniciando procesamiento con Gemini OCR (mode: Normal)
[2m2025-10-01T16:48:01.650029Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üîç GEMINI RESPONSE COMPLETA: {
  "candidates": [
    {
      "avgLogprobs": -0.001385187548260356,
      "content": {
        "parts": [
          {
            "text": "```json\n{\n  \"issuer_name\": \"FARMACIAS EUROPEAS PN, S.A\",\n  \"ruc\": \"755-247-117717\",\n  \"dv\": \"75\",\n  \"address\": \"San francisco, Calle 50, Entre Calle 70\\ny 75 Este Plaza Sonoma, Local 3.\",\n  \"invoice_number\": \"TFHKC50003376-00040642\",\n  \"date\": \"2025-09-21\",\n  \"total\": 4.95,\n  \"products\": [\n    {\n      \"name\": \"Aero-OM Antiflatulento Gotas 15ml (E)\",\n      \"quantity\": 1,\n      \"unit_price\": 4.95,\n      \"total_price\": 4.95\n    }\n  ]\n}\n```"
          }
        ],
        "role": "model"
      },
      "finishReason": "STOP"
    }
  ],
  "modelVersion": "gemini-2.0-flash",
  "responseId": "P1vdaO0d7K-a2Q_shszoBw",
  "usageMetadata": {
    "candidatesTokenCount": 215,
    "candidatesTokensDetails": [
      {
        "modality": "TEXT",
        "tokenCount": 215
      }
    ],
    "promptTokenCount": 1779,
    "promptTokensDetails": [
      {
        "modality": "IMAGE",
        "tokenCount": 1290
      },
      {
        "modality": "TEXT",
        "tokenCount": 489
      }
    ],
    "totalTokenCount": 1994
  }
}
[2m2025-10-01T16:48:01.650183Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üîç TEXTO ORIGINAL DE GEMINI: '```json
{
  "issuer_name": "FARMACIAS EUROPEAS PN, S.A",
  "ruc": "755-247-117717",
  "dv": "75",
  "address": "San francisco, Calle 50, Entre Calle 70\ny 75 Este Plaza Sonoma, Local 3.",
  "invoice_number": "TFHKC50003376-00040642",
  "date": "2025-09-21",
  "total": 4.95,
  "products": [
    {
      "name": "Aero-OM Antiflatulento Gotas 15ml (E)",
      "quantity": 1,
      "unit_price": 4.95,
      "total_price": 4.95
    }
  ]
}
```'
[2m2025-10-01T16:48:01.650253Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üîç TEXTO LIMPIADO (sin markdown): '{
  "issuer_name": "FARMACIAS EUROPEAS PN, S.A",
  "ruc": "755-247-117717",
  "dv": "75",
  "address": "San francisco, Calle 50, Entre Calle 70\ny 75 Este Plaza Sonoma, Local 3.",
  "invoice_number": "TFHKC50003376-00040642",
  "date": "2025-09-21",
  "total": 4.95,
  "products": [
    {
      "name": "Aero-OM Antiflatulento Gotas 15ml (E)",
      "quantity": 1,
      "unit_price": 4.95,
      "total_price": 4.95
    }
  ]
}'
[2m2025-10-01T16:48:01.650342Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üîç OCR DATOS PARSEADOS:
[2m2025-10-01T16:48:01.650362Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üìÑ Issuer Name: Some("FARMACIAS EUROPEAS PN, S.A")
[2m2025-10-01T16:48:01.650374Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üè¢ RUC: Some("755-247-117717")
[2m2025-10-01T16:48:01.650383Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üî¢ DV: Some("75")
[2m2025-10-01T16:48:01.650391Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üè† Address: Some("San francisco, Calle 50, Entre Calle 70\ny 75 Este Plaza Sonoma, Local 3.")
[2m2025-10-01T16:48:01.650403Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üìÑ Invoice Number: Some("TFHKC50003376-00040642")
[2m2025-10-01T16:48:01.650413Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üìÑ Date: Some("2025-09-21")
[2m2025-10-01T16:48:01.650422Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üìÑ Total: Some(4.95)
[2m2025-10-01T16:48:01.650436Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üìÑ Products Count: 1
[2m2025-10-01T16:48:01.650447Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m     üõí Product 1: 'Aero-OM Antiflatulento Gotas 15ml (E)' - Qty: 1 - Price: 4.95 - Total: 4.95
[2m2025-10-01T16:48:01.650463Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m ‚úÖ OCR Gemini exitoso: Some("FARMACIAS EUROPEAS PN, S.A")
[2m2025-10-01T16:48:01.650582Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üè∑Ô∏è CUFE generado: OCR-FARMACIAS_EUROPEAS_PN_SA-20250921-TFHKC50003376_00040642 (Comercio: FARMACIAS_EUROPEAS_PN_SA, Fecha: 20250921, N√∫mero: TFHKC50003376_00040642)
[2m2025-10-01T16:48:01.650616Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üîç VERIFICANDO DUPLICADOS:
[2m2025-10-01T16:48:01.650625Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üîç CUFE generado: OCR-FARMACIAS_EUROPEAS_PN_SA-20250921-TFHKC50003376_00040642
[2m2025-10-01T16:48:01.650636Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üîç Issuer Name: Some("FARMACIAS EUROPEAS PN, S.A")
[2m2025-10-01T16:48:01.650646Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üîç Invoice Number: Some("TFHKC50003376-00040642")
[2m2025-10-01T16:48:01.650655Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üîç Date: Some("2025-09-21")
[2m2025-10-01T16:48:01.650664Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üîç User ID: 1
[2m2025-10-01T16:48:01.652100Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üîç Duplicado encontrado por CUFE: OCR-FARMACIAS_EUROPEAS_PN_SA-20250921-TFHKC50003376_00040642
[2m2025-10-01T16:48:01.652143Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üìã ‚úÖ FACTURA DUPLICADA DETECTADA para andresfelipevalenciag@gmail.com: CUFE existente OCR-FARMACIAS_EUROPEAS_PN_SA-20250921-TFHKC50003376_00040642
[2m2025-10-01T16:48:01.652193Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üìä OCR Attempt - User: andresfelipevalenciag@gmail.com, Status: duplicate_invoice, Details: Existing CUFE: OCR-FARMACIAS_EUROPEAS_PN_SA-20250921-TFHKC50003376_00040642
[2m2025-10-01T16:48:01.652229Z[0m [33m WARN[0m [2mlum_rust_ws::api::upload_ocr_v4[0m[2m:[0m ‚ùå OCR processing failed for user 1: Esta factura ya fue registrada anteriormente.
[2m2025-10-01T17:17:41.009186Z[0m [32m INFO[0m [2mlum_rust_ws::api::root_v4[0m[2m:[0m Request ad422428-7702-4a20-8966-20bff450dacc: Root endpoint accessed
[2m2025-10-01T17:17:44.573290Z[0m [32m INFO[0m [2mlum_rust_ws::api::root_v4[0m[2m:[0m Request b6290fcd-503d-40e3-8d6e-8487871b6894: Root endpoint accessed
[2m2025-10-01T17:17:45.050572Z[0m [33m WARN[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m Missing Authorization header
[2m2025-10-01T17:17:50.884573Z[0m [32m INFO[0m [2mlum_rust_ws::api::root_v4[0m[2m:[0m Request 70584791-e6fd-4191-84fe-09eb7510ec46: Root endpoint accessed
[2m2025-10-01T17:21:11.362491Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-01T17:21:11.362741Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-01T17:21:11.362851Z[0m [32m INFO[0m [2mlum_rust_ws::api::upload_ocr_v4[0m[2m:[0m Upload OCR request from user: 1
[2m2025-10-01T17:21:11.778863Z[0m [32m INFO[0m [2mlum_rust_ws::api::upload_ocr_v4[0m[2m:[0m Received image file: optimized_1759339269184.jpg (151619 bytes)
[2m2025-10-01T17:21:11.778949Z[0m [32m INFO[0m [2mlum_rust_ws::api::upload_ocr_v4[0m[2m:[0m Using normal mode (1) for user 1
[2m2025-10-01T17:21:11.778965Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üîç Iniciando procesamiento OCR para usuario andresfelipevalenciag@gmail.com
[2m2025-10-01T17:21:11.778982Z[0m [32m INFO[0m [2mlum_rust_ws::shared::users[0m[2m:[0m Querying user by email: andresfelipevalenciag@gmail.com
[2m2025-10-01T17:21:11.782326Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m ü§ñ Iniciando procesamiento con Gemini OCR (mode: Normal)
[2m2025-10-01T17:21:14.730002Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üîç GEMINI RESPONSE COMPLETA: {
  "candidates": [
    {
      "avgLogprobs": -0.001385187548260356,
      "content": {
        "parts": [
          {
            "text": "```json\n{\n  \"issuer_name\": \"FARMACIAS EUROPEAS PN, S.A\",\n  \"ruc\": \"755-247-117717\",\n  \"dv\": \"75\",\n  \"address\": \"San francisco, Calle 50, Entre Calle 70\\ny 75 Este Plaza Sonoma, Local 3.\",\n  \"invoice_number\": \"TFHKC50003376-00040642\",\n  \"date\": \"2025-09-21\",\n  \"total\": 4.95,\n  \"products\": [\n    {\n      \"name\": \"Aero-OM Antiflatulento Gotas 15ml (E)\",\n      \"quantity\": 1,\n      \"unit_price\": 4.95,\n      \"total_price\": 4.95\n    }\n  ]\n}\n```"
          }
        ],
        "role": "model"
      },
      "finishReason": "STOP"
    }
  ],
  "modelVersion": "gemini-2.0-flash",
  "responseId": "CGPdaPqQAsi6qtsPsJiNsAw",
  "usageMetadata": {
    "candidatesTokenCount": 215,
    "candidatesTokensDetails": [
      {
        "modality": "TEXT",
        "tokenCount": 215
      }
    ],
    "promptTokenCount": 1779,
    "promptTokensDetails": [
      {
        "modality": "IMAGE",
        "tokenCount": 1290
      },
      {
        "modality": "TEXT",
        "tokenCount": 489
      }
    ],
    "totalTokenCount": 1994
  }
}
[2m2025-10-01T17:21:14.730171Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üîç TEXTO ORIGINAL DE GEMINI: '```json
{
  "issuer_name": "FARMACIAS EUROPEAS PN, S.A",
  "ruc": "755-247-117717",
  "dv": "75",
  "address": "San francisco, Calle 50, Entre Calle 70\ny 75 Este Plaza Sonoma, Local 3.",
  "invoice_number": "TFHKC50003376-00040642",
  "date": "2025-09-21",
  "total": 4.95,
  "products": [
    {
      "name": "Aero-OM Antiflatulento Gotas 15ml (E)",
      "quantity": 1,
      "unit_price": 4.95,
      "total_price": 4.95
    }
  ]
}
```'
[2m2025-10-01T17:21:14.730231Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üîç TEXTO LIMPIADO (sin markdown): '{
  "issuer_name": "FARMACIAS EUROPEAS PN, S.A",
  "ruc": "755-247-117717",
  "dv": "75",
  "address": "San francisco, Calle 50, Entre Calle 70\ny 75 Este Plaza Sonoma, Local 3.",
  "invoice_number": "TFHKC50003376-00040642",
  "date": "2025-09-21",
  "total": 4.95,
  "products": [
    {
      "name": "Aero-OM Antiflatulento Gotas 15ml (E)",
      "quantity": 1,
      "unit_price": 4.95,
      "total_price": 4.95
    }
  ]
}'
[2m2025-10-01T17:21:14.730318Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üîç OCR DATOS PARSEADOS:
[2m2025-10-01T17:21:14.730343Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üìÑ Issuer Name: Some("FARMACIAS EUROPEAS PN, S.A")
[2m2025-10-01T17:21:14.730355Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üè¢ RUC: Some("755-247-117717")
[2m2025-10-01T17:21:14.730364Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üî¢ DV: Some("75")
[2m2025-10-01T17:21:14.730373Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üè† Address: Some("San francisco, Calle 50, Entre Calle 70\ny 75 Este Plaza Sonoma, Local 3.")
[2m2025-10-01T17:21:14.730386Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üìÑ Invoice Number: Some("TFHKC50003376-00040642")
[2m2025-10-01T17:21:14.730396Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üìÑ Date: Some("2025-09-21")
[2m2025-10-01T17:21:14.730405Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üìÑ Total: Some(4.95)
[2m2025-10-01T17:21:14.730416Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üìÑ Products Count: 1
[2m2025-10-01T17:21:14.730427Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m     üõí Product 1: 'Aero-OM Antiflatulento Gotas 15ml (E)' - Qty: 1 - Price: 4.95 - Total: 4.95
[2m2025-10-01T17:21:14.730439Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m ‚úÖ OCR Gemini exitoso: Some("FARMACIAS EUROPEAS PN, S.A")
[2m2025-10-01T17:21:14.730532Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üè∑Ô∏è CUFE generado: OCR-FARMACIAS_EUROPEAS_PN_SA-20250921-TFHKC50003376_00040642 (Comercio: FARMACIAS_EUROPEAS_PN_SA, Fecha: 20250921, N√∫mero: TFHKC50003376_00040642)
[2m2025-10-01T17:21:14.730564Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üîç VERIFICANDO DUPLICADOS:
[2m2025-10-01T17:21:14.730572Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üîç CUFE generado: OCR-FARMACIAS_EUROPEAS_PN_SA-20250921-TFHKC50003376_00040642
[2m2025-10-01T17:21:14.730584Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üîç Issuer Name: Some("FARMACIAS EUROPEAS PN, S.A")
[2m2025-10-01T17:21:14.730594Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üîç Invoice Number: Some("TFHKC50003376-00040642")
[2m2025-10-01T17:21:14.730605Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üîç Date: Some("2025-09-21")
[2m2025-10-01T17:21:14.730614Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üîç User ID: 1
[2m2025-10-01T17:21:14.733083Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üîç Duplicado encontrado por CUFE: OCR-FARMACIAS_EUROPEAS_PN_SA-20250921-TFHKC50003376_00040642
[2m2025-10-01T17:21:14.733139Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üìã ‚úÖ FACTURA DUPLICADA DETECTADA para andresfelipevalenciag@gmail.com: CUFE existente OCR-FARMACIAS_EUROPEAS_PN_SA-20250921-TFHKC50003376_00040642
[2m2025-10-01T17:21:14.733190Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üìä OCR Attempt - User: andresfelipevalenciag@gmail.com, Status: duplicate_invoice, Details: Existing CUFE: OCR-FARMACIAS_EUROPEAS_PN_SA-20250921-TFHKC50003376_00040642
[2m2025-10-01T17:21:14.733225Z[0m [33m WARN[0m [2mlum_rust_ws::api::upload_ocr_v4[0m[2m:[0m ‚ùå OCR processing failed for user 1: Esta factura ya fue registrada anteriormente.
[2m2025-10-01T17:23:51.480403Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-01T17:23:51.480570Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-01T17:23:51.480630Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m Fetching user data for user_id: 1
[2m2025-10-01T17:23:51.483087Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m User data retrieved in 2ms for user_id: 1 - email: Some("andresfelipevalenciag@gmail.com")
[2m2025-10-01T17:23:52.347317Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-01T17:23:52.347488Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m Getting user balance for user_id: 1
[2m2025-10-01T17:23:52.349932Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m User balance retrieved successfully for user 1 in 2ms: 295 L√ºmis
[2m2025-10-01T17:23:52.868527Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-01T17:23:52.868824Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0mb2f6684f-22cf-4cf0-aad0-fc9a1eacba94
[2m2025-10-01T17:23:52.868873Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request b2f6684f-22cf-4cf0-aad0-fc9a1eacba94: Processing headers for user 1 with limit 50 offset 0
[2m2025-10-01T17:23:52.868917Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request b2f6684f-22cf-4cf0-aad0-fc9a1eacba94: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            '' as issuer_ruc,
            '' as issuer_dv,
            '' as issuer_address,
            '' as issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-10-01T17:23:52.873473Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request b2f6684f-22cf-4cf0-aad0-fc9a1eacba94: Retrieved 0 invoice headers (total: 0) in 4ms with enhanced filtering
[2m2025-10-01T17:23:53.169600Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-01T17:23:53.169841Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0mf13304d3-aef2-4780-b583-d4116de13573
[2m2025-10-01T17:23:53.169880Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request f13304d3-aef2-4780-b583-d4116de13573: Processing headers for user 1 with limit 50 offset 50
[2m2025-10-01T17:23:53.169907Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request f13304d3-aef2-4780-b583-d4116de13573: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            '' as issuer_ruc,
            '' as issuer_dv,
            '' as issuer_address,
            '' as issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-10-01T17:23:53.173260Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-01T17:23:53.173483Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0mb530700b-f56c-4068-b4df-b8665c9be9c7
[2m2025-10-01T17:23:53.173517Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request b530700b-f56c-4068-b4df-b8665c9be9c7: Processing headers for user 1 with limit 50 offset 100
[2m2025-10-01T17:23:53.173543Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request b530700b-f56c-4068-b4df-b8665c9be9c7: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            '' as issuer_ruc,
            '' as issuer_dv,
            '' as issuer_address,
            '' as issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-10-01T17:23:53.174835Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request f13304d3-aef2-4780-b583-d4116de13573: Retrieved 0 invoice headers (total: 0) in 4ms with enhanced filtering
[2m2025-10-01T17:23:53.177695Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request b530700b-f56c-4068-b4df-b8665c9be9c7: Retrieved 0 invoice headers (total: 0) in 4ms with enhanced filtering
[2m2025-10-01T17:23:53.358687Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-01T17:23:53.359005Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0maa2fe8f0-5db9-41a3-b679-c57ef7b2cf91
[2m2025-10-01T17:23:53.359063Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request aa2fe8f0-5db9-41a3-b679-c57ef7b2cf91: Processing for user 1 with limit 100 offset 0 order_by date direction DESC
[2m2025-10-01T17:23:53.359115Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request aa2fe8f0-5db9-41a3-b679-c57ef7b2cf91: Querying details for user 1 with enhanced filters
[2m2025-10-01T17:23:53.359217Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request aa2fe8f0-5db9-41a3-b679-c57ef7b2cf91: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-01T17:23:53.360298Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-01T17:23:53.360528Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0mb637f557-f4fd-4188-95d9-50283631c6fe
[2m2025-10-01T17:23:53.360671Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request b637f557-f4fd-4188-95d9-50283631c6fe: Processing for user 1 with limit 100 offset 100 order_by date direction DESC
[2m2025-10-01T17:23:53.360774Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request b637f557-f4fd-4188-95d9-50283631c6fe: Querying details for user 1 with enhanced filters
[2m2025-10-01T17:23:53.360808Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request b637f557-f4fd-4188-95d9-50283631c6fe: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-01T17:23:53.360689Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-01T17:23:53.361043Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m5496fc0c-8ac0-4ec9-8f9c-8d78cb37169a
[2m2025-10-01T17:23:53.361064Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 5496fc0c-8ac0-4ec9-8f9c-8d78cb37169a: Processing for user 1 with limit 100 offset 200 order_by date direction DESC
[2m2025-10-01T17:23:53.361087Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 5496fc0c-8ac0-4ec9-8f9c-8d78cb37169a: Querying details for user 1 with enhanced filters
[2m2025-10-01T17:23:53.361112Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 5496fc0c-8ac0-4ec9-8f9c-8d78cb37169a: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-01T17:23:53.363251Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request aa2fe8f0-5db9-41a3-b679-c57ef7b2cf91: Retrieved 0 invoice details (total: 0) in 4ms with enhanced pagination
[2m2025-10-01T17:23:53.365285Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request b637f557-f4fd-4188-95d9-50283631c6fe: Retrieved 0 invoice details (total: 0) in 4ms with enhanced pagination
[2m2025-10-01T17:23:53.366292Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 5496fc0c-8ac0-4ec9-8f9c-8d78cb37169a: Retrieved 0 invoice details (total: 0) in 5ms with enhanced pagination
[2m2025-10-01T17:24:16.537134Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-01T17:24:16.537430Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-01T17:24:16.537544Z[0m [32m INFO[0m [2mlum_rust_ws::api::upload_ocr_v4[0m[2m:[0m Upload OCR request from user: 1
[2m2025-10-01T17:24:16.948562Z[0m [32m INFO[0m [2mlum_rust_ws::api::upload_ocr_v4[0m[2m:[0m Received image file: optimized_1759339454455.jpg (151619 bytes)
[2m2025-10-01T17:24:16.948644Z[0m [32m INFO[0m [2mlum_rust_ws::api::upload_ocr_v4[0m[2m:[0m Using normal mode (1) for user 1
[2m2025-10-01T17:24:16.948661Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üîç Iniciando procesamiento OCR para usuario andresfelipevalenciag@gmail.com
[2m2025-10-01T17:24:16.948679Z[0m [32m INFO[0m [2mlum_rust_ws::shared::users[0m[2m:[0m Querying user by email: andresfelipevalenciag@gmail.com
[2m2025-10-01T17:24:16.951070Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m ü§ñ Iniciando procesamiento con Gemini OCR (mode: Normal)
[2m2025-10-01T17:24:19.448120Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üîç GEMINI RESPONSE COMPLETA: {
  "candidates": [
    {
      "avgLogprobs": -0.001385187548260356,
      "content": {
        "parts": [
          {
            "text": "```json\n{\n  \"issuer_name\": \"FARMACIAS EUROPEAS PN, S.A\",\n  \"ruc\": \"755-247-117717\",\n  \"dv\": \"75\",\n  \"address\": \"San francisco, Calle 50, Entre Calle 70\\ny 75 Este Plaza Sonoma, Local 3.\",\n  \"invoice_number\": \"TFHKC50003376-00040642\",\n  \"date\": \"2025-09-21\",\n  \"total\": 4.95,\n  \"products\": [\n    {\n      \"name\": \"Aero-OM Antiflatulento Gotas 15ml (E)\",\n      \"quantity\": 1,\n      \"unit_price\": 4.95,\n      \"total_price\": 4.95\n    }\n  ]\n}\n```"
          }
        ],
        "role": "model"
      },
      "finishReason": "STOP"
    }
  ],
  "modelVersion": "gemini-2.0-flash",
  "responseId": "wWPdaMnuEKesz7IP9bfewAQ",
  "usageMetadata": {
    "candidatesTokenCount": 215,
    "candidatesTokensDetails": [
      {
        "modality": "TEXT",
        "tokenCount": 215
      }
    ],
    "promptTokenCount": 1779,
    "promptTokensDetails": [
      {
        "modality": "IMAGE",
        "tokenCount": 1290
      },
      {
        "modality": "TEXT",
        "tokenCount": 489
      }
    ],
    "totalTokenCount": 1994
  }
}
[2m2025-10-01T17:24:19.448290Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üîç TEXTO ORIGINAL DE GEMINI: '```json
{
  "issuer_name": "FARMACIAS EUROPEAS PN, S.A",
  "ruc": "755-247-117717",
  "dv": "75",
  "address": "San francisco, Calle 50, Entre Calle 70\ny 75 Este Plaza Sonoma, Local 3.",
  "invoice_number": "TFHKC50003376-00040642",
  "date": "2025-09-21",
  "total": 4.95,
  "products": [
    {
      "name": "Aero-OM Antiflatulento Gotas 15ml (E)",
      "quantity": 1,
      "unit_price": 4.95,
      "total_price": 4.95
    }
  ]
}
```'
[2m2025-10-01T17:24:19.448349Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üîç TEXTO LIMPIADO (sin markdown): '{
  "issuer_name": "FARMACIAS EUROPEAS PN, S.A",
  "ruc": "755-247-117717",
  "dv": "75",
  "address": "San francisco, Calle 50, Entre Calle 70\ny 75 Este Plaza Sonoma, Local 3.",
  "invoice_number": "TFHKC50003376-00040642",
  "date": "2025-09-21",
  "total": 4.95,
  "products": [
    {
      "name": "Aero-OM Antiflatulento Gotas 15ml (E)",
      "quantity": 1,
      "unit_price": 4.95,
      "total_price": 4.95
    }
  ]
}'
[2m2025-10-01T17:24:19.448422Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üîç OCR DATOS PARSEADOS:
[2m2025-10-01T17:24:19.448448Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üìÑ Issuer Name: Some("FARMACIAS EUROPEAS PN, S.A")
[2m2025-10-01T17:24:19.448459Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üè¢ RUC: Some("755-247-117717")
[2m2025-10-01T17:24:19.448467Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üî¢ DV: Some("75")
[2m2025-10-01T17:24:19.448475Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üè† Address: Some("San francisco, Calle 50, Entre Calle 70\ny 75 Este Plaza Sonoma, Local 3.")
[2m2025-10-01T17:24:19.448485Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üìÑ Invoice Number: Some("TFHKC50003376-00040642")
[2m2025-10-01T17:24:19.448494Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üìÑ Date: Some("2025-09-21")
[2m2025-10-01T17:24:19.448512Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üìÑ Total: Some(4.95)
[2m2025-10-01T17:24:19.448522Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üìÑ Products Count: 1
[2m2025-10-01T17:24:19.448532Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m     üõí Product 1: 'Aero-OM Antiflatulento Gotas 15ml (E)' - Qty: 1 - Price: 4.95 - Total: 4.95
[2m2025-10-01T17:24:19.448543Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m ‚úÖ OCR Gemini exitoso: Some("FARMACIAS EUROPEAS PN, S.A")
[2m2025-10-01T17:24:19.448660Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üè∑Ô∏è CUFE generado: OCR-FARMACIAS_EUROPEAS_PN_SA-20250921-TFHKC50003376_00040642 (Comercio: FARMACIAS_EUROPEAS_PN_SA, Fecha: 20250921, N√∫mero: TFHKC50003376_00040642)
[2m2025-10-01T17:24:19.448818Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üîç VERIFICANDO DUPLICADOS:
[2m2025-10-01T17:24:19.448841Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üîç CUFE generado: OCR-FARMACIAS_EUROPEAS_PN_SA-20250921-TFHKC50003376_00040642
[2m2025-10-01T17:24:19.448852Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üîç Issuer Name: Some("FARMACIAS EUROPEAS PN, S.A")
[2m2025-10-01T17:24:19.448862Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üîç Invoice Number: Some("TFHKC50003376-00040642")
[2m2025-10-01T17:24:19.448871Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üîç Date: Some("2025-09-21")
[2m2025-10-01T17:24:19.448880Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üîç User ID: 1
[2m2025-10-01T17:24:19.450396Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üîç Duplicado encontrado por CUFE: OCR-FARMACIAS_EUROPEAS_PN_SA-20250921-TFHKC50003376_00040642
[2m2025-10-01T17:24:19.450440Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üìã ‚úÖ FACTURA DUPLICADA DETECTADA para andresfelipevalenciag@gmail.com: CUFE existente OCR-FARMACIAS_EUROPEAS_PN_SA-20250921-TFHKC50003376_00040642
[2m2025-10-01T17:24:19.450481Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üìä OCR Attempt - User: andresfelipevalenciag@gmail.com, Status: duplicate_invoice, Details: Existing CUFE: OCR-FARMACIAS_EUROPEAS_PN_SA-20250921-TFHKC50003376_00040642
[2m2025-10-01T17:24:19.450532Z[0m [33m WARN[0m [2mlum_rust_ws::api::upload_ocr_v4[0m[2m:[0m ‚ùå OCR processing failed for user 1: Esta factura ya fue registrada anteriormente.
[2m2025-10-01T17:27:18.902481Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-01T17:27:18.902672Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-01T17:27:18.902810Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m Fetching user data for user_id: 1
[2m2025-10-01T17:27:18.905064Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m User data retrieved in 2ms for user_id: 1 - email: Some("andresfelipevalenciag@gmail.com")
[2m2025-10-01T17:27:19.988937Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-01T17:27:19.989082Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m Getting user balance for user_id: 1
[2m2025-10-01T17:27:19.990719Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m User balance retrieved successfully for user 1 in 1ms: 295 L√ºmis
[2m2025-10-01T17:27:20.512854Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-01T17:27:20.513126Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0m753b79ec-e9dd-4a9a-876b-75dff016b3f6
[2m2025-10-01T17:27:20.513214Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 753b79ec-e9dd-4a9a-876b-75dff016b3f6: Processing headers for user 1 with limit 50 offset 0
[2m2025-10-01T17:27:20.513259Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 753b79ec-e9dd-4a9a-876b-75dff016b3f6: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            '' as issuer_ruc,
            '' as issuer_dv,
            '' as issuer_address,
            '' as issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-10-01T17:27:20.516568Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 753b79ec-e9dd-4a9a-876b-75dff016b3f6: Retrieved 0 invoice headers (total: 0) in 3ms with enhanced filtering
[2m2025-10-01T17:27:20.846328Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-01T17:27:20.846580Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0m1b5cbc45-5121-4c68-8e9d-93f3ea89a7c9
[2m2025-10-01T17:27:20.846616Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 1b5cbc45-5121-4c68-8e9d-93f3ea89a7c9: Processing headers for user 1 with limit 50 offset 100
[2m2025-10-01T17:27:20.846642Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 1b5cbc45-5121-4c68-8e9d-93f3ea89a7c9: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            '' as issuer_ruc,
            '' as issuer_dv,
            '' as issuer_address,
            '' as issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-10-01T17:27:20.849468Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 1b5cbc45-5121-4c68-8e9d-93f3ea89a7c9: Retrieved 0 invoice headers (total: 0) in 2ms with enhanced filtering
[2m2025-10-01T17:27:20.850408Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-01T17:27:20.850655Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0mc2fafefd-8028-4c63-becf-c066446c870a
[2m2025-10-01T17:27:20.850692Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request c2fafefd-8028-4c63-becf-c066446c870a: Processing headers for user 1 with limit 50 offset 50
[2m2025-10-01T17:27:20.850721Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request c2fafefd-8028-4c63-becf-c066446c870a: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            '' as issuer_ruc,
            '' as issuer_dv,
            '' as issuer_address,
            '' as issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-10-01T17:27:20.853484Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request c2fafefd-8028-4c63-becf-c066446c870a: Retrieved 0 invoice headers (total: 0) in 2ms with enhanced filtering
[2m2025-10-01T17:27:21.055604Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-01T17:27:21.055838Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m80778e4f-e804-4c67-b496-ee278f4f6758
[2m2025-10-01T17:27:21.055876Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 80778e4f-e804-4c67-b496-ee278f4f6758: Processing for user 1 with limit 100 offset 200 order_by date direction DESC
[2m2025-10-01T17:27:21.055896Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 80778e4f-e804-4c67-b496-ee278f4f6758: Querying details for user 1 with enhanced filters
[2m2025-10-01T17:27:21.055924Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 80778e4f-e804-4c67-b496-ee278f4f6758: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-01T17:27:21.056700Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-01T17:27:21.056889Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m11169852-d29e-4f69-bbf3-0fa894b77bb3
[2m2025-10-01T17:27:21.056923Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 11169852-d29e-4f69-bbf3-0fa894b77bb3: Processing for user 1 with limit 100 offset 100 order_by date direction DESC
[2m2025-10-01T17:27:21.056941Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 11169852-d29e-4f69-bbf3-0fa894b77bb3: Querying details for user 1 with enhanced filters
[2m2025-10-01T17:27:21.056966Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 11169852-d29e-4f69-bbf3-0fa894b77bb3: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-01T17:27:21.059117Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-01T17:27:21.059294Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0me9253b71-3c80-402a-aea6-a67440fd3055
[2m2025-10-01T17:27:21.059359Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request e9253b71-3c80-402a-aea6-a67440fd3055: Processing for user 1 with limit 100 offset 0 order_by date direction DESC
[2m2025-10-01T17:27:21.059374Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request e9253b71-3c80-402a-aea6-a67440fd3055: Querying details for user 1 with enhanced filters
[2m2025-10-01T17:27:21.059390Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request e9253b71-3c80-402a-aea6-a67440fd3055: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-01T17:27:21.061015Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 11169852-d29e-4f69-bbf3-0fa894b77bb3: Retrieved 0 invoice details (total: 0) in 4ms with enhanced pagination
[2m2025-10-01T17:27:21.061143Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 80778e4f-e804-4c67-b496-ee278f4f6758: Retrieved 0 invoice details (total: 0) in 5ms with enhanced pagination
[2m2025-10-01T17:27:21.061307Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request e9253b71-3c80-402a-aea6-a67440fd3055: Retrieved 0 invoice details (total: 0) in 2ms with enhanced pagination
[2m2025-10-01T17:27:39.770794Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-01T17:27:39.771008Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-01T17:27:39.771118Z[0m [32m INFO[0m [2mlum_rust_ws::api::upload_ocr_v4[0m[2m:[0m Upload OCR request from user: 1
[2m2025-10-01T17:27:40.196233Z[0m [32m INFO[0m [2mlum_rust_ws::api::upload_ocr_v4[0m[2m:[0m Received image file: optimized_1759339657707.jpg (151619 bytes)
[2m2025-10-01T17:27:40.196325Z[0m [32m INFO[0m [2mlum_rust_ws::api::upload_ocr_v4[0m[2m:[0m Using normal mode (1) for user 1
[2m2025-10-01T17:27:40.196345Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üîç Iniciando procesamiento OCR para usuario andresfelipevalenciag@gmail.com
[2m2025-10-01T17:27:40.196363Z[0m [32m INFO[0m [2mlum_rust_ws::shared::users[0m[2m:[0m Querying user by email: andresfelipevalenciag@gmail.com
[2m2025-10-01T17:27:40.198756Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m ü§ñ Iniciando procesamiento con Gemini OCR (mode: Normal)
[2m2025-10-01T17:27:44.564279Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üîç GEMINI RESPONSE COMPLETA: {
  "candidates": [
    {
      "avgLogprobs": -0.001385187548260356,
      "content": {
        "parts": [
          {
            "text": "```json\n{\n  \"issuer_name\": \"FARMACIAS EUROPEAS PN, S.A\",\n  \"ruc\": \"755-247-117717\",\n  \"dv\": \"75\",\n  \"address\": \"San francisco, Calle 50, Entre Calle 70\\ny 75 Este Plaza Sonoma, Local 3.\",\n  \"invoice_number\": \"TFHKC50003376-00040642\",\n  \"date\": \"2025-09-21\",\n  \"total\": 4.95,\n  \"products\": [\n    {\n      \"name\": \"Aero-OM Antiflatulento Gotas 15ml (E)\",\n      \"quantity\": 1,\n      \"unit_price\": 4.95,\n      \"total_price\": 4.95\n    }\n  ]\n}\n```"
          }
        ],
        "role": "model"
      },
      "finishReason": "STOP"
    }
  ],
  "modelVersion": "gemini-2.0-flash",
  "responseId": "jGTdaPHgINfzqtsPyZTM-As",
  "usageMetadata": {
    "candidatesTokenCount": 215,
    "candidatesTokensDetails": [
      {
        "modality": "TEXT",
        "tokenCount": 215
      }
    ],
    "promptTokenCount": 1779,
    "promptTokensDetails": [
      {
        "modality": "TEXT",
        "tokenCount": 489
      },
      {
        "modality": "IMAGE",
        "tokenCount": 1290
      }
    ],
    "totalTokenCount": 1994
  }
}
[2m2025-10-01T17:27:44.564409Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üîç TEXTO ORIGINAL DE GEMINI: '```json
{
  "issuer_name": "FARMACIAS EUROPEAS PN, S.A",
  "ruc": "755-247-117717",
  "dv": "75",
  "address": "San francisco, Calle 50, Entre Calle 70\ny 75 Este Plaza Sonoma, Local 3.",
  "invoice_number": "TFHKC50003376-00040642",
  "date": "2025-09-21",
  "total": 4.95,
  "products": [
    {
      "name": "Aero-OM Antiflatulento Gotas 15ml (E)",
      "quantity": 1,
      "unit_price": 4.95,
      "total_price": 4.95
    }
  ]
}
```'
[2m2025-10-01T17:27:44.564465Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üîç TEXTO LIMPIADO (sin markdown): '{
  "issuer_name": "FARMACIAS EUROPEAS PN, S.A",
  "ruc": "755-247-117717",
  "dv": "75",
  "address": "San francisco, Calle 50, Entre Calle 70\ny 75 Este Plaza Sonoma, Local 3.",
  "invoice_number": "TFHKC50003376-00040642",
  "date": "2025-09-21",
  "total": 4.95,
  "products": [
    {
      "name": "Aero-OM Antiflatulento Gotas 15ml (E)",
      "quantity": 1,
      "unit_price": 4.95,
      "total_price": 4.95
    }
  ]
}'
[2m2025-10-01T17:27:44.564550Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üîç OCR DATOS PARSEADOS:
[2m2025-10-01T17:27:44.564571Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üìÑ Issuer Name: Some("FARMACIAS EUROPEAS PN, S.A")
[2m2025-10-01T17:27:44.564583Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üè¢ RUC: Some("755-247-117717")
[2m2025-10-01T17:27:44.564605Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üî¢ DV: Some("75")
[2m2025-10-01T17:27:44.564613Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üè† Address: Some("San francisco, Calle 50, Entre Calle 70\ny 75 Este Plaza Sonoma, Local 3.")
[2m2025-10-01T17:27:44.564626Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üìÑ Invoice Number: Some("TFHKC50003376-00040642")
[2m2025-10-01T17:27:44.564636Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üìÑ Date: Some("2025-09-21")
[2m2025-10-01T17:27:44.564654Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üìÑ Total: Some(4.95)
[2m2025-10-01T17:27:44.564666Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üìÑ Products Count: 1
[2m2025-10-01T17:27:44.564677Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m     üõí Product 1: 'Aero-OM Antiflatulento Gotas 15ml (E)' - Qty: 1 - Price: 4.95 - Total: 4.95
[2m2025-10-01T17:27:44.564699Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m ‚úÖ OCR Gemini exitoso: Some("FARMACIAS EUROPEAS PN, S.A")
[2m2025-10-01T17:27:44.564855Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üè∑Ô∏è CUFE generado: OCR-FARMACIAS_EUROPEAS_PN_SA-20250921-TFHKC50003376_00040642 (Comercio: FARMACIAS_EUROPEAS_PN_SA, Fecha: 20250921, N√∫mero: TFHKC50003376_00040642)
[2m2025-10-01T17:27:44.564898Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üîç VERIFICANDO DUPLICADOS:
[2m2025-10-01T17:27:44.564908Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üîç CUFE generado: OCR-FARMACIAS_EUROPEAS_PN_SA-20250921-TFHKC50003376_00040642
[2m2025-10-01T17:27:44.564919Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üîç Issuer Name: Some("FARMACIAS EUROPEAS PN, S.A")
[2m2025-10-01T17:27:44.564931Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üîç Invoice Number: Some("TFHKC50003376-00040642")
[2m2025-10-01T17:27:44.564954Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üîç Date: Some("2025-09-21")
[2m2025-10-01T17:27:44.564962Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üîç User ID: 1
[2m2025-10-01T17:27:44.567265Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üîç Duplicado encontrado por CUFE: OCR-FARMACIAS_EUROPEAS_PN_SA-20250921-TFHKC50003376_00040642
[2m2025-10-01T17:27:44.567331Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üìã ‚úÖ FACTURA DUPLICADA DETECTADA para andresfelipevalenciag@gmail.com: CUFE existente OCR-FARMACIAS_EUROPEAS_PN_SA-20250921-TFHKC50003376_00040642
[2m2025-10-01T17:27:44.567365Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üìä OCR Attempt - User: andresfelipevalenciag@gmail.com, Status: duplicate_invoice, Details: Existing CUFE: OCR-FARMACIAS_EUROPEAS_PN_SA-20250921-TFHKC50003376_00040642
[2m2025-10-01T17:27:44.567406Z[0m [33m WARN[0m [2mlum_rust_ws::api::upload_ocr_v4[0m[2m:[0m ‚ùå OCR processing failed for user 1: Esta factura ya fue registrada anteriormente.
[2m2025-10-01T17:32:22.207331Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-01T17:32:22.207502Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-01T17:32:22.207559Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m Fetching user data for user_id: 1
[2m2025-10-01T17:32:22.210108Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m User data retrieved in 2ms for user_id: 1 - email: Some("andresfelipevalenciag@gmail.com")
[2m2025-10-01T17:32:23.292351Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-01T17:32:23.292485Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m Getting user balance for user_id: 1
[2m2025-10-01T17:32:23.294238Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m User balance retrieved successfully for user 1 in 1ms: 295 L√ºmis
[2m2025-10-01T17:32:23.823452Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-01T17:32:23.823687Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0m041e904d-f3ce-480e-b97c-5aac5183110c
[2m2025-10-01T17:32:23.823724Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 041e904d-f3ce-480e-b97c-5aac5183110c: Processing headers for user 1 with limit 50 offset 0
[2m2025-10-01T17:32:23.823762Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 041e904d-f3ce-480e-b97c-5aac5183110c: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            '' as issuer_ruc,
            '' as issuer_dv,
            '' as issuer_address,
            '' as issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-10-01T17:32:23.826139Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 041e904d-f3ce-480e-b97c-5aac5183110c: Retrieved 0 invoice headers (total: 0) in 2ms with enhanced filtering
[2m2025-10-01T17:32:24.116648Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-01T17:32:24.116894Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0ma28bbb0b-5134-4f53-94aa-aacff3d97f78
[2m2025-10-01T17:32:24.116933Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request a28bbb0b-5134-4f53-94aa-aacff3d97f78: Processing headers for user 1 with limit 50 offset 100
[2m2025-10-01T17:32:24.116957Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request a28bbb0b-5134-4f53-94aa-aacff3d97f78: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            '' as issuer_ruc,
            '' as issuer_dv,
            '' as issuer_address,
            '' as issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-10-01T17:32:24.121003Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request a28bbb0b-5134-4f53-94aa-aacff3d97f78: Retrieved 0 invoice headers (total: 0) in 4ms with enhanced filtering
[2m2025-10-01T17:32:24.121928Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-01T17:32:24.122076Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0m51980fc1-80a6-461a-be82-dfb882f0d327
[2m2025-10-01T17:32:24.122104Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 51980fc1-80a6-461a-be82-dfb882f0d327: Processing headers for user 1 with limit 50 offset 50
[2m2025-10-01T17:32:24.122125Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 51980fc1-80a6-461a-be82-dfb882f0d327: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            '' as issuer_ruc,
            '' as issuer_dv,
            '' as issuer_address,
            '' as issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-10-01T17:32:24.124253Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 51980fc1-80a6-461a-be82-dfb882f0d327: Retrieved 0 invoice headers (total: 0) in 2ms with enhanced filtering
[2m2025-10-01T17:32:24.305081Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-01T17:32:24.305358Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0mca820599-b815-4ca1-9ea6-d86d365b57e0
[2m2025-10-01T17:32:24.305399Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request ca820599-b815-4ca1-9ea6-d86d365b57e0: Processing for user 1 with limit 100 offset 0 order_by date direction DESC
[2m2025-10-01T17:32:24.305418Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request ca820599-b815-4ca1-9ea6-d86d365b57e0: Querying details for user 1 with enhanced filters
[2m2025-10-01T17:32:24.305448Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request ca820599-b815-4ca1-9ea6-d86d365b57e0: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-01T17:32:24.308753Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request ca820599-b815-4ca1-9ea6-d86d365b57e0: Retrieved 0 invoice details (total: 0) in 3ms with enhanced pagination
[2m2025-10-01T17:32:24.313516Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-01T17:32:24.313786Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0mcea35fee-9ffc-4810-8b30-4655bb03a1a5
[2m2025-10-01T17:32:24.313831Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request cea35fee-9ffc-4810-8b30-4655bb03a1a5: Processing for user 1 with limit 100 offset 100 order_by date direction DESC
[2m2025-10-01T17:32:24.313850Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request cea35fee-9ffc-4810-8b30-4655bb03a1a5: Querying details for user 1 with enhanced filters
[2m2025-10-01T17:32:24.313878Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request cea35fee-9ffc-4810-8b30-4655bb03a1a5: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-01T17:32:24.314119Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-01T17:32:24.314432Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0maa0d20eb-313c-4ad1-a884-85e3af7d94e2
[2m2025-10-01T17:32:24.314474Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request aa0d20eb-313c-4ad1-a884-85e3af7d94e2: Processing for user 1 with limit 100 offset 200 order_by date direction DESC
[2m2025-10-01T17:32:24.314494Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request aa0d20eb-313c-4ad1-a884-85e3af7d94e2: Querying details for user 1 with enhanced filters
[2m2025-10-01T17:32:24.314549Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request aa0d20eb-313c-4ad1-a884-85e3af7d94e2: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-01T17:32:24.316748Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request cea35fee-9ffc-4810-8b30-4655bb03a1a5: Retrieved 0 invoice details (total: 0) in 2ms with enhanced pagination
[2m2025-10-01T17:32:24.317346Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request aa0d20eb-313c-4ad1-a884-85e3af7d94e2: Retrieved 0 invoice details (total: 0) in 2ms with enhanced pagination
[2m2025-10-01T17:32:43.351526Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-01T17:32:43.351738Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-01T17:32:43.351844Z[0m [32m INFO[0m [2mlum_rust_ws::api::upload_ocr_v4[0m[2m:[0m Upload OCR request from user: 1
[2m2025-10-01T17:32:43.765966Z[0m [32m INFO[0m [2mlum_rust_ws::api::upload_ocr_v4[0m[2m:[0m Received image file: optimized_1759339961264.jpg (151619 bytes)
[2m2025-10-01T17:32:43.766044Z[0m [32m INFO[0m [2mlum_rust_ws::api::upload_ocr_v4[0m[2m:[0m Using normal mode (1) for user 1
[2m2025-10-01T17:32:43.766062Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üîç Iniciando procesamiento OCR para usuario andresfelipevalenciag@gmail.com
[2m2025-10-01T17:32:43.766080Z[0m [32m INFO[0m [2mlum_rust_ws::shared::users[0m[2m:[0m Querying user by email: andresfelipevalenciag@gmail.com
[2m2025-10-01T17:32:43.767912Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m ü§ñ Iniciando procesamiento con Gemini OCR (mode: Normal)
[2m2025-10-01T17:32:46.378296Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üîç GEMINI RESPONSE COMPLETA: {
  "candidates": [
    {
      "avgLogprobs": -0.001385187548260356,
      "content": {
        "parts": [
          {
            "text": "```json\n{\n  \"issuer_name\": \"FARMACIAS EUROPEAS PN, S.A\",\n  \"ruc\": \"755-247-117717\",\n  \"dv\": \"75\",\n  \"address\": \"San francisco, Calle 50, Entre Calle 70\\ny 75 Este Plaza Sonoma, Local 3.\",\n  \"invoice_number\": \"TFHKC50003376-00040642\",\n  \"date\": \"2025-09-21\",\n  \"total\": 4.95,\n  \"products\": [\n    {\n      \"name\": \"Aero-OM Antiflatulento Gotas 15ml (E)\",\n      \"quantity\": 1,\n      \"unit_price\": 4.95,\n      \"total_price\": 4.95\n    }\n  ]\n}\n```"
          }
        ],
        "role": "model"
      },
      "finishReason": "STOP"
    }
  ],
  "modelVersion": "gemini-2.0-flash",
  "responseId": "vGXdaO_XBZitqtsPm7PfsAY",
  "usageMetadata": {
    "candidatesTokenCount": 215,
    "candidatesTokensDetails": [
      {
        "modality": "TEXT",
        "tokenCount": 215
      }
    ],
    "promptTokenCount": 1779,
    "promptTokensDetails": [
      {
        "modality": "IMAGE",
        "tokenCount": 1290
      },
      {
        "modality": "TEXT",
        "tokenCount": 489
      }
    ],
    "totalTokenCount": 1994
  }
}
[2m2025-10-01T17:32:46.378424Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üîç TEXTO ORIGINAL DE GEMINI: '```json
{
  "issuer_name": "FARMACIAS EUROPEAS PN, S.A",
  "ruc": "755-247-117717",
  "dv": "75",
  "address": "San francisco, Calle 50, Entre Calle 70\ny 75 Este Plaza Sonoma, Local 3.",
  "invoice_number": "TFHKC50003376-00040642",
  "date": "2025-09-21",
  "total": 4.95,
  "products": [
    {
      "name": "Aero-OM Antiflatulento Gotas 15ml (E)",
      "quantity": 1,
      "unit_price": 4.95,
      "total_price": 4.95
    }
  ]
}
```'
[2m2025-10-01T17:32:46.378484Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üîç TEXTO LIMPIADO (sin markdown): '{
  "issuer_name": "FARMACIAS EUROPEAS PN, S.A",
  "ruc": "755-247-117717",
  "dv": "75",
  "address": "San francisco, Calle 50, Entre Calle 70\ny 75 Este Plaza Sonoma, Local 3.",
  "invoice_number": "TFHKC50003376-00040642",
  "date": "2025-09-21",
  "total": 4.95,
  "products": [
    {
      "name": "Aero-OM Antiflatulento Gotas 15ml (E)",
      "quantity": 1,
      "unit_price": 4.95,
      "total_price": 4.95
    }
  ]
}'
[2m2025-10-01T17:32:46.378597Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üîç OCR DATOS PARSEADOS:
[2m2025-10-01T17:32:46.378628Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üìÑ Issuer Name: Some("FARMACIAS EUROPEAS PN, S.A")
[2m2025-10-01T17:32:46.378671Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üè¢ RUC: Some("755-247-117717")
[2m2025-10-01T17:32:46.378681Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üî¢ DV: Some("75")
[2m2025-10-01T17:32:46.378689Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üè† Address: Some("San francisco, Calle 50, Entre Calle 70\ny 75 Este Plaza Sonoma, Local 3.")
[2m2025-10-01T17:32:46.378700Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üìÑ Invoice Number: Some("TFHKC50003376-00040642")
[2m2025-10-01T17:32:46.378710Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üìÑ Date: Some("2025-09-21")
[2m2025-10-01T17:32:46.378718Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üìÑ Total: Some(4.95)
[2m2025-10-01T17:32:46.378729Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üìÑ Products Count: 1
[2m2025-10-01T17:32:46.378740Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m     üõí Product 1: 'Aero-OM Antiflatulento Gotas 15ml (E)' - Qty: 1 - Price: 4.95 - Total: 4.95
[2m2025-10-01T17:32:46.378755Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m ‚úÖ OCR Gemini exitoso: Some("FARMACIAS EUROPEAS PN, S.A")
[2m2025-10-01T17:32:46.378890Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üè∑Ô∏è CUFE generado: OCR-FARMACIAS_EUROPEAS_PN_SA-20250921-TFHKC50003376_00040642 (Comercio: FARMACIAS_EUROPEAS_PN_SA, Fecha: 20250921, N√∫mero: TFHKC50003376_00040642)
[2m2025-10-01T17:32:46.378927Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üîç VERIFICANDO DUPLICADOS:
[2m2025-10-01T17:32:46.378936Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üîç CUFE generado: OCR-FARMACIAS_EUROPEAS_PN_SA-20250921-TFHKC50003376_00040642
[2m2025-10-01T17:32:46.378947Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üîç Issuer Name: Some("FARMACIAS EUROPEAS PN, S.A")
[2m2025-10-01T17:32:46.378958Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üîç Invoice Number: Some("TFHKC50003376-00040642")
[2m2025-10-01T17:32:46.378967Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üîç Date: Some("2025-09-21")
[2m2025-10-01T17:32:46.378976Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üîç User ID: 1
[2m2025-10-01T17:32:46.381291Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üîç Duplicado encontrado por CUFE: OCR-FARMACIAS_EUROPEAS_PN_SA-20250921-TFHKC50003376_00040642
[2m2025-10-01T17:32:46.381362Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üìã ‚úÖ FACTURA DUPLICADA DETECTADA para andresfelipevalenciag@gmail.com: CUFE existente OCR-FARMACIAS_EUROPEAS_PN_SA-20250921-TFHKC50003376_00040642
[2m2025-10-01T17:32:46.381410Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üìä OCR Attempt - User: andresfelipevalenciag@gmail.com, Status: duplicate_invoice, Details: Existing CUFE: OCR-FARMACIAS_EUROPEAS_PN_SA-20250921-TFHKC50003376_00040642
[2m2025-10-01T17:32:46.381452Z[0m [33m WARN[0m [2mlum_rust_ws::api::upload_ocr_v4[0m[2m:[0m ‚ùå OCR processing failed for user 1: Esta factura ya fue registrada anteriormente.
[2m2025-10-01T17:33:40.635965Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-01T17:33:40.636228Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-01T17:33:40.636331Z[0m [32m INFO[0m [2mlum_rust_ws::api::upload_ocr_v4[0m[2m:[0m Upload OCR request from user: 1
[2m2025-10-01T17:33:41.060817Z[0m [32m INFO[0m [2mlum_rust_ws::api::upload_ocr_v4[0m[2m:[0m Received image file: optimized_1759340018574.jpg (151619 bytes)
[2m2025-10-01T17:33:41.060900Z[0m [32m INFO[0m [2mlum_rust_ws::api::upload_ocr_v4[0m[2m:[0m Using normal mode (1) for user 1
[2m2025-10-01T17:33:41.060918Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üîç Iniciando procesamiento OCR para usuario andresfelipevalenciag@gmail.com
[2m2025-10-01T17:33:41.060934Z[0m [32m INFO[0m [2mlum_rust_ws::shared::users[0m[2m:[0m Querying user by email: andresfelipevalenciag@gmail.com
[2m2025-10-01T17:33:41.063341Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m ü§ñ Iniciando procesamiento con Gemini OCR (mode: Normal)
[2m2025-10-01T17:33:43.900543Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üîç GEMINI RESPONSE COMPLETA: {
  "candidates": [
    {
      "avgLogprobs": -0.001385187548260356,
      "content": {
        "parts": [
          {
            "text": "```json\n{\n  \"issuer_name\": \"FARMACIAS EUROPEAS PN, S.A\",\n  \"ruc\": \"755-247-117717\",\n  \"dv\": \"75\",\n  \"address\": \"San francisco, Calle 50, Entre Calle 70\\ny 75 Este Plaza Sonoma, Local 3.\",\n  \"invoice_number\": \"TFHKC50003376-00040642\",\n  \"date\": \"2025-09-21\",\n  \"total\": 4.95,\n  \"products\": [\n    {\n      \"name\": \"Aero-OM Antiflatulento Gotas 15ml (E)\",\n      \"quantity\": 1,\n      \"unit_price\": 4.95,\n      \"total_price\": 4.95\n    }\n  ]\n}\n```"
          }
        ],
        "role": "model"
      },
      "finishReason": "STOP"
    }
  ],
  "modelVersion": "gemini-2.0-flash",
  "responseId": "9WXdaJKwFqCnqtsPluS7-Qc",
  "usageMetadata": {
    "candidatesTokenCount": 215,
    "candidatesTokensDetails": [
      {
        "modality": "TEXT",
        "tokenCount": 215
      }
    ],
    "promptTokenCount": 1779,
    "promptTokensDetails": [
      {
        "modality": "IMAGE",
        "tokenCount": 1290
      },
      {
        "modality": "TEXT",
        "tokenCount": 489
      }
    ],
    "totalTokenCount": 1994
  }
}
[2m2025-10-01T17:33:43.900675Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üîç TEXTO ORIGINAL DE GEMINI: '```json
{
  "issuer_name": "FARMACIAS EUROPEAS PN, S.A",
  "ruc": "755-247-117717",
  "dv": "75",
  "address": "San francisco, Calle 50, Entre Calle 70\ny 75 Este Plaza Sonoma, Local 3.",
  "invoice_number": "TFHKC50003376-00040642",
  "date": "2025-09-21",
  "total": 4.95,
  "products": [
    {
      "name": "Aero-OM Antiflatulento Gotas 15ml (E)",
      "quantity": 1,
      "unit_price": 4.95,
      "total_price": 4.95
    }
  ]
}
```'
[2m2025-10-01T17:33:43.900732Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üîç TEXTO LIMPIADO (sin markdown): '{
  "issuer_name": "FARMACIAS EUROPEAS PN, S.A",
  "ruc": "755-247-117717",
  "dv": "75",
  "address": "San francisco, Calle 50, Entre Calle 70\ny 75 Este Plaza Sonoma, Local 3.",
  "invoice_number": "TFHKC50003376-00040642",
  "date": "2025-09-21",
  "total": 4.95,
  "products": [
    {
      "name": "Aero-OM Antiflatulento Gotas 15ml (E)",
      "quantity": 1,
      "unit_price": 4.95,
      "total_price": 4.95
    }
  ]
}'
[2m2025-10-01T17:33:43.900822Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üîç OCR DATOS PARSEADOS:
[2m2025-10-01T17:33:43.900839Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üìÑ Issuer Name: Some("FARMACIAS EUROPEAS PN, S.A")
[2m2025-10-01T17:33:43.900850Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üè¢ RUC: Some("755-247-117717")
[2m2025-10-01T17:33:43.900859Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üî¢ DV: Some("75")
[2m2025-10-01T17:33:43.900867Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üè† Address: Some("San francisco, Calle 50, Entre Calle 70\ny 75 Este Plaza Sonoma, Local 3.")
[2m2025-10-01T17:33:43.900880Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üìÑ Invoice Number: Some("TFHKC50003376-00040642")
[2m2025-10-01T17:33:43.900889Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üìÑ Date: Some("2025-09-21")
[2m2025-10-01T17:33:43.900897Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üìÑ Total: Some(4.95)
[2m2025-10-01T17:33:43.900907Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üìÑ Products Count: 1
[2m2025-10-01T17:33:43.900917Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m     üõí Product 1: 'Aero-OM Antiflatulento Gotas 15ml (E)' - Qty: 1 - Price: 4.95 - Total: 4.95
[2m2025-10-01T17:33:43.900930Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m ‚úÖ OCR Gemini exitoso: Some("FARMACIAS EUROPEAS PN, S.A")
[2m2025-10-01T17:33:43.901030Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üè∑Ô∏è CUFE generado: OCR-FARMACIAS_EUROPEAS_PN_SA-20250921-TFHKC50003376_00040642 (Comercio: FARMACIAS_EUROPEAS_PN_SA, Fecha: 20250921, N√∫mero: TFHKC50003376_00040642)
[2m2025-10-01T17:33:43.901060Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üîç VERIFICANDO DUPLICADOS:
[2m2025-10-01T17:33:43.901069Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üîç CUFE generado: OCR-FARMACIAS_EUROPEAS_PN_SA-20250921-TFHKC50003376_00040642
[2m2025-10-01T17:33:43.901081Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üîç Issuer Name: Some("FARMACIAS EUROPEAS PN, S.A")
[2m2025-10-01T17:33:43.901091Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üîç Invoice Number: Some("TFHKC50003376-00040642")
[2m2025-10-01T17:33:43.901101Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üîç Date: Some("2025-09-21")
[2m2025-10-01T17:33:43.901109Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üîç User ID: 1
[2m2025-10-01T17:33:43.902789Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üîç Duplicado encontrado por CUFE: OCR-FARMACIAS_EUROPEAS_PN_SA-20250921-TFHKC50003376_00040642
[2m2025-10-01T17:33:43.902836Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üìã ‚úÖ FACTURA DUPLICADA DETECTADA para andresfelipevalenciag@gmail.com: CUFE existente OCR-FARMACIAS_EUROPEAS_PN_SA-20250921-TFHKC50003376_00040642
[2m2025-10-01T17:33:43.902859Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üìä OCR Attempt - User: andresfelipevalenciag@gmail.com, Status: duplicate_invoice, Details: Existing CUFE: OCR-FARMACIAS_EUROPEAS_PN_SA-20250921-TFHKC50003376_00040642
[2m2025-10-01T17:33:43.902889Z[0m [33m WARN[0m [2mlum_rust_ws::api::upload_ocr_v4[0m[2m:[0m ‚ùå OCR processing failed for user 1: Esta factura ya fue registrada anteriormente.
[2m2025-10-01T17:37:47.879695Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-01T17:37:47.879872Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-01T17:37:47.879932Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m Fetching user data for user_id: 1
[2m2025-10-01T17:37:47.882202Z[0m [32m INFO[0m [2mlum_rust_ws::api::userdata_v4[0m[2m:[0m User data retrieved in 2ms for user_id: 1 - email: Some("andresfelipevalenciag@gmail.com")
[2m2025-10-01T17:37:48.678114Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-01T17:37:48.678379Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0m1d635c26-b19d-4d2d-993a-212cb8d88c64
[2m2025-10-01T17:37:48.678415Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 1d635c26-b19d-4d2d-993a-212cb8d88c64: Processing headers for user 1 with limit 50 offset 0
[2m2025-10-01T17:37:48.678442Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 1d635c26-b19d-4d2d-993a-212cb8d88c64: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            '' as issuer_ruc,
            '' as issuer_dv,
            '' as issuer_address,
            '' as issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-10-01T17:37:48.681903Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 1d635c26-b19d-4d2d-993a-212cb8d88c64: Retrieved 0 invoice headers (total: 0) in 3ms with enhanced filtering
[2m2025-10-01T17:37:48.970291Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-01T17:37:48.970524Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0m92962eb2-0bf0-4969-9b95-e87bf591a61e
[2m2025-10-01T17:37:48.970561Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 92962eb2-0bf0-4969-9b95-e87bf591a61e: Processing headers for user 1 with limit 50 offset 100
[2m2025-10-01T17:37:48.970587Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 92962eb2-0bf0-4969-9b95-e87bf591a61e: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            '' as issuer_ruc,
            '' as issuer_dv,
            '' as issuer_address,
            '' as issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-10-01T17:37:48.972557Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 92962eb2-0bf0-4969-9b95-e87bf591a61e: Retrieved 0 invoice headers (total: 0) in 2ms with enhanced filtering
[2m2025-10-01T17:37:48.977476Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-01T17:37:48.977690Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice headers with enhanced filtering [3mrequest_id[0m[2m=[0m9220c2a5-5de3-458f-b5f5-9b16709454a5
[2m2025-10-01T17:37:48.977725Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 9220c2a5-5de3-458f-b5f5-9b16709454a5: Processing headers for user 1 with limit 50 offset 50
[2m2025-10-01T17:37:48.977751Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 9220c2a5-5de3-458f-b5f5-9b16709454a5: Executing header query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY h.reception_date DESC) as id,
            h.no,
            h.date,
            h.tot_itbms,
            h.cufe,
            h.issuer_name,
            h.tot_amount,
            h.url,
            h.process_date,
            h.reception_date,
            h.type,
            '' as time,
            '' as auth_date,
            '' as issuer_ruc,
            '' as issuer_dv,
            '' as issuer_address,
            '' as issuer_phone,
            '' as receptor_name,
            COALESCE(detail_counts.details_count, 0) as details_count,
            COALESCE(payment_counts.payments_count, 0) as payments_count
        FROM public.invoice_header h
        LEFT JOIN (
            SELECT cufe, COUNT(*) as details_count
            FROM public.invoice_detail
            GROUP BY cufe
        ) detail_counts ON h.cufe = detail_counts.cufe
        LEFT JOIN (
            SELECT cufe, COUNT(*) as payments_count
            FROM public.invoice_payment
            GROUP BY cufe
        ) payment_counts ON h.cufe = payment_counts.cufe
        WHERE h.user_id = $1
     AND h.reception_date >= $2 ORDER BY h.reception_date DESC LIMIT $3 OFFSET $4
[2m2025-10-01T17:37:48.979475Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 9220c2a5-5de3-458f-b5f5-9b16709454a5: Retrieved 0 invoice headers (total: 0) in 1ms with enhanced filtering
[2m2025-10-01T17:37:49.142682Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-01T17:37:49.142900Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0md69b2dd2-a599-4af5-8ce7-48003b1f9537
[2m2025-10-01T17:37:49.142938Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request d69b2dd2-a599-4af5-8ce7-48003b1f9537: Processing for user 1 with limit 100 offset 0 order_by date direction DESC
[2m2025-10-01T17:37:49.142958Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request d69b2dd2-a599-4af5-8ce7-48003b1f9537: Querying details for user 1 with enhanced filters
[2m2025-10-01T17:37:49.143005Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request d69b2dd2-a599-4af5-8ce7-48003b1f9537: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-01T17:37:49.143829Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-01T17:37:49.143936Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-01T17:37:49.144096Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m2723400b-da60-4e89-a62c-ca882788cf4e
[2m2025-10-01T17:37:49.144134Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 2723400b-da60-4e89-a62c-ca882788cf4e: Processing for user 1 with limit 100 offset 200 order_by date direction DESC
[2m2025-10-01T17:37:49.144172Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 2723400b-da60-4e89-a62c-ca882788cf4e: Querying details for user 1 with enhanced filters
[2m2025-10-01T17:37:49.144193Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request: Getting invoice details with enhanced pagination [3mrequest_id[0m[2m=[0m072eead3-b4f2-4d09-81b5-da3922ec2939
[2m2025-10-01T17:37:49.144198Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 2723400b-da60-4e89-a62c-ca882788cf4e: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-01T17:37:49.144221Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 072eead3-b4f2-4d09-81b5-da3922ec2939: Processing for user 1 with limit 100 offset 100 order_by date direction DESC
[2m2025-10-01T17:37:49.144241Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 072eead3-b4f2-4d09-81b5-da3922ec2939: Querying details for user 1 with enhanced filters
[2m2025-10-01T17:37:49.144293Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 072eead3-b4f2-4d09-81b5-da3922ec2939: Executing optimized query: 
        SELECT 
            ROW_NUMBER() OVER (ORDER BY d.date DESC) as id,
            d.cufe, d.quantity, d.code, d.description, d.unit_price, d.amount,
            d.unit_discount, d.date, d.total, d.issuer_name, d.reception_date
        FROM public.invoice_with_details d
        WHERE d.user_id = $1
     AND d.reception_date >= $2 ORDER BY d.date DESC LIMIT $3 OFFSET $4
[2m2025-10-01T17:37:49.146008Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 2723400b-da60-4e89-a62c-ca882788cf4e: Retrieved 0 invoice details (total: 0) in 1ms with enhanced pagination
[2m2025-10-01T17:37:49.146076Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request d69b2dd2-a599-4af5-8ce7-48003b1f9537: Retrieved 0 invoice details (total: 0) in 3ms with enhanced pagination
[2m2025-10-01T17:37:49.147033Z[0m [32m INFO[0m [2mlum_rust_ws::api::invoice_query_v4[0m[2m:[0m Request 072eead3-b4f2-4d09-81b5-da3922ec2939: Retrieved 0 invoice details (total: 0) in 2ms with enhanced pagination
[2m2025-10-01T17:37:50.250387Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-01T17:37:50.250605Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m Getting user balance for user_id: 1
[2m2025-10-01T17:37:50.252729Z[0m [32m INFO[0m [2mlum_rust_ws::api::rewards_v4[0m[2m:[0m User balance retrieved successfully for user 1 in 2ms: 295 L√ºmis
[2m2025-10-01T17:38:55.242653Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-01T17:38:55.242849Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-01T17:38:55.242959Z[0m [32m INFO[0m [2mlum_rust_ws::api::upload_ocr_v4[0m[2m:[0m Upload OCR request from user: 1
[2m2025-10-01T17:38:55.829083Z[0m [32m INFO[0m [2mlum_rust_ws::api::upload_ocr_v4[0m[2m:[0m Received image file: optimized_1759340332921.jpg (296580 bytes)
[2m2025-10-01T17:38:55.829244Z[0m [32m INFO[0m [2mlum_rust_ws::api::upload_ocr_v4[0m[2m:[0m Using normal mode (1) for user 1
[2m2025-10-01T17:38:55.829292Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üîç Iniciando procesamiento OCR para usuario andresfelipevalenciag@gmail.com
[2m2025-10-01T17:38:55.829310Z[0m [32m INFO[0m [2mlum_rust_ws::shared::users[0m[2m:[0m Querying user by email: andresfelipevalenciag@gmail.com
[2m2025-10-01T17:38:55.830878Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m ü§ñ Iniciando procesamiento con Gemini OCR (mode: Normal)
[2m2025-10-01T17:38:59.477389Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üîç GEMINI RESPONSE COMPLETA: {
  "candidates": [
    {
      "avgLogprobs": -0.0031894794730253,
      "content": {
        "parts": [
          {
            "text": "```json\n{\n  \"issuer_name\": \"FARMACIAS EUROPEAS PN, S.A\",\n  \"ruc\": \"755-247-117717\",\n  \"dv\": \"75\",\n  \"address\": \"San francisco, Calle 50, Entre Calle 70\\ny 75 Este Plaza Sonoma, Local 3.\",\n  \"invoice_number\": \"TFHKC50003376-00040642\",\n  \"date\": \"2025-09-21\",\n  \"total\": 4.95,\n  \"products\": [\n    {\n      \"name\": \"Aero-OM Antiilatulento Gotas 15ml (E)\",\n      \"quantity\": 1,\n      \"unit_price\": 4.95,\n      \"total_price\": 4.95\n    }\n  ]\n}\n```"
          }
        ],
        "role": "model"
      },
      "finishReason": "STOP"
    }
  ],
  "modelVersion": "gemini-2.0-flash",
  "responseId": "MGfdaMrBBLeMmtkPxeX6GA",
  "usageMetadata": {
    "candidatesTokenCount": 215,
    "candidatesTokensDetails": [
      {
        "modality": "TEXT",
        "tokenCount": 215
      }
    ],
    "promptTokenCount": 2295,
    "promptTokensDetails": [
      {
        "modality": "IMAGE",
        "tokenCount": 1806
      },
      {
        "modality": "TEXT",
        "tokenCount": 489
      }
    ],
    "totalTokenCount": 2510
  }
}
[2m2025-10-01T17:38:59.477574Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üîç TEXTO ORIGINAL DE GEMINI: '```json
{
  "issuer_name": "FARMACIAS EUROPEAS PN, S.A",
  "ruc": "755-247-117717",
  "dv": "75",
  "address": "San francisco, Calle 50, Entre Calle 70\ny 75 Este Plaza Sonoma, Local 3.",
  "invoice_number": "TFHKC50003376-00040642",
  "date": "2025-09-21",
  "total": 4.95,
  "products": [
    {
      "name": "Aero-OM Antiilatulento Gotas 15ml (E)",
      "quantity": 1,
      "unit_price": 4.95,
      "total_price": 4.95
    }
  ]
}
```'
[2m2025-10-01T17:38:59.477633Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üîç TEXTO LIMPIADO (sin markdown): '{
  "issuer_name": "FARMACIAS EUROPEAS PN, S.A",
  "ruc": "755-247-117717",
  "dv": "75",
  "address": "San francisco, Calle 50, Entre Calle 70\ny 75 Este Plaza Sonoma, Local 3.",
  "invoice_number": "TFHKC50003376-00040642",
  "date": "2025-09-21",
  "total": 4.95,
  "products": [
    {
      "name": "Aero-OM Antiilatulento Gotas 15ml (E)",
      "quantity": 1,
      "unit_price": 4.95,
      "total_price": 4.95
    }
  ]
}'
[2m2025-10-01T17:38:59.477751Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üîç OCR DATOS PARSEADOS:
[2m2025-10-01T17:38:59.477771Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üìÑ Issuer Name: Some("FARMACIAS EUROPEAS PN, S.A")
[2m2025-10-01T17:38:59.477783Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üè¢ RUC: Some("755-247-117717")
[2m2025-10-01T17:38:59.477793Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üî¢ DV: Some("75")
[2m2025-10-01T17:38:59.477800Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üè† Address: Some("San francisco, Calle 50, Entre Calle 70\ny 75 Este Plaza Sonoma, Local 3.")
[2m2025-10-01T17:38:59.477812Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üìÑ Invoice Number: Some("TFHKC50003376-00040642")
[2m2025-10-01T17:38:59.477821Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üìÑ Date: Some("2025-09-21")
[2m2025-10-01T17:38:59.477830Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üìÑ Total: Some(4.95)
[2m2025-10-01T17:38:59.477840Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üìÑ Products Count: 1
[2m2025-10-01T17:38:59.477851Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m     üõí Product 1: 'Aero-OM Antiilatulento Gotas 15ml (E)' - Qty: 1 - Price: 4.95 - Total: 4.95
[2m2025-10-01T17:38:59.477864Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m ‚úÖ OCR Gemini exitoso: Some("FARMACIAS EUROPEAS PN, S.A")
[2m2025-10-01T17:38:59.477973Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üè∑Ô∏è CUFE generado: OCR-FARMACIAS_EUROPEAS_PN_SA-20250921-TFHKC50003376_00040642 (Comercio: FARMACIAS_EUROPEAS_PN_SA, Fecha: 20250921, N√∫mero: TFHKC50003376_00040642)
[2m2025-10-01T17:38:59.478012Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üîç VERIFICANDO DUPLICADOS:
[2m2025-10-01T17:38:59.478030Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üîç CUFE generado: OCR-FARMACIAS_EUROPEAS_PN_SA-20250921-TFHKC50003376_00040642
[2m2025-10-01T17:38:59.478046Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üîç Issuer Name: Some("FARMACIAS EUROPEAS PN, S.A")
[2m2025-10-01T17:38:59.478059Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üîç Invoice Number: Some("TFHKC50003376-00040642")
[2m2025-10-01T17:38:59.478068Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üîç Date: Some("2025-09-21")
[2m2025-10-01T17:38:59.478078Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üîç User ID: 1
[2m2025-10-01T17:38:59.479646Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üîç Duplicado encontrado por CUFE: OCR-FARMACIAS_EUROPEAS_PN_SA-20250921-TFHKC50003376_00040642
[2m2025-10-01T17:38:59.479721Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üìã ‚úÖ FACTURA DUPLICADA DETECTADA para andresfelipevalenciag@gmail.com: CUFE existente OCR-FARMACIAS_EUROPEAS_PN_SA-20250921-TFHKC50003376_00040642
[2m2025-10-01T17:38:59.479748Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üìä OCR Attempt - User: andresfelipevalenciag@gmail.com, Status: duplicate_invoice, Details: Existing CUFE: OCR-FARMACIAS_EUROPEAS_PN_SA-20250921-TFHKC50003376_00040642
[2m2025-10-01T17:38:59.479798Z[0m [33m WARN[0m [2mlum_rust_ws::api::upload_ocr_v4[0m[2m:[0m ‚ùå OCR processing failed for user 1: Esta factura ya fue registrada anteriormente.
[2m2025-10-01T17:40:23.878526Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-01T17:40:23.878746Z[0m [32m INFO[0m [2mlum_rust_ws::middleware::auth[0m[2m:[0m üîê JWT authentication successful [3muser_id[0m[2m=[0m1 [3memail[0m[2m=[0mandresfelipevalenciag@gmail.com
[2m2025-10-01T17:40:23.878850Z[0m [32m INFO[0m [2mlum_rust_ws::api::upload_ocr_v4[0m[2m:[0m Upload OCR request from user: 1
[2m2025-10-01T17:40:24.339401Z[0m [32m INFO[0m [2mlum_rust_ws::api::upload_ocr_v4[0m[2m:[0m Received image file: optimized_1759340421855.jpg (123087 bytes)
[2m2025-10-01T17:40:24.339479Z[0m [32m INFO[0m [2mlum_rust_ws::api::upload_ocr_v4[0m[2m:[0m Using normal mode (1) for user 1
[2m2025-10-01T17:40:24.339495Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üîç Iniciando procesamiento OCR para usuario andresfelipevalenciag@gmail.com
[2m2025-10-01T17:40:24.339514Z[0m [32m INFO[0m [2mlum_rust_ws::shared::users[0m[2m:[0m Querying user by email: andresfelipevalenciag@gmail.com
[2m2025-10-01T17:40:24.341962Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m ü§ñ Iniciando procesamiento con Gemini OCR (mode: Normal)
[2m2025-10-01T17:40:27.131929Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üîç GEMINI RESPONSE COMPLETA: {
  "candidates": [
    {
      "avgLogprobs": -0.002775309253330073,
      "content": {
        "parts": [
          {
            "text": "```json\n{\n  \"issuer_name\": \"LAL'S\",\n  \"ruc\": \"2605120-1-834459\",\n  \"dv\": \"32\",\n  \"address\": \"Lalo's Balboa Boutique\",\n  \"invoice_number\": \"BB185660_258\",\n  \"date\": \"2025-09-21\",\n  \"total\": 21.29,\n  \"products\": [\n    {\n      \"name\": \"Cazuela de Frijoles + 1x Carne Molida\",\n      \"quantity\": 1,\n      \"unit_price\": 9.95,\n      \"total_price\": 9.95\n    },\n    {\n      \"name\": \"Cazuela de Frijoles + 1x Carne Molida\",\n      \"quantity\": 1,\n      \"unit_price\": 9.95,\n      \"total_price\": 9.95\n    }\n  ]\n}\n```"
          }
        ],
        "role": "model"
      },
      "finishReason": "STOP"
    }
  ],
  "modelVersion": "gemini-2.0-flash",
  "responseId": "iGfdaKT-JObVz7IP__WWwAM",
  "usageMetadata": {
    "candidatesTokenCount": 242,
    "candidatesTokensDetails": [
      {
        "modality": "TEXT",
        "tokenCount": 242
      }
    ],
    "promptTokenCount": 2295,
    "promptTokensDetails": [
      {
        "modality": "TEXT",
        "tokenCount": 489
      },
      {
        "modality": "IMAGE",
        "tokenCount": 1806
      }
    ],
    "totalTokenCount": 2537
  }
}
[2m2025-10-01T17:40:27.132099Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üîç TEXTO ORIGINAL DE GEMINI: '```json
{
  "issuer_name": "LAL'S",
  "ruc": "2605120-1-834459",
  "dv": "32",
  "address": "Lalo's Balboa Boutique",
  "invoice_number": "BB185660_258",
  "date": "2025-09-21",
  "total": 21.29,
  "products": [
    {
      "name": "Cazuela de Frijoles + 1x Carne Molida",
      "quantity": 1,
      "unit_price": 9.95,
      "total_price": 9.95
    },
    {
      "name": "Cazuela de Frijoles + 1x Carne Molida",
      "quantity": 1,
      "unit_price": 9.95,
      "total_price": 9.95
    }
  ]
}
```'
[2m2025-10-01T17:40:27.132177Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üîç TEXTO LIMPIADO (sin markdown): '{
  "issuer_name": "LAL'S",
  "ruc": "2605120-1-834459",
  "dv": "32",
  "address": "Lalo's Balboa Boutique",
  "invoice_number": "BB185660_258",
  "date": "2025-09-21",
  "total": 21.29,
  "products": [
    {
      "name": "Cazuela de Frijoles + 1x Carne Molida",
      "quantity": 1,
      "unit_price": 9.95,
      "total_price": 9.95
    },
    {
      "name": "Cazuela de Frijoles + 1x Carne Molida",
      "quantity": 1,
      "unit_price": 9.95,
      "total_price": 9.95
    }
  ]
}'
[2m2025-10-01T17:40:27.132285Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üîç OCR DATOS PARSEADOS:
[2m2025-10-01T17:40:27.132310Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üìÑ Issuer Name: Some("LAL'S")
[2m2025-10-01T17:40:27.132336Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üè¢ RUC: Some("2605120-1-834459")
[2m2025-10-01T17:40:27.132346Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üî¢ DV: Some("32")
[2m2025-10-01T17:40:27.132354Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üè† Address: Some("Lalo's Balboa Boutique")
[2m2025-10-01T17:40:27.132363Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üìÑ Invoice Number: Some("BB185660_258")
[2m2025-10-01T17:40:27.132377Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üìÑ Date: Some("2025-09-21")
[2m2025-10-01T17:40:27.132385Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üìÑ Total: Some(21.29)
[2m2025-10-01T17:40:27.132397Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üìÑ Products Count: 2
[2m2025-10-01T17:40:27.132408Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m     üõí Product 1: 'Cazuela de Frijoles + 1x Carne Molida' - Qty: 1 - Price: 9.95 - Total: 9.95
[2m2025-10-01T17:40:27.132421Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m     üõí Product 2: 'Cazuela de Frijoles + 1x Carne Molida' - Qty: 1 - Price: 9.95 - Total: 9.95
[2m2025-10-01T17:40:27.132433Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m ‚úÖ OCR Gemini exitoso: Some("LAL'S")
[2m2025-10-01T17:40:27.132531Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üè∑Ô∏è CUFE generado: OCR-LAL'S-20250921-BB185660_258 (Comercio: LAL'S, Fecha: 20250921, N√∫mero: BB185660_258)
[2m2025-10-01T17:40:27.132562Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üîç VERIFICANDO DUPLICADOS:
[2m2025-10-01T17:40:27.132572Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üîç CUFE generado: OCR-LAL'S-20250921-BB185660_258
[2m2025-10-01T17:40:27.132581Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üîç Issuer Name: Some("LAL'S")
[2m2025-10-01T17:40:27.132589Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üîç Invoice Number: Some("BB185660_258")
[2m2025-10-01T17:40:27.132598Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üîç Date: Some("2025-09-21")
[2m2025-10-01T17:40:27.132605Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m   üîç User ID: 1
[2m2025-10-01T17:40:27.135531Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üìã ‚úÖ NO SE ENCONTR√ì DUPLICADO - Procediendo a guardar factura
[2m2025-10-01T17:40:27.135648Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üîë Partkey asignado al producto 'Cazuela de Frijoles + 1x Carne': OCR-LAL'S-20250921-BB185660_258|1
[2m2025-10-01T17:40:27.135674Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üîë Partkey asignado al producto 'Cazuela de Frijoles + 1x Carne': OCR-LAL'S-20250921-BB185660_258|2
[2m2025-10-01T17:40:27.135689Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üíæ Guardando datos de factura en base de datos: OCR-LAL'S-20250921-BB185660_258
[2m2025-10-01T17:40:27.146128Z[0m [32m INFO[0m [2msqlx::postgres::notice[0m[2m:[0m Usuario 1, sin redenci√≥n previa, buscando desde: 2025-09-08
[2m2025-10-01T17:40:27.146816Z[0m [32m INFO[0m [2msqlx::postgres::notice[0m[2m:[0m Usuario 1, contando desde semana m√°s reciente con facturas: 2025-09-29
[2m2025-10-01T17:40:27.147728Z[0m [32m INFO[0m [2msqlx::postgres::notice[0m[2m:[0m Semana 0 (desde 2025-09-29 hasta 2025-10-05 00:00:00): facturas = t
[2m2025-10-01T17:40:27.147889Z[0m [32m INFO[0m [2msqlx::postgres::notice[0m[2m:[0m Semana 1 (desde 2025-09-22 hasta 2025-09-28 00:00:00): facturas = t
[2m2025-10-01T17:40:27.147948Z[0m [32m INFO[0m [2msqlx::postgres::notice[0m[2m:[0m Semana 2 (desde 2025-09-15 hasta 2025-09-21 00:00:00): facturas = t
[2m2025-10-01T17:40:27.148144Z[0m [32m INFO[0m [2msqlx::postgres::notice[0m[2m:[0m Semana 3 (desde 2025-09-08 hasta 2025-09-14 00:00:00): facturas = t
[2m2025-10-01T17:40:27.148233Z[0m [32m INFO[0m [2msqlx::postgres::notice[0m[2m:[0m Resultado final para usuario 1: 4 semanas consecutivas (despu√©s de redenci√≥n: <NULL>)
[2m2025-10-01T17:40:27.197656Z[0m [31mERROR[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m Error guardando datos para andresfelipevalenciag@gmail.com: Error insertando invoice_detail: error returned from database: duplicate key value violates unique constraint "idx_invoice_detail_partkey"
[2m2025-10-01T17:40:27.197713Z[0m [32m INFO[0m [2mlum_rust_ws::services::ocr_service[0m[2m:[0m üìä OCR Attempt - User: andresfelipevalenciag@gmail.com, Status: database_error, Details: Error insertando invoice_detail: error returned from database: duplicate key value violates unique constraint "idx_invoice_detail_partkey"
[2m2025-10-01T17:40:27.197759Z[0m [33m WARN[0m [2mlum_rust_ws::api::upload_ocr_v4[0m[2m:[0m ‚ùå OCR processing failed for user 1: Tu factura fue procesada correctamente, pero hubo un problema guardando los datos. Nuestro equipo lo revisar√°.
[2m2025-10-01T17:40:27.198118Z[0m [31mERROR[0m [2mtower_http::trace::on_failure[0m[2m:[0m response failed [3mclassification[0m[2m=[0mStatus code: 500 Internal Server Error [3mlatency[0m[2m=[0m3319 ms
[2m2025-10-01T17:41:09.316598Z[0m [32m INFO[0m [2mlum_rust_ws[0m[2m:[0m signal received, starting graceful shutdown
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.34s
     Running `target/debug/lum_rust_ws`
[2m2025-10-01T18:41:56.687992Z[0m [32m INFO[0m [2mlum_rust_ws::monitoring[0m[2m:[0m üîç Monitoring system initialized
[2m2025-10-01T18:41:56.688066Z[0m [32m INFO[0m [2mlum_rust_ws[0m[2m:[0m üîç Monitoring system initialized
[2m2025-10-01T18:41:56.688120Z[0m [32m INFO[0m [2mlum_rust_ws::optimization[0m[2m:[0m üîß Creating optimized database pool with 50 max connections
[2m2025-10-01T18:41:57.240449Z[0m [32m INFO[0m [2mlum_rust_ws::optimization[0m[2m:[0m ‚úÖ Database pool created successfully
[2m2025-10-01T18:41:57.240560Z[0m [32m INFO[0m [2mlum_rust_ws::optimization[0m[2m:[0m üîß Creating optimized Redis client
[2m2025-10-01T18:41:57.240697Z[0m [32m INFO[0m [2mlum_rust_ws::optimization[0m[2m:[0m ‚úÖ Redis client created successfully
[2m2025-10-01T18:41:57.290351Z[0m [32m INFO[0m [2mlum_rust_ws::domains::qr::service[0m[2m:[0m üöÄ Initializing optimized hybrid QR service (2-level cascade)
[2m2025-10-01T18:41:57.290392Z[0m [32m INFO[0m [2mlum_rust_ws::domains::qr::service[0m[2m:[0m üìä Expected performance: 85% success with Rust (5-15ms), 12% with Python fallback (30-50ms)
[2m2025-10-01T18:41:57.290481Z[0m [32m INFO[0m [2mlum_rust_ws::shared::performance[0m[2m:[0m üöÄ Initializing PerformanceManager with advanced configuration
[2m2025-10-01T18:41:57.290504Z[0m [32m INFO[0m [2mlum_rust_ws::shared::performance[0m[2m:[0m üìä QR Detection: 50 max concurrent
[2m2025-10-01T18:41:57.290514Z[0m [32m INFO[0m [2mlum_rust_ws::shared::performance[0m[2m:[0m üìä OCR Processing: 20 max concurrent
[2m2025-10-01T18:41:57.290525Z[0m [32m INFO[0m [2mlum_rust_ws::shared::performance[0m[2m:[0m üìä Webhook Processing: 100 max concurrent
[2m2025-10-01T18:41:57.290535Z[0m [32m INFO[0m [2mlum_rust_ws::shared::performance[0m[2m:[0m üìä API Requests: 200 max concurrent
[2m2025-10-01T18:41:57.290680Z[0m [32m INFO[0m [2mlum_rust_ws::webhook::deduplication[0m[2m:[0m üîÑ MessageDeduplicator initialized with TTL: 300s, max_entries: 10000
[2m2025-10-01T18:41:57.290715Z[0m [32m INFO[0m [2mlum_rust_ws::shared::performance[0m[2m:[0m üî• Starting performance warm-up process...
[2m2025-10-01T18:41:57.292663Z[0m [32m INFO[0m [2mlum_rust_ws::shared::performance[0m[2m:[0m ‚úÖ Database connection verified
[2m2025-10-01T18:41:57.293090Z[0m [32m INFO[0m [2mlum_rust_ws::shared::performance[0m[2m:[0m ‚úÖ Redis connection verified
[2m2025-10-01T18:41:57.293191Z[0m [32m INFO[0m [2mlum_rust_ws::shared::performance[0m[2m:[0m üî• Performance warm-up completed
[2m2025-10-01T18:41:57.293230Z[0m [32m INFO[0m [2mlum_rust_ws[0m[2m:[0m üöÄ Application state initialized with optimized configuration
[2m2025-10-01T18:41:57.300248Z[0m [32m INFO[0m [2mlum_rust_ws[0m[2m:[0m listening on 0.0.0.0:8000
